var BBB=BBB||{};
BBB.BBBStoreLocator=function(c){function q(){var a=!1,a=c("#storeLocatorOmnibarInput").attr("placeholder"),a=!c.trim(c("#storeLocatorOmnibarInput").val())||a==c("#storeLocatorOmnibarInput").val()?!1:!0;b.debug("origin",b.settings.origin);b.originIsSet()&&(a=!0);a?(c("#storeLocatorOmnibarInputWarning").hide(),c("#storeLocatorOmnibarInput").css("border","2px solid #ccc")):(c("#storeLocatorOmnibarInputWarning").show(),c("#storeLocatorOmnibarInput").css("border","2px solid red"));return a}var b=this,
r={startLat:40.718954,startLong:-74.329795,origin:"",key:"Gmjtd%7Clu6120u8nh%2C2w%3Do5-lwt2l",tableName:"mqap.34703_AllInfo",searchURL:"//www.mapquestapi.com/search/v2/search",radiusSearchURL:"//www.mapquestapi.com/search/v2/radius",radius:50,maxMatches:20,conceptID:"",favoriteStoreID:"",enableFavoriteStores:!0,preloadStoresBasedOnFavorite:!0,debug:!1,useAlerts:!1,runSearchOnLoad:!1,favoriteStoreLink:"",imgBasePath:"/_assets/global/images/storeLocator/",usePrintPage:!1,printPage:"/store/selfservice/store/p2p_directions_print2.jsp",
useScrollShadows:!0},n,p=null!=navigator.userAgent.match(/iPad/i);this.debug=function(a){if(!b.settings.debug)return!1;window.console&&window.console&&window.console.log&&window.console.log(arguments)};this.init=function(a){var e,d,f,g="",h=[];b.settings=c.extend({},r,a);b.bindEventHandlers();hostedData=b.settings.tableName;c.browser.msie&&8>=parseInt(c.browser.version,10)&&c("#storeLocatorUseMyLocationContainer").hide();c("#storeLocatorRadiusInput").val(b.settings.radius);b.settings.favoriteStoreLink=
c("#storeLocatorHiddenLink").attr("href");g+=' ("display_online" = ?) ';h.push("Y");0<b.settings.conceptID.length&&("BedBathUS"===b.settings.conceptID?b.settings.conceptID="10":"BuyBuyBaby"===b.settings.conceptID?b.settings.conceptID="40":"BedBathCanada"===b.settings.conceptID&&(b.settings.conceptID="50"),c.isNumeric(b.settings.conceptID)&&(setDefaultConcept(b.settings.conceptID),g+=' and "store_type" = ?',h.push(b.settings.conceptID)));b.settings.runSearchOnLoad&&0<b.settings.origin.length&&(f={origin:b.settings.origin,
hostedDataList:[{extraCriteria:g,parameters:h}]},runAjaxSearch(f).done(function(a){loadMapPoints(a)&&(b.searchData=a,makeMapVisible(),initMap({origin:e,radius:d}),removeMapRoute(),hideGetDirectionsForm())}));c.isNumeric(b.settings.favoriteStoreID)&&b.settings.enableFavoriteStores&&b.loadStore(b.settings.favoriteStoreID).done(function(a){b.debug("load store data returned",a);0<a.resultsCount&&"object"===typeof a.searchResults[0]&&(b.favoriteStore=a.searchResults[0],b.debug("self.favoriteStore ",b.favoriteStore),
b.settings.preloadStoresBasedOnFavorite&&(e={latLng:{lat:b.favoriteStore.shapePoints[0],lng:b.favoriteStore.shapePoints[1]}},d=b.settings.radius,b.settings.origin=e,f={origin:e,hostedDataList:[{extraCriteria:g,parameters:h}],options:{radius:d}},runAjaxSearch(f).done(function(a){loadMapPoints(a)&&(b.searchData=a,makeMapVisible(),initMap({origin:e,radius:d}),removeMapRoute(),hideGetDirectionsForm())})))})};this.getMap=function(){return b.map};this.initMap=function(a,c,d){"undefined"===typeof b.map&&
(b.loadMap(a,c),b.loadModules(d));return b.map};this.makeMapVisible=function(){c("#storeLocatorResults").show();c("#storeLocatorResultsMsg").show();c("#storeLocatorInfo").show()};this.hideGetDirectionsForm=function(){c("#storeLocatorDirections").fadeOut();c("#storeLocatorTurnByTurnDirections").empty()};this.setDefaultConcept=function(a){var b,d,f;f=c("#storeLocatorStoreConceptsContainer");switch(a){case "10":b=c("#storeLocatorStoreConceptBBBY");d=c('label[for="storeLocatorStoreConceptBBBY"]');break;
case "20":b=c("#storeLocatorStoreConceptCTS");d=c('label[for="storeLocatorStoreConceptCTS"]');break;case "30":b=c("#storeLocatorStoreConceptHarmon");d=c('label[for="storeLocatorStoreConceptHarmon"]');break;case "40":b=c("#storeLocatorStoreConceptBaby"),d=c('label[for="storeLocatorStoreConceptBaby"]')}"undefined"!==typeof b&&0!==b.length&&(b.detach(),d.detach(),b.prop("checked","checked"),f.prepend(d),f.prepend(b))};this.showSingleStore=function(a){var e;b.loadStore(a).done(function(a){b.debug("load store data returned",
a);0<a.resultsCount&&"object"===typeof a.searchResults[0]&&(e=a.searchResults[0],b.debug("currentStore",e),b.searchData=a,b.settings.origin={latLng:{lat:e.shapePoints[0],lng:e.shapePoints[1]}},makeMapVisible(),initMap({origin:b.settings.origin}),b.loadMapPoints(a),b.map.setZoomLevel(12),b.removeMapRoute(),c("#storeLocatorTurnByTurnDirections").empty(),b.showGetDirectionsForm(1))})};this.showPoiInfoWindow=function(a){b.debug("poi.infoWindow",a.infoWindow);"undefined"===typeof a.infoWindow?(a.toggleInfoWindow(),
b.debug("we toggled the info window")):a.infoWindow.visible||(b.debug("we toggled the info window"),a.toggleInfoWindow())};this.showGetDirectionsForm=function(a){c("#top-shadow").hide();c("#bottom-shadow").hide();c("#storeLocatorDirections").fadeIn();var e=b.map.getShapeCollection("searchResultsPois").getByKey(a);c("#storeLocatorDirectionsSearchingOnPoiKey").val(a);a=b.searchData.searchResults[a-1];storeConceptName(a.fields.store_type);var d=a.fields.address+", "+a.fields.city+", "+a.fields.state+
" "+a.fields.postal;c("#storeLocatorDirectionsOmniEndInput").val(d);c("#storeLocatorPrintAddressesDestination").html("<h3>Destination</h3><h6>"+a.name+"</h6>"+a.fields.address+"<br />"+a.fields.city+","+a.fields.state+" "+a.fields.postal);c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsStartingLat").val(a.shapePoints[0]);c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsStartingLng").val(a.shapePoints[1]);b.showPoiInfoWindow(e)};this.storeConceptName=function(a){switch(a.toString()){case "10":return"Bed Bath & Beyond";
case "20":return"Christmas Tree Shops";case "30":return"Harmon Face Values";case "40":return"Buybuy Baby";case "50":return"BBBY Canada"}};this.storeConceptIconColor=function(a){switch(a.toString()){case "10":return"poi-bbby-";case "20":return"poi-harmon-";case "30":return"poi-harmon-";case "40":return"poi-baby-";case "50":return"poi-bbby-"}};this.formatStoreHours=function(a){a=a.replace(/,/g,"<br />");a=a.replace("Monday-Friday","M-F");a=a.replace("Monday","Mon");a=a.replace("Tuesday","Tues");a=a.replace("Wednesday",
"Wed");a=a.replace("Thursday","Thurs");a=a.replace("Friday","Fri");a=a.replace("Saturday","Sat");return a=a.replace("Sunday","Sun")};this.removeMapRoute=function(){"function"===typeof this.map.removeRoute&&this.map.removeRoute()};this.loadStore=function(a){return runAjaxSearch({origin:"",hostedDataList:[{extraCriteria:'"RecordId" = ?',parameters:[a]}],options:{radius:2999},searchURL:"//www.mapquestapi.com/search/v2/recordinfo"})};this.loadMapPoints=function(a){var e=new MQA.ShapeCollection,d="",f,
g;f=g="";var h=0,l=[];b.map.removeShapeCollection("searchResultsPois");e.collectionName="searchResultsPois";this.debug("Data",a);if(a.collections){if(b.settings.useAlerts)if(d="Please select your preferred location:",c.each(a.collections[0],function(a,b){"US"==b.adminArea1&&(1<b.adminArea5.length&&1<b.adminArea4.length&&1<b.adminArea3.length)&&(h++,l.push(b),d+='<div class ="ambiguousResult clearfix">',d+='<div class ="ambiguousLocation">',d+=b.adminArea5,d+=", "+b.adminArea4,d+=", "+b.adminArea3,
d+="</div>",d+='<div class="button button_active"> <a href="javascript:void(0)" class="resolveAmbiguous" data-lat="'+b.latLng.lat+'" data-lng="'+b.latLng.lng+'" >use this location</a></div>',d+="</div>")}),1<h)BBB.modalDialog.openDialog({wrapperSetting:{type:"html",showPreloader:!0,modalContentHTML:d},uiDialiogSettings:{width:500,maxHeight:c(window).height()-200,title:"We found "+h+' areas listed as "'+c.trim(c("#storeLocatorOmnibarInput").val())+'"',close:function(a,b){c(this).dialog("destroy").remove()},
dialogClass:"modalWindow "}});else{if(1==h){a=l[0];a={latLng:{lat:a.latLng.lat,lng:a.latLng.lng}};b.settings.origin=a;c("#storeLocatorOmnibarInput").val("");c("#storeLocatorSearchForm").trigger("submit");return}0==h&&(d="To help refine your search, please enter a zip code and expand your search area. For additional assistance, call 1.800.GO.BEYOND and select option 1.",BBB.modalDialog.openDialog({wrapperSetting:{type:"html",showPreloader:!0,modalContentHTML:d},uiDialiogSettings:{width:500,title:"No stores found",close:function(a,b){c(this).dialog("destroy").remove()},
dialogClass:"modalWindow "}}))}return!1}if(0===a.resultsCount)d="To help refine your search, please enter a zip code and expand your search area. For additional assistance, call 1.800.GO.BEYOND and select option 1.",BBB.modalDialog.openDialog({wrapperSetting:{type:"html",showPreloader:!0,modalContentHTML:d},uiDialiogSettings:{width:500,title:"No stores found",close:function(a,b){c(this).dialog("destroy").remove()},dialogClass:"modalWindow "}});else{c("#storeLocatorOmnibarInput")[0]&&0<c("#storeLocatorOmnibarInput").val().length?
c("#storeLocatorResultsMsg").html(a.resultsCount+(1==a.resultsCount?" store was":" stores were")+' found near "'+c("#storeLocatorOmnibarInput").val()+'" based on your criteria '):c("#storeLocatorResultsMsg").html(a.resultsCount+" stores were found near your location");for(i=0;i<a.searchResults.length;i++)f=new MQA.Poi({lat:a.searchResults[i].shapePoints[0],lng:a.searchResults[i].shapePoints[1]}),g=new MQA.Icon(b.settings.imgBasePath+storeConceptIconColor(a.searchResults[i].fields.store_type)+(i+1)+
".png",24,33),f.setIcon(g),f.setShadow(!1),g='<div class="infowindow" style="width: 200px; font: bold 14px Helvetica, Arial, sans-serif;">'+storeConceptName(a.searchResults[i].fields.store_type)+"<br />"+a.searchResults[i].name+"</div>"+a.searchResults[i].fields.address+"<br />"+a.searchResults[i].fields.city+", "+a.searchResults[i].fields.state+" "+a.searchResults[i].fields.postal+'<br /><a href="javascript:showGetDirectionsForm('+(i+1)+')" class="storeLocatorLocationItemGetDirectionsLink" data-poi-index="'+
(i+1)+'">Get Directions</a>',f.setRolloverContent(g),f.setInfoContentHTML(g),f.key=i+1,e.add(f),f='<div class="storeLocatorLocationSpecialtyItems">',a.searchResults[i].fields.FTG&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_ftg26.png" />'),a.searchResults[i].fields.HD&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_hd26.png" />'),a.searchResults[i].fields.HBC&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_hbc26.png" />'),a.searchResults[i].fields.WM&&(f+='<img src="'+b.settings.imgBasePath+
'storeLocator_wm26.png" />'),a.searchResults[i].fields.STUDIO&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_photo26.png" />'),"1"==a.searchResults[i].fields.BW&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_wb26.png" />'),"1"==a.searchResults[i].fields.VERDI&&(f+='<img src="'+b.settings.imgBasePath+'storeLocator_babystroller26.png" />'),f+="</div>",d+='<div class="storeLocatorLocationItem" data-poi-index="'+(i+1)+'"><h6><span class="storeLocatorLocationItemCounter">'+a.searchResults[i].resultNumber+
". </span>"+a.searchResults[i].name+'</h6><span class="storeLocatorLocationItemDistance">('+a.searchResults[i].distance+" mi)</span><address>"+a.searchResults[i].fields.address+"<br />"+a.searchResults[i].fields.city+", "+a.searchResults[i].fields.state+" "+a.searchResults[i].fields.postal+"<br />"+a.searchResults[i].fields.Phone+"<br /></address>",b.settings.enableFavoriteStores&&(d=b.settings.favoriteStoreID==a.searchResults[i].fields.RecordId?d+' <div class="button button_secondary button_disabled"> <input type="button" value="My Store" /> </div> ':
d+(' <div class="button button_secondary"> <a href="'+b.settings.favoriteStoreLink.replace("dummyId",a.searchResults[i].fields.RecordId)+'" class="storeLocatorMakeFavoriteStoreButton">Make Favorite Store</a></div> ')),d+='<a href="javascript:showGetDirectionsForm('+(i+1)+')" class="storeLocatorLocationItemGetDirectionsLink" data-poi-index="'+(i+1)+'">Get Directions</a>',d+='<div class="storeLocatorLocationItemHours ">',a.searchResults[i].fields.SPECIAL_MSG&&(d+=a.searchResults[i].fields.SPECIAL_MSG+
"<br />"),d+=formatStoreHours(a.searchResults[i].fields.hours)+"</div>"+f+"</div>";b.map.addShapeCollection(e);b.map.bestFit();b.settings.useScrollShadows?(c("#top-shadow").remove(),c("#bottom-shadow").remove(),c("#storeLocatorAddressResults").before('<div id="top-shadow"></div>').html(d).after('<div id="bottom-shadow"></div>'),0==c("#storeLocatorAddressResults").scrollTop()&&c("#top-shadow").hide()):c("#storeLocatorAddressResults").html(d);return!0}};this.loadMap=function(a){"undefined"===typeof a&&
(a={});a=c.extend({elt:document.getElementById("storeLocatorMapResults"),zoom:9,mtype:"map",zoomOnDoubleClick:!0,origin:b.settings.origin,radius:b.settings.radius},a);b.debug("Load map options",a);b.map=new MQA.TileMap(a)};this.loadMapDirections=function(a,c,d){b.map.removeShapeCollection("searchResultsPois");MQA.withModule("directions",function(){b.map.addRoute([a,c],{routeOptions:d},displayDirectionsResults)});b.map.bestFit()};this.displayDirectionsResults=function(a){b.debug("directions data",
a);b.routeData=a;if(0<a.info.messages.length)b.settings.useAlerts&&alert(a.info.messages[0]);else{var e=a.route.locations[0],d=a.route.locations[1],f,g,h,l,m=b.map.getShapeCollectionNames();for(f=0;f<m.length;f++)-1!==m[f].indexOf("route")&&(g=b.map.getShapeCollection(m[f]),b.debug(g),g.items[1]&&g.items[2]&&(h=g.items[1],g=g.items[2],l=new MQA.Icon(b.settings.imgBasePath+storeConceptIconColor(b.settings.conceptID)+"a.png",24,33),h.setIcon(l),h.setIconOffset({x:-13,y:-30}),h=new MQA.Icon(b.settings.imgBasePath+
storeConceptIconColor(b.settings.conceptID)+"b.png",24,33),g.setIcon(h),g.setIconOffset({x:-13,y:-30})));c("#storeLocatorTurnByTurnRouteInfo").html(a.route.distance+" miles | Trip Time: "+a.route.formattedTime);c("#storeLocatorTurnByTurnRouteInfo").append(b.printDirectionsLink(a));displayTurns(a);c("#storeLocatorPrintAddressesOrigin").html("<h3>Starting Point</h3>"+e.street+"<br />"+e.adminArea5+", "+e.adminArea3+" "+e.postalCode);c("#storeLocatorPrintAddressesDestination").html("<h3>Directions To</h3>"+
d.street+"<br />"+d.adminArea5+", "+d.adminArea3+" "+d.postalCode).trigger("storeLocator.directionsLoaded")}};this.printDirectionsLink=function(a){var e;return b.settings.usePrintPage?(e=a.route.locations[0],a=c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsOmniEndInput").val(),e=e.street+" "+e.adminArea5+","+e.adminArea3+" "+e.postalCode,a=b.settings.printPage+"?origin="+encodeURIComponent(e)+"&destination="+encodeURIComponent(a),c('<a href="'+a+'" class="print" title="Print" target="_blank"></a>')):
c('<a href="javascript:window.print()" class="print" title="Print"></a>')};this.displayTurns=function(a){this.debug(a);this.debug("routeType",a.route.options.routeType);if(a.route){a=a.route.legs;var e,d=0,f=0,g;for(e="<table><tbody>";d<a.length;d++)for(f=0;f<a[d].maneuvers.length;f++){g=a[d].maneuvers[f];e+="<tr>";e+="<td>";b.debug(g);g.iconUrl&&(e+='<img src="'+b.customTurnIcon(g.turnType.toString(),g.iconUrl)+'" /> ');for(k=0;k<g.signs.length;k++){var h=g.signs[k];h&&h.url&&(e+='<img src="'+h.url+
'"> ')}e+="</td><td>"+g.narrative+"</td>";e+='<td class="printOnly storeLocatorMiles">'+g.distance+" mi</td>";e+="</tr>"}c("#storeLocatorTurnByTurnDirections").html(e+"</tbody></table>")}};this.customTurnIcon=function(a,c){var d=b.settings.imgBasePath,f="";switch(a){case "0":f="straight.png";break;case "1":f="slight_right.png";break;case "2":f="turn_right.png";break;case "3":f="sharp_right.png";break;case "5":f="sharp_left.png";break;case "6":f="turn_left.png";break;case "7":f="slight_left.png";break;
case "8":f="uturn_right.png";break;case "9":f="uturn_left.png";break;case "10":f="merge_right.png";break;case "11":f="merge_left.png";break;case "12":case "13":f="ramp.png";break;case "14":f="exit_right.png";break;case "15":f="exit_left.png";break;default:return c}return d+f};this.getStaticMapUrl=function(){if(c.isEmptyObject(b.routeData))return"";var a;a="//www.mapquestapi.com/staticmap/v4/getmap?key="+b.settings.key;a=a+"&size=976,600"+("&stops=A,"+b.routeData.route.locations[0].latLng.lat+","+
b.routeData.route.locations[0].latLng.lng+",0,0|");a+="B,"+b.routeData.route.locations[1].latLng.lat+","+b.routeData.route.locations[1].latLng.lng+",0,0|";return a+="&session="+b.routeData.route.sessionId};this.loadModules=function(a){MQA.withModule("largezoom","viewoptions","geolocationcontrol","directions",function(){b.map.addControl(new MQA.LargeZoom,new MQA.MapCornerPlacement(MQA.MapCorner.TOP_LEFT,new MQA.Size(5,5)));b.map.addControl(new MQA.ViewOptions);n=new MQA.GeolocationControl;b.geolocationControl=
n;n.onLocate=function(a,e){var g=e.coords;b.settings.origin={latLng:{lat:g.latitude,lng:g.longitude}};c("#storeLocatorOmnibarInput").val("");c("#storeLocatorSearchForm").trigger("submit");this.deactivate()};var a=b.map.addControl(n,new MQA.MapCornerPlacement(MQA.MapCorner.TOP_RIGHT,new MQA.Size(10,50)));b.debug(a)})};this.runAjaxSearch=function(a){var e=b.settings,d=e.radiusSearchURL;"undefined"===typeof a&&(a={});"undefined"!==typeof a.searchURL&&(d=a.searchURL);a=c.extend(!0,{origin:e.origin,hostedDataList:[{tableName:e.tableName,
extraCriteria:"",parameters:[],columnNames:[]}],options:{radius:e.radius,maxMatches:e.maxMatches}},a);b.debug("searchParams :",a);b.debug("hostedDataList parameters",a.hostedDataList[0].parameters);var f=a.hostedDataList[0].parameters;delete a.hostedDataList[0].parameters;var g="";0<f.length&&(g=',"parameters":['+('"'+f.join('","')+'"'),g+="]");b.debug("paramStr",g);e={key:decodeURIComponent(e.key),inFormat:"json",json:JSON.stringify(a).replace('"columnNames":[]','"columnNames":[]'+g)};b.debug("finalParameters",
e);return c.ajax({url:d,dataType:"jsonp",crossDomain:!0,data:e})};this.originIsSet=function(){return"object"===typeof b.settings.origin&&c.isNumeric(b.settings.origin.latLng.lat)||void 0!==b.settings.origin.length&&0<b.settings.origin.length?!0:!1};this.debugMapEvents=function(a){b.debug(a)};this.bindEventHandlers=function(){c("#storeLocatorUseMyLocationButton").click(function(){b.debug("got use my location click.");b.geolocationControl.activate();b.makeMapVisible()});c("#storeLocatorDirectionsRouteTypeRadioGroup").buttonset();
c("#storeLocatorDirectionsFastest").button({icons:{primary:"iconCar"},text:!1});c("#storeLocatorDirectionsTransit").button({icons:{primary:"iconBus"},text:!1});c("#storeLocatorDirectionsWalking").button({icons:{primary:"iconWalk"},text:!1});c("body").on("click",".storeLocatorLocationItemGetDirectionsLink",function(){c(this).data("poiIndex")});c("#storeLocatorDirectionsForm").on("submit",function(a){var b=!0;c.trim(c("#storeLocatorDirectionsOmniStartInput").val())?c("#storeLocatorDirectionsOmniStartInput").css("border",
"2px solid #ccc"):(b=!1,c("#storeLocatorDirectionsOmniStartInput").css("border","2px solid red"));c.trim(c("#storeLocatorDirectionsOmniEndInput").val())?c("#storeLocatorDirectionsOmniEndInput").css("border","2px solid #ccc"):(b=!1,c("#storeLocatorDirectionsOmniEndInput").css("border","2px solid red"));b?c("#storeLocatorDirectionsWarning").hide():c("#storeLocatorDirectionsWarning").show();if(!b)return!1;a.preventDefault();a={};var b={},d={},f=[];b.latLng={};b.latLng.lat=c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsStartingLat").val();
b.latLng.lng=c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsStartingLng").val();a=c("#storeLocatorDirectionsForm").find("#storeLocatorDirectionsOmniStartInput").val();c("#storeLocatorDirectionsForm").find("input:radio[name='routeType']:checked")[0]&&(d.routeType=c("#storeLocatorDirectionsForm").find("input:radio[name='routeType']:checked").val());c("#storeLocatorDirectionsAvoidSeasonalRoads").prop("checked")&&f.push("approximate seasonal closure");c("#storeLocatorDirectionsAvoidHighways").prop("checked")&&
f.push("limited access");c("#storeLocatorDirectionsAvoidTolls").prop("checked")&&f.push("toll road");d.avoids=f;d.timeType=1;loadMapDirections(a,b,d)});c("#storeLocatorDirectionsBackToReultsLink").click(function(a){a.preventDefault();b.debug("back to search results");b.debug(b.map.getShapeCollectionNames());b.removeMapRoute();b.loadMapPoints(b.searchData);c("#storeLocatorDirections").fadeOut();c("#storeLocatorTurnByTurnDirections").empty();c("#storeLocatorTurnByTurnRouteInfo").empty()});c("input.storeLocatorStoreConcept,input.storeLocatorSpecialtyDept,#storeLocatorRadiusInput").change(function(){"undefined"!==
typeof b.settings.origin&&c("#storeLocatorSearchForm").trigger("submit")});c("body").on("mouseenter",".storeLocatorLocationItem",function(){var a=c(this).data("poiIndex"),e=b.map.getShapeCollection("searchResultsPois");if(e&&(a=e.getByKey(a)))b.showPoiInfoWindow(a),p||c(this).siblings().stop().fadeTo(150,0.4)});c("#storeLocatorResults, #storeLocatorAddressResults").on("touchend",".storeLocatorLocationItem",function(){var a=c(this).data("poiIndex"),e=b.map.getShapeCollection("searchResultsPois");e&&
(a=e.getByKey(a))&&b.showPoiInfoWindow(a)});c("body").on("mouseleave",".storeLocatorLocationItem",function(){if(!p){var a=c(this).data("poiIndex"),e=b.map.getShapeCollection("searchResultsPois");e&&e.getByKey(a)&&c(this).siblings().stop().fadeTo(150,1)}});c("#storeLocatorAddressResults").scroll(function(){if(b.settings.useScrollShadows&&c("#storeLocatorAddressResults")[0]){var a=c("#storeLocatorAddressResults").get(0).scrollHeight-700,e=c(this).scrollTop();b.debug(c(this).scrollTop());b.debug(c("#storeLocatorAddressResults").get(0).scrollHeight);
0<e?c("#top-shadow").show():c("#top-shadow").hide();e<a?c("#bottom-shadow").show():c("#bottom-shadow").hide()}});c("#storeLocatorSearchForm").on("submit",function(a){var e=c("#storeLocatorSearchForm"),d="",f,g=[],h="",l=[];if(!1===q())return!1;d=!c.trim(c("#storeLocatorOmnibarInput").val())&&b.originIsSet?b.settings.origin:c.trim(c("#storeLocatorOmnibarInput").val());f=e.find("#storeLocatorRadiusInput").val();c.each(e.find("input:checkbox[name=storeLocatorStoreConcept]:checked"),function(){g.push(c(this).val())});
h+=' ("display_online" = ?) ';l.push("Y");if(0<g.length){var m="";c.each(g,function(a,b){m+=' "store_type" = ? or';l.push(b.toString())});h+=" and ("+m.replace(/or$/,"")+")"}c("#storeLocatorFTG").prop("checked")&&(h+=' and "FTG" = ? ',l.push("1"));c("#storeLocatorHBC").prop("checked")&&(h+=' and "HBC" = ? ',l.push("1"));c("#storeLocatorHD").prop("checked")&&(h+=' and "HD" = ? ',l.push("1"));c("#storeLocatorWM").prop("checked")&&(h+=' and "WM" = ? ',l.push("1"));c("#storeLocatorWB").prop("checked")&&
(h+=' and "BW" = ? ',l.push("1"));c("#storeLocatorPhoto").prop("checked")&&(h+=' and "STUDIO" = ? ',l.push("1"));c("#storeLocatorBaby").prop("checked")&&(h+=' and "VERDI" = ? ',l.push("1"));e={origin:d,hostedDataList:[{extraCriteria:h,parameters:l}],options:{radius:f}};b.debug("sending search params",e);runAjaxSearch(e).done(function(a){loadMapPoints(a)&&(b.searchData=a,b.settings.origin=d,makeMapVisible(),initMap({origin:d,radius:f}),removeMapRoute(),hideGetDirectionsForm(),"function"===typeof rkg_micropixel&&
rkg_micropixel(BBB.currentSiteName,"storeloc"))});a.preventDefault()});c("body").on("click",".resolveAmbiguous",function(){var a=c(this).data("lat"),e=c(this).data("lng");b.settings.origin={latLng:{lat:a,lng:e}};c(".ui-dialog-content").dialog("close");c("#storeLocatorOmnibarInput").val("");c("#storeLocatorSearchForm").trigger("submit")})};this.mqaMissing=function(){"undefined"!==typeof window.console&&"undefined"!==typeof window.console.log&&(window.console.log("ERROR!!!! MQA lib missing"),window.console.log(arguments));
return!1};if("undefined"!==typeof MQA)return{init:init,initMap:initMap,getMap:getMap,bindEventHandlers:bindEventHandlers,showSingleStore:showSingleStore,loadMapDirections:loadMapDirections,getStaticMapUrl:getStaticMapUrl};c("#storeLocatorSearchForm")[0]?(c("#storeLocatorSearchForm").find(":input").attr("disabled","disabled"),BBB.fn.addOverlay("#storeLocatorSearchForm",{showLoaderImage:!1,useOuterHeight:!0,useOuterWidth:!0,zIndex:200,overlayText:'<span class="error" style="font-size:20px;">'+BBB.fn.getString("somethingWentWrong")+
"</span>",useWhite:!0})):c(".collegeSearchResults")[0]&&c(".collegeSearchResults").hide().filter(":last").after('<div class="grid_12 clearfix marTop_20"><p class="error">'+BBB.fn.getString("somethingWentWrong")+"</p></div>");return{init:mqaMissing,initMap:mqaMissing,getMap:mqaMissing,bindEventHandlers:mqaMissing,showSingleStore:mqaMissing,loadMapDirections:mqaMissing,getStaticMapUrl:mqaMissing}}(jQuery);
