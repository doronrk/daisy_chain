window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag._tagv="2.13.0";lpTag.cfg={retry:{count:0,max:3,timeout:1e3},scriptPrefix:"_lpTagScriptId_",count:0};lpTag.log=function(msg,type,app){lpTag._logcnt=lpTag._logcnt||0;"undefined"!=typeof lpMTagDebug&&"function"==typeof lpMTagDebug.Display&&lpMTagDebug.Display(msg,type,app,lpTag._logcnt);if("undefined"!=typeof lpTaglogListeners)for(var i=0;i<lpTaglogListeners.length;i++)try{lpTaglogListeners[i](msg,type,app,lpTag._logcnt)}catch(e){"undefined"!=typeof lpMTagDebug&&"function"==typeof lpMTagDebug.Display&&lpMTagDebug.Display("Exception="+e+" msg="+msg,type,app,lpTag._logcnt)}lpTag._logcnt++};lpTag.csds=function(){function setDomains(_srvMap){for(var i=0;i<_srvMap.length;i++)srvMap[_srvMap[i].service]=_srvMap[i].baseURI}function getDomain(srv){var baseURI=srvMap[srv];return baseURI?baseURI:srvMap.ALL}function getCSDSMap(){return srvMap}var srvMap=[];return{getDomain:getDomain,setDomains:setDomains,getCSDSMap:getCSDSMap}}();lpTag.getDomain=lpTag.csds.getDomain;lpTag.events=function(){function bind(app,ev,fn){if(!app||!ev||"function"!=typeof fn){lpTag.log("bind invalid params:  app=["+app+"] ev=["+ev+"]  fn=["+fn+"]","ERROR","EVENTS");return null}var evId=eventId++;lstnrs[prefix+evId]={id:evId,name:ev,app:app,fn:fn};lpTag.log("ev: "+ev+",  app: "+(app||"*")+"bind","DEBUG","EVENTS");return evId}function unbind(id){if(!id){lpTag.log("Ev listen id not spec for unbind","ERROR","EVENTS");return null}var ev=lstnrs[prefix+id];if("undefined"==typeof ev){lpTag.log("Ev listen id not Found for unbind id="+id,"ERROR","EVENTS");return!1}delete lstnrs[prefix+id];lpTag.log("Ev listen id="+id+" unbind","DEBUG","EVENTS");return!0}function hasFired(app,evName){if("*"==app&&"*"==evName)return fired;for(var ret=[],n=0;n<fired.length;n++)"*"!=app&&fired[n].app!=app||"*"!=evName&&fired[n].evName!=evName||ret.push(fired[n]);return ret}function trigger(app,evName,data){if("undefined"!=typeof evName&&"undefined"!=typeof app){if("LPT"==app&&"DOM_READY"==evName){if(lpt_domReady_hasTriggered)return;lpt_domReady_hasTriggered=!0}if("undefined"!=typeof lpTag._deferExecuted){fired.push({app:app,evName:evName,data:data});for(var n in lstnrs){var l=lstnrs[n];if(!(l.name!=evName&&"*"!=l.name||"*"!=l.app&&l.app!=app))try{var ev={app:app,name:evName};l.fn(data,ev);lpTag.log("app="+app+" ev="+evName+" triggered","DEBUG","EVENTS")}catch(err){lpTag.log("Error triggering  "+evName,"DEBUG","EVENTS")}}}else lpTag.defer(function(){lpTag.events.trigger(app,evName,data)},1)}else lpTag.log("Ev name or app not spec for trigger","ERROR","EVENTS")}var eventId=0,lstnrs={},fired=[],prefix="evId_",lpt_domReady_hasTriggered=!1;return{bind:bind,unbind:unbind,hasFired:hasFired,trigger:trigger}}();lpTag.tglMng=function(){function run(taglets){_createTaglets(taglets);try{taglets=_sortIncludes(taglets)}catch(e){lpTag.log("Exception in _manageIncludes:"+e,"ERROR","LPTAG")}_initTaglets(taglets);_execDefers();lpTag.events.trigger("LPTAG","ON_READY");_startTaglets(taglets);lpTag.events.trigger("LPTAG","ON_STARTED")}function _sortIncludes(taglets){for(var tgl_list=[],tgl_obj={},i=0;i<taglets.length;i++){var t=lpTag.taglets[taglets[i].name];"undefined"!=typeof t.includes&&"undefined"==typeof t.includes.length&&(t.includes=[t.includes]);tgl_obj[taglets[i].name]=lpTag.taglets[taglets[i].name].includes}for(var cnt=0,isNotEmpty=!0;isNotEmpty;){cnt++;isNotEmpty=!1;for(var name in tgl_obj){if("undefined"==typeof tgl_obj[name]||"undefined"!=typeof tgl_obj[name]&&0==tgl_obj[name].length){tgl_list.push(_getTaglet(taglets,name));delete tgl_obj[name];tgl_obj=_removeFromIncludes(tgl_obj,name)}isNotEmpty=!0}if(cnt>taglets.length+1){var msg="";try{for(var n in tgl_obj){msg+="# tgl=["+n+"] missing -> ";for(var i=0;i<tgl_obj[n].length;i++)msg+=" "+tgl_obj[n][i].name}}catch(e){lpTag.log("Exception in sortInclude:"+e,"ERROR","LPTAG")}lpTag.log("Missing/circular includes:"+msg,"ERROR","LPTAG");isNotEmpty=!1}}return tgl_list}function _getTaglet(tgls,name){for(var i=0;i<tgls.length;i++)if(tgls[i].name==name)return tgls[i];return void 0}function _removeFromIncludes(arr,name){for(var n in arr){var inc=arr[n];if("undefined"!=typeof inc){for(var tmp=[],i=0;i<inc.length;i++)inc[i].name!=name&&tmp.push(inc[i]);arr[n]=tmp}}return arr}function _createTaglets(taglets){for(var i=0;i<taglets.length;i++)try{lpTag.log("Processing taglet: "+taglets[i].name,"DEBUG","LPTAG");eval(taglets[i].code)}catch(e){lpTag.log("Error creating taglet:"+taglets[i].name+"  e="+e,"ERROR","LPTAG")}}function _initTaglets(taglets){for(var i=0;i<taglets.length;i++){var tgl=lpTag.taglets[taglets[i].name];try{lpTag.log("Init taglet: "+taglets[i].name,"DEBUG","LPTAG");tgl.init(taglets[i].parameters)}catch(e){lpTag.log("Error init taglet:"+taglets[i].name+"  e="+e,"ERROR","LPTAG")}}}function _execDefers(){lpTag._deferExecuted=!0;lpTag.defer=function(fn){try{fn()}catch(e){lpTag.log("Error executing defer fn:"+e,"ERROR","LPTAG")}};_execDeferArr(lpTag._defB);_execDeferArr(lpTag._defT);_execDeferArr(lpTag._defL)}function _execDeferArr(_defArr){if("undefined"!=typeof _defArr){for(var i=0;i<_defArr.length;i++)try{_defArr[i]()}catch(e){lpTag.log("Error executing defer fn:"+e,"ERROR","LPTAG")}_defArr.length=0}}function _startTaglets(taglets){for(var i=0;i<taglets.length;i++){var tgl=lpTag.taglets[taglets[i].name];try{if("function"==typeof tgl.start){lpTag.log("Start taglet: "+taglets[i].name,"DEBUG","LPTAG");tgl.start()}lpTag.events.trigger("LPTAG","TAGLET_STARTED",{name:taglets[i].name})}catch(e){lpTag.log("Error start taglet :"+taglets[i].name+"e= "+e,"ERROR","LPTAG")}}}return{run:run}}();lpTag.device=function(){function family(){return deviceFamily}function os(){return deviceOS}function osName(){return osTypeString[deviceOS]}function familyName(){return familyTypeString[deviceFamily]}function _getDeviceFamily(){var deviceFamily=familyType.desktop;mobileAgent&&!tabletAgent?deviceFamily=familyType.mobile:(tabletAgent||android)&&(deviceFamily=familyType.tablet);return deviceFamily}function _getDeviceOS(){var deviceOS=osType.windows;macOSX&&!mobileAgent?deviceOS=osType.mac:android?deviceOS=osType.android:iOS?deviceOS=osType.iOS:linux&&(deviceOS=osType.linux);return deviceOS}function _cloneEnum(obj){var resObj={};for(var key in obj)resObj[key]=obj[key];return resObj}var familyType={desktop:0,tablet:1,mobile:2},familyTypeString=["Desktop","Tablet","Mobile"],osType={windows:0,mac:1,linux:2,iOS:3,android:4},osTypeString=["Windows","Mac OSX","Linux","iOS","Android"],userAgent=navigator.userAgent,mobileAgent=userAgent.match(/(Windows Phone|iPhone|iPod|mobile|Mobile|IEMobile)/g)?!0:!1,tabletAgent=userAgent.match(/(Tablet PC|iPad|Tablet|tablet)/g)?!0:!1,macOSX=userAgent.match(/(Mac OS)/g)?!0:!1,linux=userAgent.match(/(Linux)/g)?!0:!1,iOS=userAgent.match(/(iPhone|iPod|iPad)/g)?!0:!1,android=userAgent.match(/(android|Android)/g)?!0:!1,deviceFamily=_getDeviceFamily(),deviceOS=_getDeviceOS();return{os:os,osEnum:_cloneEnum(osType),osName:osName,family:family,familyEnum:_cloneEnum(familyType),familyName:familyName}}();lpTag.start=function(){lpTag.load(lpTag.protocol+"//"+(lpTag.ovr&&lpTag.ovr.tagjs?lpTag.ovr.tagjs:"tags.liveperson.net")+"/lptag/api/account/"+lpTag.site+"/configuration/applications/taglets/.jsonp"+(lpTag.section?"?s="+lpTag.section:""),"UTF-8",lpTag.cfg.scriptPrefix+lpTag.cfg.count);lpTag.cfg.count++};lpTag.retries=0;lpTag.callback=function(response){function removeScript(scriptId){for(var scriptTag;scriptTag=document.getElementById(scriptId);)try{scriptTag.parentNode.removeChild(scriptTag);for(var key in scriptTag)scriptTag.hasOwnProperty(key)&&delete scriptTag[key]}catch(exc){lpTag.log("error removing script: "+scriptId,"ERROR","LPTAG")}}try{var retry=lpTag.cfg.retry;if(response.retry){var prevCount=lpTag.cfg.count-1;removeScript(lpTag.cfg.scriptPrefix+prevCount);isNaN(response.retry.maxRetries)||(retry.max=parseInt(response.retry.maxRetries));isNaN(response.retry.timeout)||(retry.timeout=parseInt(response.retry.timeout));if(retry.count<retry.max){lpTag.log("retrying count="+retry.count+" max="+retry.max,"DEBUG","LPTAG");retry.count++;var that=this;setTimeout(function(){that.start()},retry.timeout)}else lpTag.log("exceeded max retries: "+retry.max+", stopping","ERROR","LPTAG")}else{retry.count=0;lpTag.csds.setDomains(response.serviceMap);lpTag.tglMng.run(response.taglets)}}catch(e){lpTag.log("callback has failed "+e,"ERROR","LPTAG")}};lpTag.run=function(){"undefined"!=typeof window._lptTagStop||"undefined"!=typeof lpTag.autoStart&&!lpTag.autoStart||lpTag.start()};lpTag.run();