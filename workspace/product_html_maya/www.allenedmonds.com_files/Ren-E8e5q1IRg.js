/* Script imported from http://www.allenedmonds.com/wcsstore/AllenEdmonds/javascript/CatalogArea/customProductDetail.js */
function getLiveChatStaticButton(divId){var propName,lpStaticBut,result=null;if(!window.lpMTagStatic){return result;}for(propName in window.lpMTagStatic){if(propName.indexOf("lpStaticBut")>-1){lpStaticBut=window.lpMTagStatic[propName];if(lpStaticBut.divID==divId){result=lpStaticBut;return result;}}}return result;}var CUST_LIVECHAT_BUTTON_ID="lpButDivID-1314816095562";function customLiveChatOn(){console.info(">>> customLiveChatOn");var lctl=dojo.query("a",CUST_LIVECHAT_BUTTON_ID);if(lctl&&lctl.length>0){var lct=lctl[0];var cust_livechat_link=dojo.byId("cust_livechat_link");cust_livechat_link.title=lct.title;cust_livechat_link.onclick=lct.onclick;}dojo.addClass("custhelp_livechat","cust_livechaton");}function customLiveChatOff(){console.info(">>> customLiveChatOff");dojo.removeClass("custhelp_livechat","cust_livechaton");}(function(window){var displayOneOfManySwatchGroup,customShoeData=null,customProduct={},selectOneOfManySwatches=new SelectOneOfMany(function(swatch){var swatchId=swatch.id;if(swatchId){var swatchIdArray=swatchId.split("-");if(swatchIdArray.length==3){var compName=swatchIdArray[1].replace("_"," ");var sku=swatchIdArray[2];changeSwatchTitle(compName,sku);}}dojo.addClass(swatch,"ci-swatch-selected");dojo.addClass(swatch.parentNode,"ci-swatch-selected");},function(swatch){dojo.removeClass(swatch,"ci-swatch-selected");dojo.removeClass(swatch.parentNode,"ci-swatch-selected");});customProduct.switchToCustomDesign=function(partNumber){if(customShoeData===null){dojo.addClass("productpage","custom-product-loading");getCustomShoeJSON(partNumber);}else{switchToCustomDesignAfterDataLoad();}};customProduct.populateCustomView=populateCustomView;function uCaseFirstChar(text){if(text.length==1){return text.toUpperCase();}return text.charAt(0).toUpperCase()+text.substr(1);}function t(text){return document.createTextNode(text);}function indexOfInArray(ary,item){for(var i=0;i<ary.length;i++){if(ary[i]==item){return i;}}return -1;}function objectHasProperties(obj){for(var prop in obj){if(obj.hasOwnProperty(prop)){return true;}}return false;}function createEl(name,attrs){var el=document.createElement(name);if(attrs){for(var attrName in attrs){if(attrs.hasOwnProperty(attrName)){dojo.attr(el,attrName,attrs[attrName]);}}}for(var i=2;i<arguments.length;i++){var childValue=arguments[i];if(typeof childValue==="string"){el.appendChild(document.createTextNode(childValue));}else{if(typeof arguments[i]!=="undefined"){el.appendChild(arguments[i]);}else{console.error("undefinded arguments for element creation of "+name);}}}return el;}var e=createEl;function SelectOneOfMany(selectFunction,deselectFunction){var selectFunc,deselectFunc,lastSelectedArgs=null;if(!(this instanceof SelectOneOfMany)){return new SelectOneOfMany();}selectFunc=selectFunction;deselectFunc=deselectFunction;this.select=function(){if(lastSelectedArgs!==null){deselectFunc.apply(this,lastSelectedArgs);}lastSelectedArgs=arguments;selectFunc.apply(this,arguments);};this.deselect=function(){deselectFunc.apply(this,arguments);};}function selectMediumSwatch(compName,sku){var comp,color,img;comp=customShoeData.componentMap[compName];if(comp){color=comp.colorMap[sku];if(color){img=dojo.byId("ci-swatch-med-img-"+compName.replace(" ","_"));dojo.attr(img,"src",color.swatchM);}}}function getColorName(compName,sku){var comp=customShoeData.componentMap[compName];if(!comp){return"";}var color=comp.colorMap[sku];if(!color){return"";}return color.name;}function changeSwatchTitle(compName,sku){if(!compName){return;}var colorName=getColorName(compName,sku);var swatchTitle=dojo.byId(compName.replace(" ","_")+"SwatchLabelColor");if(swatchTitle&&colorName){setTextContent(swatchTitle,colorName);}}function DisplayOneOfManyNameElement(elements){var elementObj=elements;for(var propName in elementObj){if(elementObj.hasOwnProperty(propName)){dojo.style(elementObj[propName],"display","none");}}return new SelectOneOfMany(function(propName){var selectedComp,swatch,currentShown=elementObj[propName.replace("_"," ")],nameNU=propName.replace("_"," ");selectedComp=customShoeData.currentSelection.getComponentByName(nameNU);if(selectedComp){swatch=dojo.byId("ciswatch-"+propName+"-"+selectedComp.sku);if(swatch){selectOneOfManySwatches.select(swatch);}selectMediumSwatch(nameNU,selectedComp.sku);}dojo.style(currentShown,"display","block");},function(element){var comp=(typeof element==="string")?element.replace("_"," "):element;dojo.style(elementObj[comp],"display","none");});}var handleCustomShoeResponseAfterLoad;function getCustomShoeJSON(partNumber,callback){var parameters={};handleCustomShoeResponseAfterLoad=callback;parameters.langId=langId;parameters.storeId=storeId;parameters.catalogId=catalogId;parameters.partNumber=partNumber;dojo.publish("ajaxRequestInitiated");dojo.xhrGet({url:getAbsoluteURL()+"CustomProductInfoViewJSON",handleAs:"json",content:parameters,service:this,load:handleCustomShoeResponse,error:function(errObj,ioArgs){console.debug("error - inside getCustomShoeJSON");console.debug(errObj);dojo.publish("ajaxRequestCompleted");}});}function NameValue(name,value){this.name=name;this.value=value;}function UrlHelper(pathname,params){if(!(this instanceof UrlHelper)){return new UrlHelper(pathname,params);}this.pathname=pathname;this.params=params;}UrlHelper.prototype={toString:function(){var isFirstParam=true;var result=this.pathname;for(var i=0;i<this.params.length;i++){var param=this.params[i];if(isFirstParam){result+="?";isFirstParam=false;}else{result+="&";}result+=param.name+"="+param.value;}return result;},addParams:function(){var length=arguments.length;if(!this.params){this.params=[];}for(var i=0;i<length;i+=2){if(i+1<length){this.params.push(new NameValue(arguments[i],arguments[i+1]));}}},encode:function(){return encodeURIComponent(this.toString());}};function getSizeAndWidthDescriptionString(ls,rs,lw,rw){function padSize(value){if(value.length==2){value=(value.charAt(1)=="5")?"0"+value:value+"0";}else{if(value.length==1){value="00"+value;}}return value;}return"LS"+padSize(ls)+"RS"+padSize(rs)+"LW"+lw+"RW"+rw;}customProduct.addCustomToWishlistOnClick=function(evt){if(!customAttributeValidation()){return false;}var sizes=customShoeData.currentSelection.sizes;var quantity=dojo.byId("quantitySelect");if(quantity){quantity=quantity.value;}var rightSize=sizes.isDiff?sizes.size.right:sizes.size.left;var rightWidth=sizes.isDiff?sizes.width.right:sizes.width.left;var sizeWidthDescription=getSizeAndWidthDescriptionString(sizes.size.left,rightSize,sizes.width.left,rightWidth);var ajaxLogonForm=new UrlHelper("AjaxLogonForm");ajaxLogonForm.addParams("page","customerlinkwishlist");var interestItemAdd=new UrlHelper("InterestItemAdd");interestItemAdd.addParams("storeId",storeId,"catalogId",catalogId,"langId",langId,"quantity_2",quantity,"description",sizeWidthDescription,"calculationUsageId",-1,"URL",ajaxLogonForm.toString());var kitAddUrl=new UrlHelper(getAbsoluteURL()+"DynamicKitConfigurationAdd");kitAddUrl.addParams("storeId",storeId,"catalogId",catalogId,"langId",langId,"catEntryId",customShoeData.catEntryId,"selectLeftSize",sizes.size.left,"selectRightSize",rightSize,"selectLeftWidth",sizes.width.left,"selectRightWidth",rightWidth);for(var i=0;i<customShoeData.currentSelection.components.length;i++){var component=customShoeData.currentSelection.components[i];kitAddUrl.addParams("componentId",component.sku,"quantity",1);}kitAddUrl.addParams("URL",interestItemAdd.encode());var targetElement=getTarget(getEvent(evt));targetElement.href=kitAddUrl.toString();return true;};function selectComponentSku(componentName,sku){customShoeData.currentSelection.setSku(componentName,sku);populateCustomView();}var imageData=[];var imageDataSize={width:550,height:351};function populateImageData(canvasWidth,canvasHeight){var tempCanvas=e("canvas",{width:canvasWidth,height:canvasHeight});if(typeof tempCanvas.getContext==="undefined"){tempCanvas=null;return;}for(var i=0;i<imageData.length;i++){if(imageData[i].img.height>0){tempCanvas=e("canvas",{width:canvasWidth,height:canvasHeight});var ctx=tempCanvas.getContext("2d");ctx.drawImage(imageData[i].img,imageData[i].x,imageData[i].y);imageData[i].data=ctx.getImageData(0,0,canvasWidth,canvasHeight);tempCanvas=null;}else{imageData[i].data=null;}}}customProduct.switchToNonCustomDesign=function(){afterSwitchToNonCustom();dojo.removeClass("productpage","custom-product");dojo.addClass("productpage","non-custom-product");};function switchToCustomDesignAfterDataLoad(){afterSwitchToCustom();}var customGroupAccordion={firstClick:true,duration:500};customGroupAccordion.click=function(headerEl){var groupList,imgDiv,className,isOpen;imgDiv=headerEl.childNodes[0];className=imgDiv.className;isOpen=(className.indexOf("open")>-1);if(isOpen){this.close(headerEl);this.setOpen(null);}else{if(this.openEl!=null){this.close(this.openEl);}this.open(headerEl);this.setOpen(headerEl);}};function openCustomGroupClick(){var result=dojo.query("#custom-component-group-list .custom-component-group-content");var content=result[0];dojo.fx.wipeOut({node:content}).play();}function closeCustomGroupClick(){var result=dojo.query("#custom-component-group-list .custom-component-group-content");var content=result[0];dojo.fx.wipeIn({node:content}).play();}customGroupAccordion.open=function(headerEl){var content=headerEl.nextSibling;var imgDiv=headerEl.childNodes[0];imgDiv.className="custom-component-group-icon ccgi-open";dojo.fx.wipeIn({node:content,duration:customGroupAccordion.duration}).play();};customGroupAccordion.close=function(headerEl,duration){var content=headerEl.nextSibling;var imgDiv=headerEl.childNodes[0];imgDiv.className="custom-component-group-icon ccgi-closed";var options={node:content};if(typeof duration!=="undefined"&&duration!=null){options.duration=duration;}else{options.duration=customGroupAccordion.duration;}dojo.fx.wipeOut(options).play();};customGroupAccordion.setOpen=function(headerEl){this.openEl=headerEl;};function customGroupClick(headerEl){console.info(headerEl.innerHTML);var imgDiv=headerEl.childNodes[0];var className=imgDiv.className;var isOpen=(className.indexOf("open")>-1);}customProduct.ccgcItemRadioClick=function(radio){if(radio.name=="component"){displayOneOfManySwatchGroup.select(radio.value);}};customProduct.customImageSwatchClick=function(event,componentName,sku,colorName){var len,components,color,swatch,swatchContainer,applyAllCheckBox,viewGroups=customShoeData.componentViewGroups,i=0;if(typeof event.target!="undefined"){swatch=event.target;}else{swatch=event.srcElement;}swatchContainer=swatch.parentNode.parentNode.parentNode;applyAllCheckBox=dojo.query(".ci-applyall-cb",swatchContainer)[0];var currentComp=customShoeData.currentSelection.getComponentByName(componentName);if(currentComp&&currentComp.sku!=sku){var compListItem=dojo.byId("customPartsItem_"+componentName.replace(" ","_"));if(compListItem){dojo.removeClass(compListItem,"cps_redo");}}selectOneOfManySwatches.select(swatch);selectMediumSwatch(componentName,sku);if(typeof applyAllCheckBox!=="undefined"&&applyAllCheckBox.checked&&typeof customShoeData.materialGroup!=="undefined"){components=customShoeData.materialGroup.components;len=components.length;for(;i<len;i++){componentName=components[i].name;color=customShoeData.getColorByName(componentName,colorName);if(color){customShoeData.currentSelection.setSku(componentName,color.sku);}}populateCustomView();}else{selectComponentSku(componentName,sku);}updatePrice();};function updatePrice(){var i,component,parameters={};parameters.langId=langId;parameters.storeId=storeId;parameters.catalogId=catalogId;parameters.catEntryId=customShoeData.catEntryId;parameters.selectLeftSize=customShoeData.currentSelection.sizes.size.left;parameters.selectRightSize=customShoeData.currentSelection.sizes.size.right;parameters.selectLeftWidth=customShoeData.currentSelection.sizes.width.left;parameters.selectRightWidth=customShoeData.currentSelection.sizes.width.right;for(i=0;i<customShoeData.currentSelection.components.length;i++){component=customShoeData.currentSelection.components[i];parameters["componentId_"+(i+1)]=component.sku;}dojo.publish("ajaxRequestInitiated");dojo.xhrGet({url:getAbsoluteURL()+"KitPriceJSON",handleAs:"json-comment-filtered",content:parameters,service:this,load:function(serviceResponse,ioArgs){var itemOfferprice=dojo.byId("custItemOfferprice");var price=parseFloat(serviceResponse.price);if(price!=null&&typeof price!=="undefined"){price=price.toFixed(2);setTextContent(itemOfferprice,"$"+price);}dojo.publish("ajaxRequestCompleted");},error:function(errObj,ioArgs){console.debug("error - inside updatePrice");console.debug(errObj);dojo.publish("ajaxRequestCompleted");}});}var firstComponentName;function updateCustomComponents(compName,sku){var component=customShoeData.componentMap[compName];var color=component.colorMap[sku];var itemElement=populateCustomComponents.viewMap[compName];var img=dojo.query(".ccgc-item-style-img",itemElement)[0];var nameSpan=dojo.query(".ccgc-item-style-name",itemElement)[0];setTextContent(nameSpan,color.name);dojo.attr(img,"src",color.swatchS);}function getSizeChartXML(url,parent,callback){dojo.xhrGet({url:url,handleAs:"xml",load:handleGetSizeChart,error:function(errObj,ioArgs){console.debug("error - inside getCustomShoeJSON");console.debug(errObj);}});function handleGetSizeChart(doc,ioArgs){var i,j,widthsForSize,width,sizeArrayForWidth,size,sizeNum,sizeList,widthList,sizeMap,widthMap,sizeLabels,widthLabels,sizesList=doc.getElementsByTagName("sizes");customShoeData.sizes={};sizeList=customShoeData.sizes.sizeList=[];widthList=customShoeData.sizes.widthList=[];sizeMap=customShoeData.sizes.sizeMap={};widthMap=customShoeData.sizes.widthMap={};sizeLabels=customShoeData.sizes.sizeLabels={};widthLabels=customShoeData.sizes.widthLabels={};for(i=0;i<sizesList.length;i++){handleSizeNode(sizesList[i]);}for(i=0;i<sizeList.length;i++){size=sizeList[i];widthsForSize=sizeMap[size];for(j=0;j<widthsForSize.length;j++){width=widthsForSize[j];if(indexOfInArray(widthList,width)<0){widthList.push(width);sizeArrayForWidth=[];widthMap[width]=sizeArrayForWidth;sizeArrayForWidth.push(size);}else{sizeArrayForWidth=widthMap[width];if(indexOfInArray(sizeArrayForWidth,size)<0){sizeArrayForWidth.push(size);}}}}for(i=0;i<sizeList.length;i++){size=sizeList[i];sizeNum=parseInt(size);if(sizeNum>20&&size.charAt(size.length-1)==5){sizeLabels[size]=size.substr(0,size.length-1)+".5";}else{sizeLabels[size]=size;}}for(i=0;i<widthList.length;i++){width=widthList[i];widthLabels[width]=width;}widthLabels["B"]="B (Narrow)";widthLabels["D"]="D (Medium)";widthLabels["EEE"]="EEE (Wide)";widthList.sort(function(a,b){var result=0;if(a.charAt(0)==="A"&&b.charAt(0)==="A"){result=(a.length-b.length)*-1;}else{if(a<b){result=-1;}else{if(a>b){result=1;}}}return result;});populateSizeAndWidth(parent);callback();}function handleSizeNode(sizesNode){var sizeList=sizesNode.getElementsByTagName("size");if(sizeList.length>0){var sizeNode=sizeList[0];var size=getTextContent(sizeNode);customShoeData.sizes.sizeList.push(size);var widths=sizesNode.getElementsByTagName("widths");if(widths.length>0){var widthArray=handleWidthList(widths[0].getElementsByTagName("width"));customShoeData.sizes.sizeMap[size]=widthArray;}}}function handleWidthList(nodeList){var widthArray=[];for(var i=0;i<nodeList.length;i++){var width=getTextContent(nodeList[i]);widthArray.push(width);}return widthArray;}}function setTextContent(node,text){if(typeof node.textContent!=="undefined"){node.textContent=text;}else{if(typeof node.text!=="undefined"){node.text=text;}else{if(typeof node.innerText!=="undefined"){node.innerText=text;}else{console.error("did not get set content");}}}}function getTextContent(node){if(typeof node.textContent!=="undefined"){return node.textContent;}else{if(typeof node.text!=="undefined"){return node.text;}else{if(typeof node.innerText!=="undefined"){return node.innerText;}else{console.error("did not get text content");}}}}function populateSizeAndWidth(parent){var i,cpQuantity,diffLink,returnLink,sizeArea=e("div",{id:"cp-size-area"}),leftSizeSelect=e("select",{id:"cp-left-size-select","class":"cp-select"}),leftWidthSelect=e("select",{id:"cp-left-width-select","class":"cp-select"}),rightSizeSelect=e("select",{id:"cp-right-size-select","class":"cp-select"}),rightWidthSelect=e("select",{id:"cp-right-width-select","class":"cp-select"});sizeArea.appendChild(e("div",{"class":"cp-size-area-section"},e("div",{"class":"cp-size-label"},"Left Shoe:"),leftSizeSelect,leftWidthSelect));sizeArea.appendChild(e("div",{"class":"cp-size-area-section cp-size-area-right"},e("div",{"class":"cp-size-label"},"Right Shoe:"),rightSizeSelect,rightWidthSelect));cpQuantity=e("select",{id:"cp-quantity"});for(i=1;i<10;i++){cpQuantity.appendChild(e("option",{value:i},t(i)));}attachLeftAndRightEvents(sizeArea,leftSizeSelect,rightSizeSelect,leftWidthSelect,rightWidthSelect,diffLink,returnLink);parent.appendChild(sizeArea);reloadCpSizeSelect("","left");reloadCpSizeSelect("","right");reloadCpWidthSelect("","left");reloadCpWidthSelect("","right");}function attachLeftAndRightEvents(sizeArea,leftSize,rightSize,leftWidth,rightWidth,diffLink,returnLink){var firstSidePicked=null;var moveSidesTogether=true;function updateSizeOrWidth(side,type,evt,reloadFunction){var otherSide=(side==="left")?"right":"left",targetElement=getTarget(getEvent(evt)),value=targetElement.value;reloadFunction(value,side);if(firstSidePicked==null){firstSidePicked=side;}else{if(firstSidePicked!==side){moveSidesTogether=false;}}customShoeData.currentSelection.sizes[type][side]=value;if(moveSidesTogether){var otherSelect=dojo.byId("cp-"+otherSide+"-"+type+"-select");customShoeData.currentSelection.sizes[type][otherSide]=value;otherSelect.value=value;reloadFunction(value,otherSide);}updatePrice();}leftSize.onchange=function(evt){updateSizeOrWidth("left","size",evt,reloadCpWidthSelect);};rightSize.onchange=function(evt){updateSizeOrWidth("right","size",evt,reloadCpWidthSelect);};leftWidth.onchange=function(evt){updateSizeOrWidth("left","width",evt,reloadCpSizeSelect);};rightWidth.onchange=function(evt){updateSizeOrWidth("right","width",evt,reloadCpSizeSelect);};}function reloadCpSizeSelect(width,side){var i,sizeList,sizeLabel,sizeLabels=customShoeData.sizes.sizeLabels,sizeSelect=dojo.byId("cp-"+side+"-size-select"),currentSize=sizeSelect.value;if(width==""){sizeList=customShoeData.sizes.sizeList;}else{sizeList=customShoeData.sizes.widthMap[width];}sizeSelect.innerHTML="";sizeSelect.appendChild(e("option",{value:""},"Size"));for(i=0;i<sizeList.length;i++){size=sizeList[i];sizeLabel=sizeLabels[size];if(typeof sizeLabel!=="undefined"){sizeSelect.appendChild(e("option",{value:size},sizeLabel));}else{logger.error("size "+size+" has no label");}}if(currentSize!=""){sizeSelect.value=currentSize;}}function reloadCpWidthSelect(size,side){var i,widthList,widthLabels=customShoeData.sizes.widthLabels,widthSelect=dojo.byId("cp-"+side+"-width-select"),currentWidth=widthSelect.value;if(size==""){widthList=customShoeData.sizes.widthList;}else{widthList=customShoeData.sizes.sizeMap[size];}widthSelect.innerHTML="";widthSelect.appendChild(e("option",{value:""},"Width"));for(i=0;i<widthList.length;i++){width=widthList[i];widthSelect.appendChild(e("option",{value:width},widthLabels[width]));}if(currentWidth!=""){widthSelect.value=currentWidth;}}function brightnessOnCanvasData(pixels,adjustment){var d=pixels.data;for(var i=0;i<d.length;i+=4){d[i]+=adjustment;d[i+1]+=adjustment;d[i+2]+=adjustment;}return pixels;}function checkPositionBounds(pos,canvasWidth,canvasHeight){return pos.x>=0&&pos.y>=0&&pos.x<=canvasWidth&&pos.y<=canvasHeight;}customProduct.customImageHolderOnClick=function(ev){if(customShoeData.imageHasNotBeenClicked){populateImageData(imageDataSize.width,imageDataSize.height);customShoeData.imageHasNotBeenClicked=false;}var view=populateCustomView.lastView;var uCaseView=view.charAt(0).toUpperCase()+view.slice(1);var testImage=$("#customImage"+uCaseView+"ViewMain");if(testImage.length==0){return;}var alpha,height=351,width=550,imgPos=$(testImage).offset(),mousePos={x:ev.pageX-imgPos.left,y:ev.pageY-imgPos.top},pixelPos=4*(mousePos.x+imageDataSize.width*mousePos.y);for(var i=0;i<imageData.length;i++){if(imageData[i].data==null){continue;}if(checkPositionBounds(mousePos,imageDataSize.width,imageDataSize.height)){alpha=imageData[i].data.data[pixelPos+3];}else{alpha=0;}if(alpha>0){var name=imageData[i].comp.name;customProduct.customPartsItemClick(name);return;}}};var mouseoverComponent={current:null,canvas:null};customProduct.customImageHolderOnMouseover=function(ev){var customImageCanvas=dojo.byId("customImageCanvas");if(typeof customImageCanvas==="undefined"||typeof customImageCanvas.getContext==="undefined"){return;}if(customShoeData.imageHasNotBeenClicked){populateImageData(imageDataSize.width,imageDataSize.height);customShoeData.imageHasNotBeenClicked=false;}var view=populateCustomView.lastView;var uCaseView=view.charAt(0).toUpperCase()+view.slice(1);var testImage=$("#customImage"+uCaseView+"ViewMain");if(testImage.length==0){return;}var currentComp,currentImageData,alpha,imgPos=$(testImage).offset(),mousePos={x:ev.pageX-imgPos.left,y:ev.pageY-imgPos.top},pixelPos=4*(mousePos.x+imageDataSize.width*mousePos.y);for(var i=0;i<imageData.length;i++){if(imageData[i].data==null){continue;}if(checkPositionBounds(mousePos,imageDataSize.width,imageDataSize.height)){alpha=imageData[i].data.data[pixelPos+3];}else{alpha=0;}if(alpha>0){currentImageData=imageData[i];break;}}var currentCompName=(typeof currentImageData==="undefined")?"undefined":currentImageData.comp.name;if(mouseoverComponent.current!=currentCompName){var ctx=customImageCanvas.getContext("2d");ctx.clearRect(0,0,imageDataSize.width,imageDataSize.height);if(typeof currentImageData!=="undefined"){if(currentImageData.brightData==null||typeof currentImageData.brightData==="undefined"){ctx.drawImage(currentImageData.img,currentImageData.x,currentImageData.y);var tempImageData=ctx.getImageData(0,0,imageDataSize.width,imageDataSize.height);currentImageData.brightData=brightnessOnCanvasData(tempImageData,50);ctx.clearRect(0,0,imageDataSize.width,imageDataSize.height);}ctx.putImageData(currentImageData.brightData,0,0);}mouseoverComponent.current=currentCompName;}};var saveStockpd="";var saveAvailabilityLabelClassName="";function setCustomInstockText(noStockVal){var custAvailabilityHolder=dojo.byId("custAvailabilityHolder");var custInstock=dojo.byId("cust-instock");custInstock.innerHTML=noStockVal.replace(/&amp;nbsp;/g," ");dojo.removeClass(custAvailabilityHolder,"display-none");}function removeCustomInstockText(){var stockpd,availabilityLabel;if(stockpd=dojo.byId("stockpd")){stockpd.innerHTML=saveStockpd;}if(availabilityLabel=dojo.byId("availability-label")){availabilityLabel.className=saveAvailabilityLabelClassName;}}function getEvent(evt){return evt||window.event;}function getTarget(evt){return(typeof evt.target!="undefined")?evt.target:evt.srcElement;}function toneStitchingFix(color){var path="/wcsstore/AllenEdmonds/Attachment/images/database/Swatches/",swatchS="stitching_tone_swatchS.png",swatchM="stitching_tone_swatchM.png",swatchL="stitching_tone_swatchL.png";if(color.name==="Tone on Tone"){if(typeof color.swatchS==="undefined"){color.swatchS=path+swatchS;}if(typeof color.swatchM==="undefined"){color.swatchM=path+swatchM;}if(typeof color.swatchL==="undefined"){color.swatchL=path+swatchL;}}}function handleCustomShoeResponse(serviceResponse,ioArgs){var i,j,groups,materialGroup,stitchingGroup,soleGroup,component,color;customShoeData=serviceResponse;customShoeData.SIDE="side";customShoeData.TOP="top";customShoeData.BACK="back";customShoeData.BOTTOM="bottom";customShoeData.componentViewGroups=[];groups=customShoeData.componentViewGroups;materialGroup={label:"Material & Color",components:[]};stitchingGroup={label:"Stiching & Welt",components:[]};soleGroup={label:"Sole & Insole",components:[]};function getColorByName(colorName){var color,i=0,clen=this.colors.length;for(;i<clen;i++){color=this.colors[i];if(color.name==colorName){return color;}}return;}customShoeData.componentMap={};customShoeData.allColors={};if(customShoeData.componentParts){for(i=0;i<customShoeData.componentParts.length;i++){component=customShoeData.componentParts[i];component.getColorByName=getColorByName;customShoeData.componentMap[component.name]=component;component.colorMap={};for(j=0;j<component.colors.length;j++){color=component.colors[j];component.colorMap[color.sku]=color;toneStitchingFix(color);}switch(component.name){case"Stitching":case"Welt":stitchingGroup.components.push(component);break;case"Sole":case"Insole":soleGroup.components.push(component);break;default:materialGroup.components.push(component);}}if(materialGroup.components.length>0){customShoeData.materialGroup=materialGroup;groups.push(materialGroup);}if(stitchingGroup.components.length>0){groups.push(stitchingGroup);}if(soleGroup.components.length>0){groups.push(soleGroup);}if(materialGroup.components.length>0){(function(){var i=0,j,len=materialGroup.components.length,allColors=customShoeData.allColors,color,clen,component,colorName,hasColor;for(;i<len;i++){component=materialGroup.components[i];clen=component.colors.length;for(j=0;j<clen;j++){color=component.colors[j];allColors[color.name]=color.name;}}for(colorName in allColors){if(allColors.hasOwnProperty(colorName)){hasColor=false;for(i=0;i<len;i++){component=materialGroup.components[i];color=component.getColorByName(colorName);if(typeof color==="undefined"){delete allColors[colorName];break;}}}}})();}if(customShoeData.componentMap["Logo"]){customShoeData.baseStyles.push({"components":[{"name":"Logo","sku":"0"}]});customShoeData.isBaseball=true;dojo.style("customImageHolderView","display","none");}else{customShoeData.isBaseball=false;}}customShoeData.isColorInAll=function(colorName){return(typeof this.allColors[colorName]!=="undefined");};customShoeData.getCurrentSelectionSku=function(compName){var comp,i=0;if(typeof this.currentSelection.components!=="undefined"){for(;i<this.currentSelection.components.length;i++){comp=this.currentSelection.components[i];if(comp.name==compName){return comp.sku;}}}return undefined;};customShoeData.copyCompoentSelection=function(from,to){var i=0;if(!from||!to){return;}to.components=new Array();for(;i<from.components.length;i++){to.components[i]={};to.components[i].name=from.components[i].name;to.components[i].sku=from.components[i].sku;}};customShoeData.getMainImage=function(view){for(var i=0;i<this.shoeViews.length;i++){var shoeView=this.shoeViews[i];if(shoeView.indexOf(view)>-1){return shoeView;}}if(this.shoeViews.length>0){return this.shoeViews[this.shoeViews.length-1];}return null;};customShoeData.getColorByName=function(compName,colorName){var comp=this.componentMap[compName];if(typeof comp!=="undefined"){return comp.getColorByName(colorName);}};customShoeData.isInMaterialGroup=function(compName){if(customShoeData.materialGroup&&customShoeData.materialGroup.components){var components=customShoeData.materialGroup.components;for(var i=0;i<components.length;i++){if(components[i].name==compName){return true;}}}return false;};customShoeData.getComponentGroupByCompName=function(compName){var groups=customShoeData.componentViewGroups;for(var i=0;i<groups.length;i++){var components=groups[i].components;for(var j=0;j<components.length;j++){if(components[j].name==compName){return groups[i];}}}};customShoeData.currentSelection={};customShoeData.copyCompoentSelection(customShoeData.baseStyles[0],customShoeData.currentSelection);customShoeData.currentSelection.sizes={size:{left:"",right:""},width:{left:"",right:""},isDiff:false};customShoeData.currentSelection.getComponentByName=function(name){var len,i=0;if(!this.components){return;}len=this.components.length;for(;i<len;i++){if(this.components[i].name==name){return this.components[i];}}};customShoeData.currentSelection.setSku=function(componentName,sku){var comp=this.getComponentByName(componentName);if(typeof comp==="undefined"){this.components=[{name:componentName,sku:sku}];comp=this.getComponentByName(componentName);}var selectedCompColor=dojo.byId("customPartsColor_"+componentName.replace(" ","_"));var colorName=getColorName(componentName,sku);comp.sku=sku;if(selectedCompColor&&colorName){setTextContent(selectedCompColor,colorName);}};customShoeData.currentSelection.setColorByName=function(componentName,colorName){var selectedComp=this.getComponentByName(componentName);var comp=customShoeData.componentMap[componentName];var compColor=customShoeData.getColorByName(componentName,colorName);if(typeof selectedComp!=="undefined"&&typeof compColor!=="undefined"){selectedComp.sku=compColor.sku;}};customShoeData.currentSelection.isColorSelected=function(componentName,sku){var selectedComp=this.getComponentByName(componentName);if(selectedComp){return selectedComp.sku==sku;}};populateCustomComponents();displayOneOfManySwatchGroup=populateCustomImageSwatchGroupContainer();populateCustomView(customShoeData.SIDE);customShoeData.imageHasNotBeenClicked=true;if(customShoeData.noStockText){setCustomInstockText(customShoeData.noStockText);}if(customShoeData.sizeChart){getSizeChartXML(customShoeData.sizeChart,dojo.byId("cpSizeHolder"),function(){if(handleCustomShoeResponseAfterLoad){handleCustomShoeResponseAfterLoad();}});}customProduct.customShoeData=customShoeData;}function populateCustomImageSwatchGroupContainer(){var j,clen,component,customImageSwatchContainer,color,swatch,swatchesDiv,ciSwatchContLeft,contLeftClass,swatchMedContClass,swatchContClass,len=customShoeData.componentParts.length,swatchGroupObj={},i=0,appllyAllCheckOnClick=function(evt){var i,components,componentName,imgList,img,imgIdParts,colorName,checkbox,swatchContainer;var targetElement=getTarget(getEvent(evt));checkbox=targetElement;swatchContainer=checkbox.parentNode;if(checkbox.checked){if(typeof customShoeData.materialGroup!=="undefined"){components=customShoeData.materialGroup.components;imgList=dojo.query(".ci-swatch");for(i=0;i<imgList.length;i++){img=imgList[i];if(img.className.indexOf("selected")>-1){colorName=img.title;}}if(typeof colorName!=="undefined"){for(i=0;i<components.length;i++){componentName=components[i].name;color=customShoeData.getColorByName(componentName,colorName);if(color){customShoeData.currentSelection.setSku(componentName,color.sku);populateCustomView();}}}}dojo.addClass(swatchContainer,"ci-only-show-common");}else{dojo.removeClass(swatchContainer,"ci-only-show-common");}updatePrice();};var customImageSwatchGroupContainer=dojo.byId("customImageSwatchGroupContainer");for(i=0;i<len;i++){component=customShoeData.componentParts[i];swatchContClass="customImageSwatchContainer";swatchMedContClass="ci-swatch-med-cont";if(component.name==="Sole"){swatchContClass+=" ci-swatch-cont-sole";}customImageSwatchContainer=e("div",{"class":swatchContClass},e("div",{"class":"customImageSwatchContainerHeader"},e("span",{"class":"swatchLabelComponent"},component.name+": "),e("span",{id:component.name.replace(" ","_")+"SwatchLabelColor","class":"swatchLabelColor"})),e("div",{"class":swatchMedContClass},e("img",{id:"ci-swatch-med-img-"+component.name.replace(" ","_"),"class":"ci-swatch-med-img",src:"/wcsstore/dojo131/dojo/resources/blank.gif"})));swatchesDiv=createEl("div",{"class":"ci-swatches-holder"});customImageSwatchContainer.appendChild(swatchesDiv);clen=component.colors.length;var queryResults=dojo.query(".swatchContainerInstructions",customImageSwatchGroupContainer);if(queryResults&&queryResults.length>0){swatchGroupObj["Instructions"]=queryResults[0];}for(j=0;j<clen;j++){color=component.colors[j];swatch=(typeof color.swatchS==="undefined")?"":color.swatchS;if(!swatch||swatch.length==0){swatch="/wcsstore/dojo131/dojo/resources/blank.gif";}var swatchImageProps={id:"ciswatch-"+component.name.replace(" ","_")+"-"+color.sku,src:swatch,"class":customShoeData.isColorInAll(color.name)?"ci-swatch":"ci-swatch ci-not-common",title:color.name};if(swatch.indexOf("blank.gif")>-1){swatchImageProps["class"]=swatchImageProps["class"]+" ci-blank-swatch";}if(component.name=="Logo"&&customShoeData.isBaseball){swatchImageProps["class"]=swatchImageProps["class"]+" ci-baseball";}var swatchImage=createEl("img",swatchImageProps);eval("swatchImage.onclick = function( evt ) { evt = evt || window.event; customProduct.customImageSwatchClick(evt, '"+component.name+"','"+color.sku+"', '"+color.name+"') };");swatchesDiv.appendChild(createEl("div",{"class":"ci-swatch-border"},swatchImage));}if(customShoeData.isInMaterialGroup(component.name)&&component.name!=="Logo"){var appllyAllCheckHolder=e("div",{"class":"ci-applyall-cb-holder"},e("input",{"class":"ci-applyall-cb",type:"checkbox",onclick:appllyAllCheckOnClick}),e("span",{"class":"ci-applyall-label"},"Apply to entire shoe"));customImageSwatchContainer.appendChild(appllyAllCheckHolder);}swatchGroupObj[component.name]=customImageSwatchContainer;if(customImageSwatchGroupContainer){customImageSwatchGroupContainer.appendChild(customImageSwatchContainer);}}var swatchGroupSwitcher=DisplayOneOfManyNameElement(swatchGroupObj);swatchGroupSwitcher.select("Instructions");return swatchGroupSwitcher;}customProduct.customPartsItemClick=function(listItem){console.info("customPartsItemClick");if(typeof listItem==="string"){listItem=dojo.byId("customPartsItem_"+listItem.replace(" ","_"));if(!listItem){return;}}if(populateCustomComponents.selected){dojo.removeClass(populateCustomComponents.selected,"selectedCustomPart");}populateCustomComponents.selected=listItem;dojo.addClass(listItem,"selectedCustomPart");displayOneOfManySwatchGroup.select(getCompNameFromId(listItem.id));};customProduct.customItemCheckClick=function(checkLink){var currentComp,baseComp,compName=getCompNameFromId(checkLink.id),compListItem=dojo.byId("customPartsItem_"+compName.replace(" ","_"));currentComp=customProduct.customShoeData.currentSelection.getComponentByName(compName);baseComp=customProduct.customShoeData.currentSelection.getComponentByName.call(customProduct.customShoeData.baseStyles[0],compName);if(compListItem&&currentComp&&baseComp){dojo.addClass(compListItem,"cps_redo");currentComp.lastSelected=currentComp.sku;currentComp.sku=baseComp.sku;populateCustomView();}};customProduct.customItemRedoClick=function(redoLink){var currentComp,compName=getCompNameFromId(redoLink.id),compListItem=dojo.byId("customPartsItem_"+compName.replace(" ","_"));currentComp=customProduct.customShoeData.currentSelection.getComponentByName(compName);if(compListItem&&currentComp){dojo.removeClass(compListItem,"cps_redo");currentComp.sku=currentComp.lastSelected;populateCustomView();}};function getCompNameFromId(id){return id.substr(id.indexOf("_")+1);}function populateCustomComponents(){var i,customPartsItem,cpiDivProps,name,cpcDivProps,currComp,comp,colorName="",customPartsList=dojo.byId("customPartsList");if(!(customShoeData.componentParts&&customPartsList)){return;}populateCustomComponents.viewMap={};for(i=0;i<customShoeData.componentParts.length;i++){name=customShoeData.componentParts[i].name;if(i==0){firstComponentName=name;cpiDivProps={"class":"topCustomPartsList"};}else{cpiDivProps=null;}cpcDivProps={"id":"customPartsColor_"+name.replace(" ","_"),"class":"customPartsColor"};currComp=customShoeData.currentSelection.getComponentByName(name);comp=customShoeData.componentMap[name];if(currComp&&comp){var color=comp.colorMap[currComp.sku];if(color){colorName=color.name;}}var itemCheckRedoLink=e("a",{id:"cpsredo_"+name,"class":"custom_part_selection cps_redo",href:"javascript:;"},e("img",{src:"/wcsstore/AllenEdmonds/images/ex_cancel.png","class":"customItemCheck"}));var itemCheckLink=e("a",{id:"cpsundo_"+name,"class":"custom_part_selection cps_undo",href:"javascript:;"},e("img",{src:"/wcsstore/AllenEdmonds/images/check.png","class":"customItemCheck"}));var customPartsLabel=e("span",{"class":"customPartsLabel"},": ");var colorNamDiv=e("span",cpcDivProps,colorName);var cpiDiv=e("div",cpiDivProps,name,customPartsLabel,colorNamDiv,itemCheckLink,itemCheckRedoLink);customPartsItem=e("li",{id:"customPartsItem_"+name.replace(" ","_")},cpiDiv);customPartsItem.onclick=function(){customProduct.customPartsItemClick(this);};itemCheckRedoLink.onclick=function(){customProduct.customItemCheckClick(this);};customPartsList.appendChild(customPartsItem);populateCustomComponents.viewMap[name]=customPartsItem;}}populateCustomComponents.selected=null;function _Set(){this.values=[];}_Set.prototype.add=function(item){if(this._getIndex(item)==null){this.values.push(item);}};_Set.prototype._getIndex=function(item){var result=null;for(var i=0;i<this.values.length;i++){if(item==this.values[i]){result=i;break;}}return result;};_Set.prototype.has=function(item){return(this._getIndex(item)!=null);};_Set.prototype.remove=function(item){var index=this._getIndex(item);if(index!=null){this.values.splice(index,1);}};function populateCustomView(view){var img,uCaseView,customImageView,mainImage,partType,part,color,partView,colorView,len,customImageHolder,imageId,top=0,i=0;len=(customShoeData.currentSelection.components)?customShoeData.currentSelection.components.length:0;if(typeof view==="undefined"){view=populateCustomView.lastView;}var customImageHolderImageSectionTemp=dojo.byId("customImageHolderImageSectionTemp");if(!customImageHolderImageSectionTemp){customImageHolder=document.getElementById("customImageHolder");customImageHolderImageSectionTemp=e("div",{id:"customImageHolderImageSectionTemp",style:"display: none; position: absolute; left: 0; top: 0;"});customImageHolder.appendChild(customImageHolderImageSectionTemp);}uCaseView=view.charAt(0).toUpperCase()+view.slice(1);customImageView=e("div");customImageHolderImageSectionTemp.appendChild(customImageView);mainImage=customShoeData.getMainImage(view);var imageSet=new _Set();var doneAddingImages=false;function imgOnLoad(){imageSet.remove(this.id);}function imgOnError(){imageSet.remove(this.id);dojo.style(this,"display","none");}if(view==customShoeData.BOTTOM){mainImage=null;}if(mainImage){if(view==customShoeData.BACK){top="-20";}else{if(view==customShoeData.BOTTOM){top="69";}}imageId="customImage"+uCaseView+"ViewMain";imageSet.add(imageId);img=document.createElement("img");img.onload=imgOnLoad;img.onerror=imgOnError;img.id=imageId;img.src=mainImage;dojo.style(img,"position","absolute");dojo.style(img,"left","0px");dojo.style(img,"top",top+"px");customImageView.appendChild(img);}var canvasHeight=351;var canvasWidth=550;if(customShoeData.currentSelection.components){imageData=[];for(;i<len;i++){partType=customShoeData.currentSelection.components[i];part=customShoeData.componentMap[partType.name];if(part!=null){color=part.colorMap[partType.sku];if(color){partView=part[view];colorView=color[view];if(partView==null&&view==customShoeData.BOTTOM){partView={x:0,y:69};}if(partView&&colorView){imageId="customImage"+uCaseView+"View"+partType.name;imageSet.add(imageId);img=document.createElement("img");img.onload=imgOnLoad;img.onerror=imgOnError;img.id=imageId;dojo.style(img,"position","absolute");dojo.style(img,"left",partView.x+"px");dojo.style(img,"top",partView.y+"px");img.src=colorView;customImageView.appendChild(img);imageData.push({comp:part,img:img,x:partView.x,y:partView.y,data:null});}}}}customShoeData.imageHasNotBeenClicked=true;}doneAddingImages=true;var imageIntervalCount=0;var imageloadInterval=setInterval(function(){if(doneAddingImages&&imageSet.values.length==0){clearInterval(imageloadInterval);populateImageData(imageDataSize.width,imageDataSize.height);dojo.addClass("customImageSideView","display-none");dojo.addClass("customImageTopView","display-none");dojo.addClass("customImageBackView","display-none");dojo.addClass("customImageBottomView","display-none");dojo.removeClass("customImage"+uCaseView+"View","display-none");var theRealCustomImageView=dojo.byId("customImage"+uCaseView+"View");theRealCustomImageView.innerHTML=customImageView.innerHTML;customImageView.parentNode.removeChild(customImageView);customImageView=null;}},100);populateCustomView.lastView=view;checkForChangeComponents();}function checkForChangeComponents(){var i,baseComp,currentComp,compListItem,bcList=customShoeData.baseStyles[0].components;console.info("checkForChangeComponents");for(i=0;i<bcList.length;i++){baseComp=bcList[i];currentComp=customShoeData.currentSelection.getComponentByName(baseComp.name);compListItem=dojo.byId("customPartsItem_"+baseComp.name.replace(" ","_"));if(!compListItem){continue;}if(baseComp.sku!=currentComp.sku){dojo.addClass(compListItem,"changed");}else{dojo.removeClass(compListItem,"changed");}}}function customAttributeValidation(focusId){if(dojo.byId("cp-left-size-select").value==""){MessageHelper.formErrorHandleClient(focusId,"Please select left size.");return false;}if(dojo.byId("cp-left-width-select").value==""){MessageHelper.formErrorHandleClient(focusId,"Please select left width.");return false;}if(dojo.byId("cp-right-size-select").value==""){MessageHelper.formErrorHandleClient(focusId,"Please select right size.");return false;}if(dojo.byId("cp-right-width-select").value==""){MessageHelper.formErrorHandleClient(focusId,"Please select right width.");return false;}if(customShoeData.isBaseball){var currentComponents=customProduct.customShoeData.currentSelection.components;var baseballErrorStr="Please select a team logo.";if(!(currentComponents.length>0&&currentComponents[0].sku!=0)){MessageHelper.formErrorHandleClient(focusId,baseballErrorStr);return false;}}return true;}customProduct.addToBagOnClick=function(evt){evt=evt||window.event;if(!customAttributeValidation("cp-left-width-select")){return false;}var sizes=customShoeData.currentSelection.sizes;var quantity=1;var sizeWidthDescription=getSizeAndWidthDescriptionString(sizes.size.left,sizes.size.right,sizes.width.left,sizes.width.right);var ordCalcUrl=new UrlHelper("OrderCalculate");ordCalcUrl.addParams("URL","OrderItemDisplay");var orderItemAddUrl=new UrlHelper("OrderItemAdd");orderItemAddUrl.addParams("storeId",storeId,"catalogId",catalogId,"langId",langId,"quantity_2",quantity,"description",sizeWidthDescription,"calculationUsageId",-1,"URL",ordCalcUrl.toString());var kitAddUrl=new UrlHelper(getAbsoluteURL()+"DynamicKitConfigurationAdd");kitAddUrl.addParams("storeId",storeId,"catalogId",catalogId,"langId",langId,"catEntryId",customShoeData.catEntryId,"selectLeftSize",sizes.size.left,"selectRightSize",sizes.size.right,"selectLeftWidth",sizes.width.left,"selectRightWidth",sizes.width.right);for(var i=0;i<customShoeData.currentSelection.components.length;i++){var component=customShoeData.currentSelection.components[i];kitAddUrl.addParams("componentId",component.sku,"quantity",1);}kitAddUrl.addParams("URL",orderItemAddUrl.encode());var targetElement=getTarget(getEvent(evt));targetElement.href=kitAddUrl.toString();return true;};function imageElementStr(seq,path,x,y){return'<image sequence="'+seq+'" path="'+path+'" x="'+x+'" y="'+y+'" />';}customProduct.createImageLink=function(view){var mainImage,partType,part,color,partView,colorView,len,imagestr='<?xml version="1.0" ?><images>',urlBase="http://"+window.location.host,top=0,zIndex=10,i=0;len=(customShoeData.currentSelection.components)?customShoeData.currentSelection.components.length:0;mainImage=customShoeData.getMainImage(view);if(mainImage){if(view==customShoeData.BACK){top="-20";}else{if(view==customShoeData.BOTTOM){top="69";}}imagestr+=imageElementStr(zIndex,urlBase+mainImage,0,top);zIndex+=10;}if(customShoeData.currentSelection.components){for(i=0;i<len;i++){partType=customShoeData.currentSelection.components[i];part=customShoeData.componentMap[partType.name];if(part!=null){color=part.colorMap[partType.sku];if(color){partView=part[view];colorView=color[view];if(partView&&colorView){imagestr+=imageElementStr(zIndex,urlBase+colorView,partView.x,partView.y);zIndex+=10;}}}}}imagestr+="</images>";var result="http://"+window.location.host+"/webapp/wcs/stores/servlet/DKImageView?catalogId="+catalogId+"&langId="+langId+"&storeId="+storeId+"&imageXml="+encodeURIComponent(imagestr);console.info(result);return false;};function buildCustomPreData(productpage){var customProductpage=e("div",{id:"customProductpage","class":"display-none"});var item_offerprice=dojo.byId("item_offerprice");var offerprice=getTextContent(item_offerprice);var prodPageContents=' 		<div id="custProductPageLeft"> 			<div id="fullimageHolder"> 				<div id="customImageHolder" onclick="customProduct.customImageHolderOnClick( event );"  onmousemove="customProduct.customImageHolderOnMouseover( event );"> 					<div id="customImageSwatchGroupContainer"><div class="swatchContainerInstructions"> 					Create your perfect shoe be selecting the parts in the<br> custom parts menu or highlighting them directly on the shoe. 					</div></div> 					<div id="customImageHolderImageSection"> 						<canvas id="customImageCanvas" class = "highlight-canvas" width="550" height="351"></canvas> 						<div id="customImageSideView"> 						</div> 						<div id="customImageTopView" class="display-none"></div> 						<div id="customImageBackView" class="display-none"></div> 						<div id="customImageBottomView" class="display-none"></div> 					</div> 					<div id="customImageHolderView"> 						<a href="javascript:;" class="cp-view-link" onclick="customProduct.populateCustomView(&quot;side&quot;);false;"> 							<img src="/wcsstore/AllenEdmonds/images/custom_view_side.jpg" class="customViewSelectIcon"/> 						</a> 						<a href="javascript:;" class="cp-view-link" onclick="customProduct.populateCustomView(&quot;top&quot;);false;"> 							<img src="/wcsstore/AllenEdmonds/images/custom_view_top.jpg" class="customViewSelectIcon"/> 						</a> 						<a href="javascript:;" class="cp-view-link" onclick="customProduct.populateCustomView(&quot;back&quot;);false;"> 							<img src="/wcsstore/AllenEdmonds/images/custom_view_back.jpg" class="customViewSelectIcon"/> 						</a> 						<a href="javascript:;" class="cp-view-link" onclick="customProduct.populateCustomView(&quot;bottom&quot;);false;"> 							<img src="/wcsstore/AllenEdmonds/images/custom_view_bottom.jpg" class="customViewSelectIcon"/> 						</a> 					</div> 				</div> 			</div> 			<hr class="custOverviewAreaDivider"/> 			<div id="custOverviewArea"><span id="custOVAreaDesc" class="prodDesc"></span></div> 		</div> 		<div id="custProductPageright"> 			<div class="exitDesignMode"><a href="javascript:;" onclick="customProduct.exitDesignModeClick(); return false;">[ exit design mode ]</a></div> 			<div class="customShoeLabel">Design Your Own Shoe:</div> 			<h1 id="custProdName" class="prodName">'+customProductInfo.name+'</h1> 			<div id="cpSizeHolder"></div> 			<h2 class="customizePartsLabel">Customize Parts:</h2> 			<ul id="customPartsList"></ul> 			<div id="custAttributeBoxPrice"> 				<span id="custItemOfferprice">'+offerprice+'</span> 			</div> 			<div id="custAvailabilityHolder" class="display-none"> 				<span class="pdp-form-label">Availability: </span> 				<span id="cust-instock"></span> 			</div> 			<div id="customAddtoBagBtn"> 				<a href="javascript:;" onclick="return customProduct.addToBagOnClick(event);"> 					ADD TO BAG 				</a> 			</div> 			<!--<div><a href="javascript:;" onclick="customProduct.createImageLink(&quot;side&quot;)">test</a></div>--> 			<div id="custshipping"> 				<span class="cust_contactarea_label1">Free Shipping &amp; Returns:</span> 				<span class="cust_contactarea_label2"> No Minimums.</span> 				<span id="custshipping_viewpolicy" class="cust_contactarea_label2"><a href="javascript:dijit.byId(&quot;returnPolicyDialog&quot;).show();">View Policy</a></span> 			</div> 			<div id="custhelp"> 				<span class="cust_contactarea_label1">Need Help:</span> 				<span class="cust_contactarea_label2"> <a href="'+customProductInfo.contactUsViewURL+'">Contact us ></a></span> 				<span id="custhelp_livechat" class="cust_contactarea_label2 cust_livechaton"> 					<div class="cust-livechat-image"></div><span class="cust_chat_on"><a id="cust_livechat_link" href="javascript:;">Live Chat</a></span> 					<span class="cust_chat_off">Chat Off</span> 				</span> 			</div> 			<div id="'+CUST_LIVECHAT_BUTTON_ID+'"></div> 		</div>';customProductpage.innerHTML=prodPageContents;productpage.parentNode.insertBefore(customProductpage,productpage);(function(){var custOVAreaDesc;whenReady(function(){custOVAreaDesc=dojo.byId("custOVAreaDesc");return !(typeof custOVAreaDesc==="undefined"||custOVAreaDesc==null);},function(){var list=dojo.query("> .prodDesc",dojo.byId("longDescriptionAlternatives_1"));if(list&&list.length>0&&custOVAreaDesc){custOVAreaDesc.innerHTML="<h1>OVERVIEW</h1> "+list[0].innerHTML;}},50);whenReady(function(){var custLiveChat=dojo.byId(CUST_LIVECHAT_BUTTON_ID);return !(typeof custLiveChat==="undefined"||custLiveChat==null);},function(){loadScript("//server.iad.liveperson.net/hc/76921506/?cmd=mTagRepstate&site=76921506&buttonID=14&divID="+CUST_LIVECHAT_BUTTON_ID+"&bt=3&c=1");setupCustomLiveChatButton();},50);})();}customProduct.customButtonOnClick=function(partNumber){var customProductpage,productpage=dojo.byId("productpage"),customProductStartLoading=dojo.byId("customProductStartLoading");var queryStrMap=dojo.queryToObject(window.location.search.substr(1));if(queryStrMap["cpn"]){partNumber=queryStrMap["cpn"];}if(customProduct.customShoeData){customProductpage=dojo.byId("customProductpage");dojo.style(productpage,"display","none");dojo.removeClass(customProductpage,"display-none");}else{dojo.removeClass(customProductStartLoading,"display-none");buildCustomPreData(productpage);getCustomShoeJSON(partNumber,function(){var customProductpage=dojo.byId("customProductpage");dojo.addClass(customProductStartLoading,"display-none");dojo.style(productpage,"display","none");dojo.removeClass(customProductpage,"display-none");updatePrice();});}};customProduct.exitDesignModeClick=function(){var productpage=dojo.byId("productpage"),customProductpage=dojo.byId("customProductpage");dojo.style(productpage,"display","");dojo.addClass(customProductpage,"display-none");};customProduct.initCustom=function(partNum){var cpButton=e("div",{id:"customProductStart","class":"buttonText"},"Design your own shoe");var customButtonHolder=e("div",{id:"customButtonHolder"},cpButton,e("div",{id:"customProductStartLoading","class":"alpha70 display-none"},e("img",{src:"/wcsstore/AllenEdmonds/images/loading_pl.gif"})));cpButton.onclick=function(){customProduct.customButtonOnClick(partNum);};var beforeCustomShoeButton=dojo.byId("beforeCustomShoeButton");if(beforeCustomShoeButton){beforeCustomShoeButton.parentNode.insertBefore(customButtonHolder,beforeCustomShoeButton);}};function whenReady(test,callback,interval){var intValue=setInterval(function(){if(test()){clearInterval(intValue);callback();}},interval);}customProduct.custLiveChatOnClick=function(event){var liveChatLink,liveChatLinkList,liveChatButton=dojo.byId(CUST_LIVECHAT_BUTTON_ID);if(liveChatButton){liveChatLinkList=dojo.query("a",liveChatButton);if(liveChatLinkList.length>0){liveChatLink=liveChatLinkList[0];liveChatLink.onclick.apply(liveChatLink,arguments);}}};function setupCustomLiveChatButton(){var liveChatButton;whenReady(function(){liveChatButton=getLiveChatStaticButton(CUST_LIVECHAT_BUTTON_ID);return !(typeof liveChatButton==="undefined"||liveChatButton==null);},function(){console.info("setupCustomLiveChatButton");checkCustomLiveChatState(liveChatButton.state);liveChatButton.getTextLinkText=function(state){checkCustomLiveChatState(state);if(state==this.ONLINE){return this.config.displayTextOnline;}else{if(state==this.OCCUPIED){return this.config.displayTextOccupied;}else{return this.config.displayTextOffline;}}};},200);}function checkCustomLiveChatState(state){var ONLINE=2;if(state==ONLINE){customLiveChatOn();}else{customLiveChatOff();}}window.customProduct=customProduct;})(window);console.info("CUSTOM INFO TEST");if(customProductInfo&&customProductInfo.hasCustom){dojo.addOnLoad(function(){customProduct.initCustom(customProductInfo.customPartNumber);});}