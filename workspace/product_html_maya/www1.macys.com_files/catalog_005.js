MACYS.namespace("MACYS.Recommendations.RTD");MACYS.Recommendations.RTD.generateGUID=function(){var a=function(){var b=new Date();return(((b.getTime()+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+a()+a()+a()+a()+a()+a())};MACYS.Recommendations.RTD.sendRTOEvent=function(c,h,k,j,e){var g=MACYS.util.Cookie.get("macys_online_uid")||"";var i=MACYS.util.Cookie.get("90067660_login")||"";var b=null;var a="";var m=MACYS.Recommendations.RTD.getRTDSessionCookie();if(m){b=m}else{b=j||g}var f={Clicked:"/EventsWar/events/event/product/clicked",AddtoBag:"/EventsWar/events/event/product/addtobag",Sale:"/EventsWar/events/event/product/sale",Presented:"/EventsWar/events/event/product/presented"};a="/sdp/rto/recordevent/processaddtobag";if(!MACYS.Recommendations.RTD.oldDycesEnabled){a=f[c]}var d=e?e:function(n){};var l="visitorId="+b+"&customerId="+g+"&trackingId="+i+"&choiceIds="+h+"&productIds="+k;YAHOO.util.Connect.asyncRequest("POST",a,{success:d,failure:function(n){console.log(n.toString())}},l)};MACYS.Recommendations.RTD.sendInformantCall=function(h,g,o,n,l,e){var f=MACYS.util.Cookie.get("macys_online_uid")||"";var i=MACYS.util.Cookie.get("90067660_login")||"";var b=null;var a="/EventsWar/events/record/customeraction";var j=MACYS.util.Cookie.get("shippingCountry");var q=MACYS.Recommendations.RTD.getRTDSessionCookie();if(q){b=q}else{b=n||f}var d=e?e:function(r){};var c="RECENTLY_PURCHASED";var p="";var m=location.search.match(/[&|?]zone=([^&]+)/);if(h=="Sale"){p="visitorId="+b+"&sender=MCOM-NAVAPP&context=Checkout&responseType="+h+"&orderDetails="+l+"&countryCode="+j;var k=$("#shopCategoryID");if(k){p+="&categoryID="+k.val()}}else{if(h.match("Pros")){if(m){c=m[1]}else{c="ATBPage"}h=h.replace("Pros","")}p="visitorId="+b+"&sender=MCOM-NAVAPP&context="+c+"&responseType="+h+"&choiceIds="+g+"&productIds="+o+"&customerId="+f+"&countryCode="+j}YAHOO.util.Connect.asyncRequest("POST",a,{success:d,failure:function(r){console.log(r.toString())}},p)};MACYS.Recommendations.RTD.getRTDSessionCookie=function(){var c=MACYS.util.Cookie.get("RTD");if(!c){var b=MACYS.Recommendations.RTD.generateGUID();MACYS.log("generated GUID:"+b);var a=new Date();a.setFullYear(a.getFullYear()+30);MACYS.util.Cookie.expires=a;MACYS.util.Cookie.set("RTD",b);c=MACYS.util.Cookie.get("RTD")}return c};MACYS.Recommendations.RTD.getRecommendations=function(i){var j=MACYS.util.Cookie.get("macys_online_uid");if(!MACYS.Recommendations.RTD.validateAttributeAsNumber(i,j)){return}var c=(MACYS.util.Url.getPathname().indexOf("/registry/wedding/")!==-1)?"&isRegistryMode=Y":"&isRegistryMode=N",g=YAHOO.util.Cookie.get("shippingCountry")||null,a=YAHOO.util.Cookie.get("zipCode")||null,d=(g&&g!=="US")?"&isInternationalMode=Y":"&isInternationalMode=N",h=MACYS.Recommendations.RTD.getRTDSessionCookie()||null,j,f=MACYS.util.Cookie.get("90067660_login")||null;var e=function(t){var l=null,q=null,s,k;try{l=YAHOO.lang.JSON.parse(t.responseText)}catch(r){i.setFailureFlag(true);MACYS.log(r.toString())}var k=[];if(l.recommendedItems.length>0){for(q=0;q<l.recommendedItems.length;q++){product=l.recommendedItems[q];s={productId:product.productId,choiceId:product.choiceId};k.push(s)}}else{MACYS.log("Incorrect JSON response format");i.setFailureFlag(true)}var n=i.getRecommendationsObj();var m=new Array();var q,o;for(q=0;q<k.length;q++){var p=k[q];o=p.productId;n.products[o]={id:o,choiceId:p.choiceId};n.products[o].availability="true";n.recsReceived+=1;m[q]=o}i.setRecommendationsObj(n);i.setOrder(m);i.getThumbnails()};var b="visitorId="+(h?h:"")+"&customerId="+(j?j:"")+"&pageId="+i.getPageId()+"&categoryId="+i.getCategoryId()+"&trackingId="+(f?f:"")+"&countryCode="+(g?g:"")+"&zipCode="+(a?a:"")+d+c+"&maxRecommendations=10";YAHOO.util.Connect.asyncRequest("POST",MACYS.Recommendations.rtoURL,{success:e,timeout:MACYS.Recommendations.recommendationsEngineTimeout,failure:function(k){MACYS.log(k.toString());i.setFailureFlag(true);i.failureCallback(i.getContainerId(),"Exception in Engine Call on getting Recommendations")}},b)};MACYS.Recommendations.RTD.notifyRTDFormation=function(b){var c="";for(var a=0;a<b.length;a++){if(b[a]){if(a!=0){c+="|"}c+=b[a]}}return c};MACYS.Recommendations.RTD.validateAttributeAsNumber=function(b,a){if(a){if(isNaN(a)){b.setFailureFlag(true);b.failureCallback(b.getContainerId(),"Exception in Engine Call on getting Recommendations. Invalid attribute.");return false}}return true};
