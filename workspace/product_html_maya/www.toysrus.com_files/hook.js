hl_ext={templates:{InGrid2:{onBeforeCall:function(r,e){if("REQUEST"==r.callType()){r.setProperty("creative","172x3892_T-R-IG_TI_1-8_InGrid2"),r.setFilter("price",null),"75.00"==r.getProperty("minprice")&&"10.00"==r.getProperty("maxprice")&&r.setProperty("maxprice","100.00");var t=e.urlParse(window.location.toString()).qs;t.categoryid&&(t.hasOwnProperty("sr")?r.getProperty("taxonomy")||r.getProperty("keyword")||r.setTaxonomy(t.categoryid):(r.setTaxonomy(t.categoryid),r.setProperty("keyword",null)));var o=r.getProperty("maxads ");o&&(r.setProperty("maxads",o),r.setProperty("maxads ",null)),o=r.getProperty("minorganic "),o&&(r.setProperty("minorganic",o),r.setProperty("minorganic ",null));var i=r.getProperty("taxonomy");if(i)for(var a=["54227636"],s=0,n=a.length;n>s;++s)if(i==a[s]){r.setProperty("nodisplay","pubrequest-01");break}}else if("UPDATE"==r.callType()){var c=r.getProperty("productid"),p=r.getProperty("parentsku");if(r.setProperty("productid",p),r.setProperty("parentsku",c),jQuery)try{var l=jQuery("#price .list");if(l&&l.length>0){var d=l.text().replace(/\$/,"");/[\d\.]/.match(d)&&r.setProperty("regularPrice",d)}}catch(u){e.error("TRU update scrape failed - "+u.toString())}}return!0},render:function(r,e){var t='<div class="prodloop_float">';return t+=e.hasOwnProperty("_ta")&&e._ta.hasOwnProperty("site")&&("tru"==e._ta.site||"bru"==e._ta.site)?' <div class="prodloop_cont hl-product '+e._ta.site+'"> ':' <div class="prodloop_cont hl-product '+("rgb(229, 237, 248)"==jQuery("#leftnav_container").css("background-color")?"tru":"bru")+'"> ',t+='<div class="varHeightTop"><div class="prodloop-thumbnail hl-image"><a href="'+r.toUrl(e.ProductPage)+'"><span class="banner"></span><img width="150" height="150" class="swatchProdImg" src="'+e.Image+'" alt="" border="0" /></a></div><div class="prSnippet prSnippetLarge prStarsValue'+parseFloat(e.Rating||"0").toFixed(1).replace(/\./,"")+'"><div class="prSnippetEngine"><div class="prSnippetRatingUnclickable"><div class="prStars">'+parseFloat(e.Rating||"0").toFixed(1)+' stars</div></div></div></div><br/><a href="'+r.toUrl(e.ProductPage)+'" class="prodtitle">'+e.ProductName+' </a><div class="prodPrice familyPrices">',parseFloat(e.ComparePrice)>parseFloat(e.Price)&&(t+='<span class="listPrice2">'+r.toNumber(e.ComparePrice)+"</span> "),t+='<span class="hl-price ourPrice2',parseFloat(e.ComparePrice)>parseFloat(e.Price)&&(t+=" adjusted"),t+='">'+r.toNumber(e.Price)+"</span></div>",e.shortDescription.length>0&&(t+='<div class="hl-description"><b>Product Description</b><br/>'+r.clip(e.shortDescription.replace(/\\'/g,"'"),90,2,"... [<a href='"+r.toUrl(e.ProductPage)+"'>Read More</a>]")+"</div>"),t+="</div></div></div>"},onPageBind:function(r,e,t){function o(r,e,t){if(0!=r.length){var i=e.children(".prodloop_row_cont"),s=i[t],n=jQuery(s).children(".prodloop_float");t<i.length?r.insertBefore(n.first()):r.length>0&&(e.append("<div class='prodloop_row_cont'></div>"),e.children(".prodloop_row_cont").last().append(r),i=e.children(".prodloop_row_cont"),s=i[t],n=jQuery(s).children(".prodloop_float")),r=jQuery(s).children(".prodloop_float:gt("+(a-1)+")").detach(),o(r,e,t+1)}}function i(r){var e=r.children(".prodloop_row_cont");e.removeClass("lastRow"),e.last().addClass("lastRow"),e.each(function(r,e){var t=jQuery(e).children(".prodloop_float");t.removeClass("first"),t.first().addClass("first")}),jQuery(".hl-product").each(function(r,e){var t=jQuery(e).parent().parent().height(),o=t-10+"px",i=t-30+"px";jQuery(e).parent().css("height",o),jQuery(e).css("height",i)})}var a=4;if("REQUEST"==r.callType()){e.addCss(e.CDN+"/toysrus/tru_product.css");var s=jQuery("#familyProducts");if(1===s.length){for(var n=s.children(".prodloop_row_cont"),c=0;c<t.length&&!(c>n.length);c++){var p=n[c],l=jQuery(p).children(".prodloop_float");l.length>=a-1&&(l=jQuery(p).children(".prodloop_float:gt("+(a-2)+")").detach(),p.appendChild(t[c][0]),o(l,s,c+1))}i(s)}}return!0}},mobile:{onBeforeCall:function(r){return"REQUEST"==r.callType()&&(r.setProperty("creative","291x231_M-C-IG_TI_1_Mobile"),r.setProperty("maxMes","1"),r.setProperty("minOrganic","3")),!0},render:function(r,e){var t='<div class="pdtListCellCont hl-product '+e._ta.site+'">',o=r.urlParse(e.ProductPage),i=o.qs.hmclckthru,a=window.location.protocol+"//"+window.location.hostname+"/skava/static/product.html?type=TRU_product_us&url="+encodeURIComponent(i.split(".com")[1])+"&domain="+encodeURIComponent("http://www.toysrus.com"),s=e.ProductPage.split("hmClckThru")[0]+"hmClckThru="+encodeURIComponent(a);return t+=' <span class="banner"></span><div class="pdtListImgCont"> <a href="'+s+'"> <img class="pdtListImg" src="'+e.Image+'?resize=130%3A140" index="0"> </a> <div class="pdtAddToCartButton" onclick="HLLibrary.dropBeacon(\''+e.ClickBeacon+'\');" productlink="'+i.split(".com")[1]+'">Add to Cart</div></div> <div class="pdtListCellDetailsCont"> <a href="'+s+'"> <div class="pdtListTitle">'+e.ProductName+'</div> </a> <div class="pdtRatingImg" style="background-position : '+-19*(5-Math.floor(e.Rating||5))+'px 0px"></div> ',e.ComparePrice>e.Price&&(t+=' <div class="pdtListPrice" index="0">'+r.toNumber(e.ComparePrice)+"</div> "),t+=' <div class="pdtListPrice" index="1">'+r.toNumber(e.Price)+"</div> </div></div>"},onPageBind:function(r,e,t,o){function i(){window.outerWidth>768?(jQuery(".hookLogicCont").css("border-right","0.2em solid #CCC"),jQuery(".hookLogicCont").css("border-bottom","0")):(jQuery(".hookLogicCont").css("border-right","0"),jQuery(".hookLogicCont").css("border-bottom","0.2em solid #CCC"))}if(0==o.length)return!1;e.addCss(e.CDN+"/toysrus/tru_product_mobile.css");var a,s;for(a=0;a<t.length;++a)for(s=0;s<t[a].length;++s)o[0].appendChild(t[a][s]);return jQuery("div.hl-product").css("min-height",jQuery(".pdtListCellCont").css("min-height")),i(),jQuery(window).resize(function(){i()}),jQuery("#id_skcontent").trigger("hlRendered"),!0}}},onInit:function(r){(location.hostname.indexOf("toysrus.com")>-1||location.hostname.indexOf("babysrus.com")>-1)&&r.setOption("sync")},onBeforeCall:function(r,e){if("REQUEST"==r.callType()){r.setProperty("creative","172x3892_T-R-IG_TI_1-8_InGrid2"),r.setFilter("price",null),"75.00"==r.getProperty("minprice")&&"10.00"==r.getProperty("maxprice")&&r.setProperty("maxprice","100.00");var t=e.urlParse(window.location.toString()).qs;t.categoryid&&(t.hasOwnProperty("sr")?r.getProperty("taxonomy")||r.getProperty("keyword")||r.setTaxonomy(t.categoryid):(r.setTaxonomy(t.categoryid),r.setProperty("keyword",null)));var o=r.getProperty("maxads ");o&&(r.setProperty("maxads",o),r.setProperty("maxads ",null)),o=r.getProperty("minorganic "),o&&(r.setProperty("minorganic",o),r.setProperty("minorganic ",null));var i=r.getProperty("taxonomy");if(i)for(var a=["54227636"],s=0,n=a.length;n>s;++s)if(i==a[s]){r.setProperty("nodisplay","pubrequest-01");break}}else if("UPDATE"==r.callType()){var c=r.getProperty("productid"),p=r.getProperty("parentsku");if(r.setProperty("productid",p),r.setProperty("parentsku",c),jQuery)try{var l=jQuery("#price .list");if(l&&l.length>0){var d=l.text().replace(/\$/,"");/[\d\.]/.match(d)&&r.setProperty("regularPrice",d)}}catch(u){e.error("TRU update scrape failed - "+u.toString())}}return!0}};hl_key='db1d4221-1c70-46f9-8f5e-26d0b09a40c7';hl_api='www.hlserve.com';hl_beam='beam.hlserve.com';hl_cid=128;hl_debug=false;
/*
 * Contains browser detection code based on jQuery 1.8.3
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 */
var HLLibrary=(function(ext,apiKey,clientId,apiHost,beamHost,isDebug){ext=ext||{};ext.templates=ext.templates||{};var opts={};var callSeq=0;var history={};var lib={CDN:"//dnisjsqid2b9p.cloudfront.net",SYNC:"//"+beamHost+"/sync?dest="+location.protocol.replace(":","")+"%3A%2F%2Fidsync.rlcdn.com%2F382779.gif%3Fpartner_uid=[HMGUID]",ENV:(function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||(ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua))||[];var versions=(match[2]||"0").split(".");var env={browser:match[1]||"",version:versions[0]||"0",quirks:(document.compatMode!="CSS1Compat")};env.maxUrl=(env.browser=="msie"?2048:8192);return env}(navigator.userAgent)),log:function(){try{if(isDebug){lib.log=function(){try{if(typeof console==="undefined"||arguments.length==0){return}var args=Array.prototype.slice.call(arguments,0);args[0]="HL: "+args[0];console.log.apply(console,args)}catch(ex){try{console.log(ex.toString())}catch(e){}}};lib.log.apply(this,Array.prototype.slice.call(arguments,0))}else{lib.log=function(){}}}catch(ex){try{console.log(ex.toString())}catch(e){}}},error:function(ex){try{var match,line,col;if(ex.stack){match=/\(.+:(\d+):(\d+)\)/.exec(ex.stack)||[];line=match[1];col=match[2]}lib.log(ex.toString()+(line?" at "+line+":"+col:""));lib.dropBeacon(lib.toBeacon({msg:ex.toString(),line:line,col:col},beamHost+"/error"))}catch(ex){try{console.log(ex.toString())}catch(e){}}},getHistory:function(){return history},getCookie:function(name){try{name=name.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1");var m=document.cookie.match(new RegExp("(?:^|;)\\s?"+name+"=(.*?)(?:;|$)","i"));if(m){return decodeURIComponent(m[1])}}catch(ex){lib.error(ex)}return null},setCookie:function(name,value,expireDays){try{var expire=new Date();expire.setTime(expire.getTime()+(expireDays*24*60*60*1000));var cookie=name+"="+value+"; expires="+expire.toGMTString();document.cookie=cookie;lib.log("set cookie "+cookie)}catch(ex){lib.error(ex)}},urlParse:function(url){var kvps,kvp,i,j,results={full:String(url),qs:{}};i=url.indexOf("?");if(i<0){results.page=url}else{results.page=url.substring(0,i);kvps=url.substring(i+1).split("&");for(j=0;j<kvps.length;++j){kvp=kvps[j].split("=");if(kvp.length==2){results.qs[kvp[0].toLowerCase()]=decodeURIComponent(kvp[1].replace(/\+/g,"%20"))}}}return results},hasOption:function(code){return !!opts[code]},toNumber:function(value,fmt){fmt=fmt||lib.PriceUS;var s=parseFloat(value).toFixed(fmt[4]).split(".");return fmt[0]+s[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+fmt[2])+(fmt[4]>0?fmt[3]+s[1]:"")+fmt[1]},PriceUS:["$","",",",".",2],PriceUK:["£","",",",".",2],toUrl:function(url,params){if(url){var i=url.indexOf("//");var result=(i<0?"//"+url:url.substring(i));var kvps=[];for(i in params){kvps.push(encodeURIComponent(i)+"="+encodeURIComponent(params[i]))}if(kvps.length>0){result+=(result.indexOf("?")<0?"?":"&")+kvps.join("&")}return result}},toBeacon:function(params,endpoint){return lib.toUrl(endpoint||beamHost+"/beacon",params)},htmlDecode:function(str){var p=document.createElement("div");p.innerHTML=str.replace("&apos;","'");return p.innerText||p.textContent},htmlEncode:function(str){var p=document.createElement("div");p.innerText=p.textContent=str;return p.innerHTML.replace('"',"&quote;")},clip:function(text,maxLen,mode,elipsis){elipsis=elipsis||"";var i,c,re=/[\w-]/;if(text.length>maxLen){for(i=maxLen;i>0;--i){if(re.test(text.charAt(i))){for(--i;i>0&&re.test(text.charAt(i));--i){}if(i>0){return text.substr(0,i)+elipsis}}}if(mode==2||mode==3){for(i=maxLen+1;i<text.length;++i){if(re.test(text.charAt(i))){for(++i;i<text.length&&re.test(text.charAt(i));++i){}return text.substr(0,i)+elipsis}}}if(mode==1||mode==3){return text.substr(0,maxLen)+elipsis}}return text},newGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0;return(c=="x"?r:(r&3|8)).toString(16)})},getRand:function(a,b){return Math.floor(Math.random()*b+a)},isArray:function(o){return o!==null&&o!==undefined&&o.constructor===Array},isDom:function(o){return(typeof HTMLElement!=="undefined"?o instanceof HTMLElement:(o!==null&&typeof o==="object"&&o.nodeType===1&&typeof o.nodeName==="string"))},toDom:function(html){var p=document.createElement("div");p.innerHTML=html;return p.children},addCss:function(url){var t=document.createElement("link");t.rel="stylesheet";t.type="text/css";t.href=url;document.getElementsByTagName("head")[0].appendChild(t)},addScript:function(src,async){var tag=document.createElement("script");tag.type="text/javascript";tag.async=async;tag.src=src;document.getElementsByTagName("head")[0].appendChild(tag)},addIframe:function(src){var tag=document.createElement("iframe");tag.src=src;tag.width=0;tag.height=0;tag.style.visibility="hidden";document.getElementsByTagName("body")[0].appendChild(tag)},dropBeacon:function(url){var img=document.createElement("img");img.src=lib.toUrl(url);lib.log("beaconed "+img.src)},newRequest:function(){return new ApiRequest(++callSeq)},newUpdate:function(){return new ApiUpdate(++callSeq)},newOrder:function(){return new ApiOrder(++callSeq)},newEvent:function(){return new ApiEvent(++callSeq)},newOrganicUpdate:function(){return new ApiOrganic(++callSeq)},setOption:function(code){opts[code]=1}};var supported=(function(env){return !(env.browser=="msie"&&(env.version<8||env.version==8&&env.quirks))})(lib.ENV);isDebug=!!isDebug||lib.getCookie("debug-mode")!==null;var organicGUID=lib.newGUID();_callExtension(null,"onInit",lib);if(lib.hasOption("sync")){lib.addIframe(lib.SYNC)}function _api(host,params,callback){var fn="hl_c"+lib.getRand(1000000,9999999);params.json=fn;window[fn]=function(data){callback(data);window[fn]=undefined;try{delete window[fn]}catch(ex){}};if(params.apikey){params.apiKey=params.apikey;delete params.apikey}var call=lib.toUrl(host,params);lib.addScript(call,true);lib.log("called "+call)}function _callExtension(namespace,name){var method,label;if(namespace&&ext.templates[namespace]&&typeof ext.templates[namespace][name]==="function"){method=ext.templates[namespace][name];label=namespace+"."+name}else{if(typeof ext[name]==="function"){method=ext[name];label="global."+name}else{return undefined}}lib.log("--> "+label);var result=method.apply(null,Array.prototype.slice.call(arguments,2));lib.log("<-- "+label);return result}function _extend(target,source){for(var i in source){if(!target.hasOwnProperty(i)){target[i]=source[i]}}}var Api=function(type,isBeacon,id){var my={params:{},filters:{},tmpl:null,attr:{},divs:[],maps:{},endpoint:null,require:{}};this.my=my;this.callType=function(){return type};this.getProperty=function(name){var key=name.toString().toLowerCase();return my.params[key]||null};this.setProperty=function(name,value){try{var key=name.toString().toLowerCase();if(my.maps[key]){key=my.maps[key]}if(key=="nodisplay"){return this.setProperty("displaya","0").setProperty("rsn",value)}if(value===null||value===undefined||value===""){if(my.params.hasOwnProperty(key)){delete my.params[key];lib.log(type+" ("+id+") unset-prop "+name)}else{lib.log(type+" ("+id+") set-prop "+name+" = <*empty*>")}}else{my.params[key]=value;lib.log(type+" ("+id+") set-prop "+name+" = "+value)}}catch(ex){lib.error(ex)}return this};this.getAttribute=function(name){var key=name.toString().toLowerCase();return my.attr[key]||null};this.setAttribute=function(name,value){try{var key=name.toString().toLowerCase();if(value===null||value===undefined||value===""){if(my.attr.hasOwnProperty(key)){delete my.attr[key];lib.log(type+" ("+id+") unset-attr "+name)}}else{my.attr[key]=value;lib.log(type+" ("+id+") set-attr "+name+" = "+value)}}catch(ex){lib.error(ex)}return this};this.submit=function(){try{if(isBeacon){this.setProperty("cid",clientId);this.setProperty("pid",lib.newGUID())}else{this.setProperty("apikey",apiKey.toUpperCase());this.setProperty("useState","1");this.setAttribute("clientid",clientId)}this.setProperty("_",lib.getRand(1,100000000000));this.setProperty("~uid",organicGUID);if(!my.params.hasOwnProperty("puserid")){var puserid=(function(){var c=lib.getCookie("s_vi");if(!c){c=lib.getCookie("__utma");if(c){c=c.split(".").slice(0,3).join(".")}else{c=lib.getCookie("hl_p");if(!c&&!lib.hasOption("no-cookie")){c=lib.newGUID();lib.setCookie("hl_p",c)}}}return c}());this.setProperty("puserid",puserid)}_callExtension(my.tmpl,"onBeforeCall",this,lib);my._prep.apply(null,Array.prototype.slice.call(arguments,0));if(!my._isValid()){return}if(isDebug){history[id]={module:my.tmpl,type:type,endpoint:my.endpoint,call:my.params}}if(isBeacon){lib.dropBeacon(lib.toBeacon(my.params,my.endpoint))}else{_api(my.endpoint,my.params,my._cb)}}catch(ex){lib.error(ex)}};my._isValid=function(){var i,result=true;for(i in my.require){if(!my.params.hasOwnProperty(i)){result=false;lib.log(type+" ("+id+") Validation Error: Missing property '"+my.require[i]+"'")}}return result};my._prep=function(){return};my._cb=function(response){try{lib.log(type+" ("+id+") API Response",response);if(response.PageBeacon){lib.dropBeacon(response.PageBeacon)}}catch(ex){lib.error(ex)}}};var ApiUpdate=function(id){var base=new Api("UPDATE",false,id);var my=base.my;delete base.my;my.endpoint=apiHost+"/delivery/api/product";my.maps={hlpagetype:"hlpt",instock:"quantity",sku:"productid",regularprice:"compareprice",publishersku:"pgid",sellerid:"advertiserid"};my.require={productid:"sku",quantity:"inStock"};return base};var ApiOrganic=function(id){var base=new Api("ORGANIC",true,id);var my=base.my;delete base.my;my.endpoint=beamHost+"/skudata";my.maps={hlpagetype:"hlpt",skuid:"organicskus"};my.require={organicskus:"organicSKUs"};my._prep=function(){base.setProperty("action","skudata")};return base};var ApiOrder=function(id){var base=new Api("ORDER",false,id);var my=base.my;delete base.my;my.endpoint=apiHost+"/delivery/api/confirmation";my.maps={hlpagetype:"hlpt",sku:"productid",sellerid:"advertiserid"};my.require={productid:"sku",price:"price",quantity:"quantity"};return base};var ApiEvent=function(id){var base=new Api("EVENT",true,id);var my=base.my;delete base.my;my.endpoint=beamHost+"/beacon";my.maps={hlpagetype:"hlpt",sku:"prodid",parentsku:"psku",publishersku:"pgrp",eventtype:"ec",eventdata:"ep",attributionId:"add_id"};my.require={prodid:"sku",ec:"eventType"};my._prep=function(){base.setProperty("action","logevent");if(typeof my.params.ep==="object"){base.setProperty("ep",lib.JSON.stringify(my.params.ep))}};return base};var ApiRequest=function(id){var base=new Api("REQUEST",false,id);var my=base.my;delete base.my;my.maps={hlpagetype:"hlpt",organicskus:"skuid"};my._isValid=function(){var result=true;if(my.tmpl===null){lib.log("REQUEST ("+id+") Failed Validation: The setModule call is missing or refers to a non-existant module.");result=false}if(!my.params.taxonomy&&!my.params.keyword){lib.log("REQUEST ("+id+") Failed Validation: Missing call to setTaxonomy or setKeyword");result=false}return result};my._prep=function(){if(!supported){base.setProperty("nodisplay","notsupported");base.setAttribute("_unsupported",true)}var a,i,filters=lib.JSON.stringify(my.filters);if(filters!="{}"){base.setProperty("filters",filters)}for(var i=0;i<arguments.length;++i){a=arguments[i];if(lib.isDom(a)){my.divs.push(a)}else{var div=document.getElementById(a.toString());if(div!==null){my.divs.push(div)}}}if(my.params.hasOwnProperty("skuid")){var organic=lib.newOrganicUpdate();var copy=["skuid","cuserid","puserid"];for(var i=0;i<copy.length;++i){if(my.params.hasOwnProperty(copy[i])){organic.setProperty(copy[i],my.params[copy[i]])}}organic.submit();if(lib.hasOption("sku-filter")&&my.params.hasOwnProperty("filters")){base.setProperty("skuLookupOnly","true")}else{base.setProperty("skuid",null)}}my.endpoint=apiHost+"/delivery/api/"+(my.params.taxonomy?"taxonomy":"search")};my._cb=function(response){try{var i,j,c,d,temp,depth,ads,pb,content=[],backup;ads=response.ProductAd||response.SearchProductAd||[];if(ads.length===0&&lib.hasOption("kw-seq")&&my.kwSeq&&my.kwIdx<my.kwSeq.length-1){lib.log("REQUEST ("+id+") kw-seq fallback");base.setKeyword(my.kwSeq[++my.kwIdx]);base.submit();return}if(ads.length===0&&lib.hasOption("auto-retry")&&my.retry!==true){lib.log("REQUEST ("+id+") auto-retrying");my.retry=true;base.submit();return}for(i=0;i<ads.length;++i){ads[i]._ra=lib.JSON.parse(ads[i].RenderingAttributes||"{}");ads[i]._used=true;ads[i].Count=ads.length;ads[i].Index=i}var pb=lib.urlParse(response.PageBeacon);if(my.kwSeq&&my.kwIdx>0){pb.qs.fbkw=my.kwSeq.slice(0,my.kwIdx).join("|")}_callExtension(my.tmpl,"onPreRender",base,lib,ads,pb.qs);depth=my.attr.encode||1;for(i=0;i<ads.length;++i){if(ads[i].ProductName){ads[i].ProductName=lib.htmlDecode(lib.htmlDecode(ads[i].ProductName))}ads[i]._ta=my.attr;if(ads[i].ProductPage){temp=lib.toUrl(ads[i].ProductPage);if(my.attr.linkprefix){temp="http:"+temp;for(j=0;j<depth;++j){temp=encodeURIComponent(temp)}temp=lib.toUrl(my.attr.linkprefix+temp)}ads[i].ProductPage=temp}content.push(lib.toDom(_callExtension(my.tmpl,"render",lib,ads[i])))}var divFound=true;if(ads.length>0){divFound=_callExtension(my.tmpl,"onPageBind",base,lib,content,my.divs);divFound=(divFound===undefined?false:divFound)}else{divFound=_callExtension(my.tmpl,"onNoContent",base,lib,my.divs);divFound=(divFound===undefined?true:divFound)}if(!divFound){pb.qs.c="O"}lib.dropBeacon(lib.toUrl(pb.page,pb.qs));if(pb.qs.action!="universal"&&divFound&&!lib.hasOption("no-imps")){for(i=0;i<ads.length;++i){if(ads[i].ImpBeacon&&ads[i]._used){lib.dropBeacon(ads[i].ImpBeacon)}}}}catch(ex){lib.error(ex)}};base.setModule=function(module){try{if(module.indexOf("_")>-1){var t=module.split(/_/);module=t[t.length-1]}if(ext.templates.hasOwnProperty(module)){my.tmpl=module;lib.log("REQUEST ("+id+") template = "+module)}else{throw new Error("Template "+module+" not found")}}catch(ex){lib.error(ex)}return base};base.setTaxonomy=function(taxonomy){return base.setProperty("taxonomy",taxonomy)};base.setKeyword=function(kw){if(kw!==null&&kw!==undefined){if(lib.hasOption("kw-seq")&&lib.isArray(kw)&&kw.length>0){my.kwSeq=kw;my.kwIdx=0;lib.log("REQUEST ("+id+") using kw-seq: ",kw);return base.setKeyword(kw[0])}else{return base.setProperty("keyword",kw.toString().replace(/[^A-Za-z0-9_ -]/g,"").toLowerCase())}}return base};base.setFilter=function(name,value,delimiter){try{delimiter=delimiter||"|";var key=name.toString().toLowerCase();if(value===null||value===undefined||value===""){if(my.filters.hasOwnProperty(key)){delete my.filters[key];lib.log("REQUEST ("+id+") unset-filter "+name)}else{lib.log("REQUEST ("+id+") set-filter "+name+" = <*empty*>")}}else{value=value.toString();my.filters[key]=(value.indexOf(delimiter)>-1)?value.split(delimiter):value;lib.log("REQUEST ("+id+") set-filter "+name+" = "+value)}}catch(ex){lib.error(ex)}return base};return base};return lib}(hl_ext,hl_key,hl_cid,hl_api,hl_beam,hl_debug));if(!window.JSON){HLLibrary.JSON={};HLLibrary.JSON.parse=function(j){return eval("("+j.replace(/[\n\r]/g,"")+")")};HLLibrary.JSON.stringify=function(v){if(v instanceof Object){var s="";if(v.constructor===Array){for(var i=0;i<v.length;s+=this.stringify(v[i])+",",i++){}return"["+s.substr(0,s.length-1)+"]"}if(v.toString!==Object.prototype.toString){return'"'+v.toString().replace(/"/g,"\\$&")+'"'}for(var p in v){s+='"'+p.replace(/"/g,"\\$&")+'":'+this.stringify(v[p])+","}return"{"+s.substr(0,s.length-1)+"}"}return typeof v==="string"?'"'+v.replace(/"/g,"\\$&")+'"':String(v)}}else{HLLibrary.JSON=window.JSON}delete hl_ext;delete hl_key;delete hl_cid;delete hl_api;delete hl_beam;delete hl_debug;