_mf_tag = {
  "init": function() {
    var id = 'mf_div';
    var div = this.create_element(document, ['div', 'id', id]);
    if (div) {
      div.style.display = "none";
      var body = document.getElementsByTagName('body')[0].firstChild;
      if(body) body.parentNode.insertBefore(div, body);
      var referrer = "&referrer=" + encodeURIComponent(location.href);
      var mf_query_string = this.find_our_tag();
      var mf_piggy_string = "";
      if (mf_query_string.length > 0) mf_piggy_string = "?" + mf_query_string;
      if (mf_query_string.length > 0) mf_query_string = "&" + mf_query_string;
      var iframe = '<' + 'iframe src="//tags.mediaforge.com/pix/511?type=pos' + mf_query_string + referrer + '" width="0" height="0"></iframe>';
      this.inner_html(id, iframe);
      if (mf_query_string.indexOf('orderNumber') != -1) {
        var fb_script = document.createElement('script');
        if (fb_script) {
          fb_script.setAttribute('type', 'text/javascript');
          fb_script.src = "//tags.mediaforge.com/js/1569" + mf_piggy_string;
          if (body) body.parentNode.insertBefore(fb_script, body);
        }
        var bt_script = document.createElement('script');
        if (bt_script) {
          bt_script.setAttribute('type', 'text/javascript');
          bt_script.src = "//tags.mediaforge.com/js/1570" + mf_piggy_string;
          if (body) body.parentNode.insertBefore(bt_script, body);
        }
        var script_2617 = document.createElement('script');
        if (script_2617) {
          script_2617.setAttribute('type', 'text/javascript');
          script_2617.src = "//tags.mediaforge.com/js/2617" + mf_piggy_string;
          if (body) body.parentNode.insertBefore(script_2617, body);
        }
      }
      this.set_timeout(3000);
      var __stormJs = 't1.stormiq.com/dcv4/jslib/5793_A540772E_7258_4156_BD1C_E2B9DF06FE3E.js';
      var TrackBasket=function(){};var TrackCustParam=function(){this.lc=0;};var saleTrack=new TrackBasket(),customTrack=new TrackCustParam(),__pxi=new Image(1,1),__ofsi=[],__ofcp=[],__ofcs=[],__ofsr=[],__ofpv=[],__ofic,__prt;TrackBasket.prototype.addSaleItem=function($ic,$iv,$m1,$m2,$m3,$m4){var $t=[];$t[0]=$ic;$t[1]=$iv;$t[2]=($m1===undefined)?"":$m1;$t[3]=($m2===undefined)?"":$m2;$t[4]=($m3===undefined)?"":$m3;$t[5]=($m4===undefined)?"":$m4;__ofsi.push($t);};TrackBasket.prototype.logSale=function($i){__ofic=$i;};TrackBasket.prototype.logClickOutSale=function(cnv,mid,rdr,exp){this.cos={cnv:cnv,mid:mid,rdr:rdr,exp:exp,itm:__ofsi[0]};__ofsi=[];};TrackCustParam.prototype.logCustomParameter=function(){};TrackCustParam.prototype.addCustomParameter=function($k,$v){var $t=[];$t[0]=$k;$t[1]=$v;$t[2]='';__ofcp.push($t);};TrackCustParam.prototype.logStoredParameters=function($type){var $i;this.lc+=1;if($type===undefined){$type='iqpage';}
      if($type.toLowerCase().indexOf("iq")!==0){$type="iq"+$type;}
      for($i=0;$i<__ofcp.length;$i++){if(__ofcp[$i][2]===''){__ofcp[$i][2]=$type;__ofcp[$i][3]=this.lc;}}};function rdr($r,$n){if($r!==undefined){if($r.href!==undefined){$r.href=$r;}else{if($n===undefined){$n="";}
      if($n.toLowerCase()==='true'){window.open($r);}else{self.location=$r;}}}}
      function logOCSale($p,$r,$n){var $t=[];$t[0]=$p;$t[1]=$r;$t[2]=$n;__ofcs.push($t);rdr($r,$n);}
      function logOCSearch($s,$p,$d){var $t=[];$t[0]=$s;$t[1]=$p;$t[2]=$d;__ofsr.push($t);}
      function logOCPV($p,$r,$n){var $t=[];$t[0]=$p;$t[1]=$r;$t[2]=$n;__ofpv.push($t);rdr($r,$n);}
      function genProc($arg){}
      function getCkVal(cn){return(document.cookie.indexOf(cn)===-1)?'':document.cookie.substring(document.cookie.indexOf(cn),(document.cookie+';').indexOf(';',document.cookie.indexOf(cn)));}
      var _stdbg={ckn:'_#stdbg',rc:"",chkLog:function(){var loc=document.location.search.replace("?","");if(loc===""){return;}
      var pars=loc.split("&"),par=0,qsp=[];for(par=0;par<pars.length;par++){if(pars[par].substring(0,3)==="_st"){qsp.push(pars[par]);}}
      if(qsp.length>0){var di=0,cc=decodeURIComponent(getCkVal(this.ckn).replace(this.ckn+"=",""));if(cc.length===0){this.rc=qsp.join("&");}else{var cps=cc.split("&"),nps=[];for(par=0;par<cps.length;par++){var ckv=cps[par].split("=");for(di=0;di<qsp.length;di++){var qkv=qsp[di].split("=");if(ckv[0]===qkv[0]){ckv[1]=qkv[1];qsp[di]="";break;}}
      nps.push(ckv[0]+"="+ckv[1]);}
      this.rc=nps.join("&")+"&"+qsp.join("&");this.rc.replace("&&","&");if(this.rc.substring(this.rc.length-1)==="&"){this.rc=this.rc.substring(0,this.rc.length-1);}}
      var dt=new Date();dt.setHours(dt.getHours()+25);var ck=this.ckn+'='+encodeURIComponent(this.rc)+'; path=/; expires='+dt.toGMTString();document.cookie=ck;}},isDbg:function(dbg){if(this.rc===""){this.rc=decodeURIComponent(getCkVal(this.ckn).replace(this.ckn+"=",""));}
      if(this.rc===""){return false;}
      var pars=this.rc.split("&"),par=0;for(par=0;par<pars.length;par++){var kv=pars[par].split("=");if(kv.length===2&&kv[0].toUpperCase()===dbg.toUpperCase()){return kv[1]==="1";}}
      return false;}};function setLC(){var dt=new Date();dt.setMinutes(dt.getMinutes()+20);var ck='_#lc=#; expires='+dt.toGMTString();document.cookie=ck;}
      function stormInst(nu){_stdbg.chkLog();if(!nu){setLC();}
      if(_stdbg.isDbg("_stcoredbg")){var p=__stormJs.split("/");p[p.length-1]="q."+p[p.length-1];__stormJs=p.join("/");}
      __stormJs=__stormJs.replace('https://','').replace('http://','');__stormJs=__prt+__stormJs;var scr=document.createElement('script');scr.setAttribute('type','text/javascript');scr.setAttribute('src',__stormJs);document.getElementsByTagName('head')[0].appendChild(scr);}
      __prt=(("https:"===document.location.protocol)?"https://":"http://");if(typeof(__stormJs)!=='undefined'){try{if(getCkVal('_#lc')===''){var $px=(__stormJs.replace('https://','').replace('http://','')).split('/')[0];__pxi.onload=stormInst;__pxi.src=__prt+$px+"/px.gif";}else{stormInst(true);}}catch(e){}}
      if(typeof(Storm)==="undefined")Storm={};Storm.DataLayer=new function(){var self=this;self.data={};self.put=function(key,value,store){if(typeof(store)==="undefined")store="user";if(typeof(self.data[store])==="undefined")self.data[store]={}
      self.data[store][key]=value;};self.get=function(key,store){if(typeof(store)==="undefined")store="user";if(typeof(self.data[store])==="undefined")self.data[store]={}
      if(typeof self.data[store][key]==="undefined")return null;return self.data[store][key]};};
      this.storm_data(mf_query_string);
    }  
  },
  "storm_data": function(mf_query_string) {
    if (mf_query_string.indexOf('orderNumber') != -1) {
      var parameters = mf_query_string.split('&');
      var mf_price = "";
      var mf_ordernumber = "";
      for (var param_index = 0; param_index < parameters.length; param_index++) {
        if (parameters[param_index].indexOf('orderNumber') != -1) {
          var split_query = parameters[param_index].split('=');
          if (split_query.length == 2) mf_ordernumber = split_query[1];
        }
        if (parameters[param_index].indexOf('price') != -1) {
          var split_query = parameters[param_index].split('=');
          if (split_query.length == 2) mf_price = split_query[1];
        }
      }
      var dc_trans = {
        orderid : mf_ordernumber,
        totalPrice : mf_price
      }; 
      Storm.DataLayer.put('transaction', dc_trans);
      Storm.DataLayer.put('pageName', 'conversion_page');
    }
  },
  "create_element": function(doc, def, parent) {
    var el = null;
    if(typeof doc.createElementNS != "undefined")
    el = doc.createElementNS('http://www.w3.org/1999/xhtml', def[0]);
    else if(typeof doc.createElement != "undefined")
    el = doc.createElement(def[0]);
    if(!el)
    return false;
    for(var i = 1; i < def.length; i++)
    el.setAttribute(def[i++], def[i]);
    if(parent)
    parent.appendChild(el);
    return el;
  },
  "set_timeout": function(t) {
    this.timeout = setTimeout('timeout_mf()', t ? t : 3000);
  },
  "inner_html": function(id, html) {
    document.getElementById(id).innerHTML = html;
  },
  "find_our_tag": function() {
    var query_string = "";
    var scripts = document.getElementsByTagName('script');
    for (var script_index = 0; script_index < scripts.length; script_index++) {
      script_name = scripts[script_index].src;
      if (script_name.indexOf("tags.mediaforge.com") != -1) {
        var index = script_name.indexOf("?");
        if (index > -1) {
          query_string = script_name.substr(index + 1);
          break;
        }
      }
    }
    return query_string;
  }
};

function timeout_mf() {
  var t = _mf_tag.timeout;
  if(t) _mf_tag.inner_html('mf_div', '');
}

_mf_tag.init();
