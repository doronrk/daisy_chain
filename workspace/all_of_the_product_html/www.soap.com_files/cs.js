$(document).ready(function(){clickStream.bindClientStartTime();clickStream.changeTopNavLink();var b=clickStream.getClickStreamJson();if(!b){return}var a=clickStream.ignoreRequestInBrowsePage(b);if(a){return}clickStream.bindSearchParams(b);clickStream.changeLink();clickStream.sendRequest(b);clickStream.bindClickStreamTagClick()});$(document).ajaxComplete(function(b,d){var c=d.getResponseHeader("ClickStream");var a=$.parseJSON(c);if(!a){return}clickStream.bindPdpParames(a);clickStream.sendRequest(a);clickStream.bindClickStreamTagClick();clickStream.reviseRefTag()});$(document).ajaxStop(function(){clickStream.changeLink()});var clickStream=(function(){var b={pageType:"page-type",subPageType:"sub-page-type",hitType:"hitType",tabId:"tab-id",siteVariant:"site_variant",customerId:"customer-id",info:"Info",ignoreRequest:"IgnoreRequest",pageTypeIdSource:"page-type-id-source",quidsiRegion:"quidsi-region"};var z=[b.pageType,b.subPageType,b.hitType,b.tabId,b.siteVariant,b.customerId];var u=[b.quidsiRegion,b.pageType,b.subPageType,b.hitType,b.tabId,b.siteVariant,b.customerId];function m(K){var L=new Object();var N=K.Info.split(",");for(var J=0;J<N.length;J++){var M=N[J].split("=");if(M.length!=2){return}L[M[0]]=M[1]}return L}function I(M,O){if(!M){return}if(!O){O=B(M)}var L=/^(http:\/\/|https:\/\/)/;var N=M.RequestAPI.replace(L,"");var K=document.location.protocol+"//"+N+"?json="+encodeURIComponent(O)+"&random="+Math.random();var J=new Image();J.src=K}function y(K){if(K&&K.EnableLog){var L=$("<table></table>");for(var J in K){L.append("<tr><td>"+J+"</td><td>"+d(K[J])+"</td></tr>")}L.append("<br />");$("body",window.top.document).append(L)}}function d(L){var K=document.createElement("div");(K.textContent!=null)?(K.textContent=L):(K.innerText=L);var J=K.innerHTML;K=null;return J}function B(L){var M=[];var J=function(N){if(typeof N=="object"&&N!=null){return B(N)}return/^(string|number)$/.test(typeof N)?'"'+N+'"':N};for(var K in L){if(K=="ClickstreamInfo"&&L[K]!=null){M.push('"'+K+'":'+JSON.stringify(L[K]))}else{M.push('"'+K+'":'+J(L[K]))}}return"{"+M.join(",")+"}"}function q(K){var L=f();var J=$(L).closest("["+K+"]");return J.attr(K)}function f(){var J=h();if(!J){return null}J=J.target||J.srcElement;return J}function h(){if(document.all){return window.event}func=h.caller;while(func!=null){var J=func.arguments[0];if(J){if((J.constructor==Event||J.constructor==MouseEvent)||(typeof(J)=="object"&&J.preventDefault&&J.stopPropagation)){return J}}func=func.caller}return null}function k(K,J,L){var M=m(K);M[J]=L;e(K,M)}function F(K,J){var L=m(K);delete L[J];e(K,L)}function E(K,J){var M=m(K);if(J in M){var L=M[J];delete M[J];M[J]=L;e(K,M)}}function e(K,L){var M="";for(var J in L){M+=J+"="+L[J]+","}K.Info=M.substring(0,M.length-1)}function s(K,J){if(J==undefined){J=q("reftag")}if(J){if(J.indexOf("=")>=0){J=J.substring(J.indexOf("=")+1)}k(K,"ref-override",J)}}function l(N,K){var M=new Date().getTime();var L=$("body").data("clientStartTime");var J=10000;N.StartTime=K+M-L;N.EndTime=parseInt(N.StartTime)+J}function o(J,K){if(K==undefined){K=q("hitType")}if(K==undefined){K="pageHit"}else{switch(K.toLowerCase()){case"pagehit":K="pageHit";break;case"popup":K="popUp";break;case"pagetouch":K="pageTouch";break;default:break}}k(J,"hitType",K)}function x(K,J,M){if(J==undefined){J=q("pageType")}if(M==undefined){M=q("subPageType")}if(J){k(K,"page-type",J);if(M==undefined){M=""}var N=m(K);var L=N["sub-page-type"].substring(0,N["sub-page-type"].indexOf("-")+1);k(K,"sub-page-type",L+M)}}function D(K,J){if(J){k(K,"page-type-id",J)}}function n(J,K){if(K){k(J,"groupingASIN",K)}}function C(K,J){if(J){k(K,"ProductGlId",J)}}function j(L,J){if(J){var M=m(L);var K="event-quidsi-action."+M["page-type-id"];F(L,K);k(L,"event-quidsi-action."+J,"DISCOVERY")}}function A(J){k(J,b.pageTypeIdSource,"externalAsin")}function p(J){k(J,"is-glance-view","Y")}function w(){var K="VISITOR_ID";var J=document.cookie.match(new RegExp("(^| )"+K+"=([^;]*)(;|$)"));if(J!=null){return unescape(J[2])}return null}function G(J){var K=$(J).text()||$("#clickStreamJson").text();if(K){return $.parseJSON(K)}return undefined}function i(M){var N=G(M);var J=[];if(N){var O=m(N);for(var L=0;L<z.length;L++){var K=z[L];if(K in O){J.push(K+"="+O[K])}}}if(J.length>0){N[b.info]=J.join(",")}return N}function r(){var M=G();var J=[];if(M){var N=m(M);for(var L=0;L<u.length;L++){var K=u[L];if(K in N){J.push(K+"="+N[K])}}}if(J.length>0){M[b.info]=J.join(",")}return M}function H(K,J){J=J||$("#clickStreamJson").attr("pageTypeShortHand");if(K&&J){K=K.replace("@pageType",J)}return a(K,"_@pageType")}function c(J,K){K=K||$("#clickStreamJson").attr("subPageTypeShortHand");if(J&&K){J=J.replace("@subPageType",K)}return a(J,"_@subPageType")}function g(K,J){if(K&&J){K=K.replace("@position",J)}return a(K,"_@position")}function a(J,K){if(J){return J.replace(K,"")}return J}function v(J,L){var K=G();if(K){K[J]=L;$("#clickStreamJson").text(B(K))}}function t(N,M){var L=M.split("=");var J=L[0];if(N.indexOf("&"+J+"=")>=0||N.indexOf("?"+J+"=")>=0){var K=new RegExp(J+"=[^&]*");N=N.replace(K,M);return N}N+=(N.indexOf("?")>0?"&":"?")+M;return N}return{sendClientRequest:function(J,K,N,M){var L=i();if(!L){return}s(L,J);l(L,parseInt(L.EndTime));o(L,N);x(L,K,M);L.HTTP_REFERER=document.location.href;clickStream.sendRequest(L)},sendRequest:function(J,K){if(!J||J.IgnoreRequest==true){return}I(J,K);y(J)},getHtmlAttribute:function(J){return q(J)},getRefByHtmlAttribute:function(){return q("reftag")},appendRef:function(K,J){J=J||clickStream.getRefByHtmlAttribute();if(K&&J){K=t(K,J)}return K},appendClickStreamInfo:function(L,K,J){if(!L){return L}var M=[];K=K||$("#clickStreamJson").attr("pageType");if(K){M.push("pageType="+K)}J=J||clickStream.getRefByHtmlAttribute();if(J){M.push(J)}if(M.length>0){L+=(L.indexOf("?")>0?"&":"?")+M.join("&")}return L},getClickStreamObj:function(J){J=J||f();var K=new Object();K.pageType=$(J).attr("pageType");K.subPageType=$(J).attr("subPageType");K.reftag=$(J).attr("reftag");K.hitType=$(J).attr("hitType");return K},bindClientStartTime:function(){$("body").data("clientStartTime",new Date().getTime())},bindClickStreamTagClick:function(){$(".clickStreamTag").click(function(){clickStream.sendClientRequest()});$(".clickStreamTag").removeClass("clickStreamTag")},appendClickStreamTag:function(J){$(J).addClass("clickStreamTag")},changeLink:function(){$(".cSChangeLink").each(function(){var J=$(this).closest("[reftag]").attr("reftag");var K=$(this).find("a").attr("href");if(K&&J){var L=K+(K.indexOf("?")!=-1?"&":"?")+J;$(this).find("a").attr("href",L);$(this).removeClass("cSChangeLink")}})},changeTopNavLink:function(){$("#siteNav a").each(function(){var J=$(this).attr("reftag");var K=$(this).attr("href");if(K&&K.toLowerCase().indexOf("javascript")<0&&J){J=H(J,$("#clickStreamJson").attr("pageTypeShortHand")||"gpt");J=c(J);K=clickStream.appendRef(K,J);$(this).attr("href",K)}})},reviseRefTag:function(K){var J=1;K=K||$(".cSReftag");K.each(function(){var L=$(this).attr("reftag");if(L){if(L.indexOf("@pageType")>0){L=H(L)}if(L.indexOf("@subPageType")>0){L=c(L)}if(L.indexOf("@position")>0){L=g(L,J++)}$(this).attr("reftag",L)}})},syncVisitorIdSendClickStream:function(){v(b.ignoreRequest,false);var J=clickStream.getClickStreamJson();if(!J){return}J.Session=w();clickStream.sendRequest(J)},getClickStreamJson:function(J){return G(J)},sendDiscoveryRequest:function(M,K,P,O,J,L,Q){var N=r();if(!N){return}x(N,M,"");D(N,P||K);if(!P){A(N)}n(N,O);C(N,J);s(N,L);j(N,P||K);p(N);l(N,parseInt(N.EndTime));o(N,Q);N.HTTP_REFERER=document.location.href;clickStream.sendRequest(N)},bindEasyReorderClickStream:function(N,J){var L=$(N).attr("subPageTypeShortHand");var K=$(N).attr("reftag");var M=easyReorderClickStream.subPageTypeShortHand;if(K&&M){easyReorderClickStream.reftag=K.replace("@subPageType",M)}easyReorderClickStream.pageTypeId=J||$(N).attr("pageTypeId");easyReorderClickStream.subPageType=$(N).attr("subPageType")||easyReorderClickStream.subPageType;easyReorderClickStream.actionPageType=$(N).attr("actionPageType")||easyReorderClickStream.actionPageType;easyReorderClickStream.subPageTypeShortHand=L||easyReorderClickStream.subPageTypeShortHand},sendEasyReordersClientRequest:function(M,N,P,J,Q){var L=i($("#mlClickStreamJson"));if(!L){return}var O=clickStream.getClickStreamJson();var K=O?O.EndTime:L.EndTime;s(L,M);l(L,parseInt(K));o(L,Q);x(L,N,P);D(L,J);L.HTTP_REFERER=document.location.href;clickStream.sendRequest(L)},easyReorderClickStreamClear:function(){$("#mlClickStreamJson").remove();if(typeof(easyReorderClickStream)!="undefined"){easyReorderClickStream.subPageType="";easyReorderClickStream.subPageTypeShortHand="";easyReorderClickStream.reftag="";easyReorderClickStream.actionPageType="";easyReorderClickStream.pageTypeId=""}},ignoreRequestInBrowsePage:function(K){if(!K){return false}var N=m(K);var J=N["tab-id"].toLowerCase();if(J!="look"){return false}var M=window.location.pathname.toLowerCase();var L=window.location.hash.toLowerCase();if(M.indexOf("/cat=")>-1||M.indexOf("/subcat=")>-1||M.indexOf("/buy")>-1||M.indexOf("/b/")>-1||M.indexOf("/clothing-clearance")>-1||M.indexOf("/shoes-clearance")>-1||M.indexOf("/shoes-new-arrivals")>-1||M.indexOf("/shoes-best-sellers")>-1||M.indexOf("/shoes-outlet")>-1||M.indexOf("/gift-cards")>-1){if(L&&L!="#fromsearch=y"&&L.indexOf("=")>-1){return true}}return false},bindSearchParams:function(J){if(location.href.toLowerCase().indexOf("s=")>-1||location.href.toLowerCase().indexOf("subcat=")>-1){if(typeof(clickStreamParams)!="undefined"&&clickStreamParams.qid){k(J,"qid",clickStreamParams.qid);E(J,"alias-or-index");k(J,"total-found",clickStreamParams.totalFound)}}},bindDiscoveryRequest:function(O,P,N){if(N||!O||!P){return}var M=$(O).attr("asin");var L=$(O).attr("ProductId");var J=$(O).attr("ProductGlId");var K=clickStream.getRefByHtmlAttribute();clickStream.sendDiscoveryRequest("F-PDPSkuSelection",P,M,L,J,K,"pageTouch")},bindDiscoveryRequestForUniversalTemplate:function(O,P,N){if(N||O==null||P==null||P==""){return}var M=O.Asin;var L=O.ProductId;var J=O.ProductGlId;var K=clickStream.getRefByHtmlAttribute();clickStream.sendDiscoveryRequest("F-PDPSkuSelection",P,M,L,J,K,"pageTouch")},bindClickStreamRequestOnSelect:function(K,J){if(K&&J){$(J).on("change",function(){var L=$(this).val();clickStream.sendClientRequest(K[L])})}},bindPdpParames:function(L){var J=location.href.toLowerCase();if(J.indexOf("/p/")>-1&&J.indexOf("qid=")>-1&&J.indexOf("sr=">-1)){var M=getURLParameter("qid");var K=getURLParameter("sr");if(typeof(M)!="undefined"&&typeof(K)!="undefined"){k(L,"qid",M);k(L,"sr",K)}}}}}());