define("emailLightbox/bootstrapEmailAcquisitionModal",["jquery","ko","get!pageLocation/pageLocation","get!googleTagManager/eBagsGtm","bootstrapShim"],function(n,t,i,r){"use strict";function u(u){var f=this,e=n.extend({},{modalSelector:"#emailAcquisitionModal",emailAddressInvalidClass:"invalidEmailAddress",emailAddressValidClass:"validEmailAddress",modalSubmitButtonSelector:"#emailAcquisitionModal .formbutton",emailAddressTextBoxSelector:"#emailAcquisitionModal .formtext",delayBeforeCloseOnSuccess:5e3,modalTriggerSelector:".content-placement-email-modal-trigger",displayOnPageLoad:!1},u),o=13;f.emailAddress=t.observable("");f.emailAddressValid=t.observable(!0);f.state=t.observable("form");f.displayError=t.observable(!1);f.stealOfTheDayAlerts=t.observable(!0);f.emailAddressValidityCssClass=t.computed(function(){return f.emailAddressValid()?e.emailAddressValidClass:e.emailAddressInvalidClass},f);f.processing=t.observable(!1);f.lastClickedLink=null;f.init=function(){n(e.modalTriggerSelector+" a").on("click",function(n){n.preventDefault();f.lastClickedLink=this});n(e.modalSelector).on("show.bs.modal",function(){i.saveUserData("emlb|-|open",null);n(e.emailAddressTextBoxSelector).on("keypress",function(t){t.which==o&&(n(this).trigger("blur"),f.processing(!0),f.submit())})}).on("hide.bs.modal",function(){if(f.state()=="confirmation"){var t="emlb|-|close,email="+f.emailAddress()+",sotd="+f.stealOfTheDayAlerts();i.saveUserData(t,null)}else i.saveUserData("emlb|-|close",null);n(e.emailAddressTextBoxSelector).off("keypress");f.emailAddressValid(!0);f.emailAddress("");f.timeoutId&&clearTimeout(f.timeoutId)})};f.close=function(){n(e.modalSelector).modal("hide")};f.submit=function(){var t=new RegExp("^[a-zA-Z0-9_\\+-]+(\\.[a-zA-Z0-9_\\+-]+)*@[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)*\\.([a-zA-Z]{2,4})$");f.emailAddressValid(t.test(f.emailAddress()));f.emailAddressValid()||(f.processing(!1),n(e.emailAddressTextBoxSelector).trigger("focus"));f.emailAddressValid()&&n.ajax({url:"/Site/SubscribeEmailAjax",cache:!1,type:"POST",dataType:"json",data:{AnchorTag:"LB","SubscribeEmailServiceModel.EmailAddress":f.emailAddress(),"SubscribeEmailServiceModel.SubscriptionType":f.stealOfTheDayAlerts()?"DealOfTheDay":"Site"},success:function(n){if(f.processing(!1),n.SuccessfullySubscribed){var t="emlb|-|signup,email="+f.emailAddress()+",sotd="+f.stealOfTheDayAlerts();f.state("confirmation");i.saveUserData(t,null);r.FireRegistrationEvent("eBagsEmailLightbox");f.timeoutId=setTimeout(f.close,e.delayBeforeCloseOnSuccess)}else f.displayError(!0)}})};e.displayOnPageLoad&&e.displayOnPageLoad.toLowerCase()==="true"&&n(function(){n(e.modalSelector).modal("show")})}return u});define("emailLightbox/emailLightbox",["jquery","get!core/screenInit","ko","get!pageLocation/pageLocation","get!googleTagManager/eBagsGtm"],function(n,t,i,r,u){n(function(){function f(){var f=!1,t=this;return t.init=function(){f||(f=!0,n.colorbox({inline:!0,href:"#emailAcquisitionLightbox",close:"",opacity:.6,responsive:!0,onClosed:function(){if(t.State()=="Confirmation"){var n="emlb|-|close,email="+t.EmailAddress()+",sotd="+t.StealOfTheDayAlerts();r.saveUserData(n,null)}else r.saveUserData("emlb|-|close",null)},onComplete:function(){r.saveUserData("emlb|-|open",null);i.applyBindings(t,document.getElementById("emailAcquisitionLightbox"));n("#pageModal").length>0?n("#colorbox").css("width","480px"):n.colorbox.resize({innerWidth:430,innerHeight:390})}}))},t.dispose=function(){n.colorbox.close()},t.EmailAddress=i.observable(""),t.EmailAddressValid=i.observable(!0),t.State=i.observable("Form"),t.DisplayError=i.observable(!1),t.StealOfTheDayAlerts=i.observable(!0),t.Submit=function(){var i=new RegExp("^\\s{0,3}[a-zA-Z0-9_\\+-]+(\\.[a-zA-Z0-9\\+-]+)*@[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)*\\.([a-zA-Z]{2,4})\\s{0,3}$"),f=i.test(t.EmailAddress());t.EmailAddressValid(f);t.EmailAddressValid()&&n.ajax({url:"/Site/SubscribeEmailAjax",cache:!1,type:"POST",dataType:"json",data:{AnchorTag:"LB","SubscribeEmailServiceModel.EmailAddress":t.EmailAddress(),"SubscribeEmailServiceModel.SubscriptionType":t.StealOfTheDayAlerts()?"DealOfTheDay":"Site"},success:function(n){if(n.SuccessfullySubscribed){t.State("Confirmation");var i="emlb|-|signup,email="+t.EmailAddress()+",sotd="+t.StealOfTheDayAlerts();r.saveUserData(i,null);u.FireRegistrationEvent("eBagsEmailLightbox");setTimeout(t.dispose,5e3)}else t.DisplayError(!0)}})},t}t(new f,{minWidth:481})})})