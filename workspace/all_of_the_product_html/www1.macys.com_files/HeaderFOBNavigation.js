define(["jquery","base"],function(e,t){var n=[],i,a,o,r=0,s,l=4,u,c,h,f,d,g,v,M;return{UP:"up",DOWN:"down",TOPNAV_CLASS:"macysDynFlyout",onReady:function(e){u=e},fetchFOBList:function(){var n=this,i=t.isThirdParty()?"http://www.macys.com":"";var a=i+"/shop/topnav?application="+(g||t.getCurrentChannel());e.ajax({url:a,type:"GET",crossDomain:true,dataType:"jsonp",jsonpCallback:"topnavCallback",cache:true,timeout:2e3,success:function(e,i,a){var o=t.isThirdParty()?t.absoluteLinkatize(e.html,"http://www.macys.com"):e.html;n.fetchFOBListSuccess(o,i,a)},error:function(e,t,i){n.fetchFOBListError(e,t,i)}})},distributeWidths:function(){var t=e("header#globalMastheadContainer div#globalMastheadCategoryMenu > ul").width(),n=0,i=0,a=0,o=0,r=0,s=5;var l=e("header#globalMastheadContainer").length>1?e("header#globalMastheadContainer div#globalMastheadCategoryMenu > ul:not('.nav') > li"):e("header#globalMastheadContainer div#globalMastheadCategoryMenu > ul > li");l.each(function(t){var a=e(this);n+=a.width();n+=10;i++});o=Math.floor((t-n)/(i-1));if(o<0){var u=Math.ceil((n-t)/i/2);s=s-u}else{e("header#globalMastheadContainer div#globalMastheadCategoryMenu > ul > li").each(function(t){if(t<i-1){e(this).css("margin-right",o+"px")}})}e("header#globalMastheadContainer div#globalMastheadCategoryMenu > ul > li").css("padding-right",s+"px").css("padding-left",s+"px")},fetchFOBListSuccess:function(t,n,i){var a=this;if(t.length>0){var r=e("div#globalMastheadCategoryMenu");r.html(t);setTimeout(function(){o=e("div#globalMastheadCategoryMenu > ul > li");u(true)},25)}else{u(false)}},getFOBSelectorId:function(e){return t.FLEX_LABEL_PREFIX+e},fetchFOBListError:function(e,t,n){u(false)},deselect:function(n){var i="li#"+this.getFOBSelectorId(n);e(i).removeClass("selected-flyout");if(t.getIEVersion()<10){e(this).removeClass("flyout-iefix")}},deselectOthers:function(t,n){var i=this;if(n===undefined){n="selected-flyout"}if(t===undefined){o.removeClass(n)}else{o.each(function(a){if(i.getFOBSelectorId(t)!==e(this).attr("id")){e(this).removeClass(n)}})}},getCategoryIds:function(t){var n,i,a=[],o,r;o=t||e("div#globalMastheadCategoryMenu > ul").html();o=o.toLowerCase();n=o.match(/id=("|')?(f|F)lexlabel_[0-9]+("|')?/g);if(n!=null&&n.length>0){for(i=0;i<n.length;i++){r=n[i];if(r[r.length-1]==='"'){r=r.substring(0,r.length-1)}var s=r.substr(r.indexOf("_")+1);if(!isNaN(s)){a.push(Number(s))}}}return a},getVerticalMouseMoveDirection:function(){return s||this.UP},trackVerticalMouseDirection:function(e){if(!a){return}if(e.clientY!==r){s=e.clientY<r?this.UP:this.DOWN;r=e.clientY}return},init:function(e,n){g=n||false;i=t.isTouch();a=e||false;if(!t.isNavApp()||t.isThirdParty()){this.fetchFOBList()}else{u(this.getCategoryIds().length>0)}},bind:function(){if(!a){return}o=e("div#globalMastheadCategoryMenu > ul > li");if(o.length===0){throw new Error("Top FOB navigation bar is empty.")}else{if(i){this.bindTouchEvents()}else{this.bindEvents()}}},bindTouchEvents:function(){var t=this;o.click(function(n){n.preventDefault();t.doEnter(e(this),d)});e("div#globalMastheadCategoryMenu > ul > li > a").mouseup(function(e){e.preventDefault();clearTimeout(M);return false});e("div#globalMastheadCategoryMenu > ul > li > a").mousedown(function(t){t.preventDefault();var n=this;M=window.setTimeout(function(){window.location.href=e(n).attr("href")},1e3);return false})},onOver:function(e){c=e},onOut:function(e){h=e},onMove:function(e){f=e},onClick:function(e){d=e},getMouseCoords:function(){return v},doEnter:function(e,n){if(typeof n==="function"){var i=t.getSuffixId(e.attr("id"));var a=e.context.parentNode.childElementCount;var o=e.index();var r=e.offset();n(i,a,o,r,e)}},bindEvents:function(){var n=this;o.bind("mouseover",function(e){v={x:e.clientX,y:e.clientY};f(e)});o.mouseenter(function(t){n.doEnter(e(this),c)});o.mousemove(function(e){v={x:e.clientX,y:e.clientY};f(e)});o.mouseleave(function(n){var i=e(this).attr("id"),a;a=t.getSuffixId(i);h(a)})}}});