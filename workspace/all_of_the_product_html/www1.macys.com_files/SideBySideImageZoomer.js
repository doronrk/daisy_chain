define(["jquery","imageUtils","logger"],function(t,i,o){var e=4;function n(o,n){var s,h=e,a="zoom",m,r;m=i.getElement(o);if(typeof n==="undefined"){n={}}if(typeof n.zoomHTML!=="undefined"){s=t(n.zoomHTML)}else if(typeof n.zoomRegionBoxID!=="undefined"){s=i.getElement(n.zoomRegionBoxID)}if(!s||s.length===0){throw"zoomRegionBoxID or zoomHTML is required!"}if(typeof n.zoomRegionBoxDivisor!=="undefined"&&!isNaN(n.zoomRegionBoxDivisor)){h=n.zoomRegionBoxDivisor}s=i.scale(m,s,h);if(typeof n.heightWidthEqual!=="undefined"){s.height(s.width())}if(n.widthEqualsHeight){s.width(s.height())}m.append(s);return s}function s(){var e,s;if(typeof this.options==="undefined"){this.options={}}if(typeof this.options.zoomFactor!=="undefined"&&!isNaN(this.options.zoomFactor)){this.zoomFactor=this.options.zoomFactor}if(typeof this.options.units!=="undefined"&&!isNaN(this.options.units)){this.units=this.options.units}e=i.init(this.image.attr("id"),this.container.attr("id"),this.options);this.container=e.imageContainer;this.image=e.image;this.viewOffset=this.container.offset();this.zoomRegionBox=n(this.container,this.options);if(t("img",this.zoomContainer).length===0){o.log("Setting zoom image src: "+this.image.attr("src"));this.zoomContainer.append("<img src="+this.image.attr("src")+">")}this.zoomImage=t("img",this.zoomContainer);this.zoomContainer.width(this.container.width());s=this.zoomContainer.width()/this.zoomRegionBox.width();this.zoomContainer=i.scale(this.zoomRegionBox,this.zoomContainer,s);if(typeof this.options.heightWidthEqual!=="undefined"&&this.options.heightWidthEqual){this.zoomContainer.height(this.zoomContainer.width())}else{this.zoomContainer.height(this.container.height())}if(this.options.widthEqualsHeight){this.zoomContainer.width(this.zoomContainer.height())}if(typeof this.options.opacity!=="undefined"){this.opacity=this.options.opacity;this.zoomRegionBox.css({backgroundImage:"url("+this.image.attr("src")+")",backgroundPosition:"0 0","background-repeat":"no-repeat",backgroundSize:this.image.width()+this.units+" "+this.image.height()+this.units})}if(this.image.width()!==this.container.width()){this.container.width(this.image.width());o.log("SideBySideImageZoomer adjusting container height to match image width.")}if(this.image.height()!==this.container.height()){this.container.height(this.image.height());o.log("SideBySideImageZoomer adjusting container height to match image height.")}this.documentZoom=t(document.body).css("zoom");this.documentZoom=typeof this.documentZoom!=="undefined"&&this.documentZoom!=="normal"?this.documentZoom:1}function h(o,e,n,h){this.container=i.getElement(o);this.image=i.getElement(e);this.zoomContainer=i.getElement(n);this.zoomImage=undefined;this.options=h;this.viewOffset="";this.zoomRegionBox="";this.zoomRegionBoxBorderAdjustment=0;this.hidden=true;this.zoomFactor=1;this.opacity={};this.units="px";this.documentZoom=1;s.apply(this);this.win=t(window)}h.prototype.setZoomRegionBoxPosition=function(t,i){var o,e,n,s;n=this.zoomRegionBox;s=this.container;o=t-n.width()/2;e=i-n.height()/2;o=Math.max(o,0);e=Math.max(e,0);o=Math.min(o,s.width()-n.outerWidth());e=Math.min(e,s.height()-n.outerHeight());n.css({left:o+this.units,top:e+this.units})};h.prototype.setImageSrc=function(t){this.image.attr("src",t)};h.prototype.setZoomImageSrc=function(t){this.zoomImage.attr("src",t)};h.prototype.getImageSrc=function(){return this.image.attr("src")};h.prototype.getZoomImageSrc=function(){this.zoomImage.attr("src")};h.prototype.startEvent=function(){this.zoomRegionBox.show();this.hidden=false};h.prototype.endEvent=function(){this.zoomRegionBox.hide();this.hidden=true;this.zoomContainer.css("display","none");if(typeof this.opacity.opacity!=="undefined"){this.image.css({opacity:100,"-ms - filter":'"progid:DXImageTransform.Microsoft.Alpha" ( Opacity = 100 )'})}};h.prototype.processEvent=function(t){var o,e,n,s,h,a,m,r,g,d;h=window.event?window.event:t;i.zoomReset(this.image,{zoom:this.zoomFactor-1,parentContainer:this.container});o=this.win.scrollTop();e=this.win.scrollLeft();if(this.documentZoom===0||typeof this.documentZoom==="undefined"){this.documentZoom=1}a=Math.floor(h.clientX/this.documentZoom-this.viewOffset.left+e);m=Math.floor(h.clientY/this.documentZoom-this.viewOffset.top+o);this.setZoomRegionBoxPosition.apply(this,[a,m]);n=this.zoomRegionBox.position().left;s=this.zoomRegionBox.position().top;if(this.hidden){return}if(this.zoomContainer.css("display")==="none"){this.zoomContainer.css("display","block")}this.zoomContainer.show();i.zoomImage(n,s,this.image,this.zoomContainer,i.zoomConstants.IN,{units:this.units});if(typeof this.opacity.opacity!=="undefined"){if(a>=0&&m>=0&&a<=this.image.width()&&m<=this.image.height()){d=this.zoomRegionBoxBorderAdjustment;r=Math.ceil(-1*n-d);g=Math.ceil(-1*s-d);this.zoomRegionBox.css({"background-position":r+this.units+" "+g+this.units});this.image.css(this.opacity)}}};h.prototype.defaultWidth=0;h.prototype.defaultHeight=0;return{SideBySideImageZoomer:h}});