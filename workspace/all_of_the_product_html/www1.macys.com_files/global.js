MACYS.namespace("MACYS.quickBag");if(document.domain.indexOf("macys.com")!=-1){document.domain="macys.com"}else{if(document.domain.indexOf("fds.com")!=-1){document.domain="fds.com"}}MACYS.quickBag.baseHost="";MACYS.quickBag.maxNumberOfItemsVisible=3;MACYS.quickBag.width=325;MACYS.quickBag.animationSpeed=1;MACYS.quickBag.isInitialized=false;MACYS.quickBag.quickBagNumberOfItemsDivs=0;MACYS.quickBag.quickBagNumberOfItems=0;MACYS.quickBag.zeroItemHTMLMessage='<div class="zeroItemCount">0 items in your bag. Shop great deals now!</div>';MACYS.quickBag.bagUpcs=null;MACYS.quickBag.animationTimers={quickBagAnim:null,quickBagBodyAnim:null,quickBagItemAnim:null,quickBagOrderLevelPromoAnim:null,isAnimatingQuickBagHeight:function(){return((this.quickBagAnim&&this.quickBagAnim.isAnimated())||(this.quickBagBodyAnim&&this.quickBagAnim.isAnimated()))},isAnimatingOrderLevelPromoHeight:function(){return(this.quickBagOrderLevelPromoAnim&&this.quickBagOrderLevelPromoAnim.isAnimated())},isAnimatingItemDelete:function(){return(this.quickBagItemAnim&&this.quickBagItemAnim.isAnimated())},isAnimating:function(){return(this.isAnimatingQuickBagHeight()||this.isAnimatingItemDelete()||this.isAnimatingOrderLevelPromoHeight())}};MACYS.quickBag.setBagUpcs=function(c){var e=MACYS.quickBag,b=c.bagItems,d,a;if(b&&b.length>0){e.bagUpcs=[];for(d=0,a=b.length;d<a;d++){e.bagUpcs[d]={upcID:b[d].upcID,quantity:b[d].quantity,sequenceNumber:b[d].sequenceNumber,gwpItem:b[d].gwpIndicator}}}else{e.bagUpcs=null}};MACYS.quickBag.overlay={isLayerOpen:false,isOpenExecuting:false,elementID:"globalMastheadQuickBagHeader",layerEvent:"mouseover",useCloseButton:false,trackMouseOut:true,mouseOutDelay:0,mouseOutTimerID:null,enableBodyClickClose:false,findOverlay:function(a){if(!a){return null}if(a.id==="quickBag"||a.id===MACYS.quickBag.overlay.elementID){return a}if(!a.parentNode){return null}if(a.nodeName.toLowerCase()==="body"||a.parentNode.nodeName.toLowerCase()==="body"){return null}return MACYS.quickBag.overlay.findOverlay(a.parentNode)}};MACYS.quickBag.mouseMove=(function(){var c=YAHOO.util.Dom,a=YAHOO.util.Event,e=MACYS.quickBag,b={},d;b.init=function(){a.addListener(document.body,"mousemove",b.action,b,true)};d=false;b.action=function(h){var j=e.overlay,g,i,f;if(e.animationTimers.isAnimating()||!j.isLayerOpen){return true}g=a.getTarget(h);f=j.findOverlay(g);if(f){d=true;return true}i=function(){if(d){return}e.close(h)};if(j.mouseOutDelay>0){j.mouseOutTimerID=setTimeout(i,j.mouseOutDelay);d=false}else{e.close(h)}};return b}());MACYS.quickBag.bodyClickClose=(function(){var d=YAHOO.util.Dom,a=YAHOO.util.Event,e=MACYS.quickBag,c=e.overlay,b={};b.init=function(){a.addListener(document.body,"click",b.action,b,true)};b.action=function(h){if(e.animationTimers.isAnimating()||!c.isLayerOpen){return true}var g=a.getTarget(h),f=c.findOverlay(g);if(f){return true}e.close(h)};return b}());MACYS.quickBag.createCoremetricsTag=function(a,b){cmCreatePageElementTag(b[0],b[1])};MACYS.quickBag.button=(function(){var self={},Dom=YAHOO.util.Dom,Event=YAHOO.util.Event,quickBag=MACYS.quickBag,quickBagOverlay=quickBag.overlay,configBase=MACYS.config.Base,quickBagPanel=quickBag.panel,bagCommon=MACYS.bagCommon,afterQuickBagOpenAnimation,qbBodyDiv;afterQuickBagOpenAnimation=function(){if(!quickBag.animationTimers.isAnimating()){quickBag.overlay.isLayerOpen=true;qbBodyDiv=Dom.getElementsByClassName("bd","div","quickBag")[0];Dom.setStyle(qbBodyDiv,"overflow-y","auto")}};self.init=function(){self.element=Dom.get(quickBagOverlay.elementID);var getCacheFunction=function(){if(document.URL!=null&&document.URL.indexOf("nosessioncookie")==-1){if(!MACYS.util.Cookie.get("FORWARDPAGE_KEY")){window.location=MACYS.config.Base.nosession;return}}quickBag.cache.get()};Event.addListener(self.element,quickBagOverlay.layerEvent,getCacheFunction,self,true);quickBagPanel=quickBag.panel};self.action=function(item,handler,obj){var cacheTime,promoCode,hostname;if(quickBag.animationTimers.isAnimating()||quickBagOverlay.isLayerOpen||quickBagOverlay.isOpenExecuting){return}quickBagOverlay.isOpenExecuting=true;cacheTime=new Date().getTime();promoCode=MACYS.util.Cookie.get("PromoCodeOne","SMISCGCs");promoCode=(promoCode)?"&promoCode[0]="+promoCode:"";hostname=configBase.ajaxBaseHost;if(configBase.protocol==="https:"){hostname=configBase.ajaxSecureHost}YAHOO.util.Connect.asyncRequest("POST",hostname+configBase.Bag.quickBagURL+"?timenow="+cacheTime+promoCode,{success:handler,failure:handler,argument:item,scope:obj,timeout:configBase.defaultAjaxTimeout})};self.handleError=function(o){var quickBagContentDiv=YAHOO.util.Dom.get("quickBagContent"),errorImgSrc=configBase.assetsUrl+"/web20/assets/img/quickbag/go_to_checkout.gif",shoppingBagURL=bagCommon.addCatIDParam(MACYS.bagCommon.getShoppingBagUrl()),image='<a href="'+shoppingBagURL+'"><img src="'+errorImgSrc+'" alt="Go To Checkout" title="Go To Checkout"/></a>';quickBagContentDiv.innerHTML='<div class="ajaxErrorText"><span class="ajaxError">This preview is temporarily unavailable.<br>Please view your item(s) in checkout.</span><br>'+image+"<br></div>";quickBagContentDiv.style.display="block";quickBagPanel.show();quickBag.heightAnimationManager.open(afterQuickBagOpenAnimation);if(MACYS.quickBag.cache){MACYS.quickBag.cache.forceExpire()}};self.handleResponse=function(response){var i,target,fudgeFactor,globalMastheadBox,xpos,ypos,quickBagBody,quickBagDiv,adMap,promoPool,adLinks,promoText,poolImgSrc,errorMsg,errMessage,elen,errorMsgList,num,nlen,promo,result="",subTotal="",youSavedTotal="",orderLevelPromo="",myBag="",bagItems,errorImgSrc,element,blen,giftBox,hasColor,hasSize,hasType,isGiftcard,curConvert,totalQty,checkoutImgSrc,shoppingBagURL,checkoutButton,quickBagFirstItem,funcDisplay,funcHide,divsItem,dlen,showQuantity,createCoremetricsTag=quickBag.createCoremetricsTag;if(quickBag.animationTimers.isAnimating()||quickBagOverlay.isLayerOpen){return}i=0;quickBagOverlay.isOpenExecuting=false;Dom.addClass("globalMastheadQuickBagHeader","open");Dom.addClass("globalMastheadBagTab","open");target=Dom.get("globalMastheadQuickBagHeader");fudgeFactor=(YAHOO.env.ua.gecko?2:3);globalMastheadBox=Dom.get("globalMastheadSearchMenu");xpos=Dom.getX(globalMastheadBox)+(globalMastheadBox.offsetWidth+2)-quickBag.width-fudgeFactor;ypos=Dom.getY(target)+target.offsetHeight;quickBagPanel.render(document.body);quickBagPanel.hide();quickBagPanel.moveTo(Math.floor(xpos),ypos-1);if(response&&response!=""&&response!="undefined"){try{response=response.replace(/\n/g,"");response=response.replace(/\r/g,"");response=response.replace(/\t/g," ");response=response.replace(/<!--[^(-->)]+-->/g,"");response=response=eval("("+response+")")}catch(e){self.handleError(response);return}}else{self.handleError(response);return}bagCommon.currency=response.currency;quickBag.setBagUpcs(response);quickBagBody=Dom.getElementsByClassName("bd","div","quickBag")[0];quickBagBody.style.height="";quickBagDiv=Dom.get("quickBag");adMap="";if(response.adPools){promoPool=response.adPools.BAG_AD_POOL;if(promoPool&&promoPool.items[0]&&promoPool.items[0].adLinks){adLinks=promoPool.items[0].adLinks;promoText=promoPool.items[0].text||"";poolImgSrc=configBase.assetsUrl+"/dyn_img/site_ads/"+promoPool.items[0].fileName;adMap="<a href="+adLinks[0].url+'><img src="'+poolImgSrc+'" alt="'+promoText+'"/></a>'}}if(response.bagItems&&response.bagItems.length>0){bagItems=response.bagItems;errorImgSrc=configBase.assetsUrl+"/img/icons/icon_error.gif";blen=response.bagItems.length;curConvert=function(str){return str};for(element=0;element<blen;element+=1){if(bagItems[element].registry&&bagItems[element].firstRegistryItem){result+='<div class="quickBagItem registryQuickBagItem" id="quickBagItem'+i+++'">'}else{result+='<div class="quickBagItem" id="quickBagItem'+i+++'">'}if(bagItems[element].gwpIndicator===true){result+='<div class="quickBagAlertMessage"> This Bonus has been added to your bag</div>'}if(bagItems[element].errorCodes&&bagItems[element].errorCodes!=""){errorMsgList=bagItems[element].errorCodes;elen=errorMsgList.length;for(errorMsg=0;errorMsg<elen;errorMsg+=1){errMessage=errorMsgList[errorMsg].replace(/&apos;/g,"'");result+='<div class="quickBagAlertMessage"><img src="'+errorImgSrc+'"/>'+errMessage+"</div>"}}if(bagItems[element].registry&&bagItems[element].firstRegistryItem){giftBox=configBase.assetsUrl+"/web20/assets/img/quickbag/gift_box.gif";result+='<div class="registryItem"><img src="'+giftBox+'"  alt="Gift" class="regGiftBoxImg"/>';if((bagItems[element].registry.registrantFirstName&&bagItems[element].registry.registrantFirstName!="")&&(bagItems[element].registry.coregistrantFirstName&&bagItems[element].registry.coregistrantFirstName!="")){result+='<span class="regItemText">For: '+bagItems[element].registry.registrantFirstName+" &amp; "+bagItems[element].registry.coregistrantFirstName+"</span></div>"}else{result+='<span class="regItemText">For: Registry Id '+bagItems[element].registry.registryID+"</span></div>"}}result+='<div id="productImage_quickBagItem'+(i-1)+'"  class="quickBagImageContainer">';if(bagItems[element].registry){result+='<a href="'+configBase.baseUrl+"/registry/wedding/redirectbvrgvr?registryId="+bagItems[element].registry.registryID+'">'}else{result+='<a href="'+bagItems[element].productURL+'">'}result+='<img class="quickBagImage" src="'+configBase.imageUrl+"/products/"+bagItems[element].productImage+'?$filtersm$&wid=75">';if(bagItems[element].colorWayPrimaryImgAvailable===false&&bagItems[element].swatchImage){result+='<div class="quickBagSwatchImage" ><img src="'+configBase.imageUrl+"/swatches/"+bagItems[element].swatchImage+'?$filtersm$&wid=19&hei=19&fit=fit,1"/></div>'}result+="</a>";result+="</div>";result+='<div class="quickBagItemDetails">';result+='<div class="quickBagItemText">';result+='<a href="';if(bagItems[element].registry){result+=configBase.baseUrl+"/registry/wedding/redirectbvrgvr?registryId="+bagItems[element].registry.registryID}else{result+=bagItems[element].productURL}result+='">'+bagItems[element].productName+"</a></div>";
hasColor=(bagItems[element].color&&bagItems[element].color!="");hasSize=(bagItems[element].size&&bagItems[element].size!="");hasType=(bagItems[element].type&&bagItems[element].type!="");showQuantity=(bagItems[element].quantity>1);if(hasColor){result+='<span>Color: <span class="sizeColorType">'+bagItems[element].color+"</span>";if(hasSize||hasType){result+=","}result+="</span> "}if(hasSize){result+='<span>Size: <span class="sizeColorType">'+bagItems[element].size+"</span>";if(hasType){result+=","}result+="</span> "}if(hasType){result+='<span>Type: <span class="sizeColorType">'+bagItems[element].type+"</span></span> "}result+='<div class="quickBagMemberPrice">';result+=bagCommon.product.processPrices(bagItems[element]);if(bagItems[element].personalizationFee&&bagItems[element].personalizationFee!=""){result+='<span class="personalizationFee">'+curConvert(bagCommon.currency+bagItems[element].personalizationFee)+" <span>Personalization Fee</span></span>"}isGiftcard=(bagItems[element].giftCard&&bagItems[element].giftCard!="");if(isGiftcard){result+='<span class="quickBagMemberPrice">'+bagItems[element].giftCard.emailId+"</span>"}if(bagItems[element].promotions&&bagItems[element].promotions!=""){promo=bagItems[element].promotions;nlen=promo.length;for(num=0;num<nlen;num+=1){result+='<span class="promoDesc">'+curConvert(promo[num].promoDesc)+'<span class="promoPrice"> -'+curConvert(bagCommon.currency+promo[num].amountDiscounted)+"</span></span>"}}result+='<div class="itemCommandButtons">';if(bagItems[element].registry){result+='<a href="'+configBase.baseUrl+"/registry/wedding/redirectbvrgvr?registryId="+bagItems[element].registry.registryID+'" style="border:none;" class="editItem">'}else{result+='<a href="'+configBase.baseUrl+bagItems[element].productURL+'" style="border:none;" class="editItem">'}result+='<img alt="View Item/Edit" title="View Item/Edit" src="'+configBase.assetsUrl+'/web20/assets/img/nav/quickbag/edit.png" />';result+="</a>";result+=' <span class="quickBagRemoveButton">';result+=' <img alt="Remove" title="Remove" src="'+configBase.assetsUrl+'/web20/assets/img/nav/quickbag/remove.png" />';result+=" </span>";result+="</div>";result+="</div>";result+="</div>";result+='<div class="clearFloats"></div>';result+="</div>"}Dom.get("quickBagContent").innerHTML=result;var incompatiblePromos=false,triggerDidNotAppliedPromos=false;if(response.promotions&&response.promotions!=""){orderLevelPromo+='<div class="promoDescOrder">';promo=response.promotions;nlen=promo.length;for(num=0;num<nlen;num+=1){if(promo[num].incompatible===true){incompatiblePromos=true}else{if(promo[num].triggerDidNotApplied===true){triggerDidNotAppliedPromos=true}}if(promo[num].promoDesc&&promo[num].itemSequenceNumber==0){orderLevelPromo+='<span class="promoDesc">'+curConvert(promo[num].promoDesc);if(promo[num].amountDiscounted>0){orderLevelPromo+='<span class="promoPrice"> -'+curConvert(bagCommon.currency+promo[num].amountDiscounted)+"</span>"}orderLevelPromo+="</span>"}}orderLevelPromo+="</div>"}if(!incompatiblePromos||!triggerDidNotAppliedPromos){Dom.get("orderLevelPromo").innerHTML=orderLevelPromo}totalQty=response.totalQty;checkoutImgSrc=configBase.assetsUrl+"/web20/assets/img/quickbag/quickbag_checkout.gif";shoppingBagURL=bagCommon.addCatIDParam(MACYS.bagCommon.getShoppingBagUrl());checkoutButton='<div class="checkoutButton"><a href="'+shoppingBagURL+'"><img src="'+checkoutImgSrc+'"/></a></div>';myBag+='<div id="myBag"><span id="quickBagYouSavedTotal"> </span><span class="myBagLink"><a href="'+shoppingBagURL+'">your bag</a></span>';myBag+='<span id="myBagCount"></span>';subTotal+='<span id="quickBagSubTotal"></span></div>';if(adMap===""){Dom.addClass("qbPromoAd","hidden")}else{Dom.get("qbPromoAd").innerHTML=adMap}Dom.get("quickBagBottom").innerHTML=checkoutButton+myBag+subTotal;Event.addListener(Dom.getElementsByClassName("checkoutButton","div","quickBagBottom"),"click",createCoremetricsTag,["checkout button","hover_bag"]);Event.addListener(Dom.getElementsByClassName("myBagLink","span","myBag"),"click",createCoremetricsTag,["your bag link","hover_bag"]);Event.addListener(Dom.getElementsByClassName("quickBagImageContainer","div","quickBagContent"),"click",createCoremetricsTag,["product image thumbnail","hover_bag"]);Event.addListener(Dom.getElementsByClassName("quickBagItemText","div","quickBagContent"),"click",createCoremetricsTag,["product name","hover_bag"]);Event.addListener(Dom.getElementsByClassName("editItem","a"),"click",createCoremetricsTag,["edit","hover_bag"]);Event.addListener(Dom.getElementsByClassName("quickBagRemoveButton","span"),"click",createCoremetricsTag,["remove","hover_bag"]);Event.addListener(Dom.get("qbPromoAd"),"click",createCoremetricsTag,["promo details link","hover_bag"]);quickBag.setQuickBagNumberOfItems(totalQty);quickBag.setQuickBagSubtotal(response.merchandiseTotal);quickBag.setQuickBagYouSavedTotal(response.discountTotal);quickBag.quickBagNumberOfItemsDivs=bagItems.length;quickBag.quickBagNumberOfItems=totalQty;quickBagFirstItem=Dom.get("quickBagContent").childNodes[0];if(quickBagFirstItem){quickBagFirstItem.style.border="none"}}else{Dom.get("quickBagContent").innerHTML=quickBag.zeroItemHTMLMessage;if(adMap===""){Dom.addClass("qbPromoAd","hidden")}else{Dom.get("qbPromoAd").innerHTML=adMap}}quickBagDiv.style.height="0px";quickBagPanel.show();funcDisplay=function(e,divItem){Dom.addClass(divItem,"quickBagItemHover")};funcHide=function(e,divItem){Dom.removeClass(divItem,"quickBagItemHover")};divsItem=Dom.getElementsByClassName("quickBagItem","div","quickBagContent");dlen=divsItem.length;for(i=0;i<dlen;i++){Event.addListener(divsItem[i],"mouseover",funcDisplay,divsItem[i]);Event.addListener(divsItem[i],"mouseout",funcHide,divsItem[i]);var productImgElement=Dom.get("productImage_"+divsItem[i].id);Event.addListener(productImgElement,"mouseover",self.hideSwatch);Event.addListener(productImgElement,"mouseout",self.showSwatch)}quickBag.initDeleteButtons();quickBag.heightAnimationManager.open(afterQuickBagOpenAnimation)};self.showSwatch=function(event){var target=YAHOO.util.Event.getTarget(event);if(target.tagName==="IMG"){var jumboSwatch=Dom.getElementsByClassName("quickBagSwatchImage","div",target.parentNode)[0];if(jumboSwatch){Dom.removeClass(jumboSwatch,"jumboSwatchHidden")}}};self.hideSwatch=function(event){var target=YAHOO.util.Event.getTarget(event);if(target.tagName==="IMG"){var jumboSwatch=Dom.getElementsByClassName("quickBagSwatchImage","div",target.parentNode)[0];if(jumboSwatch){Dom.addClass(jumboSwatch,"jumboSwatchHidden")}}};return self}());MACYS.quickBag.setQuickBagSubtotal=function(a){var b=YAHOO.util.Dom.get("quickBagSubTotal");b.innerHTML=" ("+MACYS.bagCommon.currency+a+")"};MACYS.quickBag.setQuickBagYouSavedTotal=function(c){if(c){var b,a=c.replace(",","");a=(a&&!isNaN(a)&&parseFloat(a,10))||0;if(a>0){b=YAHOO.util.Dom.get("quickBagYouSavedTotal");b.innerHTML="you saved: "+MACYS.bagCommon.currency+c}}};MACYS.quickBag.setQuickBagNumberOfItems=function(b){MACYS.bagCommon.setBagNumberOfItems(b);b=(b&&!isNaN(b)&&parseInt(b,10))||0;if(b>0){var a=b>1?" items":" item",c=YAHOO.util.Dom.get("myBagCount");c.innerHTML=": "+b+a}};MACYS.quickBag.initDeleteButtons=(function(){var Dom=YAHOO.util.Dom,Event=YAHOO.util.Event,afterQuickBagItemAnimation,quickBagItemParent,quickBagFirstItem,afterQuickBagHeightAnimation,buttonListeners,translateIndex,handleDeleteItemRequestSuccess,handleDeleteItemRequestFailure,handleDeleteButtonClick,quickBag=MACYS.quickBag;afterQuickBagItemAnimation=function(unused1,unused2,o){quickBagItemParent=o.quickBagItem.parentNode;quickBagItemParent.removeChild(o.quickBagItem);quickBag.quickBagNumberOfItemsDivs--;quickBagFirstItem=Dom.get("quickBagContent").childNodes[0];if(quickBagFirstItem){quickBagFirstItem.style.border="none"}};afterQuickBagHeightAnimation=function(){};buttonListeners=function(removeButton){Event.addListener(removeButton,"click",handleDeleteButtonClick)};translateIndex=function(oldIndex,indexOfRemovedItem){return oldIndex<indexOfRemovedItem?oldIndex:oldIndex-1};handleDeleteItemRequestSuccess=function(o){var response,indexOfRemovedItem=o.argument[0],promoDesc;quickBag.cache.forceExpire();response=o.responseText;if(response&&response!=""&&response!="undefined"){try{response=response.replace(/\n/g,"");response=response.replace(/\r/g,"");response=response.replace(/\t/g," ");response=response.replace(/<!--[^(-->)]+-->/g,"");response=response=eval("("+response+")")}catch(e){handleDeleteItemRequestFailure(o);return}}else{handleDeleteItemRequestFailure(o);return}quickBag.setBagUpcs(response);quickBag.setQuickBagNumberOfItems(response.totalQty);quickBag.setQuickBagSubtotal(response.merchandiseTotal);quickBag.setQuickBagYouSavedTotal(response.discountTotal);MACYS.quickBag.promoCodeCookie.update(response.promoCodes,response.promotions);promoDesc="";if(response.promotions&&response.promotions.length>0){var promoList=response.promotions;var promoLength=promoList.length;for(var promoIndex=0;promoIndex<promoLength;++promoIndex){if(!promoList[promoIndex].incompatible||!promoList[promoIndex].triggerDidNotApplied){promoDesc+='<span class="promoDesc">'+promoList[promoIndex].promoDesc+' <span class="promoPrice">-'+MACYS.bagCommon.currency+promoList[promoIndex].amountDiscounted+"</span></span>"}}}quickBag.heightAnimationManager.updateOrderLevelPromoDiv(promoDesc)};handleDeleteItemRequestFailure=function(e){};handleDeleteButtonClick=function(e){var attributes,callback,dummy_div,i,c,quickBagItemAnim,quickBagItemIndex,quickBagDeletedItem,quickBagItem,quickBagContentChildNodes,qbclen,postData,promoCode,configBase=MACYS.config.Base,yUtil=YAHOO.util,callbacks,hostname;if(!MACYS.quickBag.animationTimers.isAnimating()){quickBagDeletedItem=Dom.getAncestorByClassName(Event.getTarget(e),"quickBagItem");quickBagItemIndex=parseInt(quickBagDeletedItem.id.substr(quickBagDeletedItem.id.lastIndexOf("m")+1,10));quickBagContentChildNodes=Dom.get("quickBagContent").childNodes;qbclen=quickBagContentChildNodes.length;for(i=0,c=0;
i<qbclen;i++){quickBagItem=quickBagContentChildNodes[i];if(quickBagItem===quickBagDeletedItem){quickBagItem.id="quickBagItemRemoved"}else{quickBagItem.id="quickBagItem"+c++}}callbacks={success:handleDeleteItemRequestSuccess,failure:handleDeleteItemRequestFailure,timeout:configBase.defaultAjaxTimeout,argument:[quickBagItemIndex]};postData="source=QB&upcId[0]="+quickBag.bagUpcs[quickBagItemIndex].upcID+"&sequenceNumber[0]="+quickBag.bagUpcs[quickBagItemIndex].sequenceNumber+"&quantity[0]="+quickBag.bagUpcs[quickBagItemIndex].quantity+"&gwpIndicator[0]="+quickBag.bagUpcs[quickBagItemIndex].gwpItem;promoCode=MACYS.util.Cookie.get("PromoCodeOne","SMISCGCs");postData+=(promoCode)?"&promoCode[0]="+promoCode:"";hostname=configBase.ajaxBaseHost;if(configBase.protocol==="https:"){hostname=configBase.ajaxSecureHost}yUtil.Connect.asyncRequest("POST",hostname+configBase.Bag.quickBagRemoveURL,callbacks,postData);attributes={height:{to:0}};Dom.setStyle(quickBagDeletedItem,"min-height","0px");Dom.setStyle(quickBagDeletedItem,"overflow","hidden");quickBagItemAnim=new yUtil.Anim(quickBagDeletedItem,attributes,quickBag.animationSpeed,yUtil.Easing.easeOut);attributes={quickBagItem:quickBagDeletedItem};if(quickBag.quickBagNumberOfItemsDivs===1){dummy_div=document.createElement("div");dummy_div.innerHTML=MACYS.quickBag.zeroItemHTMLMessage;Dom.insertAfter(dummy_div.firstChild,quickBagDeletedItem)}quickBagItemAnim.onComplete.subscribe(afterQuickBagItemAnimation,attributes,false);quickBag.animationTimers.quickBagItemAnim=quickBagItemAnim;quickBagItemAnim.animate();quickBag.heightAnimationManager.deleteItem(quickBagDeletedItem,afterQuickBagHeightAnimation)}};return function(){Dom.getElementsByClassName("quickBagRemoveButton","span","quickBagContent",buttonListeners)}}());MACYS.quickBag.heightAnimationManager=(function(){var k=false,d,c,f,l,h,a,b,j,i=YAHOO.util.Dom,m=MACYS.quickBag,g=YAHOO.util,e=m.animationTimers;a=function(){var n=i.get("orderLevelPromo");if(n.clientHeight){i.setStyle(n,"height","auto")}};b=function(r,q,p,o){var n;l=p;h=o;if(r!==-1){n={height:{to:r}};e.quickBagAnim=new g.Anim(c,n,m.animationSpeed,g.Easing.easeOut);if(p){e.quickBagAnim.onComplete.subscribe(p,o,false)}e.quickBagAnim.animate()}if(q!==-1){n={height:{to:q}};e.quickBagBodyAnim=new g.Anim(d,n,m.animationSpeed,g.Easing.easeOut);if(p){e.quickBagBodyAnim.onComplete.subscribe(p,o,false)}e.quickBagBodyAnim.animate()}};j=function(J,w,s){var N=0,F=0,I,y,x,M=i.getElementsByClassName("quickBagItem","div","quickBagContent"),A=i.getElementsByClassName("zeroItemCount","div","quickBagContent")[0],E=i.getElementsByClassName("ajaxErrorText","div","quickBagContent"),r=i.getElementsByClassName("hd","div","quickBag")[0],v=i.getElementsByClassName("ft","div","quickBag")[0],L=i.get("orderLevelPromo"),C=i.get("quickBagBottom"),z,o,n,p,D,H,K,B,q,u,G,t;if(E&&E.length>0){N+=E[0].offsetHeight;if(v){v.style.display="none"}}else{if(v){v.style.display=""}if(A){M.push(A);if(L){L.style.display="none"}if(C){C.style.display="none"}}else{if(L){L.style.display=""}if(C){C.style.display=""}}}for(I=0,y=0;I<M.length&&y<m.maxNumberOfItemsVisible;I++){if(M[I]!=J){N+=M[I].offsetHeight;y++;x=I}}if((J?M.length-1:M.length)>m.maxNumberOfItemsVisible){I=x+1;while(M[x]===J){I++}N+=Math.floor(M[I].offsetHeight/2)}G=0;t=0;if(r){G=r.offsetHeight}if(v){t=v.offsetHeight}F=N;N+=G+t;f=N;z=0;o=60;n=0;z=i.getViewportHeight();o=m.panel.cfg.getProperty("y");n=z-o-20;if((N>n)&&(n>130)){F=n-(N-F);N=n}d.scrollTop=0;p=i.get("myBag");D=i.getElementsByClassName("checkoutButton","div","quickBag")[0];H=i.get("quickBagBottom");q=3;u=15;if(p&&D&&H){K=H.offsetHeight/2-p.offsetHeight/2-u;B=H.offsetHeight/2-D.offsetHeight/2-u+q;p.style.paddingTop=K+"px";D.style.paddingTop=B+"px"}b(N,F,w,s)};return{updateOrderLevelPromoDiv:function(q){var o,t=YAHOO.util.Dom.get("orderLevelPromo"),p,n,s,r=false;if(!k){if(e.quickBagAnim&&e.quickBagAnim.isAnimated()){e.quickBagAnim.stop(false);r=true}else{if(e.quickBagBodyAnim&&e.quickBagBodyAnim.isAnimated()){r=true}}n=t.clientHeight;if(q){i.setStyle(t,"height",n+"px");p=n-(t.firstChild?t.firstChild.clientHeight:0);if(!t.firstChild){t.innerHTML='<div class="promoDesc promoDescOrder"></div>'}t.firstChild.innerHTML=q;p+=t.firstChild.clientHeight}else{p=0}f=f+p-n;if(r){b(f,-1,l,h)}else{b(f,-1)}o={height:{from:n,to:p}};s=new YAHOO.util.Anim(t,o,m.animationSpeed,g.Easing.easeOut);s.onComplete.subscribe(a);if(r){s.onComplete.subscribe(l,h,false)}s.animate();e.quickBagOrderLevelPromoAnim=s}},close:function(o,n){k=true;b(0,0,o,n)},init:function(){d=i.getElementsByClassName("bd","div","quickBag")[0];c=i.get("quickBag")},deleteItem:function(o,p,n){j(o,p,n)},open:function(o,n){k=false;j(null,o,n)}}}());MACYS.quickBag.close=(function(){var b=YAHOO.util.Dom,a,c=MACYS.quickBag,d=c.animationTimers;a=function(){if(!d.isAnimating()){c.panel.hide();c.overlay.isLayerOpen=false;b.removeClass("globalMastheadQuickBagHeader","open");b.removeClass("globalMastheadBagTab","open")}};return function(f){var g;YAHOO.util.Event.preventDefault(f);if(d.isAnimating()){return}g=b.getElementsByClassName("bd","div","quickBag")[0];b.setStyle(g,"overflow-y","hidden");c.heightAnimationManager.close(a)}}());MACYS.quickBag.cache=(function(){var d=MACYS.quickBag,b=d.button,c="qbResponse",a;a={_qbButton:b,internalCache:null,expiration:5*60*1000,isCacheAvaiable:function(){if(a.internalCache){return true}return false},enableCache:function(){if(MACYS.util&&MACYS.util.cache){a.internalCache=new MACYS.util.cache(b.action,b.handleResponse,b,this.expiration)}},set:function(e){a.internalCache.set(c,e)},get:function(){if(a.isCacheAvaiable()){a.internalCache.get(c)}else{var e=function(f){b.handleResponse(f.responseText)};b.action("",e,null)}},forceExpire:function(){if(!a.internalCache){d.cache.enableCache()}a.internalCache.forceExpire(c)}};return a}());MACYS.quickBag.promoCodeCookie=(function(){var a={};a.clear=function(){var c,b;c=document.forms.shopping_bag_form;if(!c){return}b=c.elements.PromoCode;if(!b){return}if(!b.value||b.value===""||b.value.length<=0){a.clearPromoCodes()}};a.clearPromoCodes=function(){MACYS.util.Cookie.set("PromoCodeOne","","SMISCGCs")};a.update=function(c,b){if(!c||c.length===0){a.clearPromoCodes()}else{var e=c[0];var d=a.locatePromotion(e,b);if(d&&(d.incompatible||d.triggerDidNotApplied)){a.clearPromoCodes()}}};a.locatePromotion=function(e,c){for(var d=0;d<c.length;++d){var b=c[d];if(b.promoCode===e){return b}}};return a}());YAHOO.util.Event.onDOMReady(function(){var b=YAHOO.util.Dom,c=MACYS.quickBag,a=c.overlay;if(MACYS.isTablet==true){document.getElementById("quickBag").style.display="none";document.getElementById("quickBagHeader").style.height="29px"}if(!b.get("quickBag")){return}c.promoCodeCookie.clear();MACYS.quickBag.panel=new YAHOO.widget.Panel("quickBag",{width:c.width+"px",height:"0px",underlay:"none",draggable:false,modal:false,close:a.useCloseButton,strings:{close:"&nbsp;"},zIndex:1010});if(a.useCloseButton){c.panel._doClose=MACYS.quickBag.close}b.addClass("quickBag","shadowQB");b.removeClass("quickBag","hidden");c.cache.enableCache();c.button.init();c.heightAnimationManager.init();if(a.trackMouseOut||a.mouseOutDelay>0||!a.useCloseButton){c.mouseMove.init()}if(a.enableBodyClickClose){c.bodyClickClose.init()}YAHOO.util.Event.addListener("checkoutLink","click",c.createCoremetricsTag,["quickbag tab click","hover_bag"])});
