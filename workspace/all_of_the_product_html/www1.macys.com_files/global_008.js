MACYS.namespace("MACYS.adLinkPopUp");MACYS.adLinkPopUp={definePopup:function(c,b,e,f,a){var d=new this.popupInfoValues(c,b,e,f,a);YAHOO.util.Event.addListener(YAHOO.util.Dom.get(d.key),"click",this.popupClick,d);MACYS.adLinkPopUp.scrollbarOffset=16},popupInfoValues:function(c,b,e,f,a){var d={fileName:c,width:parseInt(b),height:parseInt(e),key:f,breadCrumb:a,bodyWidth:parseInt(b)-12,bodyHeight:parseInt(e)-32};return d},buildPopupContainer:function(b){var g=YAHOO.util.Dom.get("popupOverlay");var c=YAHOO.util.Dom;if(g){c.setStyle("popupOverlay","height",b.height+"px");c.setStyle("popupOverlay","width",b.width+"px");c.setStyle("popupOverlayBody","height",b.bodyHeight+"px");c.setStyle("popupOverlayBody","width",b.bodyWidth+"px");MACYS.log("popup overlay already exists")}else{var a=document.createElement("div");a.setAttribute("id","popupOverlay");a.className="popUpOverlayShadow";var d=document.createElement("div");d.setAttribute("id","popupOverlayHeader");d.className="hd";c.setStyle(d,"height","26px");a.appendChild(d);var f=document.createElement("div");f.setAttribute("id","popupOverlayBody");f.className="bd";c.setStyle(f,"margin-left","6px");c.setStyle(f,"margin-right","6px");c.setStyle(f,"height",b.bodyHeight+"px");a.appendChild(f);var e=c.get("doc3");e.appendChild(a);MACYS.adLinkPopUp.panel=new YAHOO.widget.Panel("popupOverlay",{width:b.width+"px",height:b.height+"px",autoscroll:true,underlay:"none",draggable:true,modal:true,close:true,strings:{close:"&nbsp"},zIndex:1000})}c.get("popupOverlayBody").innerHTML="";MACYS.adLinkPopUp.panel.render();YAHOO.util.Dom.setStyle("popupOverlayBody","height",b.bodyHeight+"px");MACYS.adLinkPopUp.panel.center();MACYS.adLinkPopUp.panel.show();MACYS.loading.show()},autoWiden:function(d,b){var c=YAHOO.util.Dom;var a=function(){var e;if(d){d.scrollTop+=10;e=d.scrollTop;d.scrollTop=0}return e};if(a()>0){MACYS.log("scrollbar exists. widening panel and body");MACYS.adLinkPopUp.panel.cfg.setProperty("width",(b.width+MACYS.adLinkPopUp.scrollbarOffset)+"px");c.setStyle(d,"width",(b.bodyWidth+MACYS.adLinkPopUp.scrollbarOffset)+"px");c.setStyle(d,"height",b.bodyHeight+"px")}},loadScript:function(b,c){var a=document.createElement("script");a.type="text/javascript";if(a.readyState){a.onreadystatechange=function(){if(a.readyState=="loaded"||a.readyState=="complete"){a.onreadystatechange=null;c()}}}else{a.onload=function(){c()}}a.src=b;document.getElementsByTagName("head")[0].appendChild(a)},executeScripts:function(element){function execEvals(){var tagCollection=YAHOO.util.Dom.getElementsBy(function(el){return el},"script",element);if(tagCollection.length>0){for(var i=0;i<tagCollection.length;i++){var script;if(document.all){script=tagCollection[i].innerText}else{script=tagCollection[i].textContent}try{eval(script)}catch(e){MACYS.log(e);MACYS.log("eval error on: "+script)}}}}var tagCollection=YAHOO.util.Dom.getElementsBy(function(el){return el.src},"script",element);if(tagCollection.length>0){for(var i=0;i<tagCollection.length;i++){if(tagCollection[i].src){MACYS.log("loading script: "+i+":"+tagCollection[i].src);if(i==(tagCollection.length-1)){MACYS.adLinkPopUp.loadScript(tagCollection[i].src,function(){execEvals()})}else{MACYS.adLinkPopUp.loadScript(tagCollection[i].src,function(){})}}}}},addManualLinkClick:function(b){var a=YAHOO.util.Dom;function c(d){var f=a.getElementsBy(function(g){return g.href},d,b);if(f&&f.length>0){for(var e=0;e<f.length;e++){if(f[e].href&&f[e].href.indexOf("javascript")<0){a.setAttribute(f[e],"onclick","cmCreateManualLinkClickTag('"+f[e].href+"')")}}}}c("a");c("area")},handlePopUpRequestSuccess:function(e){var a=e.argument;var b=YAHOO.util.Dom;if(e!=null){MACYS.loading.hide();var d=b.get("popupOverlayBody");if(d){d.innerHTML=e.responseText;MACYS.adLinkPopUp.addManualLinkClick(d);MACYS.adLinkPopUp.executeScripts(d);MACYS.adLinkPopUp.autoWiden(d,a)}}var c=b.get("popupOverlay_mask");if(c){YAHOO.util.Event.purgeElement(c);YAHOO.util.Event.addListener(c,"click",MACYS.adLinkPopUp.closePopUpPanel)}},handlePopUpRequestError:function(c){var a=YAHOO.util.Dom;MACYS.loading.hide();MACYS.log("pop up render failure");MACYS.log(c.toString());a.get("popupOverlayBody").innerHTML='<div class="ajaxErrorText"><span class="ajaxError">Oops! We\'re experiencing a<br> technical problem.</span><span class="greyAjaxError">It\'s just a temporary glitch.<br> Please try again.</span></div>';var b=a.get("popupOverlay_mask");if(b){YAHOO.util.Event.purgeElement(b);YAHOO.util.Event.addListener(b,"click",MACYS.adLinkPopUp.closePopUpPanel)}},closePopUpPanel:function(b){if(b){YAHOO.util.Event.preventDefault(b)}MACYS.adLinkPopUp.panel.hide();var a=YAHOO.util.Dom.get("popupOverlay_mask");if(a){a.style.display="none"}},trackIt:function(d,b){var a=b.breadCrumb.split("_");var c;if(YDOM.get("eolCategoryName")){c=YDOM.get("eolCategoryName").innerHTML}else{a[0]=(a[0]=="")?"n":a[0];a[1]=(a[1]=="")?"n":a[1];c=a[0].toLowerCase()+"_"+a[1];c=c.replace(/ /gi,"-")}cmCreatePageElementTag(c,"popup")},popupClick:function(c,b){MACYS.adLinkPopUp.trackIt(c,b);MACYS.adLinkPopUp.buildPopupContainer(b);var a="/shop/media/popup/?popupFileName="+b.fileName;YAHOO.util.Connect.asyncRequest("GET",a,{success:MACYS.adLinkPopUp.handlePopUpRequestSuccess,failure:MACYS.adLinkPopUp.handlePopUpRequestError,abort:MACYS.adLinkPopUp.handlePopUpRequestError,timeout:MACYS.config.Base.defaultAjaxTimeout,argument:b},null)}};
