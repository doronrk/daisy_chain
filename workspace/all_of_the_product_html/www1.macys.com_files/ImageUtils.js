define(["jquery","logger"],function(t,e){var i=0,o=5,n=1/5,f={IN:0,OUT:1,RESET:2},h="px";function a(e){var i;if(typeof e==="string"&&!/^#/.test(e)){i=t("#"+e)}else{i=t(e)}return i}function d(t){if(typeof t==="undefined"){t={}}if(typeof t.units!=="undefined"){h=t.units}return t}function r(t,e,i){var o=t.replace(/wid=(\d*)/,"wid="+e);if(typeof i==="undefined"){o=o.replace(/\&hei=(\d*)/,"")}else{o=o.replace(/hei=(\d*)/,"hei="+i)}return o}function p(t,e,i){var o,n;if(isNaN(i)){return{}}if(i===0){o=t;n=e}else if(i<0){o=t/i;n=e/i}else{o=t*i;n=e*i}return{width:Math.abs(o),height:Math.abs(n)}}function m(t,e,i){var o,n,f;if(isNaN(i)){return e}o=a(t);n=a(e);f=p(o.width(),o.height(),i);if(typeof f.width!=="undefined"&&typeof f.height!=="undefined"){n.width(Math.floor(f.width));n.height(Math.floor(f.height))}return n}function g(t,i,f){var h,d=o,r=n;t=a(t);i=a(i);i.append(t);t.height(t.height());t.width(t.width());t.width(i.width());t.height(i.height());e.log("ImageUtils image dimensions: "+t.width()+" "+t.height());if(typeof f!=="undefined"){if(typeof f.mazZoom!=="undefined"&&!isNaN(f.mazZoom)){d=f.mazZoom}if(typeof f.minZoom!=="undefined"&&!isNaN(f.minZoom)){r=f.minZoom}}h=i.offset();t.data({zoom:1,maxZoom:d,minZoom:r,top:0,left:0,parentOffsetLeft:i.position()?i.position().left:0,parentOffsetTop:i.position()?i.position().top:0,width:t.width(),height:t.height(),originalWidth:t.width(),originalHeight:t.height()});return{image:t,imageContainer:i,viewOffset:h}}function s(t,e,i,o,n,h){switch(n){case f.IN:u(t,e,i,o,h);break;case f.OUT:l(t,e,i,o,h);break;case f.RESET:w(i,h);break;default:w(i,h);break}}function u(e,i,o,n,f){var a=o.data(),r;f=d(f);if(a.zoom<a.maxZoom||o.is(":animated")){a.zoom++}if(typeof n!=="undefined"){r=t("img",n);if(typeof r!=="undefined"){r=m(n,r,a.zoom);if(n.width()===n.height()&&o.height()!==o.width()){r.height(o.height()*(r.width()/o.width()))}a.left=(a.left-e)*(r.width()/o.width());a.top=(a.top-i)*(r.height()/o.height());r.css({marginLeft:Math.round(a.left)+h,marginTop:Math.round(a.top)+h})}}}function l(e,i,o,n,f){var a=o.data(),r;f=d(f);if(a.zoom>a.minZoom||o.is(":animated")){a.zoom--}if(typeof n!=="undefined"){r=t("img",n);if(typeof r!=="undefined"){r=m(n,r,a.zoom);if(n.width()===n.height()&&o.height()!==o.width()){r.height(o.height()/(r.width()/o.width()))}a.left=(a.left-e)/(r.width()/o.width());a.top=(a.top-i)/(r.height()/o.height());r.css({marginLeft:Math.round(a.left)+h,marginTop:Math.round(a.top)+h})}}}function w(t,e){var o=t.data(),n=i;e=d(e);o.zoom=typeof e.zoom!=="undefined"?e.zoom:1;o.width=o.originalWidth;o.height=o.originalHeight;o.parentOffsetLeft=0;o.parentOffsetTop=0;if(typeof e.parentContainer!=="undefined"){o.parentOffsetLeft=e.parentContainer.position().left;o.parentOffsetTop=e.parentContainer.position().top}o.top=o.parentOffsetTop;o.left=o.parentOffsetLeft;if(typeof e.animationDelay!=="undefined"){n=e.animationDelay}t.animate({width:o.width,height:o.height,left:o.left,top:o.top},n)}return{getElement:a,init:g,scale:m,zoomImage:s,zoomIn:u,zoomOut:l,zoomReset:w,zoomConstants:f,updateScene7ImageURL:r}});