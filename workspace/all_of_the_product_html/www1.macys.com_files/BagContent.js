define(["jquery","underscore","cookie","clientSideStorage"],function(e,t,r,n){var o,a,c,i,u,s,p;o={products:[],categories:[],param:""};i=function(r){o.products=[];o.categories=[];if(!r){return}o.products=t.map(r.bagItems,function(e){return e.productID});o.categories=t.map(r.bagItems,function(e){return e.categoryID});o.param=e.param({bagContents:o.products.join("|")}).replace(/%7C/g,"|")};a=function(){var t;s=r.get("CartItem","GCs");if(!s||s===p){return}p=s;t={timenow:(new Date).getTime(),"promoCode[0]":r.get("PromoCodeOne","SMISCGCs")};e.post("/bag/view?"+e.param(t),function(e){try{return i(JSON.parse(e))}catch(t){}})};u=function(){if(!r.get("CartItem","GCs")){return}c=n.getSession("qbResponse");if(c){try{i(JSON.parse(c));return true}catch(e){}}return false};if(!u()){a()}e(window).focus(a);return o});