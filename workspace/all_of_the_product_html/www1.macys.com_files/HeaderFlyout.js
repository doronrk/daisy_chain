define(["jquery","base"],function(t,e){var i=false,o=4,n=o,r=213,a=r,s=14,u=12,l=u,d=["100%","100%","47%","30%","23.25%","18%"],f=d,c=true,h=c,y=137,v,g,F,m=e.ALIGN_BOTTOM,p,b,C="http://";return{TOP:y,DEFAULT_FLYOUTS_ENABLED:c,DEFAULT_COLUMNS:o,DEFAULT_FLYOUT_COLUMN_LEFT_PADDING:u,DEFAULT_FLYOUT_COLUMN_WIDTH:r,getFlyoutRequestUrl:function(){return b},setMaxFlyoutColumns:function(t){n=t||o},setFlyoutColumnWidth:function(t){a=t||r},setFlyoutColumnLeftPadding:function(t){l=t||u},enabled:function(){return h},disable:function(){h=false},enable:function(){h=true},getEdgeCoords:function(e){var i,o,n,r;i=this.getFlyoutSelectorId(e);o=t(i);n=o.offset();r={v1:{},v2:{}};if(o.length===0){return false}else{r.vert2={x:n.left,y:n.top};r.vert3={x:n.left+o.width(),y:n.top};return r}},closeAll:function(){if(t("div.flyout-on").length>0){t("div.flyout-on").addClass("flyout-off");t("div.flyout-on").removeClass("flyout-on")}},close:function(e){var i=this.getFlyoutSelectorId(e);var o=t(i);o.removeClass("flyout-on");o.addClass("flyout-off")},getRightAlignment:function(t,e){if(t>n){throw new Error("header.getRightAlignment Failed! Columns argument has exceeded MAXIMUM.")}var i=a*t;var o=l*t;var r=n*a+n*l-(i+o);return e+r},getLeftPosition:function(e,i,o,n,r){var a=t("#globalMastheadCategoryMenu > ul").offset().left;var s=t("#globalMastheadCategoryMenu > ul").width();var u=r/2;var l=e/2;if(u+o<l+a){return a}else if(u+o>a+(s-e)+l){return a+(s-e)}else{return o-(l-u)}},init:function(t,o,n){m=o||e.ALIGN_BOTTOM;p=n||false;i=e.isTouch()||false;if(!e.isNavApp()&&h||e.isThirdParty()){this.fetchFlyouts(t||[])}else{v(true)}return true},bind:function(){if(!i){this.bindEvents()}},bindEvents:function(){var i=this;t("div.subnav").mouseenter(function(e){g(t(this))});t("div.subnav").mouseleave(function(i){var o=t(this),n=e.getSuffixId(o.attr("id"));F(n)})},hideExtraColumns:function(e){e.find("div div").each(function(e){if(e>=n){t(this).css("display","none")}})},adjustFlyoutWidth:function(t,e){var i=e*a;var o=e*l;var n=i+o+s+"px";t.css("width",n);t.find("div div").css("width",f[e]);var r=t.find("div div:last-child");if(r.has("img").length>0){r.css("background","none").css("padding-left","0px").css("width",a+l+s+"px")}else{r.css("width",a+s+"px")}return true},adjustFlyoutPosition:function(t,i,o,n,r,a){if(m===e.ALIGN_BOTTOM){var s=this.getLeftPosition(t.width(),o,n.left,i,a);t.css("left",s+"px")}},fetchFlyouts:function(i){var o=0,n="",r;if(i===undefined||i.length===0){throw new Error("HeaderFlyout.fetchFlyouts(ids) failed! ids are empty.")}if(typeof i.push==="undefined"){throw new Error("HeaderFlyout.fetchFlyouts(ids) failed! ids must be an array.")}var a=this,s=e.isThirdParty()?"http://www.macys.com":"";b=s+"/shop/flyout?application="+(p||e.getCurrentChannel());for(o=0;o<i.length;o++){r=i[o];if(typeof r!=="number"){if(r.match(/[^[0-9]/).length>0){throw new Error("HeaderFlyout.fetchFlyouts(ids) failed! id in ids is not valid id: "+r)}else{n+=r}}else{n+=r;if(o<i.length-1){n+=","}}}b+="&categoryIds="+n;t.ajax({url:b,type:"GET",crossDomain:true,dataType:"jsonp",jsonpCallback:"flyoutCallback",cache:true,timeout:2e3,success:function(t,i,o){var n=e.isThirdParty()?e.absoluteLinkatize(t.html,"http://www.macys.com"):t.html;a.flyoutsLoadedSuccess(n,i,o)},error:function(t,e,i){a.flyoutsLoadedError(t,e,i)}});return true},flyoutsLoadedSuccess:function(e,i,o){var n=t("#globalMastheadCategoryMenu"),r=this;if(!~e.indexOf("Flyout_")){v(false)}else{t("body").append("<div id='globalMastheadFlyout'></div>");setTimeout(function(){t("div#globalMastheadFlyout").html(e);v(true)},50)}},flyoutsLoadedError:function(t,e,i){v(false)},getFlyoutSelectorId:function(t){if(typeof t!=="number"||!t){throw new Error("header.getFlyoutSelectorId() failed! Required number is invalid or missing.")}return"div#globalMastheadFlyout > div#Flyout_"+t},open:function(e,i,o,r,a){var s=this.getFlyoutSelectorId(e);var u=t(s);var l=u.find("div div").length;if(l>n){l=n;this.hideExtraColumns(u)}this.adjustFlyoutWidth(u,l);this.adjustFlyoutPosition(u,i,o,r,l,a);u.removeClass("flyout-off");u.addClass("flyout-on")},onReady:function(t){v=t},onOver:function(t){g=t},onOut:function(t){F=t},replaceCoreMetrics:function(){t("div#globalMastheadCategoryMenu>ul>li").each(function(i){var o=t(this).text();o=t.trim(o);o=o.replace(/ - /g,"-");o=o.replace(/ /g,"-");o=o.toLowerCase();o=o.replace(/'/g,"%27");o=encodeURIComponent(o);t("div#Flyout_"+e.getSuffixId(t(this).attr("id"))).find("a").each(function(e){t(this).attr("href",t(this).attr("href").replace("flytrackingbreadcrumb",o))})})}}});