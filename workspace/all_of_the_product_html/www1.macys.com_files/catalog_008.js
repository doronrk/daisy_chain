MACYS.namespace("MACYS.pdp");MACYS.pdp.bops=function(){this.productId=MACYS.util.Url.getParameter("ID");this.stCookie=undefined;this.memberProductIds=[];this.bopsUPCMap=undefined;this.storeDetails=undefined;this.uri="/api/store/v2/stores/";this.pdpType=MACYS.pdp.pageType;this.learnMoreCont='<div class="hd pad-bot">Buy Online, Pick up in-store</div><div>How does it work?</div><ul><li>1. The store receives your order.</li><li>2. We find & prepare your items.</li><li>3. We contact you when it\'s ready.</li><li>4. Pick up your order at any sales counter!</li></ul>';if(this.pdpType==="MASTER"){var a=YAHOO.util.Dom.getElementsByClassName("memberProducts");if(a){for(var b=0;b<a.length;b++){var c=a[b].id.replace("member","");if(c){this.memberProductIds.push(c)}}}}};MACYS.pdp.bops.prototype.availabilitystatus=function(){MACYS.pdp.bopsHandler.stCookie=MACYS.util.Cookie.get("BOPSPICKUPSTORE","MISCGCs");if(MACYS.pdp.bopsHandler.stCookie){var a=MACYS.pdp.bops.prototype.getBopsAvailabilityURL();YAHOO.util.Connect.initHeader("Content-Type","text/json; charset=utf-8");YAHOO.util.Connect.initHeader("Accept","application/json; charset=utf-8");YAHOO.util.Connect.asyncRequest("GET",a,{success:MACYS.pdp.bopsHandler.handleSuccess,failure:MACYS.pdp.bopsHandler.handleFailure,abort:MACYS.pdp.bopsHandler.handleAbort,timeout:MACYS.config.Base.defaultAjaxTimeout},null)}};MACYS.pdp.bops.prototype.getBopsAvailabilityURL=function(){var b=MACYS.pdp.bopsHandler.uri+MACYS.pdp.bopsHandler.stCookie+"?_fields=name,address,attributes,inventories";if(MACYS.pdp.bopsHandler.pdpType==="MASTER"){var a=MACYS.pdp.bopsHandler.memberProductIds.join(",");b=b+"&productId="+a}else{b=b+"&productId="+MACYS.pdp.bopsHandler.productId}return b};MACYS.pdp.bops.prototype.handleSuccess=function(b){var d=b.responseText;d=d.replace(/\n/g,"");d=d.replace(/\r/g,"");d=d.replace(/\t/g," ");d=d.replace(/<!--[^(-->)]+-->/g,"");var f=null;try{f=YAHOO.lang.JSON.parse(d);var j=f.stores.store[0];var a=j.attributes;for(var g=0;g<a.attribute.length;g++){var c=a.attribute[g].name;if(c=="BOPS_ELIGIBILITY"){MACYS.pdp.bopsHandler.storeBopsEligibility=a.attribute[g].value;break}}MACYS.pdp.bopsHandler.storeDetails=j;MACYS.pdp.bopsHandler.storeAddress=j.address;MACYS.pdp.bopsHandler.bopsUPCMap={};for(var h=0;h<j.inventories.inventory.length;h++){MACYS.pdp.bopsHandler.bopsUPCMap[j.inventories.inventory[h].upcNumber]=j.inventories.inventory[h].storeInventory}MACYS.pdp.bops.prototype.updatePreSelectedUPCsBOPSAvailability()}catch(i){MACYS.pdp.bopsHandler.handleFailure(b);return}};MACYS.pdp.bops.prototype.updatePreSelectedUPCsBOPSAvailability=function(){if(MACYS.pdp.bopsHandler.pdpType==="MASTER"){for(var a=0;a<MACYS.pdp.bopsHandler.memberProductIds.length;a++){MACYS.pdp.bops.prototype.updateUPCsBOPSAvailabilityMsgs(MACYS.pdp.bopsHandler.memberProductIds[a])}}else{MACYS.pdp.bops.prototype.updateUPCsBOPSAvailabilityMsgs(MACYS.pdp.bopsHandler.productId)}};MACYS.pdp.bops.prototype.updateUPCsBOPSAvailabilityMsgs=function(c){var b=YAHOO.util.Dom.get("pdpShipDays"+c);var a=YAHOO.util.Dom.getElementsByClassName("bopsPreselectedUPCNumber hidden","span",b);var d=YAHOO.util.Dom.getElementsByClassName("colors");var j=YAHOO.util.Dom.getElementsByClassName("sizes");if(a&&a[0]){var l=a[0].id;var k=false;var m="";for(var f=0;f<MACYS.pdp.upcmap[c].length;f++){if(MACYS.pdp.upcmap[c][f].upc===l){var g=MACYS.pdp.upcmap[c][f].inStoreEligible;if(MACYS.pdp.upcmap[c][f].availabilityOrderMethod==="ORDR"){k=true;var e=MACYS.pdp.bopsHandler.getBOPSAvailabilityMsgByUPC(c,l,g,k);if(MACYS.pdp.upcmap[c][f].availabilityMsg){msg=MACYS.pdp.upcmap[c][f].availabilityMsg.split(":");if(d.length>0||j.length>0){b.innerHTML="<div class='bopsClear'></div><div class='ordermsg'><strong>backorder</strong><BR/>"+msg[1]+"<BR/></div><div class='bopsDivider'></div>"+e.innerHTML}else{b.innerHTML="<div class='ordermsg'><strong>backorder</strong><BR/>"+msg[1]+"<BR/></div><div class='bopsDivider'></div>"+e.innerHTML}}}else{if(MACYS.pdp.upcmap[c][f].availabilityOrderMethod==="SPEC"){k=true;var e=MACYS.pdp.bopsHandler.getBOPSAvailabilityMsgByUPC(c,l,g,k);if(MACYS.pdp.upcmap[c][f].availabilityMsg){msg=MACYS.pdp.upcmap[c][f].availabilityMsg.split(":");if(d.length>0||j.length>0){b.innerHTML="<div class='bopsClear'></div><div class='ordermsg'><strong>special order</strong><BR/>"+msg[1]+"<BR/></div><div class='bopsDivider'></div>"+e.innerHTML}else{b.innerHTML="<div class='ordermsg'><strong>special order</strong><BR/>"+msg[1]+"<BR/></div><div class='bopsDivider'></div>"+e.innerHTML}}}else{m=MACYS.pdp.bops.prototype.getBOPSAvailabilityMsgByUPC(c,l,g,k);b.innerHTML=m.innerHTML}}break}}}var h=YAHOO.util.Dom.get("bopsLearnMoreButton"+c);YAHOO.util.Event.addListener(h,"click",function(i){MACYS.pdp.bopsHandler.showLearnMore(i)})};MACYS.pdp.bops.prototype.getBOPSAvailabilityMsgByUPC=function(c,d,a,b){if(MACYS.pdp.bopsHandler.bopsUPCMap){return MACYS.pdp.bops.prototype.createBopsAvailabilityMsgStoreKnown(c,d,a,b)}else{return MACYS.pdp.bops.prototype.createBopsAvailabilityMsgStoreNotKnown(c,d,a,b)}};MACYS.pdp.bops.prototype.createBopsAvailabilityMsgStoreNotKnown=function(a,g,d,l){var k="checkotherstore"+a;var j=document.createElement("div");var b=document.createElement("div");var c=YAHOO.util.Dom.getElementsByClassName("colors");var f=YAHOO.util.Dom.getElementsByClassName("sizes");var i=null;var e=null;i=document.createElement("div");e=document.createElement("div");b.className="bopsInStock";b.innerHTML="in stock";i.className="bopsAvailabilityMsg";e.className="learn-more";if(d!=undefined&&d!=null&&d==="true"){i.innerHTML='<a href="javascript:void(0);" id='+k+">Check availability in your area</a>"}if(i.innerHTML&&MACYS.pdp.bopsHandler.pdpType==="MASTER"){b.innerHTML="in stock <div class='bopsMasterDivider'/>"}else{if(i.innerHTML&&MACYS.pdp.bopsHandler.pdpType!="MASTER"){b.innerHTML="in stock <div class='bopsDivider'/>"}}e.innerHTML='<input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="" /><input name="productId" id="productId" type="hidden" value="'+a+'" /></div><div class="clear"></div><span id="'+g+'" class="bopsPreselectedUPCNumber hidden"></span>';if(MACYS.pdp.bopsHandler.pdpType!=="MASTER"&&l===false&&(c.length>0||f.length>0)){var h=document.createElement("div");h.className="bopsClear";j.appendChild(h)}if(l===true){if(i){j.appendChild(i)}if(e){j.appendChild(e)}}else{j.appendChild(b);if(i){j.appendChild(i)}if(e){j.appendChild(e)}}return j};MACYS.pdp.bops.prototype.createBopsAvailabilityMsgStoreKnown=function(n,q,g,o){var s=false;var a=false;var r=false;var p="";var h="";var i="checkotherstore"+n;var k="bopsLearnMoreButton"+n;var f=document.createElement("div");var j=document.createElement("div");var m=YAHOO.util.Dom.getElementsByClassName("colors");var b=YAHOO.util.Dom.getElementsByClassName("sizes");var e=document.createElement("div");var d=document.createElement("div");j.className="bopsInStock";j.innerHTML="in stock";e.className="bopsAvailabilityMsg";e.id="bopsAvailabilityMsg";d.className="learn-more";p=MACYS.pdp.bopsHandler.storeDetails.name;h=MACYS.pdp.bopsHandler.storeAddress.zipCode;p=p+"<br/>";if(h){h=h.substring(0,5)}if(MACYS.pdp.bopsHandler.bopsUPCMap){var c=MACYS.pdp.bopsHandler.bopsUPCMap[q];s=c.bopsAvailability;a=c.bopsEligibility;r=c.storeAvailability;storeBopsEligibility=MACYS.pdp.bopsHandler.storeBopsEligibility;if(a!=undefined&&a!=null){if(storeBopsEligibility!=undefined&&storeBopsEligibility!=null&&storeBopsEligibility=="TRUE"){if(g!=undefined&&g!=null&&g=="true"){if(a!=undefined&&a!=null&&a=="ELIGIBLE"){if(s=="AVAILABLE"){e.innerHTML='<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/bagiconsmall.png"/><div id="splitStore"><span><strong>Pick Up In-Store</strong><BR/>Available for pick up at '+p+'<a href="javascript:void(0);" id='+i+">check other stores</a></div>";d.innerHTML="<a id="+k+' href="javascript:void(0);" class="noLinkUnderline">what\'s this?<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/what_is_this_icon.gif"/></a><input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}else{if(r=="AVAILABLE"){e.innerHTML="<strong>Pick Up In-Store</strong><BR/>Not available for pick up at "+p+'<a href="javascript:void(0);" id='+i+">check other stores</a>";d.innerHTML="<a id="+k+' href="javascript:void(0);" class="noLinkUnderline">what\'s this?<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/what_is_this_icon.gif"/></a><input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}else{e.innerHTML="<strong>Pick Up In-Store</strong><BR/>Not available at "+p+'<a href="javascript:void(0);" id='+i+">check other stores</a>";d.innerHTML="<a id="+k+' href="javascript:void(0);" class="noLinkUnderline">what\'s this?<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/what_is_this_icon.gif"/></a><input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}}}else{e.innerHTML='<a href="javascript:void(0);" id='+i+">Check availability in your area</a>";d.innerHTML='<input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /></div><div class="clear"></div><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}}else{}}else{if(g!=undefined&&g!=null&&g=="true"){e.innerHTML='<a href="javascript:void(0);" id='+i+">Check availability in your area</a>";d.innerHTML='<input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /></div><div class="clear"></div><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'
}}}else{if(s==="AVAILABLE"){e.innerHTML='Available for pick up at <a href="javascript:void(0);" id='+i+">"+p+"</a>";d.innerHTML="<a id="+k+' href="javascript:void(0);" class="noLinkUnderline">what\'s this?<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/what_is_this_icon.gif"/></a><input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}else{e.innerHTML='<a href="javascript:void(0);" id='+i+">select a store</a> to check availability in your area ";d.innerHTML="<a id="+k+' href="javascript:void(0);" class="noLinkUnderline">what\'s this?<img src="'+MACYS.config.Base.assetsUrl+'/web20/assets/img/pdp/what_is_this_icon.gif"/></a><input name="bopsStoreZipCode" id="bopsZipCode" type="hidden" value="'+h+'" /><input name="productId" id="productId" type="hidden" value="'+n+'" /><span id="'+q+'" class="bopsPreselectedUPCNumber hidden"></span>'}}if(e.innerHTML&&MACYS.pdp.bopsHandler.pdpType==="MASTER"){j.innerHTML="in stock <div class='bopsMasterDivider'/>"}else{if(e.innerHTML&&MACYS.pdp.bopsHandler.pdpType!="MASTER"){j.innerHTML="in stock <div class='bopsDivider'/>"}}if(MACYS.pdp.bopsHandler.pdpType!=="MASTER"&&o===false&&(m.length>0||b.length>0)){var l=document.createElement("div");l.className="bopsClear";f.appendChild(l)}if(o===true){f.appendChild(e);f.appendChild(d)}else{f.appendChild(j);f.appendChild(e);f.appendChild(d)}}return f};MACYS.pdp.bops.prototype.handleFailure=function(a){MACYS.log("BOPS Request Failed - "+a.statusText)};MACYS.pdp.bops.prototype.handleAbort=function(a){MACYS.log("BOPS Request Aborted - "+a.statusText)};MACYS.pdp.bops.prototype.showLearnMore=function(a){YAHOO.util.Event.preventDefault(a);cmCreatePageElementTag("learn_more","bops_pdp");window.open("https://customerservice.macys.com/app/answers/detail/a_id/264/kw/264")};
