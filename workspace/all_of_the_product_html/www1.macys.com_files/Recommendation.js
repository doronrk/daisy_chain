define(["jquery","cookie"],function(e,r){var t="MISCGCs",n="_exp",o="RTD",a="shippingCountry",i="zipCode",d="/sdp/rto/request/recommendations",s="/EventsWar/events/record/customeraction",c="@",m="you might also like...",l=15e3;var u=function(){window.splitCB=function(e){return e}};var f=function(t,n,o,s,c,m,u,f,I){if(!t){throw new Error("Recommendation.getRecommendations failure. Invalid parameter requester="+t)}if(!n){throw new Error("Recommendation.getRecommendations failure. Invalid parameter context="+n)}if(!o){throw new Error("Recommendation.getRecommendations failure. Invalid parameter productId="+o)}if(!s){s=""}if(!m){throw new Error("Recommendation.getRecommendations failure. Invalid parameter callback="+m)}var p=u||l,v=c||10,g=f||d,C=this;var w,R,T,x;w="";R=this.getRTDSessionCookie()||"";T=r.get(a)||"";x=r.get(i)||"";w+="productId="+o;w+="&requester="+t;w+="&context="+n;w+="&visitorId="+R;w+="&customerId="+s;w+="&countryCode="+T;w+="&zipCode="+x;w+="&maxRecommendations="+v;if(I){w+="&"+I}e.ajax({url:d,type:"POST",data:w,dataType:"json",timeout:p,jsonp:false,jsonpCallback:"initCB",success:function(e){m(true,h(e))},error:function(e,r,t){m(false,{error:r+",message:"+t.message+" loading: "+d})}})};var I=function(t,n,o,i,d,c,m,u,f,I){if(!t){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter requester="+t)}if(!n){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter context="+n)}if(!o){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter eventType="+o)}if(!i){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter choiceIds="+i)}if(!d){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter productIds="+d)}if(!c){c=""}if(!u){throw new Error("Recommendation.sendInformantCall failure. Invalid parameter callback="+u)}var p=f||l,h=this;var v=r.get(a)||"";m=this.getRTDSessionCookie()||"";var g="productIds="+d+"&sender="+t+"&context="+n+"&responseType="+o+"&choiceIds="+i+"&visitorId="+m+"&customerId="+c+"&countryCode="+v;if(I){g+="&"+I}e.ajax({url:s,type:"POST",data:g,dataType:"json",timeout:p,jsonp:false,jsonpCallback:"initCB",success:function(e){u(true,e)},error:function(e,r,t){u(false,{error:r+",message:"+t.message+" loading: "+s})}})};var p=function(){var e=function(){var e=new Date;return((e.getTime()+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+e()+e()+e()+e()+e()+e()};var h=function(t){if(!t||!t.recommendedItems||t.recommendedItems.length<=0){return false}var n={};var o=t.recommendedItems;var a=r.get("UserName","GCs");n.encodedChoiceId=o[0].choiceId;var i=o[0].choiceId.split(c);if(i[0]&&i[1]&&i[2]){n.choiceId=i[0].substring(3);n.headerId=i[1];n.headerText=i[2].split("$")[0].replace(/\+/g," ");n.headerText=decodeURIComponent(n.headerText.replace(/v_username/g,a));if(n.headerText.indexOf("_")!==-1||!a&&i[2].split("$")[0].indexOf("v_username")!==-1){n.headerText=m}}else if(i[0]){n.headerId="";n.choiceId=i[0].split("$")[0].substring(3);n.headerText=m}else{return false}n.productId=o[0].productId;n.recommendedIdsList=[];e.each(t.recommendedItems,function(e,r){n.recommendedIdsList.push({id:r.recommendedItemId,choiceId:r.choiceId})});n.status=t.status;n.error=t.error;return n};var v=function(){var e=r.get(o);if(!e){var t=this.generateGUID();var n=new Date;n.setFullYear(n.getFullYear()+30);r.setExpires(n.toUTCString());r.set(o,t);e=r.get(o)}return e};return{initCB:u,getRecommendations:f,sendInformantCall:I,generateGUID:p,getRTDSessionCookie:v,prepareRecommendationJSON:h}});