(function($){$.extend(Sephora.ui.controller,{FlashController:function(options){Sephora.logger.log("FlashController");this.scope=options.scope;var self=this,addToCart="button.btn-add-to-basket",scope=self.scope;$(addToCart,scope).attr("data-custom-enable",true);$.extend(self,new Sephora.ui.controller.ShoppingCartController()).addToBasket(addToCart,function(source){return $(source).closest("form").serializeArray()});$("#accept-terms",scope).change(function(){$(addToCart,scope).prop("disabled",!$(this).is(":checked"));$(".msg-accept",scope).toggleClass("hide")});self.initCartUtils()},ProductDetailController:function(scope){var self=this;$.extend(this,Sephora.util.HtmlUtils,Sephora.ui.controller.ThumbnailController,{updateReminderStoreLocator:function(sku){var settings=this.infoSettings;if(sku.is_show_find_in_store){$(settings.productActions+" .find").find("label").text("Find in store").removeClass("online-only").end().find("input").removeAttr("disabled").show().end().find("button").removeAttr("disabled").show().end()}else{if(sku.is_online_only){$(settings.productActions+" .find").find("label").text("Only available online").end().find("input").attr("disabled","disabled").hide(0,function(){$(settings.productActions+" .find").find("label").addClass("online-only")}).end().find("button").attr("disabled","disabled").hide().end()}else{$(settings.productActions+" .find").hide()}}},skuForEmail:function(origin){if($(origin).closest("#primarySkuInfoArea").length===0){return{sku_number:$(origin).attr("data-sku_number")}}else{return this.currentSku()}}});self.thumbScope=scope.find(".main-product-thumbnails")},ViewMoreController:function(scope){var settings=$.extend(settings,{swatchCount:0,swatchSize:0,maximumSwatchCount:{for36px:51,for62px:18,for32px72px:25,forText:25}});var viewMoreNeeded=false;var arrSelectors=$(scope);var hasViewMore=function(swatchGroup){settings.swatchCount=$(swatchGroup).attr("data-swatchcount");settings.swatchSize=$(swatchGroup).attr("data-swatchsize");if(settings.swatchSize=="swatch-sq-sm"&&settings.swatchCount>settings.maximumSwatchCount.for36px){return true}if(settings.swatchSize.indexOf("swatch-sq-md")>-1&&settings.swatchCount>settings.maximumSwatchCount.for62px){return true}if(settings.swatchSize.indexOf("swatch-sq-lg")>-1&&settings.swatchCount>settings.maximumSwatchCount.for62px){return true}if(settings.swatchSize=="swatch-rect"&&settings.swatchCount>settings.maximumSwatchCount.for32px72px){return true}if(settings.swatchSize=="sku-selector--text"&&$(scope).find(".product-thumb").length>settings.maximumSwatchCount.forText){return true}return false};for(var i=0;i<arrSelectors.length;i++){viewMoreNeeded=hasViewMore(arrSelectors[i]);var swatchGroupContainer=$(arrSelectors[i]).parent();if(viewMoreNeeded){$(swatchGroupContainer).addClass("more-swatches").addClass("collapsed").append("<div class='view-more'>View</div>").find(".view-more").on("click",function(){$(this).parent().toggleClass("collapsed")})}}},FindInStoreController:function(productController,scope,element){var self=this,store=new Sephora.util.storage.ProductStorage,marker,errorBuilder=new Sephora.ui.error.ErrorBuilder({top:"#find-in-store",globalInsertBefore:".search-stores-container"}),goErrorBuilder=new Sephora.ui.error.ErrorBuilder({topElement:".find",globalInsertAfter:"*:first"}),cont=$("#find-in-store"),remoteFindInStore=Sephora.ui.Store.findInStore;$.extend(self,Sephora.util.MapUtils,Sephora.ui.ViewHelper,Sephora.util.HtmlUtils,Sephora.util.Validates);self.validator=new Sephora.validation.Validator();self.validator.add(new Sephora.validation.ZipCodeValidator($("input[name='zip']",element),{anyCountry:true}));function markAndPosition(store){var storeName=self.storeNameFrom(store),lat=store.data("lat"),lng=store.data("lng"),address=$(".store-name",store).text();$("#find-in-store-map").find(".modal-title").text(address);function miles(){var val=$("select[name='within']").val(),isMiles=!(/km/i).test($("select[name='within'] option:selected").text());return{miles:isMiles?parseInt(val):val/1.6,unit:isMiles?"mile":"km"}}var latLg=new google.maps.LatLng(lat,lng);var theMap=self.repositionMap(latLg,miles());if(marker){marker.setMap(null)}marker=new google.maps.Marker({position:latLg,map:theMap,title:storeName})}var showFlame=function(){$("#find-in-store .search-stores").addClass("loading");$(document).one("ajaxComplete",function(){$("#find-in-store .search-stores").removeClass("loading")})},clearResults=function(){return cont.find(".search-stores").empty()},removeStoreList=function(){cont.find(".modal-scroll").remove()};scope.searchSkuInStores=function(){goErrorBuilder.withNoErrors(self.validator.validate(),{success:function(){$("#find-in-store .u-textDanger").remove();self.findInStore(scope.zip,-1)},error:function(){removeStoreList()}})};scope.zipPressed=function(e){if(e.keyCode===13){e.preventDefault();scope.searchSkuInStores()}};$("#find-in-store").on("click",".btn-search-again",function(e){$("#find-in-store .u-textDanger").slideUp(function(){$(this).remove()});errorBuilder.withNoErrors(self.validator.validate({top:"#find-in-store"}),{success:function(){self.findInStore(cont.find("input[name='zip']").val(),cont.find("select").val())},error:function(){removeStoreList()}});e.preventDefault()});$("#find-in-store").on("click","a.store-map-link",function(e){e.preventDefault();markAndPosition($(this).closest(".one-store"));$("body").trigger("layover",[{title:"view store map"}]);Sephora.util.PopupUtils.displayCenteredPopup($("#find-in-store-map"),{backdrop:true})});var onError=function(){var isSearchBox=$(".search-stores-container").length>0,error=$("<br>"+Sephora.ui.error.makeError(Sephora.i18n.t("inventory.lookup.notavailable")));if(isSearchBox){error.insertAfter($(".search-stores-container"));cont.find(".modal-scroll").remove()}else{cont.find(".search-stores").append(error)}Sephora.util.PopupUtils.displayCenteredPopup("#find-in-store",{backdrop:true})};$.extend(self,{findInStore:function(zip,within){function findOnServer(longLat){Sephora.util.PopupUtils.displayCenteredPopup($("#find-in-store"),{backdrop:true});showFlame();remoteFindInStore({sku_id:productController.currentSku().id,zip:zip,within:within,latitude:longLat?longLat.lat():undefined,longitude:longLat?longLat.lng():undefined},function(resp,_,xhr){if(xhr.status!==200){onError();return}clearResults().append($(resp));Sephora.ui.directive.numberField(undefined,$("#find-in-store .zip"));self.updateSkuInfo();$("body").trigger("findInStore",[zip,resp])},onError)}self.longLatFrom(Sephora.conf.CAREG.test(zip)?zip+", Canada":zip,function(longLat){findOnServer(longLat)},function(){findOnServer(false)})},updateSkuInfo:function(){var sku=productController.currentSku(),doUpdate=function(product){var findInStore=$("#find-in-store");findInStore.find("h3 span:first").html(product.brand_name).end().find("h3 span:last").html(product.display_name).end().find(".sku span:last").text(sku.sku_number).end().find(".info-row:last .value").text(sku.variation_value||"").end().find("img").attr("src",self.prodImageFor(sku.inline_image));findInStore.find(".info-row:last .label")[sku.variation_value?"show":"hide"]()};if("primary_product" in productController){doUpdate(productController.primary_product)}else{store.productFor(sku.primary_product_id,function(){doUpdate(this)})}}})},ImageZoomController:function(){var image=$(".hero-main-image > img");var size=image.attr("width");if(image.attr("data-zoom")){var largeImage=$("<img src='/images/blank.gif'/>");var zoomWindow=$("<div class='zoom-window'></div>");var glass=$("<div class='glass s"+size+"'></div>");var glassImage=image.clone();var mask=$("<div class='mask s"+size+"'></div>");var backdrop=$("<div class='zoom-backdrop'><div>");var imageContainer=$(".hero-main-image");var toolTip=$("<div class='zoom-tooltip'>CLICK TO ZOOM</div>");var closeIcon=$('<div class="icon icon-close-lg"></div>');var animationDone=true;var imageLoaded=false;var showTip=false;var imageOut=false;var glassOut=false;imageContainer.append(glass);$("body").append(toolTip);glass.append(glassImage);imageContainer.append(mask);zoomWindow.append(largeImage);if(Modernizr.touch){zoomWindow.append(closeIcon)}$("body").append(zoomWindow);$("body").append(backdrop);var getPageX=function(e){return Modernizr.touch?e.originalEvent.changedTouches[0].pageX:e.pageX};var getPageY=function(e){return Modernizr.touch?e.originalEvent.changedTouches[0].pageY:e.pageY};var closeZoomWindow=function(e){e.preventDefault();e.stopPropagation();if(animationDone){backdrop.hide();animationDone=false;zoomWindow.animate({top:(getPageY(e)-42)+"px",left:(getPageX(e)-42)+"px",width:"84px",height:"84px",opacity:0.25},500,function(){glass.hide();mask.css({display:"none"});zoomWindow.hide();animationDone=true;if(!Modernizr.touch){moveTip(e)}glassOut=false;imageOut=false})}};var moveGlass=function(e){e.preventDefault();e.stopPropagation();var offset=image.offset();var relX=getPageX(e)-offset.left;var relY=getPageY(e)-offset.top;glass.css({left:(relX-42)+"px",top:(relY-42)+"px"});glassImage.css({left:-(relX-42)+"px",top:-(relY-42)+"px"});largeImage.css({left:-(((relX/size)*1500)-size)+"px",top:-(((relY/size)*1500)-size)+"px"})};var openZoomWindow=function(e){e.preventDefault();e.stopPropagation();if(imageLoaded){if(animationDone){if(Modernizr.touch){backdrop.show();closeIcon.show()}toolTip.hide();glass.show();mask.css({display:"block",opacity:".25"});var pos=$(".wrapper").position();var extraMargin=$(".wrapper").css("margin-left").replace("px","");var leftPos=335+(isNaN(extraMargin)?pos.left:pos.left+(extraMargin-0));if(size=="300"){leftPos+=50}animationDone=false;zoomWindow.css({top:(getPageY(e)-42)+"px",left:(getPageX(e)-42)+"px",width:"84px",height:"84px",display:"block",opacity:0.25});zoomWindow.animate({top:(145+pos.top)+"px",left:leftPos+"px",width:"500px",height:"500px",opacity:1},500,function(){animationDone=true;if(glassOut&&imageOut){glassOut=false;imageOut=false;closeZoomWindow(e)}})}}};var moveTip=function(e){var relX=e.pageX+20;var relY=e.pageY-10;toolTip.css({top:relY+"px",left:relX+"px"})};var disableZoom=function(){imageLoaded=false;showTip=false;image.css("cursor","default")};var loadLargeImage=function(){disableZoom();var src=image.attr("src");if(src.indexOf("not-available")==-1&&src.indexOf("/images/blank.gif")==-1){var ext="300";if(src.indexOf("/sku/")>-1){ext="-"+ext}largeImage.attr("src",image.attr("src").replace("hero","zoom").replace(ext,""))}};loadLargeImage();image.load(loadLargeImage);largeImage.on("error",function(e){disableZoom()});largeImage.load(function(){if($(this).attr("src").indexOf("/images/blank.gif")==-1){imageLoaded=true;showTip=true;image.css("cursor","crosshair")}});var touchClose=function(){backdrop.hide();glass.hide();mask.css({display:"none"});zoomWindow.hide()};if(Modernizr.touch){imageContainer.on("touchstart",openZoomWindow);imageContainer.on("touchstart",moveGlass);imageContainer.on("touchend",closeZoomWindow);imageContainer.on("touchmove",moveGlass);backdrop.click(touchClose);closeIcon.click(touchClose)}else{imageContainer.hover(function(){},function(e){closeZoomWindow(e),imageOut=true});glass.hover(function(){},function(e){glassOut=true});imageContainer.mousemove(moveGlass);image.mouseover(openZoomWindow)}}}});var currentSku,views,settings={beautyInsiderMember:false,ingredientVariationVal:"#ingredients"},skuStorage=Sephora.util.storage.skuStorage||new Sephora.util.storage.SKUStorage(),quantField="#primarySkuInfoArea .product-quantity .quantitySelector:visible, .ancillary-products .product-quantity .quantitySelector:not([disabled='disabled']):visible, .ancillary-carousel [name='qnty']";Sephora.ui.controller.PDPController=function($scope,$element){var self=$scope.ctrl=this;var opts=$.extend({},settings,{thumbClone:$element.find(".image-selector a:first").clone()});var productView=new Sephora.ui.product.ProductView(opts,skuStorage);productView.updateUrl=function(skuId){var obj=Sephora.util.ParameterUtils.toObject(location.search);obj.skuId=skuId;Sephora.util.ParameterUtils.updateUrlForHistory(obj,true)};$.extend(this,productView,new Sephora.ui.controller.ProductDetailController($element),Sephora.ui.controller.SupportsLoves,new Sephora.ui.controller.EmailWhenBackInStockController,Sephora.util.HtmlUtils,new Sephora.ui.controller.ShoppingCartController({renderFieldError:function(){$(quantField).addClass("error")},show:function(){$(quantField).removeClass("error")}}),new Sephora.ui.controller.BiExclusiveController,{instance:"ProductDetailController"});self.scope=$element;this.infoSettings.top=$element;self.init();self.saveInitial().love(".btn-love",true);$scope.allSkuIds=function(){return self.allSkuIds};if(!!this.currentSku()&&"primary_product" in this.currentSku()){$scope.productId=this.currentSku().primary_product.id}self.addToBasket(".btn-add-to-basket, .btn-buy-the-collection, [name=add-to-basket]",function(button){var items={};if(button.data("type")=="ancillary"){items=Sephora.ShoppingCart.makeItems(button.data("sku_number"),1)}else{var hasSwatches=$(".sku-selector-content",self.scope).length>0,skuId;$(".purchase-info .product-quantity .quantitySelector",self.scope).each(function(idx){var h=$(this),qty=parseInt(h.val()),elemName=h.attr("name");if(hasSwatches&&idx===0){skuId=self.currentSkuId();items=Sephora.ShoppingCart.makeItems(skuId,qty)}else{if(!isNaN(qty)&&qty>0){items[elemName]=qty}}})}return items}).onSuccessfulAdd(function(source,cart,_,isCollection){self.updateOnAdd(cart,_,isCollection)});var validator=new Sephora.validation.Validator;validator.add(new Sephora.validation.ItemQuantityValidator({quantity:quantField}));self.validator=validator;self.initScroll();if($element.is(":visible")){currentSku=function(){return self.currentSku()};views=self;new Sephora.ui.controller.FindInStoreController(views,$scope,$element);$("body").bind("backInStockEmailNotification",views.onEmailWhenBackInStockNotification)}};Sephora.app.initializer(function(){$(".product-tabs a:first").tab("show");Sephora.util.PopupUtils.showInfoPopups(".maincontent .pop-info");if($("#flash-product-content").length){return}var thumbClone=$(".new-ppage .image-selector a:first").clone();if(!Sephora.Product.isChanel){var viewMoreSkus=new Sephora.ui.controller.ViewMoreController(".sku-selector")}Sephora.ui.controller.ImageZoomController();var swatch=$(".sku-selector .product-thumb");var skuVariantTextArea=$(".info-row.variation .value");var heroImage=$(".hero-main-image img");var lastHeroImg;var disableTooltips=setTimeout(function(){swatch.tooltip("disable")},0);var getCurrentSwatch=function(){return($(".sku-selector-content .product-thumb.current"))};var ext="";if(!Sephora.Product.isChanel){ext="-300"}swatch.on("mouseover",function(){var skuVariantText=$(this).attr("data-original-title");skuVariantTextArea.html(skuVariantText);lastHeroImg=heroImage.attr("src");heroImage.attr("src","/productimages/sku/s"+$(this).attr("data-skuid")+"-main-hero"+ext+".jpg")}).on("mouseout",function(){if($(".main-product-thumbnails .product-thumb").length==0||$(".main-product-thumbnails .current").hasClass("sku-image")){var skuVariantText=getCurrentSwatch().attr("data-original-title");skuVariantTextArea.html(skuVariantText);heroImage.attr("src","/productimages/sku/s"+getCurrentSwatch().attr("data-skuid")+"-main-hero"+ext+".jpg")}else{heroImage.attr("src",lastHeroImg)}});var addSwatchTitle=function(){swatch.each(function(){$(this).append($(this).attr("data-original-title"))})};var fragranceSwatchTitles=setTimeout(function(){addSwatchTitle()},0)});Sephora.Product.showB=Sephora.util.ParameterUtils.extractParam("showB");if(Sephora.Product.showB){$(".ancillary-products.test-a, .ancillary-products.test-b").toggle()}Sephora.Product.isChanel=$("#product-content").data("brand")=="CHANEL";Sephora.jail.lazyImages($("img[data-src]:visible"));Sephora.ui.controller.RelatedCtrl=function($scope,$element){var videoTotal=0,photoTotal=0,articleTotal=0;$scope.showVideos=$scope.showArticles=$scope.showPhotos=false;$scope.$on("videosTotal",function(evt,vidtotal){$scope.showVideos=vidtotal>0});$scope.$on("articlesTotal",function(evt,articletotal){$scope.showArticles=articletotal>0});$scope.$on("photosTotal",function(evt,photototal){$scope.showPhotos=photototal>0})};Sephora.ui.controller.VideosController=function($scope,$element,$attrs){var self=this;self.process=function(res){var items=res.items,total=items.length;if(total>0){var max=total>24?24:total,i=0,group=[],runningCount=0;$scope.groups=[];$scope.total=total;for(i;i<max;i+=2){var first=items[i],second=items[i+1];first.carouselIndex=i;group.push(first);if(!!second){second.carouselIndex=i+1;group.push(second)}$scope.groups.push({videos:group});group=[]}$scope.$emit("videosTotal",$scope.total);$scope.$apply();setTimeout(function(){Sephora.ui.initCarousel($($element).find(".carousel"))},0)}};if(!Sephora.Product.isChanel){$.ajax($attrs.ajaxUrl,{dataType:"jsonp",jsonpCallback:"backlotCallback"}).done(self.process)}};Sephora.ui.controller.ArticlesController=function($scope,$element,$sce){var self=this;var articles=[];self.addAPIArticles=function(res){$.each(res.articles,function(i,elem){if(elem.published){articles.push(elem)}})};self.process=function(){$("#pdp-bcc-articles").children().each(function(){var artObj={},img=$(this).attr("data-img-src"),txt=$(this).attr("data-text"),url=$(this).attr("data-url");artObj.images={};artObj.images.square_image={};artObj.images.square_image.medium={};artObj.images.square_image.medium.url=img?img:" ";artObj.name=txt?txt:"Get inspired on The Sephora Glossy";artObj.tumblr_url=url?url:"#";articles.unshift(artObj)});var total=articles.length,max=total>12?12:total,i=0,article="";if(total>0){$scope.groups=[];$scope.total=total;for(i;i<max;i+=1){article=articles[i];article.carouselIndex=i;if(!article.name.length){if(article.caption.length){article.name=article.caption}else{article.name="Get inspired on The Sephora Glossy"}}$scope.groups.push({articles:article})}$scope.$emit("articlesTotal",$scope.total);$scope.$apply();setTimeout(function(){Sephora.ui.initCarousel($($element).find(".carousel"))},0)}};var PID=Sephora.Sku.defaultSku.primary_product.id;var glossyurl="/rest/products/"+PID+"/glossy";if(!Sephora.Product.isChanel){$.ajax(glossyurl,{dataType:"json"}).done(function(res){if(typeof res.articles!=="undefined"&&(res.total_articles>=1)){self.addAPIArticles(res)}}).always(function(){self.process()})}$scope.trust=function(c){return $sce.trustAsHtml(c)}};Sephora.ui.controller.PhotosController=function($scope,$element,$attrs){var self=this,total;self.gatherPhotos=function(res){if(res.results){if(typeof self.results=="undefined"){self.results=res;var response=self.results;response.requested=response.paging.total_requested,response.total=total=response.paging.total_content;if(response.requested<response.total){self.getPhotos(response.paging.next)}else{self.process(self.results)}}else{var moreResults=res.results,allResults=self.results.results.concat(moreResults);self.results.results=allResults;self.process(self.results)}}};self.process=function(gatheredPhotos){var response=gatheredPhotos,results=response.results,max=total>72?72:total,i=0,item="",group=[],runningCount=0,link=results[0].beautyboard_link+"&sortby=popular",photoPop=$("#beauty-board-lrg"),lrgPhoto=$("#beauty-board-lrg div img"),clicked=false;$scope.groups=[];$scope.total=max;$scope.realTotal=total;if(total>0){for(i;i<max;i+=1){if(results[i].media!==null){item=results[i].media[0];item.link=link;item.carouselIndex=i;item.share_url=results[i].share_url;group.push(item);if((i+1)%6==0||i==(max-1)){$scope.groups.push({photos:group});group=[]}}}$scope.link=$scope.groups[0].photos[0].link;$scope.lrgPhotoSrc="";$scope.lrgPhotoModalClick=function(photo){if($scope.lrgPhotoSrc===photo.medium){Sephora.util.PopupUtils.displayCenteredPopup(photoPop,{closeSelectors:[".modal__close"],backdrop:true,backdropDark:true})}else{lrgPhoto.attr("src","");$scope.lrgPhotoSrc=photo.medium;$scope.share_url=photo.share_url;$("#beauty-board-lrg div").imagesLoaded().done(function(){Sephora.util.PopupUtils.displayCenteredPopup(photoPop,{closeSelectors:[".modal__close"],backdrop:true,backdropDark:true})})}};$scope.$emit("photosTotal",$scope.total);$scope.$apply();setTimeout(function(){Sephora.ui.initCarousel($($element).find(".carousel"))},0)}};var PID=Sephora.Sku.defaultSku.primary_product.id;var beautyboardurl=$attrs.ajaxUrl+"response=jsonp&callback=mycallback&pid="+PID+"&sort=4";if(!Sephora.Product.isChanel){self.getPhotos=function(url){$.ajax(url,{dataType:"jsonp"}).done(self.gatherPhotos)};self.getPhotos(beautyboardurl)}};Sephora.ui.directive.numberField=function(_,element){if(Modernizr.touch){element.attr("type","number")}};angular.module("PDP",[]).controller("RelatedCtrl",Sephora.ui.controller.RelatedCtrl).controller("VideosController",Sephora.ui.controller.VideosController).controller("PhotosController",Sephora.ui.controller.PhotosController).controller("ArticlesController",Sephora.ui.controller.ArticlesController).controller("PDPController",Sephora.ui.controller.PDPController).controller("CarouselController",Sephora.ui.controller.CarouselController).controller("CompController",Sephora.ui.controller.CompController).directive("sephModalVideo",function(){return{link:function($scope,element,attrs){Sephora.ui.modalVideo(element)}}}).directive("scrollToTop",Sephora.ui.directive.scrollToTop).directive("sephNumeric",function(){return{link:Sephora.ui.directive.numberField}}).directive("sephQuickLook",Sephora.ui.directive.quickLook).directive("sephEmailWhenInStock",Sephora.ui.directive.emailWhenInStock).directive("sephStars",Sephora.ui.directive.sephStars).directive("sephLoveCount",function(){return{link:function(scope,element,attrs){var SupportsLoves=Sephora.ui.controller.SupportsLoves,key=scope.productId,sessLoveCnt=Modernizr.sessionstorage?SupportsLoves.getLoveCnt(key):null,fromSession=undefined!==sessLoveCnt&&null!==sessLoveCnt?parseInt(sessLoveCnt):undefined;var allSkuIds=scope.allSkuIds(),loveCnt=!isNaN(fromSession)?fromSession:element.data("loves-num")||0,format=function(loveCnt){return loveCnt>9999?Math.floor(loveCnt/10000)+"0K":loveCnt};if(0===loveCnt&&Sephora.util.CookieUtils.isSignedInOrRecognizedUser()){allSkuIds.forEach(function(skuId,idx){Sephora.MyList.isOnMyList(skuId,function(isLoved){if(isLoved){loveCnt++}(idx===allSkuIds.length-1)&&scope.$apply(function(){scope.loveNumber=format(loveCnt);SupportsLoves.updateLoveCnt(key,loveCnt,true)})})})}else{scope.loveNumber=format(loveCnt);SupportsLoves.updateLoveCnt(key,loveCnt,true)}Sephora.event.resubscribe("itemLoved itemUnloved",function(_,skuId,loved){scope.$apply(function(){var r,oldCnt=SupportsLoves.getLoveCnt(key);r=(oldCnt!==undefined&&oldCnt!==null)?parseInt(oldCnt):loved?1:0;scope.loveNumber=format(r)})})}}}).filter("formatDuration",Sephora.ui.filter.formatDuration)})(jQuery);