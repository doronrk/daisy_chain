<html webdriver="true"><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
  </head>
  <body>  
    <div id="mf_pix_div"><img id="400_20" src="400_data/img.gif" height="0" width="0"><img id="400_46" src="400_data/366808.gif" height="0" width="0"><img id="400_33" src="400_data/seg.gif" height="0" width="0"><img id="400_48" src="400_data/event.gif" height="0" width="0"><img id="400_43" src="400_data/a.gif" height="0" width="0"><script src="400_data/c3metrics-673.js" type="text/javascript"></script></div>
    <script type="text/javascript">
      (function(doc) {
        createCookie = function(name, value, days) {
          if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            var expires = "; expires=" + date.toGMTString();
          }
          else var expires = "";
          document.cookie = name + "=" + value + expires + ";path=/;domain=.mediaforge.com;";
        }
        readCookie = function(cookie_name) {
          var ca = doc.cookie.split(';');
          var cookie_value = "";
          var max_merchant_keep = 10;
          for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(cookie_name) == 0) {
              cookie_value = c.substring(cookie_name.length + 1);
              break
            }
          }
          return cookie_value;
        }
        cleanCookies = function(cookie_name) {
          var ca = doc.cookie.split(';');
          var cookie_array = [];
          cookie_array = readCookie(cookie_name).split('|');
          var max_merchant_keep = 10;
          // go through each mid,value in the cookie_array
          var cookie_hash = {};
          for (var count = 0; count < cookie_array.length; count++) {
            // split the mid from the value
            var comma_idx = cookie_array[count].indexOf(',');
            if (comma_idx != -1) {
              var clean_value = cookie_array[count].replace(/,{2,}/g,',');
              if (clean_value.charAt(clean_value.length - 1) == ",") clean_value = clean_value.slice(0, -1);
              
              var mid = clean_value.substr(0, comma_idx);
              var value = clean_value.substr(comma_idx + 1);
              if (value.length > 0) {  
                if (mid in cookie_hash) {
                  // already have the mid in the hash table
                  var existing_array = cookie_hash[mid];
                  var found = false;
                  // go through the array and only add unique entries
                  for (var i = 0; i < existing_array.length; i++) {
                    if (existing_array[i] == value) existing_array.splice(i, 1);
                  }
                  existing_array[existing_array.length] = value;
                  cookie_hash[mid] = existing_array;
                }
                else {
                  // new hash entry for mid
                  var new_array = new Array;
                  new_array[0] = value;
                  cookie_hash[mid] = new_array;
                }
              }
            }
          }
          // push the merchant_id into the array if it doesn't exist and we are cleaning the pID
          var new_mid = '400';
          if (cookie_name == 'pID' && !(new_mid in cookie_hash)) {
            cookie_hash[new_mid] = '0';
          }
          // go through mid hash and create the cookie string on the last 10 value if applicable
          var new_value = '';
          for (var mid in cookie_hash) {
            var existing_array = cookie_hash[mid];
            var start_count = (existing_array.length > max_merchant_keep) ? existing_array.length - max_merchant_keep : 0;
            for (var array_count = start_count; array_count < existing_array.length; array_count++) {
              new_value += (new_value.length == 0) ? mid + ',' + existing_array[array_count] : '|' + mid + ',' + existing_array[array_count];
            }
          }
          
          createCookie(cookie_name, new_value, 365);
        }
        optOut = function() {
          var result = false;
          var nameEQ = "opt-out=";
          var ca = doc.cookie.split(';');
          for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) result = true;
          } 
          return result;
        }
        translateUID = function(uid) {
          var new_uid = "";
          for (var i = 0; i < uid.length; i++) {
            var uid_char = uid.charAt(i).charCodeAt();
            if ((uid_char < 48) || (uid_char > 122) || ((uid_char > 57) && (uid_char < 65)) || ((uid_char > 90) && (uid_char < 97))) {
              if (uid_char == 43) new_uid += "mfplusmf";
              if (uid_char == 61) new_uid += "mfequalmf";
              if (uid_char == 47) new_uid += "mfslashmf";
              if (uid_char == 45) new_uid += "mfhyphenmf";
            }
            else {
              new_uid += uid.charAt(i);
            }
          }
          return new_uid
        }
        processtags = function() {
          var DIV_ID = 'mf_pix_div';
          var content = '';
          var have_cart = false;
          var decoded_url = decodeURIComponent(location.search);
          var parameters = decoded_url.split('&');
          var mf_prod_id = "";
          var mf_cat_id = "";
          var mf_price = "";
          var mf_ordernumber = "";
          var mf_type = "visit";
          var mf_name = "landing";
          var mf_uID = translateUID(readCookie('uID'));
          var mf_lr_extra = "";
          if (location.search.indexOf('orderNumber') != -1) {
            mf_type = "purchase";
            mf_name = "main";
          }
          else if (location.search.indexOf('prodID') != -1) {
            mf_type = "user";
            mf_name = "product_view";
          }
          else {
            mf_type = "visit";
            mf_name = "landing";
          }
          var optional_qry_str = "";
          for (var param_index = 0; param_index < parameters.length; param_index++) {
            if (parameters[param_index].indexOf('affid') != -1) {
              var affid_split = parameters[param_index].split('=');
              if (affid_split.length == 2) mf_lr_extra = ":" + affid_split[1];
            }            
            if (parameters[param_index].indexOf('cart') != -1) {
              have_cart = true;          
              mf_price = parameters[param_index].split('=')[1];
              optional_qry_str = optional_qry_str + "&value[0]=" + mf_price;
            }
            if (parameters[param_index].indexOf('orderNumber') != -1) {
              var split_query = parameters[param_index].split('=');
              if (split_query.length == 2) mf_ordernumber = split_query[1];
            }
            if (parameters[param_index].indexOf('prodID') != -1) {
              var split_query = parameters[param_index].split('=');
              if (split_query.length == 2) mf_prod_id = split_query[1];
              var multi_prod_ids = mf_prod_id.split(',');
              if (multi_prod_ids.length > 0) {
                for (var prod_id_idx = 0; prod_id_idx < multi_prod_ids.length; prod_id_idx++) {
                  optional_qry_str = optional_qry_str + "&sku[" + prod_id_idx + "]=" + multi_prod_ids[prod_id_idx] + "&qty[" + prod_id_idx + "]=1";
                }
              }
            }
            if (parameters[param_index].indexOf('price') != -1) {
              var split_query = parameters[param_index].split('=');
              if (split_query.length == 2) mf_price = split_query[1];
            }
            if (parameters[param_index].indexOf('catID') != -1) {
              var split_query = parameters[param_index].split('=');
              if (split_query.length == 2) mf_cat_id = split_query[1];
            }
          }

          var bi_pool = false;
          if(mf_ordernumber == '' && mf_price == '') {
            if (location.search.indexOf('bi=vib') != -1) {
              var tags = {"400_20":"pixel.mathtag.com/event/img?mt_id=161332&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3="};
              bi_pool = true;
            }
            else if (location.search.indexOf('bi=bi') != -1) {
              var tags = {"400_20":"pixel.mathtag.com/event/img?mt_id=161333&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3="};
              bi_pool = true;
            }
            else if (location.search.indexOf('=rouge') != -1) {
              var tags = {"400_20":"pixel.mathtag.com/event/img?mt_id=367943&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3="};
              bi_pool = true;
            }
          }
          if(!bi_pool) {
            if (have_cart == true) {
              var tags = {
                
                  "400_48":"api.nanigans.com/event.php?app_id=38593&type=user&name=add_to_cart&user_id=" + mf_uID + "",
                
                  "400_20":"pixel.mathtag.com/event/img?mt_id=366480&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3="
                
              };
              for (var tag_id in tags) {
                if (tag_id == '400_48') { // nanigans
                  tags[tag_id] = tags[tag_id] + optional_qry_str;
                }
              }
            }
            else {
              var tags = {
                
                  
                    "400_20":"pixel.mathtag.com/event/img?mt_id=109661&amp;mt_adid=101666&amp;v1=&amp;v2=&amp;v3=&amp;s1=&amp;s2=&amp;s3=",
                  
                    "400_46":"idsync.rlcdn.com/366808.gif?partner_uid=" + mf_uID + mf_lr_extra + "",
                  
                    "400_33":"secure.adnxs.com/seg?add=755365&t=2",
                  
                    "400_48":"api.nanigans.com/event.php?app_id=38593&type=" + mf_type + "&name=" + mf_name + "&user_id=" + mf_uID + "&sku=" + mf_prod_id + "",
                  
                    "400_43":"a.amxdt.com/px/?id=16533"
                  
                
              };
            }
          }
          if (mf_cat_id.indexOf('eye') != -1) {
            content += "<img \" src=\"//" + "pixel.mathtag.com/event/img?mt_id=603527&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3=" + "\" height=\"0\" width=\"0\"/>";
          }
          if (decodeURIComponent(location.search).toLowerCase().indexOf("gift") != -1 && decodeURIComponent(location.search).toLowerCase().indexOf("card") != -1) {
            content += "<img \" src=\"//" + "pixel.mathtag.com/event/img?mt_id=517902&mt_adid=101666&v1=&v2=&v3=&s1=&s2=&s3=" + "\" height=\"0\" width=\"0\"/>";
          }
          for(var tag_id in tags) {
            content += "<img id=\"" + tag_id + "\" src=\"//" + tags[tag_id] + "\" height=\"0\" width=\"0\"/>";
          }
          document.getElementById(DIV_ID).innerHTML = content;
          var c3script = document.createElement('script');
          var c3src = "//673-ct.c3tag.com/c3metrics-673.js";
          if (location.search.indexOf("orderNumber") != -1) c3src = c3src + "?c3_transaction=" + mf_ordernumber + "&order_amount=" + mf_price;
          c3script.setAttribute('type', 'text/javascript');
          c3script.src = c3src;
          document.getElementById(DIV_ID).appendChild(c3script);
        }
        if (optOut() == false) {
          processtags();
          cleanCookies('pID');
          cleanCookies('cID');
        }
        else {
          createCookie('pID', '', -1);
          createCookie('cID', '', -1);
          createCookie('uID', '', -1);
        }
      })(document);
    </script>
  

</body></html>