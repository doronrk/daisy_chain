function resizeWindow(){if($("#cboxLoadedContent").find(".module_overlay").length>0){$.colorbox.resize();}}function handleSearchStoreAvailability(geoCoderClientEnabled){$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#errorMsgDiv").hide();$("#errorMsg").hide();if($("#cityStateZipCode").val()==""){$("#cityStateZipCode").addClass("input_txt input_error_txt");
$("#fieldErrorMsg").html("Please correct the errors listed in red below:");$("#errorMsg").html("Please enter city, state or ZIP code");$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();return;}else{var serachTermRegEx=/^[a-zA-Z0-9#'&\";{}?,.()\\-\\/+=_ \\xA9 \\u2122 \\u00AE \\*]*$/;var userSearchTerm=$("#cityStateZipCode").val();
if(!userSearchTerm.match(serachTermRegEx)){$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#fieldErrorMsg").html("Please correct the errors listed in red below:");$("#errorMsg").html("Please enter valid city, state or ZIP code");$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();
return;}}$("#storeResults>.pp_store_results_holder").html('<div class="store_net_result flt_wdt"><div class="avalability column_one flt_lft"><p><strong>availability</strong></p></div><div class="store column_two flt_lft"><p><strong>store</strong></p></div><div class="hours column_three flt_lft"><p><strong>hours</strong></p></div><div class="distance column_four flt_lft"><p><strong>distance</strong></p></div>');
$("ul.pagination").html("<li><strong>PAGE</strong></li>");$("#storeResults").hide();resizeWindow();showSpinner("blockedSectionDivCIS");var options={success:populateStoreResults,error:error};var address=$("#cityStateZipCode").val();if(geoCoderClientEnabled=="true"){googlegeolcation.allChannel.doGeocoder(address,function(){$("#checkInStores").ajaxSubmit(options);
},function(status){populateStoreError();});}else{$("#checkInStores").ajaxSubmit(options);}}function populateStoreError(){$("#fieldErrorMsg").html("");$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#errorMsg").html("We're sorry... we couldn't find any jcp stores that match your search.");
$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();hideSpinner();}var resultsPerPage=5;function populateStoreResults(responseText,statusText,xhr,$form){hideSpinner();if(responseText.errorExist=="false"){if(responseText.storeInventory.length){if(responseText.storeInventory.length==0){$("#fieldErrorMsg").html("");
$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#errorMsg").html("We're sorry... we couldn't find any jcp stores that match your search.");$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();return;}if(responseText.storeInventory.length>0){renderCoreMerticPageViewTag("Find Item In Store Results",catId,window.location.href,document.referrer);
resultsPerPage=responseText.resultsPerPage;$("#storeResults>.pp_store_results_holder").html($("#storeResults>.pp_store_results_holder").html()+'<span id="resultsPage1"></span>');pageToPopulate="resultsPage1";$("ul.pagination").html($("ul.pagination").html()+'<li onclick="pageSelect(this)"><strong style="padding: 2px 4px;">1</strong></li>');
try{jQuery.each(responseText.storeInventory,displayStoreInventory);}catch(e){handlejavaScriptError(e);}}}else{$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#fieldErrorMsg").html("");$("#errorMsg").html("We're sorry... we couldn't find any jcp stores that match your search.");
$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();}}else{$("#fieldErrorMsg").html("");$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#errorMsg").html("We're sorry... we couldn't find any jcp stores that match your search.");
$("#errorMsg").show();$("#errorMsgDiv").show();resizeWindow();return;}}var finalPageNumber="";function displayStoreInventory(index,eachObject){if(index>0&&(index)%resultsPerPage==0){var pageNumber=((index)/resultsPerPage+1);pageToPopulate="resultsPage"+pageNumber;finalPageNumber=pageNumber;$("#storeResults>.pp_store_results_holder").html($("#storeResults>.pp_store_results_holder").html()+'<span id="'+pageToPopulate+'" style="display:none"></span>');
$("ul.pagination").html($("ul.pagination").html()+'<li onclick="pageSelect(this)"><a href="javascript:void(\'findInStore:page:'+finalPageNumber+'\')" title="'+finalPageNumber+'">'+finalPageNumber+"</a></li>");}var timingsString='<div class="hours column_three flt_lft"><ul>';try{jQuery.each(eachObject.hours,function(timingIndex,eachTiming){timingsString=timingsString+"<li>"+eachTiming+"</li>";
});}catch(e){handlejavaScriptError(e);}timingsString=timingsString+"</ul></div>";var overrideText=eachObject.overrideText;if(overrideText!=""&&overrideText!=null){timingsString='<div class="hours column_three flt_lft"><ul><li>'+$("<div/>").html(overrideText).text()+"</li></ul></div>";}var startAddress=$("#cityStateZipCode").val();
var space=" ";var endAddress=eachObject.storeName+space+eachObject.city+space+eachObject.state+space+eachObject.zipCode;var availibility="not available";if(eachObject.availability!=""&&eachObject.availability=="IS"){availibility="in stock";}var directionsForm='<form action="http://maps.google.com/maps" method="get" target="_blank"><input type="hidden" name="saddr" value="'+startAddress+'"/><input type="hidden" name="daddr" value="'+endAddress+'" /><input type="submit" title="directions" value="DIRECTIONS" id="sign_in" name="sign in"></form>';
var storeString='<div class="store_net_result flt_wdt"><div class="avalability column_one flt_lft"><p>'+availibility+'</p></div><div class="store column_two flt_lft"><ul><li>'+eachObject.storeName+"</li><li>"+eachObject.street+"</li><li>"+eachObject.city+", "+eachObject.state+" "+eachObject.zipCode+"</li><li>phone: "+eachObject.storePhone+"</li></ul></div>"+timingsString+'<div class="distance column_four flt_lft"><ul><li>'+eachObject.distance+' miles</li></ul></div><div class="direction_btn flt_rgt"><div class="btn_input_holder blue_button_small"><span>'+directionsForm+"</span></div></div></div>";
$("#"+pageToPopulate).html($("#"+pageToPopulate).html()+storeString);$("#storeResults").show();$("#storeResults").addClass("pp_store_results_modal");resizeWindow();}function pageSelect(pageLink){try{if($(pageLink).children("a").length>0){var pageNumber=$(pageLink).children("a").attr("title");$("ul.pagination > li > strong").each(function(){var selectedPageNumber=$(this).html();
if(selectedPageNumber!="PAGE"){var newHtml="<a href=\"javascript:void('findInStore:page:"+selectedPageNumber+'\')" title="'+selectedPageNumber+'">'+selectedPageNumber+"</a>";$(this).parent().html(newHtml);}else{}});$("ul.pagination > li > a").each(function(){var selectedPageNumber=$(this).html();if(pageNumber==selectedPageNumber){var newHtml='<strong style="padding: 2px 4px;">'+selectedPageNumber+"</strong>";
$(this).parent().html(newHtml);}});var pageToShow="resultsPage"+pageNumber;$("#storeResults span").each(function(){if(this.id==""||this.id==pageToShow){$(this).show();}else{$(this).hide();}});}}catch(e){handlejavaScriptError(e);}resizeWindow();}function error(responseText,statusText,xhr,$form){$("#fieldErrorMsg").html("");
$("#cityStateZipCode").removeClass("input_length_txt input_error_txt");$("#cityStateZipCode").addClass("input_txt input_error_txt");$("#errorMsg").html("We're sorry... we couldn't find any jcp stores that match your search.");$("#errorMsg").show();$("#errorMsgDiv").show();hideSpinner();resizeWindow();
return;}function disableEnterKey(e,geoCoderClientEnabled){var key;if(window.event){key=window.event.keyCode;}else{key=e.which;}if(key!=13){return true;}else{handleSearchStoreAvailability(geoCoderClientEnabled);return false;}}function handleSearchStoreAvailabilityDefault(){$("#storeResults>.pp_store_results_holder").html('<div class="store_net_result flt_wdt"><div class="avalability column_one flt_lft"><p><strong>availability</strong></p></div><div class="store column_two flt_lft"><p><strong>store</strong></p></div><div class="hours column_three flt_lft"><p><strong>hours</strong></p></div><div class="distance column_four flt_lft"><p><strong>distance</strong></p></div>');
$("ul.pagination").html("<li><strong>PAGE</strong></li>");$("#storeResults").hide();resizeWindow();$("#blockedSectionDiv").prepend('<div id="page_loader" class="flt_wdt"></div>');var loadImage=$("#page_loader");var spinner=loadImage.show(function(){loadImage.addClass("mask");$(".mask").css({"opacity":0.6});
});var options={success:populateStoreResults,error:error};$("#checkInStoresDefault").ajaxSubmit(options);}