(function(d){var a=function(f,g,h){if(f!=null&&g!=null&&f.attributes!=null&&f.attributes[g]!=null){return f.attributes[g][0]}return(typeof(h)==="undefined"?null:h)};var e=function(){var f=window.location.pathname;var g=null;if(f.endsWith("search")){g=f.split("/search")[0]}else{if(f.endsWith("browse")){g=f.split("/browse")[0]}else{if(f.endsWith("browse/")){g=f.split("browse/")[0]}else{if(f.endsWith("search/")){g=f.split("search/")[0]}else{g=f}}}}return g};String.prototype.endsWith=function(f){var g=this.length-f.length;return g>=0&&this.lastIndexOf(f)===g};var c=0;d("#atg_store_searchInput").live("keypress",function(g){var f=(g.keyCode?g.keyCode:g.which);if((f!=37)&&(f!=38)&&(f!=39)&&(f!=40)&&(f!=13)){d(".dimSearchSuggContainer").html("")}});d(document).keypress(function(f){});d(".quick_order_search").find(".dimResult a").live("click",function(){var f=d(this).find(".ProductDetails").text();d(quicksearchlocation).val(f);d(".quick_order_search").hide()});d.EndecaSearchSuggestor=function(h,g){this._active=true;this._options=g;this._lastValue="";this._element=h;this._container=d('<div class="'+this._options.containerClass+'"></>');this._timeOutId;this._hideTimeOutId;this._selectedIndex=-1;var f=this;d("body").append(this._container);h.keydown(function(i){console.log("e.keyCode:"+i.keyCode);switch(i.keyCode){case 38:if(f._active){f.moveToPrev()}else{f.show()}break;case 40:if(f._active){f.moveToNext();i.preventDefault();scrollToNew()}else{f.show()}break;case 9:f.hide();break;case 13:if(f._active&&f._selectedIndex!=-1){i.preventDefault();f.selectItem();return false}b(i);break;case 27:if(f._active){f.hide()}break;default:console.log("handleRequest");f.handleRequest()}});h.blur(function(i){var j=function(){f.hide()};f._hideTimeOutId=setTimeout(j,200)})};function b(g){g.preventDefault();var f=d("input#searchText").val().replace(/[</>>&%]/g,"");var h=d("#applicationPath").val()+"/search/?Dy=1&Nty=1&Ntp=1&Ntt="+f;d.post(d("#applicationPath").val()+"/cartridges/SearchBox/includes/resultRedirection.jsp?Dy=1&Ntp=1&Nty=1&Ntt="+f,{searchTerm:f},function(i){h=d("#applicationPath").val()+i.processedURI;window.location=h})}d.EndecaSearchSuggestor.prototype.moveToPrev=function(){if(this._selectedIndex==-1){this._selectedIndex=0}else{if(this._selectedIndex==0){return}this._selectedIndex--}d(".dimResult").removeClass("selected");d(d(".dimResult").get(this._selectedIndex)).addClass("selected");if(this._selectedIndex<=4){d(".dimSearchSuggContainer").scrollTop(d(".dimSearchSuggContainer").scrollTop()-60)}};d.EndecaSearchSuggestor.prototype.moveToNext=function(){if(this._selectedIndex==-1){this._selectedIndex=0}else{if(this._selectedIndex==d(".dimResult").size()-1){return}this._selectedIndex++}d(".dimResult").removeClass("selected");d(d(".dimResult").get(this._selectedIndex)).addClass("selected");if(this._selectedIndex>=5){d(".dimSearchSuggContainer").scrollTop(d(".dimSearchSuggContainer").scrollTop()+60)}};d.EndecaSearchSuggestor.prototype.selectItem=function(){if(this._selectedIndex==-1){return}var f=d("a",d(".dimResult").get(this._selectedIndex)).attr("href");document.location.href=f};d.EndecaSearchSuggestor.prototype.hide=function(){this._container.hide();this._active=false};d.EndecaSearchSuggestor.prototype.show=function(){if(this._container.is(":hidden")){this.setPosition();this._container.show();this._active=true;this._selectedIndex=-1}};d.EndecaSearchSuggestor.prototype.handleRequest=function(){var f=this;var g=function(){var h=d.trim(f._element.val());d("#dim_serch_cont").html("");d("#dim_serch_cont").hide();if(h!=f._lastValue){if(h.length>=f._options.minAutoSuggestInputLength){console.log("requestData");f.requestData()}else{f.hide();d("#dim_serch_cont").html("")}}f._lastValue=h};if(this._timeOutId){clearTimeout(this._timeOutId)}this._timeOutId=setTimeout(g,this._options.delay)};d.EndecaSearchSuggestor.prototype.requestData=function(){d("#dim_serch_cont").html("");var g=this;var f=d.ajax({url:g.composeUrl(),dataType:"json",async:true,success:function(h){console.log("data:"+h);d("#dim_serch_cont").html("");g.showSearchResult(h)}})};d.EndecaSearchSuggestor.prototype.composeUrl=function(){var g=this._options.autoSuggestServiceUrl;var f=d.trim(this._element.val());if(g.indexOf("?")==-1){g+="?"}else{g+="&"}g+="Dy=1&collection="+this._options.collection+"&Ntk=product.displayName&Ntt="+f+"*";return g};d.EndecaSearchSuggestor.prototype.showSearchResult=function(g){var f=this.processSearchResult(g);console.log("htmlResult:"+f);if(f!=null){d("#dim_serch_cont").show()}else{this.hide()}};d.EndecaSearchSuggestor.prototype.processSearchResult=function(m){var n=null;var k=null;jQuery.each(m,function(j,r){console.log("name: "+j+",value: "+r)});var h=m.contents[0].autoSuggest;if(h==null||h.length==0){return null}for(var l=0;l<h.length;l++){var f=h[l];if(f["@type"]=="DimensionSearchAutoSuggestItem"){n=f;if(n!=null){d("#dim_serch_cont").append(this.generateHtmlContent(n))}}if(f["@type"]=="RecordSearchAutoSuggestItem"){var q=null;var p=this;var g=null;var i=e();k=f;if(k!=null&&k.records!=null&&k.records.length>0){var o=f["@type"];g=d("<div/>").addClass(o);if(k.title){}d.each(k.records,function(w,u){var C=k.records.length;if(k.records.length>k.defaultRecsPerPage){C=k.defaultRecsPerPage}if(w<C){if(i.endsWith("/")){q=u.detailsAction.contentPath.split("/")[1]}else{q=u.detailsAction.contentPath}var t=i+q+u.detailsAction.recordState;var s=d("<a class='AutoSuggestRecord clearfix'/>").attr("href",t).appendTo(g);if(typeof(p._options.select)==="function"){s.click(function(E){E.preventDefault();p._options.select.call(p,p._element,u)})}var B=d("<div class='AutoSuggestRecordInfo'/>").appendTo(s);var A=a(u,"product.displayName","");var z=a(u,"product.repositoryId","");var x=a(u,"product.CategoryId","");B.append(d("<div class='ProductName'/>").html(a(u,"product.displayName","")));var v=a(u,"product.productCode","");d("<div class='ProductDetails'/>").text(v).appendTo(B);var r=A.replace("&","+");var y=d("#applicationPath").val()+"/search/?Dy=1&Nty=1&Ntp=1&Ntt="+r;r=r.replace("'","");var D=("<a href=\"javascript:submitAutoSuggest('"+escape(r)+"')\">"+A+"</a>");var j=d("#dim_serch_cont").attr("id");d("#dim_serch_cont").append(D);d("#dim_serch_cont").show()}})}}}if(n!=null){return this.generateHtmlContent(n)}return null};d.EndecaSearchSuggestor.prototype.generateHtmlContent=function(p){var q=null;if(p!=null&&p.dimensionSearchGroups.length>0){q=d("<p></p>");if(p.title&&d.trim(p.title)!=""){}var o=p.dimensionSearchGroups;for(var k=0;k<o.length;k++){var r=o[k];var s=r.displayName;for(var h=0;h<r.dimensionSearchValues.length;h++){var t=r.dimensionSearchValues[h];var g=t.navigationState;if(t.label!="Commerce Root"){var v=t.label}var w=t.ancestors;var m="";if(w!=null&&w.length>0){for(var f=w.length-1;f>0;f--){if(f>1){m+=w[f].label+" In "}else{m+=w[f].label}}}if(p.displayImage){var u="";var l=t.count==null?"":"&nbsp;("+t.count+")";if(d.trim(t.properties.img_url_thumbnail)!=""){u=t.properties.img_url_thumbnail}else{u=this._options.defaultImage}if(w.length>1){q.append('<a href="'+this._options.searchUrl+g+'">'+this.highlightMatched(v)+" In "+m+"</a>"+l)}else{q.append('<a href="'+this._options.searchUrl+g+'">'+this.highlightMatched(v)+m+"</a>"+l)}}else{if(w.length>1){q.append('<a href="'+this._options.searchUrl+g+'">'+this.highlightMatched(v)+" In "+m+"</a>"+l)}else{q.append('<a href="'+this._options.searchUrl+g+'">'+this.highlightMatched(v)+m+"</a>"+l)}}}}}if(q!=null){return q[0]}return null};d.EndecaSearchSuggestor.prototype.highlightMatched=function(k){var j=d.trim(this._element.val()).toLowerCase();var g=k.toLowerCase();if(g.indexOf(j)!=-1){var f=g.indexOf(j);var h=k.substring(0,f);var i=k.substring(f+j.length);j=k.substr(f,j.length);g=h+"<span>"+j+"</span>"+i}return g};d.EndecaSearchSuggestor.prototype.bindEventHandler=function(){var f=this;d(".dimResult",this._container).mouseover(function(g){d(".dimResult",f._container).removeClass("selected");d(this).addClass("selected");f._selectedIndex=d(".dimResult",f._container).index(d(this))});d(".dimResult",this._container).click(function(g){f.selectItem()});d("a",d(".dimResult",this._container)).click(function(g){g.preventDefault();f.selectItem()});d(".dimRoots",this._container).click(function(){clearTimeout(f._hideTimeOutId);f._element.focus()})};d.EndecaSearchSuggestor.prototype.setPosition=function(){var f=this._element.offset();this._container.css({top:f.top+this._element.outerHeight(),left:f.left,width:this._element.width()})};d.fn.endecaSearchSuggest=function(f){var g=d.extend({},d.fn.endecaSearchSuggest.defaults,f);this.each(function(){var h=d(this);new d.EndecaSearchSuggestor(h,g)})};d.fn.endecaSearchSuggest.defaults={minAutoSuggestInputLength:3,displayImage:false,delay:250,autoSuggestServiceUrl:"",collection:"",searchUrl:"",containerClass:"dimSearchSuggContainer",defaultImage:"no_image.gif"};d("#searchText").endecaSearchSuggest({minAutoSuggestInputLength:3,collection:"/content/NYCO/SearchSuggestion",autoSuggestServiceUrl:"/nyco/global/typeAhead.jsp",searchUrl:"/nyco",containerClass:"dimSearchSuggContainer",defaultImage:'<c:url value="/images/no_image_auto_suggest.gif"/>'})})(jQuery);