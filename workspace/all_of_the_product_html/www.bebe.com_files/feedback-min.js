try{(function(){var JSON={};(function(){function f(n){return n<10?"0"+n:n}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function stringifyDate(key){return isFinite(key.valueOf())?key.getUTCFullYear()+"-"+f(key.getUTCMonth()+1)+"-"+f(key.getUTCDate())+"T"+f(key.getUTCHours())+":"+f(key.getUTCMinutes())+":"+f(key.getUTCSeconds())+"Z":null}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=stringifyDate(value)}else{if((value instanceof String)||(value instanceof Number)||(value instanceof Boolean)){value=value.valueOf()}}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var q={};q.html={};q.html.cookie={};q.html.cookie={};q.html.cookie.maxCookieLength=3000;q.html.cookie.token="_x_c_";q.html.cookie.separator="_";q.html.cookie.readCookie=function(name,id){var r,cookie,value,cookies,nameSearchString,i,ii,tokenLoc;nameSearchString=name+(id?q.html.cookie.separator+id:"")+"=";cookies=document.cookie.split(";");r=/^\s+|\s+$/g;for(i=0,ii=cookies.length;i<ii;i+=1){cookie=cookies[i].replace(r,"");if(cookie.indexOf(nameSearchString)===0){value=unescape(cookie.substring(nameSearchString.length));if(value.length===0){return null}tokenLoc=value.indexOf(q.html.cookie.token);if(tokenLoc>=0){value=value.substring(0,tokenLoc);value+=q.html.cookie.readExtraValues(name,id,cookies,r)}return value}}return null};q.html.cookie.readExtraValues=function(name,id,cookies,r){var i,ii,c,toks,tokenLoc,nextId,v,value;c={};for(i=0,ii=cookies.length;i<ii;i+=1){toks=cookies[i].split("=");c[toks[0].replace(r,"")]=unescape(toks[1])}nextId=id?id+1:1;value="";while(true){v=c[name+q.html.cookie.separator+nextId];if(v){tokenLoc=v.indexOf(q.html.cookie.token);if(tokenLoc===-1){value+=v;break}else{value+=v.substring(0,tokenLoc)}}else{break}nextId+=1}return value};q.html.cookie.writeCookie=function(name,value,days,domain,id){var date,expires,cookie,realName,cookieLength,nextId;if(value.length>=q.html.cookie.maxCookieLength*50){throw"value to big to store"}if(days){date=new Date();date.setTime(date.getTime()+(days*86400000));expires="; expires="+date.toGMTString()}else{expires=""}realName=name+(id?(q.html.cookie.separator+id):"");cookie=escape(realName)+"="+escape(value)+expires+"; path=/;";if(domain){cookie+=" domain="+domain}if(!id){nextId=1}else{nextId=id+1}if(cookie.length>q.html.cookie.maxCookieLength){cookieLength=q.html.cookie.maxCookieLength-q.html.cookie.token.length-(escape(realName)+"="+expires+"; path=/;").length;cookieLength=q.html.cookie.getEscapeSafeLength(value,cookieLength);cookie=escape(realName)+"="+escape(value).substring(0,cookieLength)+q.html.cookie.token+expires+"; path=/;";q.html.cookie.writeCookie(name,unescape(escape(value).substring(cookieLength)),days,domain,nextId)}else{while(q.html.cookie.readCookie(name,nextId)){q.html.cookie.writeCookie(name,"",days,domain,nextId);nextId+=1}}document.cookie=cookie};q.html.cookie.getEscapeSafeLength=function(str,length){var bad=true,escaped,times=0;while(bad&&(times<10)){escaped=escape(str);bad=(unescape(escaped.substring(0,length))+unescape(escaped.substring(length)))!==str;if(bad){length-=1}times+=1}return length};q.html.cookie.canWriteCookie=function(persistent,domain,cookieName){var _cookieName,canWrite;_cookieName=cookieName||("cw_test_"+Math.round(Math.random()*1000));q.html.cookie.writeCookie(_cookieName,"a",persistent?1:null,domain);canWrite="a"===q.html.cookie.readCookie(_cookieName);if(canWrite){q.html.cookie.writeCookie(_cookieName,"a",-1,domain)}return canWrite};q.cookie={};q.cookie.SessionCounter={};q.cookie.SessionCounter._cookieName="_qst";q.cookie.SessionCounter._sessionCookie="_qsst";q.cookie.SessionCounter._gaCookie="__utma";q.cookie.SessionCounter.update=function(domain){var c,s,ga,mins=30;c=q.html.cookie.readCookie(q.cookie.SessionCounter._cookieName);s=q.html.cookie.readCookie(q.cookie.SessionCounter._sessionCookie);ga=q.cookie.readGaSessionCount();if(!c){c=[1,ga]}else{c=JSON.parse(c);if(typeof c==="string"){c=JSON.parse(c)}if(!s||(parseInt(s,10)<(new Date().getTime()-mins*60*1000))){c[0]+=1}}c=JSON.stringify(c);q.html.cookie.writeCookie(q.cookie.SessionCounter._cookieName,c,365,domain);q.html.cookie.writeCookie(q.cookie.SessionCounter._sessionCookie,new Date().getTime().toString(),null,domain);return c};q.cookie.readGaSessionCount=function(){var ga=q.html.cookie.readCookie(q.cookie.SessionCounter._gaCookie);if(ga){try{ga=ga.split(".");if(ga[5]){ga=parseInt(ga[5],10)}else{ga=0}}catch(e){ga=0}}else{ga=0}return ga};q.cookie.PageView={};q.cookie.PageView.update=function(){var a,r;r=function _(){return(Math.floor(1+Math.random()*65536)).toString(36).substring(1)};if(!window.__pageViewId__){a=new Date().getTime().toString(36);window.__pageViewId__=a+r()+r()+r()}return window.__pageViewId__};q.html.fileLoader={};q.html.fileLoader.load=function(url,preLoadAction,postLoadHandler,parentNode,async,attributes){var scriptEl,preLoadResult,loadError,doPostLoad,loaded;loaded=false;doPostLoad=function(loadFailed){return function(){if(!loaded){loaded=true;if(loadFailed&&!loadError){loadError={url:document.location.href}}postLoadHandler(url,loadError,loadFailed)}}};try{if(preLoadAction){preLoadResult=preLoadAction(url)}}catch(e){preLoadResult=false;postLoadHandler(url,"Exception loading pre",true)}finally{if(preLoadResult!==false){scriptEl=q.html.fileLoader.createScriptEl(url,async,false,attributes);if(postLoadHandler){scriptEl.onload=doPostLoad(false);scriptEl.onerror=doPostLoad(true);scriptEl.onreadystatechange=function(){if((this.readyState==="complete")||(this.readyState==="loaded")){setTimeout(function(){doPostLoad(false)()},1)}}}if(!parentNode){parentNode=window.document.getElementsByTagName("head")[0]}parentNode.appendChild(scriptEl)}}};q.html.fileLoader.createScriptEl=function(path,async,forceReload,attr){var a,scriptEl=document.createElement("script");scriptEl.type="text/javascript";scriptEl.src=q.html.fileLoader.tidyUrl(path)+(forceReload?("?"+new Date().getTime()):"");if(async!==false){scriptEl.async="true";scriptEl.defer="true"}else{scriptEl.async="false";if(scriptEl.async!==false){scriptEl.async=false}scriptEl.defer="false"}for(a in attr){if(attr.hasOwnProperty(a)){scriptEl.setAttribute(a,attr[a])}}return scriptEl};q.html.fileLoader.tidyUrl=function(path){if(path.substring(0,5)==="http:"){return path}if(path.substring(0,6)==="https:"){return path}return"//"+path};q.html.PostData=function(url,data,type){var _post,agent,isIe,isIe9,isOldIe,fullUrl,loaded,retry,retryDelay,retryCount;retryCount=5;retryDelay=2000;loaded=false;retry=function(){if(retryCount>0){setTimeout(function(){if(!loaded){retryCount-=1;_post()}},retryDelay)}};agent=navigator.userAgent.toLowerCase();isIe=agent.indexOf("msie")!==-1;isIe9=agent.indexOf("msie 9")!==-1;isOldIe=((agent.indexOf("msie 7")!==-1)||(agent.indexOf("msie 6")!==-1));fullUrl=("https:"===document.location.protocol?"https:":"http:")+url;type=type||"POST";_post=function(){var xhr;try{xhr=null;try{xhr=new XMLHttpRequest()}catch(e1){}if(xhr&&!isIe){xhr.open(type,fullUrl,true)}else{if(typeof XDomainRequest!=="undefined"){xhr=new XDomainRequest();xhr.open(type,fullUrl)}else{xhr=null}}try{xhr.withCredentials=false}catch(e2){}if(xhr.setRequestHeader){xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}xhr.onload=function(){loaded=true};xhr.onreadystatechange=function(){};xhr.ontimeout=function(){};xhr.onerror=function(){};xhr.onprogress=function(){};xhr.send(data)}catch(err){try{try{q.html.fileLoader.load(fullUrl)}catch(err2){if(window.console&&window.console.log){window.console.log(err)}}}catch(e){}}retry()};if(isOldIe){q.html.fileLoader.load(fullUrl);return}else{_post()}};function extend(target,src){var key;for(key in src){if(src.hasOwnProperty(key)){target[key]=src[key]}}return target}var fb=function(){var f;f={cookieName:"qbef",trackerCookie:"qbeft",referrerCookie:"qbefr",closeCountName:"cc",submitCountName:"sc",reason:{mouseMoved:1,debug:2,explicit:3},defaultConfig:{trackingId:"",clientId:0,profileId:0,configId:1,debugMode:false,topHeight:150,moveQueueDepth:2,moveDelay:500,moveVel:500,leftGap:10,attachTime:20*1000,returnTime:1000,eventInterval:100,showProb:0.9,journeyDepth:0,closeCountDays:365,submitCountDays:30,hideFilter:"",showFilter:"",domain:"",pongUrl:"//pong.qubitproducts.com",statsPath:"/s",feedbackPath:"/f",overlay:{color:"#000",opacity:0.5,closes:true,fadeInDuration:500},images:["https://s3-eu-west-1.amazonaws.com/opentag-images/sp_grey.png"],container:{width:484,height:340,"z-index":16777269,contentClass:"content",template:" <div id='main'><a href='#' class='close'></a><div class='content'></div></div><div id='bottom'></div>",data:{},on:{"click .close":function(api,event){api=api.v1;event.preventDefault();api.hideFeedback()}}},firstPage:"getFeedback",pages:{getFeedback:{template:" <h1>{{title}}</h1><p>{{message}}</p><textarea tabindex='1' class='text'>{{placeholder}}</textarea><a tabindex='2' href='#' class='send'>Submit</a>",on:{load:function(api,event){var text,placeholder;api=api.v1;text=api.getBoxBody().find(".text");placeholder=text.val();text.on("focus",function(){if(text.val()===placeholder){text.val("")}}).on("blur",function(){if(text.val()===""){text.val(placeholder)}}).on("keyup",function(){if(text.val()===""||text.val()===placeholder){api.getBoxBody().removeClass("enabled")}else{api.getBoxBody().addClass("enabled")}})},"click .send":function(api,event){event.preventDefault();api=api.v1;if(api.getBoxBody().hasClass("enabled")){var text=api.getBoxBody().find(".text").val();api.nextPage();api.sendFeedback(text)}}},data:{title:"Help us improve",message:"We value your opinion. <br />What do you like about our site and what can we improve on?",placeholder:"Click here to type..."},nextPage:"thankYou"},thankYou:{template:" <h1>{{title}}</h1><p>{{message}}</p>",data:{title:"Thank You!",message:"We really appreciate your feedback."}}},cssBase:" body, html {background: transparent;margin: 0;padding: 0;font-family: Helvetica, Arial, sans-serif;}#main {background: url('https://s3-eu-west-1.amazonaws.com/opentag-images/sp_grey.png') no-repeat top left;font-size: 12px;line-height: 150%;padding: 38px 54px 0px 19px;}#bottom {background: url('https://s3-eu-west-1.amazonaws.com/opentag-images/sp_grey.png') no-repeat bottom left;height: 34px;}.content {height: 222px;padding: 10px;}h1 {font-size: 19px;font-weight: lighter;padding: 0;margin: 0 0 10px 0}p {font-size: 12px;font-weight: lighter;padding: 0margin: 10px 0}textarea {font-family: Helvetica, Arial, sans-serif;font-size: 12px;height: 100px;width: 391px;padding: 6px;-moz-border-radius: 5px;-webkit-border-radius: 5px;border-radius: 5px;border: 1px solid #CCC;color: #888}.enabled textarea {color: #000}.send {display: block;padding: 5px 10px 5px;color: #BBB;cursor: pointer;text-decoration: none;line-height: 1;-moz-border-radius: 3px;-webkit-border-radius: 3px;-moz-box-shadow: 0 1px 3px #999;-webkit-box-shadow: 0 1px 3px #999;box-shadow: 0 1px 3px #999;border: 1px solid #CCC;position: relative;font-size: 14px;font-weight: lighter;text-transform: uppercase;text-align: center;margin-left: 315px;margin-top: 15px;background: #f7f7f7;background: -moz-linear-gradient(top, #f7f7f7 0%, #cccccc 100%);background: -webkit-gradient(linear, left top, left bottom,color-stop(0%,#f7f7f7), color-stop(100%,#cccccc));background: -webkit-linear-gradient(top, #f7f7f7 0%,#cccccc 100%);background: -o-linear-gradient(top, #f7f7f7 0%,#cccccc 100%);background: -ms-linear-gradient(top, #f7f7f7 0%,#cccccc 100%);background: linear-gradient(top, #f7f7f7 0%,#cccccc 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#f7f7f7', endColorstr='#cccccc',GradientType=0 );}.enabled .send {color: #333;cursor: pointer;}.enabled .send:hover {border: 1px solid #BBB;background: #f2f2f2;background: -moz-linear-gradient(top, #f2f2f2 0%, #bbbbbb 100%);background: -webkit-gradient(linear, left top, left bottom,color-stop(0%,#f2f2f2), color-stop(100%,#bbbbbb));background: -webkit-linear-gradient(top, #f2f2f2 0%,#bbbbbb 100%);background: -o-linear-gradient(top, #f2f2f2 0%,#bbbbbb 100%);background: -ms-linear-gradient(top, #f2f2f2 0%,#bbbbbb 100%);background: linear-gradient(top, #f2f2f2 0%,#bbbbbb 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#f2f2f2', endColorstr='#bbbbbb',GradientType=0 );}.close {display: block;position: absolute;width: 40px;height: 40px;top: 16px;left: 416px;background: white;opacity: 0;filter: alpha(opacity=0);}.content.thankYou {text-align:center;}.content.thankYou h1 {margin-top: 40px;}",cssExtra:""},start:function(){var canInitCookies,debugging;if(f.isBadBrowser(navigator.userAgent,window)){return}if(window.self!==window.top){if(!window.fb_testing){return}}f.startTime=new Date().getTime();f.setConfig();f.initVars();canInitCookies=f.initCookies();debugging=f.shouldShowDebugUi()||f.opts.debugMode;if(!canInitCookies&&debugging){console.log("cannot init cookies")}if(canInitCookies||debugging){f.track();if(f.shouldShow()||f.shouldShowDebugUi()){f.waitTillReady()}}},isBadBrowser:function(agent,winObj){return(agent.indexOf("iPad")>=0)||(agent.indexOf("iPhone")>=0)||(agent.indexOf("android")>=0)||(agent.indexOf("Android")>=0)||(agent.indexOf("Mobile")>=0)||(agent.indexOf("mobile")>=0)||(agent.indexOf("MSIE 6")>=0)||(!winObj.sessionStorage)},waitTillReady:function(){if(document.body&&document.getElementById){f.onReady()}else{setTimeout(f.waitTillReady,100)}},onReady:function(){if(f.shouldShowDebugUi()){f.preloadResources();f.showFeedback(f.reason.debug)}else{if(f.opts.attachTime){setTimeout(f.attachEvents,f.opts.attachTime)}else{f.attachEvents()}}},shouldShowDebugUi:function(){return document.location.search.indexOf("qDebug=qBoxShow")>=0},setConfig:function(){var x,config=window.q_fb_opts||{};f.opts={};for(x in f.defaultConfig){if(f.defaultConfig.hasOwnProperty(x)){f.opts[x]=f.defaultConfig[x]}}f.deepMerge(f.opts,config)},deepMerge:function(target,source){var key,original,next;for(key in source){if(source.hasOwnProperty(key)){original=target[key];next=source[key];if(original&&next&&typeof next==="object"){f.deepMerge(original,next)}else{target[key]=next}}}},setDefault:function(key,value){if(f.opts[key]===undefined){f.opts[key]=value}},initVars:function(){f.lastMoves=[]},track:function(){q.cookie.SessionCounter.update(f.opts.domain);f.trackJourney()},getVisitorId:function(cb){var id=q.html.cookie.readCookie("_qubitTracker");if(id){cb(id)}else{setTimeout(function(){f.getVisitorId(cb)},2000)}},trackJourney:function(){var currentValue,time,pvId,referrer;time=new Date().getTime();pvId=encodeURIComponent(q.cookie.PageView.update());f.storeTrackingCookie(time,pvId,f.trackerCookie,document.location.href);referrer=f.getReferrer();if(referrer){f.storeTrackingCookie(time,pvId,f.referrerCookie,referrer)}},getReferrer:function(){var start,end;start=document.referrer.indexOf("://");if(start===-1){return document.referrer}start+=3;try{if(document.referrer.substring(start).indexOf(document.location.host)!==0){return document.referrer}return null}catch(ex){return document.referrer}},storeTrackingCookie:function(time,pvId,cookieName,value){var currentValue=f.getTrackingCookie(cookieName);if(typeof currentValue==="string"){currentValue=JSON.parse(currentValue)}currentValue.push({url:encodeURIComponent(value),time:time,pv_id:pvId});f.saveTrackingValue(cookieName,currentValue,f.opts.domain)},getTrackingCookie:function(cookieName){var currentValue;try{currentValue=JSON.parse(window.sessionStorage.getItem(cookieName))}catch(e){currentValue=[]}if(!currentValue){currentValue=[]}return currentValue},saveTrackingValue:function(key,value,domain){window.sessionStorage.setItem(key,JSON.stringify(value))},shouldShow:function(){var show,hide,url;url=f.getUrl();show=!f.opts.showFilter||new RegExp(f.opts.showFilter).test(url);hide=f.opts.hideFilter&&new RegExp(f.opts.hideFilter).test(url);return show&&!hide&&f.checkDepth()},getUrl:function(){return document.location.href},checkDepth:function(){return !f.opts.journeyDepth||(f.getTrackingCookie(f.trackerCookie).length>=f.opts.journeyDepth)},attachEvents:function(){if(f.opts.debugMode&&window.console){console.log("Listening to mouse")}var field=document;f.attachMouseMove(field);f.attachMouseOut(field);f.detectField=field;f.preloadResources()},createListenField:function(){var x=document.createElement("div");x.style.width="100%";x.style.height=f.opts.topHeight+"px";x.style.top="0";x.style.left="0";x.style.position="fixed";x.style.marginLeft=f.opts.leftGap+"px";if(window.fb_testing){x.style.backgroundColor="green";x.style.opacity="0.2"}document.body.appendChild(x);return x},attachMouseMove:function(field){if(field.attachEvent){field.attachEvent("onmousemove",f.onMouseMove)}else{if(field.addEventListener){field.addEventListener("mousemove",f.onMouseMove,false)}}},onMouseMove:function(e){f.lastMoves.push({t:e.debug_time||new Date().getTime(),x:e.clientX,y:e.clientY});while(f.lastMoves.length>f.opts.moveQueueDepth){f.lastMoves.shift()}if(f.returnTimeout){clearTimeout(f.returnTimeout);delete f.returnTimeout}if(e.clientY>f.opts.topHeight){f.removeEvent(f.detectField,"mousemove",f.onMouseMove);setTimeout(function(){f.attachMouseMove(document)},f.opts.eventInterval)}},attachMouseOut:function(field){if(field.attachEvent){field.attachEvent("onmouseout",f.onMouseOut)}else{if(field.addEventListener){field.addEventListener("mouseout",f.onMouseOut,true)}}},onMouseOut:function(e){if(f.returnTimeout){return}var x,y,t,m_l,m_p,vel,now=new Date().getTime();m_l=f.lastMoves[1];m_p=f.lastMoves[0];if(f.opts.debugMode&&window.console){console.log(m_l,m_p)}if(m_l&&m_p&&(m_l.t>=(now-f.opts.moveDelay))&&(m_p.y<=f.opts.topHeight)){x=m_l.x-m_p.x;y=m_l.y-m_p.y;t=m_l.t-m_p.t;vel=Math.sqrt(x*x+y*y)/t*1000;if(f.opts.debugMode&&window.console){console.log("vel: ",vel," ",x," ",y," ",t);console.log("lim: ",f.opts.moveVel)}if(vel>=f.opts.moveVel){if(f.opts.returnTime){f.returnTimeout=setTimeout(f.tryShowFeedback,f.opts.returnTime);f.removeEvent(f.detectField,"mousemove",f.onMouseMove);setTimeout(function(){f.attachMouseMove(f.detectField)},50)}else{f.tryShowFeedback()}}}},preloadResources:function(){if(!this.preloadResourcesCalled){f.loadjQuery(function(jQuery){f.$=jQuery;if(f.showFeedbackPending){f.doShowFeedback()}});f.preloadImages();this.preloadResourcesCalled=true}},tryShowFeedback:function(){f.removeEvents();if(Math.random()<f.opts.showProb){f.showFeedback(f.reason.mouseMoved)}else{f.incrementCloseCount()}},removeEvents:function(){f.removeEvent(f.detectField,"mousemove",f.onMouseMove);f.removeEvent(f.detectField,"mouseout",f.onMouseOut)},removeEvent:function(field,eventName,method){if(field.detachEvent){field.detachEvent("on"+eventName,method)}else{if(field.removeEventListener){field.removeEventListener(eventName,method)}}},initCookies:function(){var raw,data;raw=q.html.cookie.readCookie(f.cookieName);if(!raw){data={};data[f.closeCountName]=0;data[f.submitCountName]=0;raw=JSON.stringify(data);f.writeCountCookie(raw);return raw===q.html.cookie.readCookie(f.cookieName)}else{data=JSON.parse(raw);f.writeCountCookie(raw);return(data[f.closeCountName]===0)&&(data[f.submitCountName]===0)}},incrementCloseCount:function(){var x,data,raw=q.html.cookie.readCookie(f.cookieName);if(raw){data=JSON.parse(raw);data[f.closeCountName]+=1;data=JSON.stringify(data);f.writeCountCookie(data)}},writeCountCookie:function(data){q.html.cookie.writeCookie(f.cookieName,data,-1);q.html.cookie.writeCookie(f.cookieName,data,f.opts.closeCountDays,f.opts.domain)},incrementSubmitCount:function(){var x,data,raw=q.html.cookie.readCookie(f.cookieName);data=JSON.parse(raw);data[f.submitCountName]+=1;data=JSON.stringify(data);q.html.cookie.writeCookie(f.cookieName,data,f.opts.submitCountDays,f.opts.domain)},sendShowFeedbackPing:function(){f.sendStats({type:"fb_show"})},hideFeedback:function(){f.incrementCloseCount();f.sendStats({type:"fb_hide"});f.hideBox()},hideBox:function(){if(f.overlay){f.overlay.remove()}if(f.boxBody){f.boxBody.empty()}if(f.iframe){f.iframe.remove()}delete f.overlay;delete f.boxBody;delete f.iframe},nice_sendFeedback:function(text){f.sendStats({f:encodeURIComponent(text),r:f.activeReason});f.incrementSubmitCount()},sendFeedback:function(text){f.incrementSubmitCount();f.sendStats();f.sendOldFeedback(text)},sendStats:function(data){data=data||{};data=extend({pv_id:encodeURIComponent(q.cookie.PageView.update()),tid:encodeURIComponent(f.opts.trackingId),url:encodeURIComponent(window.location.href),time:encodeURIComponent(new Date().getTime()),tz:new Date().getTimezoneOffset(),r:f.activeReason,type:"fb_send",configId:f.opts.configId},data);f.getVisitorId(function(id){data.vid=id;var key,params=[];for(key in data){if(data.hasOwnProperty(key)){params.push(key+"="+data[key])}}q.html.PostData(f.opts.pongUrl+f.opts.statsPath+"?"+params.join("&"),"","GET")})},sendOldFeedback:function(text){var data=[];data.push(f.addKeyValue("commentdetail",text));data.push(f.addKeyValue("client_id",f.opts.trackingId));data.push(f.addKeyValue("client_code",f.opts.clientId));data.push(f.addKeyValue("profile_code",f.opts.profileId));data.push(f.addKeyValue("domain",f.opts.domain));data.push(f.addKeyValue("feedback_id",q.cookie.PageView.update()));data.push(f.addKeyValue("current_url",JSON.stringify(f.getTrackingCookie(f.trackerCookie))));data.push(f.addKeyValue("referrer_url",JSON.stringify(f.getTrackingCookie(f.referrerCookie))));data.push(f.addKeyValue("time_before_feedback",f.showTime-f.startTime));data.push(f.addKeyValue("screen_res",""));data.push(f.addKeyValue("chrome_size",""));data.push(f.addKeyValue("current_point",""));data.push(f.addKeyValue("num_of_visits",JSON.parse(q.cookie.SessionCounter.update(f.opts.domain))[0]));f.getVisitorId(function(id){data.push(f.addKeyValue("global_user_id",id));data.push(f.addKeyValue("session_counter",q.cookie.SessionCounter.update(f.opts.domain)));data.push(f.addKeyValue("pv_id",q.cookie.PageView.update()));data=data.join("&");q.html.PostData(f.opts.pongUrl+f.opts.feedbackPath,encodeURIComponent(data))})},addKeyValue:function(k,v){return k+"="+encodeURIComponent(v)},preloadImages:function(){var i,images=f.opts.images,temp=[];if(Object.prototype.toString.call(f.opts.images)==="[object Array]"){for(i=0;i<images.length;){temp[i]=new Image();temp[i].src=images[i];i+=1}}},showFeedback:function(reason){if(window.q_ef_disable){return}f.preloadResources();f.activeReason=reason;f.showTime=new Date().getTime();f.sendShowFeedbackPing();if(f.$){f.doShowFeedback()}else{f.showFeedbackPending=true}},doShowFeedback:function(){if(f.opts.overlay){f.showOverlay()}f.loadIframe()},loadIframe:function(){var left,top;left=Math.round((f.$(window).width()-f.opts.container.width)/2);top=Math.round((f.$(window).height()-f.opts.container.height)/2);if(left<10){left=10}if(top<10){top=10}f.iframe=f.$("<iframe id='qb_feedback_frame'></iframe>");f.iframe.on("load",f.loadBox).attr("frameborder",0).attr("noresize",true).attr("border",0).attr("scrolling","no").attr("allowtransparency",true).css({display:"none",position:"fixed",left:left+"px",top:top+"px",width:f.opts.container.width+"px",height:f.opts.container.height+"px",background:"transparent","z-index":f.opts.container["z-index"]});f.$("body").append(f.iframe)},loadBox:function(){var containerNode,style;style="<style>"+(f.opts.cssBase+f.opts.cssExtra).split(";").join(";\n  ").split("}").join("}\n").split("{").join("{\n")+"</style>";f.boxBody=f.iframe.contents().find("body");f.boxBody.css("background","transparent");f.iframe.contents().find("head").append(style);containerNode=f.$(f.iframe.contents().get(0).createElement("div")).html(f.template(f.opts.container.template,f.opts.container.data)).appendTo(f.boxBody);f.delegateEvents(containerNode,f.opts.container.on);f.openPage(f.opts.firstPage);f.iframe.show()},showOverlay:function(){f.overlay=f.$("<div></div>").css({width:"100%",height:"100%",position:"fixed",background:f.opts.overlay.color,opacity:f.opts.overlay.opacity,filter:"alpha(opacity="+f.opts.overlay.opacity*100+")",top:0,left:0,display:"none","z-index":f.opts.container["z-index"]-1});if(f.opts.overlay.closes){f.overlay.on("click",f.hideFeedback)}f.$("body").append(f.overlay);f.overlay.fadeIn(f.opts.overlay.fadeInDuration)},makeDelegate:function(fn){return function(event){fn(f.getAPI(),event)}},delegateEvents:function(node,events){if(!events){return}var key,fn,eventType,selector;for(key in events){if(events.hasOwnProperty(key)){if(key.split(" ").length===2){eventType=key.split(" ")[0];selector=key.split(" ")[1];fn=events[key];node.on(eventType,selector,f.makeDelegate(fn))}}}if(events.load){events.load(f.getAPI())}},openPage:function(name){var config,node;if(f.opts.pages[name]){config=f.opts.pages[name];node=f.$(f.iframe.contents().get(0).createElement("div"));node.html(f.template(config.template,config.data));f.boxBody.find("."+f.opts.container.contentClass).empty().removeClass((f.currentPageName?f.currentPageName:"")).addClass(name).append(node);if(config.on){f.delegateEvents(node,config.on)}f.currentPageName=name}else{f.hideFeedback()}},nextPage:function(){f.openPage(f.opts.pages[f.currentPageName].nextPage)},template:function(str,data){var tmpl,func,c={interpolate:/\{\{(.+?)\}\}/g};tmpl="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+str.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');";func=new Function("obj",tmpl);return func(data)},getAPI:function(){return{v1:{$:f.$,openPage:f.openPage,hideFeedback:f.hideFeedback,nextPage:f.nextPage,sendFeedback:f.sendFeedback,template:f.template,getIframe:function(){return f.iframe},getBoxBody:function(){return f.boxBody},getCurrentPageName:function(){return f.currentPageName}}}},loadjQuery:function(callback){if(f.$||window.fb_testing){callback(f.$)}var s=document.createElement("script");s.type="text/javascript";s.src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js";s.onreadystatechange=s.onload=function(){var state=s.readyState;if(!callback.done&&(!state||/loaded|complete/.test(state))){callback.done=true;callback(window.$.noConflict(true))}};(document.body||document.documentElement).appendChild(s)}};return f};if(!window.fb_testing){var f=fb();f.start();window.q_ef_show=function(){f.showFeedback(f.reason.explicit)}}else{window.fb=fb}}())}catch(e){if(window.debug){console.debug(e)}};