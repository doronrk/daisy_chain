!function(a){var b=function(b){var c={type:"apparel",content:"",ajaxUrl:"",cssModifier:!1,windowClick:!1,deferred:!1,rebuild:!0};this.options=a.extend({},c,b),this.$body=a("body")};b.prototype.buildHtml=function(){return this.options.rebuild?(this.$quickView=a('<div class="module-quickview" />'),this.$content=a('<div class="quickview-content" />')):(this.$quickView=a(".module-quickview"),this.$content=a(".quickview-content")),this.options.cssModifier&&this.$content.addClass(this.options.cssModifier),this.$quickView.append(this.$content),this},b.prototype.setContent=function(){if(""===this.options.content&&""!==this.options.ajaxUrl){var b,c=this,d=this.options.ajaxUrl.indexOf("#");-1!==d?(b=this.options.ajaxUrl.slice(0,d)+" "+this.options.ajaxUrl.slice(d),this.$content.load(b,function(){a('<button class="close-button" />').prependTo(c.$content),c.onContentReady()})):a.ajax({type:"GET",url:this.options.ajaxUrl,dataType:"html"}).done(function(a){c.$content.html(a),c.onContentReady(),c.options.deferred&&c.options.deferred.resolve()})}else this.$content.html(this.options.content),this.onContentReady();return this},b.prototype.onContentReady=function(){this.alignContent(),this.resizeLeftBox(),this.formatPrice(),this.saveSliderHtml(),this.events()},b.prototype.saveSliderHtml=function(){this.sliderHtml=this.$content.find(".quickview-box-left").clone()},b.prototype.formatPrice=function(){var b=this.$content.find(".product-price"),c=a.trim(b.text()).split("."),d=c[0]+'.<span class="decimal-price">'+c[1]+"</span>";b.html(d)},b.prototype.changeSlider=function(b,c){var d=this,e="/modules/M10-QuickView/ajax/"+b+"/color/"+c+".html";a.ajax({type:"GET",url:e,dataType:"html"}).done(function(a){var b=d.sliderHtml.clone();b.find(".slides").html(a),d.$content.find(".quickview-box-left").html(b.html()),d.initMainFlexslider()})},b.prototype.alignContent=function(){var b=this.$content.height(),c=a(window).height(),d=0;c>b&&(d+=(c-b)/2),this.options.isMobile&&(d=0),this.$content.css({top:d})},b.prototype.resizeLeftBox=function(){var a=this.$content.find(".quickview-box-right").outerHeight();this.$content.find(".quickview-box-left").css({height:a})},b.prototype.deleteBox=function(){this.$body.css("overflow",""),this.$quickView.remove()},b.prototype.insertBox=function(){var a=this;return this.$body.css("overflow","hidden").prepend(this.$quickView),setTimeout(function(){a.$quickView.css("opacity","1")}),this},b.prototype.events=function(){var b=this;return a(window).on("resize",function(){b.alignContent(),b.resizeLeftBox()}),this.$content.find(".close-button").bind("click",a.proxy(this.deleteBox,this)),this.options.windowClick&&this.$content.bind("click",a.proxy(this.deleteBox,this)),a(document).bind("keyup",a.proxy(function(a){27==a.keyCode&&this.$quickView.is(":visible")&&this.deleteBox()},this)),"custom"!==this.options.type&&(this.initDropdowns(),this.initMainFlexslider(),this.addToCartHandler(),this.selectorHandler(),this.initCustomSelectBoxes()),this},b.prototype.initCustomSelectBoxes=function(){this.$content.find(".size-selection-box").customSelect({singleSelection:!0}),this.$content.find(".color-selection-box").customSelect({singleSelection:!0}),this.$content.find(".fit-selection-box").customSelect({singleSelection:!0})},b.prototype.initDropdowns=function(){this.$content.find(".dropdown").dropdown()},b.prototype.initMainFlexslider=function(){if(this.flexSlider=this.$content.find(".media-slider"),this.flexSlider.length>0){var b=this;this.flexSlider.flexslider({selector:".slides .slide",animation:"slide",animationLoop:!0,slideshow:!1,controlNav:!0,directionNav:!0,start:function(c){b.resizeLeftBox(),a("html").hasClass("lt-ie9")&&c.find(".slide").backgroundSize()}})}},b.prototype.selectorHandler=function(){this.$content.find(".qv-selector").not(".disabled").click(function(b){var c=a("input[name=quickViewURL]").val(),d=a(b.currentTarget),e=d.attr("name"),f=a("input[name=selectedSize]"),g=a("input[name=selectedFit]"),h=a("input[name=selectedWidth]"),i=a("input[name=sku]");i="color"==e?d.val():i.val(),f="sizes"==e?d.val()!=f.val()?d.val():null:f.length?f.val():null,g="fit"==e?d.val()!=g.val()?d.val():null:g.length?g.val():null,h="width"==e?d.val()!=h.val()?d.val():null:h.length?h.val():null,c=c.replace("{color}",i),c+="/?";var j=!1;null!==f&&(c+="size="+encodeURIComponent(f),j=!0),null!==g&&(j&&(c+="&"),c+="fit="+encodeURIComponent(g),j=!0),null!==h&&(j&&(c+="&"),c+="width="+encodeURIComponent(h)),a.quickView({ajaxUrl:c,type:a(this).data("type"),rebuild:!1}),updateRequestConfirmationToken()})},b.prototype.addToCartHandler=function(){this.$content.find(".button").not(".ignore").click(function(){$this.deleteBox()})},b.prototype.removeProduct=function(b){var c=this;a.each(b.buttons,function(d,e){a(e).click(function(){a(this).data("action")?a.publish("removeProduct",{element:b.element,modalHandle:c}):c.$quickView.remove()})})},b.prototype.removeCard=function(b){var c=this;a.each(b.buttons,function(d,e){a(e).click(function(){a(this).data("action")?a.publish("removeCard",{element:b.element,modalHandle:c}):c.$quickView.remove()})})},b.prototype.cancelOrder=function(b){var c=this;a.each(b.buttons,function(d,e){a(e).click(function(){a(this).data("action")?a.publish("cancelOrder",{element:b.element,modalHandle:c}):c.$quickView.remove()})})},b.prototype.removeAddress=function(b){var c=this;a.each(b.buttons,function(d,e){a(e).click(function(){a(this).data("action")?a.publish("removeAddress",{element:b.element,modalHandle:c}):c.$quickView.remove()})})},b.prototype.okModal=function(b){var c=this;a.each(a(b.buttons),function(b,d){a(d).click(function(){c.$quickView.remove()})})},b.prototype.qasChoice=function(b){var c=this;a.each(a(b.close),function(b,d){a(d).one("click",function(){return c.$quickView.remove(),!1})}),a.each(a(b.buttons),function(d,e){a(e).one("click",function(){return a(this).data("address-choice")?(a.publish("QASAddressUpdate",{formFragment:b.formFragment,addressChoice:a(this).data("address-choice"),modalHandle:c}),c.$quickView.remove()):c.$quickView.remove(),!1})})},b.prototype.setState=function(b){var c=this;a(b.closeButton+" a").click(function(a){c.$quickView.remove(),a.preventDefault()}),"login"===b.state?a(b.checkboxElement).prop("checked",!0):a(b.checkboxElement).prop("checked",!1),a(b.swapLinks.registerLink).click(function(){return a(b.checkboxElement).prop("checked",!1),!1}),a(b.swapLinks.loginLink).click(function(){return a(b.checkboxElement).prop("checked",!0),!1})},a.quickView=function(a){var c=new b(a);return c.buildHtml().insertBox().setContent().alignContent(),c}}(jQuery);