AA.Modules.SiteAlert=(function($,AA,window){"use strict";var defaults={cookieName:"aaSiteAlert",cookieAge:0,placement:"after",sessionCookie:false,templateURL:null,templateOptions:{},fancyBoxOptions:{},endDate:'',tickerID:null,fromBCC:false,startDate:'',serverTime:'',isFancyBox:true,allowControls:true,addTo:null},document=window.document,$cookie=AA.Utils.Cookie,aaConfig=AA.Config,TICKER_ID=null;function Timer(interval){this.interval=interval||2000;this.action=null;this.running=false;this.timer=null;}
Timer.fn=Timer.prototype;Timer.fn.setAction=function(action){if(typeof action==="function"){this.action=action;}};Timer.fn.isRunning=function(){return this.running;};Timer.fn.start=function(){if(this.timer!==null){clearInterval(this.timer);}
this.timer=setInterval(this.action,this.interval);this.running=true;};Timer.fn.stop=function(){if(this.running){this.running=false;clearInterval(this.timer);}};function Scroller(el_id,interval){var self=this;this.target=$("#"+ el_id);this.index=0;this.clock=null;this.interval=8000;this.items=$.makeArray($(TICKER_ID).find("li"));this.length=this.items.length;this.current=null;if(typeof interval!=="undefined"){this.interval=interval;}
this.show=function(current,index,items){$(current).fadeOut("fast",function(){self.current=items[index];$(self.current).fadeIn("fast");});};}
Scroller.fn=Scroller.prototype;Scroller.fn.next=function(){if(this.index===(this.length-1)){this.index=0;}else{this.index++;}
this.show(this.current,this.index,this.items);};Scroller.fn.prev=function(){if(this.index<=0){this.index=this.length-1;}else{this.index--;}
this.show(this.current,this.index,this.items);};Scroller.fn.start=function(){var srlr=this;srlr.current=srlr.items[srlr.index];srlr.show(srlr.current,srlr.index,srlr.items);if(srlr.getNumItems()>1){srlr.clock=new Timer(srlr.interval);srlr.clock.setAction(function(){srlr.next();});if(srlr.target.find('div.ticker-ctrl').length){srlr.target.on("click",".ticker-prev",function(){srlr.prev();});srlr.target.on("click",".ticker-next",function(){srlr.next();});}
srlr.target.mouseenter(function(){srlr.clock.stop();});srlr.target.mouseleave(function(){srlr.clock.start();});srlr.clock.start();}};Scroller.fn.getNumItems=function(){return this.items.length;};function setCookie(name,value,minutes){var expirationMiliseconds=minutes*60000,currentDate=new Date(),expirationDate=new Date(currentDate.getTime()+ expirationMiliseconds);document.cookie=name+"="+ value+";expires="+ expirationDate.toGMTString();}
function isCookieSet(cookieName){return $cookie.exist('aa-sa-'+ cookieName);}
function init(options){if(typeof $.fancybox==="undefined"){throw new Error("SiteAlert.init(): Fancybox plugin is required");}
if(options){$.extend(defaults,options);}
TICKER_ID="#"+ defaults.tickerID;if(defaults.cookieAge>0&&!defaults.isFancyBox){$cookie.create(defaults.cookieName,true,defaults.cookieAge,defaults.sessionCookie);}
if(defaults.isFancyBox&&!aaConfig.SIGNEDIN){$.extend(defaults.fancyBoxOptions,{"onStart":function(){if(defaults.cookieAge>0){$cookie.create(defaults.cookieName,true,defaults.cookieAge,defaults.sessionCookie);}}});return window.setTimeout(function(){$.fancybox($(TICKER_ID).html(),defaults.fancyBoxOptions);},100);}
if(defaults.params&&defaults.params.hasOwnProperty("endDate")&&$("#days-left").length){var date=AA.Utils.Date;$("#days-left").html(date.getDaysLeft(new Date(),date.parseDate(defaults.params.endDate),true));}
var scroller=new Scroller(defaults.tickerID,8000);if(scroller.getNumItems()>0){if(defaults.placement==="before"){$(defaults.target).before($(TICKER_ID));}else{$(defaults.target).after($(TICKER_ID));}
scroller.start();}}
return{init:init,isCookieSet:isCookieSet};}(jQuery,AA,window));