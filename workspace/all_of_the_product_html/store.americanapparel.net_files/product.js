var AA=AA||{};AA.namespace("AA.Utils").Product=(function(AA){var Product=function(){this.init.apply(this,arguments);};Product.prototype={init:function(product,productJSON){var productObj=product||{};productJSON=JSON.parse(productJSON);this.type=productObj.type;this.sku=(productObj.sku&&productObj.sku.length)?productObj.sku:null;this.skus=productJSON.skus;this.colors=productJSON.colors;this.sizes=productJSON.sizes;this.id=productJSON.productId;this.nonReturnable=productJSON.nonReturnable;this.colorSizes=productJSON.color2size;this.name=productJSON.name;this.partialSale=productJSON.partialSale;this.selectedSize=(productObj.size&&this.sku)?productObj.size:null;this.selectedColor=product.color||null;this.onColorChange=function(){};this.onSizeChange=function(){};},getNumSizes:function(){return this.sizes.length;},getSizes:function(){return this.sizes;},getType:function(){return this.type;},isPartialSale:function(){return this.partialSale;},isNonReturnable:function(){return this.nonReturnable;},getId:function(){return this.id;},setSelectedColor:function(color){if(color&&this.getColor(color)){this.selectedColor=color;this.onColorChange();}},getSelectedColor:function(){return this.selectedColor;},setSelectedSize:function(size){if(size){this.selectedSize=size;this.onSizeChange();}},getSelectedSize:function(){return this.selectedSize;},getPrice:function(sku){if(sku){return(sku.salePrice===sku.price)?sku.price:sku.salePrice;}},getSize:function(size){var sizes=this.sizes,len=sizes.length;while(len--){if(sizes[len].key===size){return sizes[len].value;}}},getSku:function(color,size){if(color&&size){return this.skus[color+size];}else{return this.skus[this.getSelectedColor()+ this.getSelectedSize()];}},getColor:function(color){if(color){return this.colors[color];}else{return this.colors[this.getSelectedColor()];}},getColorSizes:function(color){if(color){return this.colorSizes[color];}},getSkuPrice:function(sku){if(sku){if(sku.price!==sku.salePrice){return'<span class="salePrice">'+ sku.salePrice+'</span><span class="oldPrice">'+ sku.price+'</span>';}else{return'<span class="price">'+ sku.price+'</span>';}}},getName:function(){return this.name;},renderSizes:function($targetEl,$template,color){var templatedata=[],productSizes=this.sizes,colorSizes=this.getColorSizes(color);for(var i=0,len=productSizes.length;i<len;i++){var size=productSizes[i];templatedata.push({'cssClass':($.inArray(size.key,colorSizes)>=0)?'size':'size unavailable','key':size.key,'name':size.value,'selected':(this.getSelectedSize()===size.key)?'selected':undefined});}
$targetEl.html(Mustache.render($template.html(),{sizes:templatedata}));},parseJSONforTMS:function(){var skus=[],skuObj=this.skus;for(var sku in skuObj){var obj=skuObj[sku];skus.push({inventoryStatus:obj.inventory,price:obj.price,salePrice:obj.salePrice,sku:obj.skuId});}
return{product:this.id,skus:skus};}};return Product;}(AA));$(function(){var productDetailsFullScreenLink=productDetailsFullScreenLink||IMAGE_URL+'/storefront/photos/fullscreen.html?l=1&i=',ajaxSubmit=AA.Utils.AjaxSubmit,analytics=new AA.Utils.Analytics(AA.Config.TRACK_EVENTS,AA.Config.PAGE_NAME),skuVarData=$("#skuVarData").val(),isMobile=$("#m-product").css('display')==='block',color_timer=null,zoomEl=$("#zoom1"),videoRegEx=/\.mp4/i,$color_swatch=$('div.column .colors .color'),$color_swatch_list=$('#productDetailsCol').find('div.colors'),$color_label=$('div.column .colors .label').find('span.color-txt-label'),$product_image=$('#product_img'),$product_size=$("#product-sizes"),$product_size_list=$('div.column .sizes'),$size_label=$('div.column .sizes .label').find('span.size-txt-label'),$product_img_link=$('.productImage a'),$priceEl=$("#skuPriceId"),$addtocart_button=$('#addProductBtn'),$product_fullscreen_link=$('a.product-fullscreen-lnk'),$wishListBtn=$("#addToWishlistBtn"),$product_reviews=$('a.showReviews'),$inventoryMsg=$("#inventoryStatusMessage"),INVENTORY_TML=$("#tml-inventorymsg"),$productSizesTemplate=$("#tml-productsizes"),$productSizesEl=$("#product-sizes"),productObj=new AA.Utils.Product(AA.Product,skuVarData),$finalSaleMsg=$(".product-finalsale"),PRODUCT_NAME=productObj.getName(),PRODUCT_ID=productObj.getId(),fancyboxProductConfig={'overlayOpacity':0.9,'overlayColor':'#ffffff','padding':0,'type':'iframe','titleShow':false,'centerOnScroll':true};$color_swatch_list.find('.color[data-name="'+ productObj.getSelectedColor()+'"]').addClass('selected');function updateInventory(messageDiv,messageTmpl,inventoryId,$addToBagBtn){$addToBagBtn[0].disabled=false;switch(inventoryId){case'1':messageDiv.html(Mustache.render(messageTmpl.html(),{cssclass:"inventory-shipretail",title:AA.Product.inventoryMsgs.retailTitle,msg:AA.Product.inventoryMsgs.retailMsg})).show();break;case'2':messageDiv.html(Mustache.render(messageTmpl.html(),{title:AA.Product.inventoryMsgs.lowStockTitle,msg:AA.Product.inventoryMsgs.lowStockMsg})).show();break;case'3':messageDiv.html(Mustache.render(messageTmpl.html(),{title:AA.Product.inventoryMsgs.noStockTitle,msg:AA.Product.inventoryMsgs.noStockMsg})).show();$addToBagBtn[0].disabled=true;break;default:messageDiv.hide();}}
productObj.onColorChange=function(){var sku=this.getSku();if(sku){updateInventory($inventoryMsg,INVENTORY_TML,sku.inventory,$addtocart_button);$wishListBtn[0].disabled=false;$priceEl.html(this.getSkuPrice(sku));if(!this.isNonReturnable()){if(sku.onSale){$finalSaleMsg.show();}else{$finalSaleMsg.hide();}}}else if(this.getSelectedSize()){updateInventory($inventoryMsg,INVENTORY_TML,'3',$addtocart_button);if(!this.isNonReturnable()){$finalSaleMsg.hide();}
$wishListBtn[0].disabled=true;}
this.renderSizes($productSizesEl,$productSizesTemplate,this.getSelectedColor());};productObj.onSizeChange=function(){var sku=this.getSku();if(sku){updateInventory($inventoryMsg,INVENTORY_TML,sku.inventory,$addtocart_button);$wishListBtn[0].disabled=false;if(!this.isNonReturnable()){if(sku.onSale){$finalSaleMsg.show();}else{$finalSaleMsg.hide();}}
$priceEl.html(this.getSkuPrice(sku));}else if(this.getSelectedSize()){updateInventory($inventoryMsg,INVENTORY_TML,'3',$addtocart_button);if(!this.isNonReturnable()){$finalSaleMsg.hide();}
$wishListBtn[0].disabled=true;}};loadProductInfo(productObj.parseJSONforTMS());if(productObj.isPartialSale()){$('#sku-sale-msg').show();}
$('#addToCartForm').on('submit',function(){var successUrl=$('#successUrl').val(),errorUrl=$('#errorUrl').val(),qty=$("#product-qty").val(),skuId=productObj.getSku().skuId;if(analytics.trackingEnabled()){analytics.trackAddToBag(qty);}
$('#SkuId').val(skuId);$('#successUrl').val(successUrl+"&skuId="+ skuId);$('#errorUrl').val(errorUrl+"&skuId="+ skuId);});zoomEl.bind("updateCloudZoom",function(e,data){if(!$(this).data('zoom')){$(this).CloudZoom();}else{$(this).data('zoom').updateZoomImage(data.imageSrc);}});zoomEl.CloudZoom();if(productObj.getSku()){var sku=productObj.getSku();$wishListBtn[0].disabled=false;if(!productObj.isNonReturnable()&&sku.onSale){$finalSaleMsg.show();}
updateInventory($inventoryMsg,INVENTORY_TML,sku.inventory,$addtocart_button);$color_label.html(sku.color);$size_label.html(sku.size);productObj.renderSizes($productSizesEl,$productSizesTemplate,productObj.getSelectedColor());$product_reviews.attr('href',$product_reviews.attr('data-link')+ productObj.getColor().name);$priceEl.html(productObj.getSkuPrice(sku));}else if(productObj.getSelectedColor()){if(productObj.getNumSizes()===1){productObj.setSelectedSize(productObj.getSizes()[0].key);$size_label.html(productObj.getSku().size);$wishListBtn[0].disabled=false;}else{$wishListBtn[0].disabled=true;}
productObj.renderSizes($productSizesEl,$productSizesTemplate,productObj.getSelectedColor());updatePinterestLink(window.location.toString(),$product_image.attr('src'),productObj.getSelectedColor(),PRODUCT_NAME);$product_reviews.attr('href',$product_reviews.attr('data-link')+ productObj.getColor().name);if($("#issw").length){for(var firstSku in productObj.skus){$("#issw").attr("data-issw-price-value",productObj.skus[firstSku].price);break;}}}
$color_swatch_list.on("mouseover",".color",function(){clearTimeout(color_timer);var colorObj=productObj.getColor($(this).attr('data-name'));$color_label.html(colorObj.name);$product_image.attr('src',colorObj.hoverImage);});$color_swatch_list.on("mouseout",".color",function(){if(typeof $._data($color_swatch_list[0],"events").mouseover!=='undefined'&&typeof $(this).attr("data-selected")==="undefined"){color_timer=setTimeout(function(){var colorObj=productObj.getColor(productObj.getSelectedColor());$color_label.html(colorObj.name);$product_image.attr('src',colorObj.hoverImage);if(zoomEl.attr('href')!==colorObj.hoverImage){zoomEl.trigger("updateCloudZoom",{imageSrc:colorObj.zoomImage});}},500);}});$color_swatch_list.on("click",".color",function(){if($(this).hasClass('selected')){if(zoomEl.data('zoom')&&$(this).data('noZoom')){zoomEl.data('zoom').destroy();zoomEl.removeAttr('href');return;}
var colorObj=productObj.getColor(productObj.getSelectedColor());if(zoomEl.attr('href')!==colorObj.hoverImage){$product_image.attr('src',colorObj.hoverImage);zoomEl.trigger("updateCloudZoom",{imageSrc:colorObj.zoomImage});$product_fullscreen_link.attr('href',productDetailsFullScreenLink+ colorObj.zoomImage);}
return;}
if(typeof $._data($color_swatch_list[0],"events").mouseover!=='undefined'&&typeof $._data($color_swatch_list[0],"events").mouseout!=='undefined'){$color_swatch_list.off('mouseover mouseout');}
if($('#videoContainer').length&&$('#videoContainer').is(':visible')){$('#videoContainer').hide();$('#product-image').show();}
$color_swatch.removeClass('selected');$(this).addClass('selected');productObj.setSelectedColor($(this).attr('data-name'));var colorObj=productObj.getColor(productObj.getSelectedColor());$color_label.html(colorObj.name);$product_image.attr('src',colorObj.hoverImage);$product_fullscreen_link.attr('href',productDetailsFullScreenLink+ colorObj.zoomImage);$product_reviews.attr('href',$product_reviews.attr('data-link')+ colorObj.name);updatePinterestLink(window.location.toString(),colorObj.zoomImage,colorObj.name,PRODUCT_NAME);loadCloudZoomImg(zoomEl,colorObj.zoomImage);});$product_size_list.on("click",".size",function(){if($(this).hasClass('selected')){return;}
$product_size.find('li').removeClass('selected');$(this).addClass('selected');productObj.setSelectedSize($(this).attr('data-name'));$size_label.html(productObj.getSku()?productObj.getSku().size:productObj.getSize(productObj.getSelectedSize()));});$("#aaSliderProductDetailsGallery").on("click","div.slide",function(){var detail_img_src=$(this).attr('data-imgXL');$product_image.attr('src',detail_img_src);if($('#videoContainer').length&&$('#videoContainer').is(':visible')){$('#videoContainer').hide();}
if(!$('#product-image').is(':visible')){$('#product-image').show();}
if(videoRegEx.test(detail_img_src.substr(detail_img_src.lastIndexOf(".")))){loadVideo(detail_img_src.substr(0,detail_img_src.indexOf(".mp4")));return;}
loadCloudZoomImg(zoomEl,detail_img_src);$product_fullscreen_link.attr('href',productDetailsFullScreenLink+ detail_img_src);});$('.showReviews').fancybox($.extend(fancyboxProductConfig,{'width':595,'height':444})).click(function(){analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Reviews');});$('.sizeChart').fancybox($.extend(fancyboxProductConfig,{'width':565,'height':560,'padding':10,'onComplete':function(){$("#fancybox-frame").css({'overflow-x':'hidden'});},'onStart':function(){$("body").css({'overflow':'hidden'});analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Size Chart');},'onClosed':function(){$("body").css({'overflow':'visible'});}}));$('.specChart').fancybox($.extend(fancyboxProductConfig,{'width':560,'height':580,'onComplete':function(){$("#fancybox-frame").css({'overflow-x':'hidden'});},'onStart':function(){$("body").css({'overflow':'hidden'});analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Specs Chart');},'onClosed':function(){$("body").css({'overflow':'visible'});}}));ajaxSubmit("addItemToGiftlist",function(data){if(data.success===true||data.success==="true"){$("#glAddSuccess").find("span.text").html(data.msg).end().fadeIn(1000).delay(3500).fadeOut(1000);}else{$("#glAddSuccess").find("span.text").html(data.msg).end().fadeIn(1000).delay(3500).fadeOut(1000);}});$wishListBtn.click(function(){if(productObj.getSku()){$("#glistSkuId").val(productObj.getSku().skuId);analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Add to Wish List');$("#addItemToGiftlist").submit();}});if(isMobile){$("div.ratings").appendTo("#m-product");$("div.price").appendTo("#m-product");$('div.landingPage').on('click','div.ui-collapsible',function(e){var target=$(e.target);e.preventDefault();$(this).toggleClass('is-active');$(this).find('span.ui-btn-icon').toggle();$(this).next().toggle();});}
if(typeof AA.productImgsUrl!=="undefined"){showProductGallery(AA.productImgsUrl,"#aaSliderProductDetailsGallery",CDN_URL);}
$product_fullscreen_link.click(function(){analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','View Full Size Image');});$("#productDetailsCol").on("click",'.pressImages-link',function(){analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Press Alert from '+ $(this).attr('title'));});$(".similarProducts-products").on("click",'.product',function(){analytics.trackClick(AA.Config.PAGE_NAME,'Product - Click','You Might Also Like');});$("#needle_productTopBar2, #needle_productPro").click(function(){analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Needle Chat Support['+ $(this).attr('id')+']');});if($("#locateItemLink").length){$("#locateItemLink").fancybox({'width':650,'height':650,'type':'iframe','padding':0,'overlayColor':'#ffffff','overlayOpacity':0.9,'onStart':function(){$("body").css({'overflow':'hidden'});analytics.trackClick(AA.Config.PAGE_NAME,'Button - Click','Locate this Item');$("#locateItemLink").attr('href',getFindInStoresUrl(PRODUCT_ID,'1','1','',productObj));},'onClosed':function(){$("body").css({'overflow':'visible'});}});}
showPressImages("http://www.americanapparel.net/services/atg/image.ashx?action=getbystyle&styleId="+ PRODUCT_ID+"&path=FashionMedia",".pressImages",CDN_URL);});function loadProductInfo(productData){var MasterTmsUdo=window.MasterTmsUdo||{};MasterTmsUdo.productInfo=productData||{};setTimeout(function(){AA.Utils.FireEvent(document.getElementById('tmsProductInfoClickElement'),"click");},1000);}
function getFindInStoresUrl(StyleID,OnlineStoreID,LanguageID,hostVar,productObj){var color=productObj.getSelectedColor(),size=productObj.getSelectedSize();color=(color)?color.replace(/\+/g,'%2B'):'';size=(size)?size.replace(/\+/g,'%2B'):'';return"http://www.americanapparel.net/storefront/reservations/defaultATG.aspx"+"?sid="+ StyleID+"&c="+ color+"&s="+ size+"&o="+ OnlineStoreID+"&l="+ LanguageID+"&host="+(hostVar||'');}
function showPressImages(url,divId,cdnUrl){$.getJSON(url+"&callback=?",function(data){head.js(CDN_URL+'/js/modules/AA.modules.pressimages.js',function(){AA.Modules.PressImages.init({s7Data:data,targetDiv:divId});});});}
function showProductGallery(url,divId,cdnUrl){var analytics=new AA.Utils.Analytics(AA.Config.TRACK_EVENTS,AA.Config.PAGE_NAME);$.getJSON(url+"&callback=?",function(data){if(data.length){$("#productgallery-stg").show();var IMAGE_URLi="http://i.americanapparel.net",imgData=data,slideArray=[];$.each(imgData,function(i,el){slideArray.push({'img':IMAGE_URLi+ el[0],'imgXL':IMAGE_URLi+ el[1]});});var getSlideType=function(){return(this.imgXL.lastIndexOf(".mp4")>0)?"video":"image";};if(slideArray.length<=5){$(divId).html(Mustache.render($("#tml-productgallery").html(),{"list":slideArray,"slideType":getSlideType,"alt":$("#product_img").attr("title")}));$("#aaSliderProductDetailsGallery").on("click","div.slide",function(){var _gaq=window._gaq||[],$target=$(this),type=$target.attr('data-type'),index=$target.index();analytics.trackClick(AA.Config.PAGE_NAME,'Gallery - Click',' Internal:'+ type,index);});return;}
head.js(CDN_URL+"/js/lib/jquery.bxslider.min.js",CDN_URL+'/js/modules/AA.modules.slideshow.js',function(){AA.Modules.Slider.init({s7Data:slideArray,targetDiv:divId,bxSlider:{minSlides:5,maxSlides:5,slideWidth:63,moveSlides:4,auto:false,speed:400,slideMargin:8,controls:($("#m-product").css('display')!=='block')},renderSlide:function(){return Mustache.render($("#tml-productgallery").html(),{"list":slideArray,"slideType":getSlideType,"alt":$("#product_img").attr("title")});}});if(analytics.trackingEnabled()){$.subscribe("slider.slideclick",function(e,data){analytics.trackGalleryClick(e,data);});}});}});}
function updatePinterestLink(currentUrl,productImage,color,productName){var currentColorIndex=currentUrl.indexOf('&c=');currentUrl=currentUrl.substring(0,(currentColorIndex!==-1)?currentColorIndex:currentUrl.length);currentUrl=currentUrl+'&c='+ color;currentUrl=currentUrl.replace('&','%26');productImage=productImage.replace('&','%26');productName=productName.replace('&','%26');$('#hlkPinIt').attr('href','http://pinterest.com/pin/create/button/?url='+currentUrl+'&media='+productImage+'&description='+productName);}
function loadVideo(videoSrc){var videoHtml=window.Mustache.render($("#tml-productvideo").html(),{videosrc:videoSrc,cdn_url:window.CDN_URL});if($('#product-image').is(':visible')){$('#product-image').hide();}
$("div.productImage").before(videoHtml);videojs("video1",{});window.loadVideo=function(videoSrc){if($('#videoContainer').length){videojs.players.video1.src([{type:"video/mp4",src:videoSrc+".mp4"},{type:"video/webm",src:videoSrc+".webm"},{type:"video/ogg",src:videoSrc+".theora.ogv"}]);if($('#product-image').is(':visible')){$('#product-image').hide();}
$("#videoContainer").show();}};}
function loadCloudZoomImg(cloudZoomEl,imgUrl){var productImg=new Image();$(productImg).load(function(){var self=this;if((productImg.width===1&&productImg.height===1)||(productImg.width===120&&productImg.height===160)){if(cloudZoomEl.data('zoom')){cloudZoomEl.data('zoom').destroy();}
cloudZoomEl.removeAttr('href');}else{cloudZoomEl.trigger("updateCloudZoom",{imageSrc:self.src});}}).attr("src",imgUrl);}
function popIt(width,height,scrollbars,pname,url){if(!width){width="500";}
if(!height){height="500";}
if(!scrollbars){scrollbars=1;}
var windowString='width='+ width+',height='+ height+',resizable=0,status=0,toolbar=no,scrollbars='+ scrollbars+',scrolling=auto';var popItWindow=window.open(url,pname,windowString);var pageName=AA.Config.PAGE_NAME,analytics=new AA.Utils.Analytics(AA.Config.TRACK_EVENTS,pageName);analytics.trackClick(AA.Config.PAGE_NAME,"Gallery - Click",'External: '+ url);return false;}