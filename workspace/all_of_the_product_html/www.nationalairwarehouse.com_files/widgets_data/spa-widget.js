/**
* Version: _V1416641666_
* Copyright 2011 Amazon.com, Inc., or its Affiliates.
**/

if(typeof (PYOP)==="undefined"){PYOP={}}if(typeof (PYOP.Widget)==="undefined"){PYOP.Widget={}}PYOP.Widget=new (function(){this.innerHeight=document.body.clientHeight||window.innerHeight;this.innerWidth=document.body.clientWidth||window.innerWidth;this.PaddingTopBottom=100;this.PaddingLeftRight=43;this.innerErrorContainerStyle=function(B,A){return{"height":(B-PYOP.Widget.PaddingTopBottom)+"px","width":(A-PYOP.Widget.PaddingLeftRight)+"px"}};this.applyInnerErrorContainerStyle=function(){angular.element(".widget-browser-unsupported .box-container").css(PYOP.Widget.innerErrorContainerStyle(PYOP.Widget.innerHeight,PYOP.Widget.innerWidth))};this.showGeneralErrorMessage=function(){if(angular.element(".widget-browser-unsupported .upgrade").is(":hidden")){angular.element(".widget-browser-unsupported").show();angular.element(".widget-browser-unsupported .general").show();angular.element(".widget-browser-unsupported .upgrade").hide();angular.element(".widget-inner-section").hide();angular.element(".pagination-container").hide()}};this.showCookieErrorMessage=function(){if(angular.element(".widget-browser-unsupported .upgrade").is(":hidden")){angular.element(".widget-browser-unsupported").show();angular.element(".widget-browser-unsupported .cookie").show();angular.element(".widget-browser-unsupported .upgrade").hide();angular.element(".widget-browser-unsupported .general").hide();angular.element(".widget-inner-section").hide();angular.element(".pagination-container").hide()}}});var application=angular.module("widget",["ngResource","ngCookies"]).filter("startFrom",function(){return function(A,B){B=+B;if(A instanceof Array){return A.slice(B)}}}).filter("truncateAddressName",function(){return function(A){if(A===""||typeof A==="undefined"||A===null){return""}else{names=A.split(" ");if(names.length===1){return names[0]}else{return names[0]+" "+names[1].substring(0,1)+"."}}}}).provider("$exceptionHandler",{$get:["errorLogService",function(A){return A}]}).factory("errorLogService",["$log",function(B){function A(C,D){B.error.apply(B,arguments);PYOP.Widget.applyInnerErrorContainerStyle();PYOP.Widget.showGeneralErrorMessage()}return A}]).constant("READ","Read").constant("SMARTPHONE_COLLAPSIBLE","smartphoneCollapsible").constant("INVALID_WIDGET_SIZE_CODE","InvalidWidgetSize").constant("INVALID_WIDGET_SIZE_DESCRIPTION","The widget container size is not in min/max range allowed or invalid").constant("WIDGET_SIZE",{"WALLET_MIN_WIDTH_EDIT":260,"WALLET_MIN_HEIGHT_EDIT":226,"ADDRESS_MIN_WIDTH_EDIT":260,"ADDRESS_MIN_HEIGHT_EDIT":226,"WALLET_MIN_WIDTH_READ":260,"WALLET_MIN_HEIGHT_READ":185,"ADDRESS_MIN_WIDTH_READ":260,"ADDRESS_MIN_HEIGHT_READ":185}).constant("WIDGET_TYPE",{WALLET:"WALLET",ADDRESS:"ADDRESS"}).factory("checkWidgetSizeService",["READ","WIDGET_SIZE","WIDGET_TYPE","INVALID_WIDGET_SIZE_CODE","INVALID_WIDGET_SIZE_DESCRIPTION",function(B,F,A,C,E){var D={};D.validateSize=function(J,H,G,I){validateSizeState=true;if(J===A.WALLET&&H!==B){if((G<F.WALLET_MIN_WIDTH_EDIT)||(I<F.WALLET_MIN_HEIGHT_EDIT)){validateSizeState=false}}else{if(J===A.WALLET&&H===B){if((G<F.WALLET_MIN_WIDTH_READ)||(I<F.WALLET_MIN_HEIGHT_READ)){validateSizeState=false}}else{if(J===A.ADDRESS&&H!==B){if((G<F.ADDRESS_MIN_WIDTH_EDIT)||(I<F.ADDRESS_MIN_HEIGHT_EDIT)){validateSizeState=false}}else{if(J===A.ADDRESS&&H===B){if((G<F.ADDRESS_MIN_WIDTH_READ)||(I<F.ADDRESS_MIN_HEIGHT_READ)){validateSizeState=false}}}}}if(validateSizeState===false){CBA.Checkout.widgetSendErrMsg(C,E,commonWidgetParams.widgetId,commonWidgetParams.referringURL)}};return D}]).factory("errorService",["$location","$cookies","$cookieStore",function(D,A,C){var B={};B.handleError=function(E){if((E.errorCode[0]==="AddressNotSelected")||(E.errorCode[0]==="BuyerRegionMissMatch")){D.path("/warning")}else{if(E.errorCode[0]==="BuyerCredentialMissing"){D.path("/warning");if(typeof A["session-id"]==="undefined"){PYOP.Widget.showCookieErrorMessage()}}else{D.path("/error")}}if(E.merchantCallbackMode==="true"){CBA.Checkout.widgetSendErrMsg(E.merchantErrorCode,E.merchantErrorMessage,E.widgetId,E.merchantPageUrl)}return E.content[0]};return B}]).factory("locationService",["$location","READ","SMARTPHONE_COLLAPSIBLE",function(B,A,C){var D={};D.changeAndReplace=function(E){B.path(E);B.replace()};D.routeFromResponse=function(E){if((E.length===0)&&(commonWidgetParams.widgetDesignMode===C)){D.changeAndReplace("/empty-collapsible")}else{if((E.length===0)&&(commonWidgetParams.displayMode!==A)){D.changeAndReplace("/empty")}else{if((E.length===0)&&(commonWidgetParams.displayMode===A)){D.changeAndReplace("/empty-read-only")}else{if(commonWidgetParams.widgetDesignMode===C){D.changeAndReplace("/list-collapsible")}else{if(commonWidgetParams.displayMode===A&&E[0].selected!==true){D.changeAndReplace("/empty-read-only")}else{if(commonWidgetParams.displayMode===A){D.changeAndReplace("/read-only")}}}}}}};return D}]).factory("paginationService",function(){var B={};var A=[];B.setResource=function(C){A=C};B.numPagesWithAddButton=function(C){return Math.ceil((A.length+1)/C)};B.numItems=function(){return A.length};B.numPages=function(C){return Math.ceil(A.length/C)};return B}).config(["$routeProvider",function(A){A.when("/list",{templateUrl:"list"}).when("/list-collapsible",{templateUrl:"list"}).when("/error",{templateUrl:"error"}).when("/warning",{templateUrl:"warning"}).when("/empty",{templateUrl:"empty"}).when("/empty-collapsible",{templateUrl:"empty-collapsible"}).when("/read-only",{templateUrl:"read-only"}).when("/empty-read-only",{templateUrl:"empty-read-only"})}]).controller("mainCtrl",["$scope","$rootScope","$window","$location","paginationService","READ","SMARTPHONE_COLLAPSIBLE","checkWidgetSizeService","WIDGET_TYPE",function(K,H,B,D,E,A,F,J,C){K.widgetLoading=true;K.disableWidget=true;H.showLoading=false;H.isExpanded=false;K.svaPopup=false;K.checkWidgetSizeState=false;if(!(typeof (commonWidgetParams)==="undefined")){if(commonWidgetParams.contractId!==""){CBA.Checkout.sendMsg(false,"pcId="+commonWidgetParams.contractId,commonWidgetParams.referringURL)}K.smartphoneCollapsible=(commonWidgetParams.widgetDesignMode===F)}K.currentPage=0;var I=angular.element(B);K.version="1.0.0";K.windowWidth=0;K.windowHeight=0;var G=function(){K.windowWidth=I.width();K.windowHeight=I.height();K.column=1;if(K.windowWidth>=398){K.column=2}K.pageSize=Math.floor((K.windowHeight-150)/38)*K.column;K.errorHeight=function(){return{"height":(K.windowHeight-100)+"px","width":(K.windowWidth-43)+"px"}}};K.safeApply=function(M){var L=this.$root.$$phase;if(L=="$apply"||L=="$digest"){if(M&&(typeof (M)==="function")){M()}}else{this.$apply(M)}};I.bind("resize",function(){K.safeApply(function(){G()})});G();K.checkWidgetSize=function(){if(typeof (paymentListResponse)!=="undefined"){J.validateSize(C.WALLET,commonWidgetParams.displayMode,K.windowWidth,K.windowHeight)}else{if(typeof (addressListResponse)!=="undefined"){J.validateSize(C.ADDRESS,commonWidgetParams.displayMode,K.windowWidth,K.windowHeight)}}};K.checkCurrentPageSizeLimitOnResize=function(N,L,M){if(((N+1)*L)>M){N=Math.floor(M/L);if((M%L)===0){N=N-1}}return N};K.pageNumber=function(){return K.currentPage=K.checkCurrentPageSizeLimitOnResize(K.currentPage,K.pageSize,K.numItems())};K.showPaginationButton=function(){if(D.path()==="/list"||D.path()==="/list-collapsible"){if(K.numPages()>1){return true}}return false};K.showPaginationInfo=function(){return K.showPaginationButton()};K.showAllItemsText=function(){if(K.numPages()===1){if(!K.showPaginationButton()||(K.numItems())<K.pageSize){if(K.smartphoneCollapsible===true){return H.isExpanded}else{return true}}}return false};K.showAddItemLink=function(){if(typeof (commonWidgetParams)!=="undefined"){return(commonWidgetParams.displayMode!==A)&&((K.showPaginationButton()===true)||(K.numItems()===K.pageSize))}return false};K.hideFooter=function(){return(D.path()!=="/list")||(K.numPagesWithAddButton()>1)};K.numPagesWithAddButton=function(){return E.numPagesWithAddButton(K.pageSize)};K.numItems=function(){return E.numItems()};K.numPages=function(){return E.numPages(K.pageSize)};K.prevPage=function(){if(K.currentPage>0){K.currentPage=K.currentPage-1}};K.nextPage=function(){if(K.currentPage<K.numPages()-1){K.currentPage=K.currentPage+1}};K.privacyPolicy=function(L){CBA.Checkout.openPopupPrivacyPolicy(L)};K.toggleCollapsible=function(L){if(K.smartphoneCollapsible){if(H.isExpanded===false){if(L!=="updateNonCollapsible"){CBA.Checkout.widgetSendMsg("changeHeight;265",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}else{return false}}else{CBA.Checkout.widgetSendMsg("changeHeight;135",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}H.isExpanded=!H.isExpanded}};K.openSVAPopup=function(L){K.svaPopup=true;if(L.stopPropagation){L.stopPropagation()}if(L.preventDefault){L.preventDefault()}L.cancelBubble=true;L.returnValue=false};K.closeSVAPopup=function(){K.svaPopup=false}}]).controller("addressCtrl",["$scope","$resource","$rootScope","locationService","paginationService","errorService",function(C,B,A,F,E,D){var G=B("/gp/widgets/widgets",{},{"setShippingAddress":{method:"POST",params:setShippingAddressParams}});F.changeAndReplace("/list");if((typeof (commonWidgetParams)==="undefined")&&(typeof errorDetails==="undefined")){C.widgetLoading=false;C.error=D.handleError(genericError.data)}else{if(typeof errorDetails==="undefined"){C.disableWidget=false;if(addressListResponse.data.status==="success"){C.addresses=addressListResponse.data.content.addresses;F.routeFromResponse(C.addresses);if(C.addresses.length>0){if(C.addresses[0].isValid!==false){CBA.Checkout.widgetSendMsg("addressselect",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}C.selectedAddress=C.addresses[0];E.setResource(C.addresses)}}else{C.error=D.handleError(addressListResponse.data)}C.widgetLoading=false}else{C.widgetLoading=false;C.error=D.handleError(errorDetails.data)}}C.hasAddress=function(){return C.addresses.length>0};C.addressButtonClickHandler=function(H){if(H.isValid){C.setSelectedAddress(H)}else{C.editAddress(H)}};C.setSelectedAddress=function(H){if(H.addressId===C.selectedAddress.addressId){if(C.smartphoneCollapsible===true){C.toggleCollapsible()}return false}A.showLoading=true;setShippingAddressParams.selectedShipToAddressId=C.selectedAddress.addressId;setShippingAddressParams.newShipToAddressId=H.addressId;CBA.Checkout.widgetSendMsg("addressselectpre",commonWidgetParams.widgetId,commonWidgetParams.referringURL);G.setShippingAddress({},function(I){if(I.data.status==="success"){C.selectedAddress=H;if(C.smartphoneCollapsible===true){C.toggleCollapsible()}CBA.Checkout.widgetSendMsg("addressselect",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}else{C.error=D.handleError(I.data)}A.showLoading=false})};C.editAddress=function(H){C.toggleCollapsible();if(commonWidgetParams.deviceType==="Mobile"){CBA.Checkout.appendInputToForm("#editShippingAddressMobileForm","newShipToAddressId",H.addressId);CBA.Checkout.submitWithCommonFieldsUsingWindow("#editShippingAddressMobileForm",commonWidgetParams.cartOwnerId)}else{CBA.Checkout.appendInputToForm("#editShippingAddressForm","newShipToAddressId",H.addressId);CBA.Checkout.submitWithCommonFieldsUsingPopup("#editShippingAddressForm",commonWidgetParams.cartOwnerId)}};C.isSelected=function(H){return C.selectedAddress.addressId===H};C.addNewAddressAndToggleCollapsible=function(){C.toggleCollapsible();C.addNewAddress()};C.addNewAddress=function(){if(commonWidgetParams.deviceType==="Mobile"){if(commonWidgetParams.isSandbox==="true"){CBA.Checkout.submitWithCommonFieldsUsingWindow("#addShippingAddressForm",commonWidgetParams.cartOwnerId)}else{CBA.Checkout.submitWithCommonFieldsUsingWindow("#AddShippingAddressAddPaymentMethodSelectAndAddBillingAddress",commonWidgetParams.cartOwnerId)}}else{CBA.Checkout.submitWithCommonFieldsUsingPopup("#addShippingAddressForm",commonWidgetParams.cartOwnerId)}}}]).controller("walletCtrl",["$scope","$resource","$rootScope","locationService","errorService","paginationService",function(C,B,A,G,F,E){C.showSvaBalance=false;C.svaBalance="$0";C.useSva=false;var D=B("/gp/widgets/widgets",{},{"setPaymentMethod":{method:"POST",params:setPaymentMethodParams}});G.changeAndReplace("/list");C.isValid=function(H){return((H.isExpired===false)&&(H.isBillingAddressPresent===true)&&(H.isDeclined===false)&&(H.isDisabled===false))};C.isAmazonPLCC=function(H){return H.paymentCardType==="AMAZONPLCC"};C.openASCInfoPopup=function(){window.open("http://www.amazon.com/gp/cobrandcard/marketing.html?ie=UTF8&inc=9018&place=slpp&plattr=NOPP0001&pop-up=1&pr=conplcc&ref=ox_pay_page_storecard_help","Amazon_Store_Card_Info_Page","location=no,scrollbars=1,left=50,top=50")};if((typeof (commonWidgetParams)==="undefined")&&(typeof errorDetails==="undefined")){C.widgetLoading=false;C.error=F.handleError(genericError.data)}else{if(typeof errorDetails==="undefined"){C.disableWidget=false;if(paymentListResponse.data.status==="success"){C.paymentMethods=paymentListResponse.data.content.paymentMethods;G.routeFromResponse(C.paymentMethods);if(paymentListResponse.data.content.svaBalance){C.showSvaBalance=true;C.svaBalance=paymentListResponse.data.content.svaBalance;C.useSva=setPaymentMethodParams.isAPASelected}if(C.paymentMethods.length>0){if(C.isValid(C.paymentMethods[0])===true){CBA.Checkout.widgetSendMsg("paymentselect",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}C.selectedPaymentMethod=C.paymentMethods[0];E.setResource(C.paymentMethods)}}else{C.error=F.handleError(paymentListResponse.data)}C.widgetLoading=false}else{C.widgetLoading=false;C.error=F.handleError(errorDetails.data)}}C.hasPaymentMethods=function(){return C.paymentMethods.length>0};C.paymentButtonClickHandler=function(H){if(C.isValid(H)){C.setSelectedPaymentMethod(H)}else{if(H.isDisabled===false){C.editPaymentMethod(H)}}};C.toggleUseSva=function(){C.useSva=!C.useSva;setPaymentMethodParams.isAPASelected=C.useSva;C.setSelectedPaymentMethod(C.selectedPaymentMethod,false)};C.setSelectedPaymentMethod=function(H,I){if(H.paymentInstrumentId===C.selectedPaymentMethod.paymentInstrumentId&&I!==false){if(C.smartphoneCollapsible===true){C.toggleCollapsible()}return false}A.showLoading=true;setPaymentMethodParams.selectedCCInstrumentId=C.selectedPaymentMethod.paymentInstrumentId;setPaymentMethodParams.newCCInstrumentId=H.paymentInstrumentId;D.setPaymentMethod({},function(J){if(J.data.status==="success"){C.selectedPaymentMethod=H;C.useSva=setPaymentMethodParams.isAPASelected;if(C.smartphoneCollapsible===true){C.toggleCollapsible("updateNonCollapsible")}CBA.Checkout.widgetSendMsg("paymentselect",commonWidgetParams.widgetId,commonWidgetParams.referringURL)}else{C.error=F.handleError(J.data)}A.showLoading=false})};C.isUpdateAction=function(H){if(typeof (H)!=="undefined"){if(H.paymentCardType==="BANKACCOUNT"){C.addNewPaymentMethod()}else{C.editPaymentMethod(H)}}};C.editPaymentMethod=function(H){C.toggleCollapsible("updateNonCollapsible");CBA.Checkout.appendInputToForm("#EditCreditCardForm","selectedCCInstrumentId",H.paymentInstrumentId);CBA.Checkout.appendInputToForm("#EditCreditCardForm","isBillingAddressValid",H.isBillingAddressPresent);if(commonWidgetParams.deviceType==="Mobile"){CBA.Checkout.submitWithCommonFieldsUsingWindow("#EditCreditCardForm",commonWidgetParams.cartOwnerId)}else{CBA.Checkout.submitWithCommonFieldsUsingPopup("#EditCreditCardForm",commonWidgetParams.cartOwnerId)}};C.addNewPaymentMethodAndToggleCollapsible=function(){C.toggleCollapsible();C.addNewPaymentMethod()};C.addNewPaymentMethod=function(){if(commonWidgetParams.deviceType==="Mobile"){CBA.Checkout.submitWithCommonFieldsUsingWindow("#AddPaymentMethodForm",commonWidgetParams.cartOwnerId)}else{CBA.Checkout.submitWithCommonFieldsUsingPopup("#AddPaymentMethodForm",commonWidgetParams.cartOwnerId)}};C.isSelected=function(H){return C.selectedPaymentMethod.paymentInstrumentId==H&&C.isValid(C.selectedPaymentMethod)};C.isUpdateText=function(I,K){var H={"statusTextMap":statusTextTranslations,"infoTextMap":infoTextTranslations,"buttonTextMap":buttonStatusTextTranslations};var J=H[K];if(I.isDeclined){if((I.isExpired===true)&&(I.isBillingAddressPresent===false)){return J.isDeclinedMissingBillingAddressAndExpired}else{if(I.isExpired===true){return J.isDeclinedExpired}else{if(I.isBillingAddressPresent===false){return J.isDeclinedMissingBillingAddress}}}return J.isDeclinedDeclined}else{if((I.isDisabled===true)){return J.isDisabled}else{if((I.isExpired===true)&&(I.isBillingAddressPresent===false)){return J.isExpiredAndMissingBillingAddress}else{if(I.isExpired===true){return J.isExpired}else{if(I.isBillingAddressPresent===false){return J.isMissingBillingAddress}}}}}}}])