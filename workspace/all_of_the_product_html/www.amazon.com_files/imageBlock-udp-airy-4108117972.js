P.when("A","jQuery").register("imageBlockLogger",function(A,$){window.ImageBlockclientLogger=function(feature,forceUpload){var self=this,data={},vips={"www.amazon.com":"fls-na","devo":"fls-devo.vipinteg"};
self.logSingleton=function(key){data[key]=1;
};
self.logHit=function(key){if(!data[key]){data[key]=1;
}else{data[key]++;
}};
self.logKeyValuePair=function(key,value){data[key]=value;
};
self.deleteKey=function(key){if(data[key]){delete data[key];
}};
self.startTimer=function(key){data[key]=+new Date();
};
self.endTimer=function(key){if(data[key]){data[key]=+new Date()-data[key];
}};
self.upload=function(){var protocol=location.protocol=="https:"?"https://":"http://",vip=vips[location.host]||vips.devo,url=protocol+vip+".amazon.com/1/softlines/1/OP/"+feature+"?"+$.param(data)+"&_="+(+new Date());
(new Image()).src=url;
};
if(forceUpload){$(window).unload(function(){self.upload();
});
}};
});
P.when("A","jQuery").register("imageBlockUtils",function(A,$){var utils={},options,colorToVideo,captionTimeout,landingColor,colorImages,windowResized=false,itemContainer=$("#main-image-container");
utils.VIDEO_UNSUPPORTED_CLASS_NAME="noflash";
utils.flashNotInstalled=false;
utils.embedAiryForChromelessPlayback=function(holder,videoHash,serverSideConfig,thumbs,logger,listItem){return airyInstance=Airy.embed({isShowFirstFrameWhenReadyEnabled:true,parentElement:holder[0],streamingUrls:videoHash.url,swfUrl:serverSideConfig.swfUrl,foresterMetadataParams:serverSideConfig.foresterMetadataParams,backgroundColor:"transparent",flashParams:{wmode:"transparent"},experiments:{supportChromelessPlayback:true},bindings:{canplay:function(){var rendererType=(holder.find("video").length>0)?"HTML5":"FLASH";
logger.logKeyValuePair("ChromelessVideo",rendererType);
},playing:function(){holder.parent().css("z-index",8);
},videounsupported:function(){utils.flashNotInstalled=true;
A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
logger.logKeyValuePair("ChromelessVideo","NO_FLASH_ERROR");
listItem.addClass(utils.VIDEO_UNSUPPORTED_CLASS_NAME);
},error:function(){A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
logger.logKeyValuePair("ChromelessVideo","ERROR");
},ended:function(){airyInstance.seek(0);
}},cuePoints:[{values:videoHash.durationSeconds-1,type:"position",callback:function(cuePointValue,type,eventContext){var timeRemainingSeconds=eventContext.durationSeconds-eventContext.playheadTimeSeconds;
holder.css("background-color","white").find(".airy-renderer-container").fadeTo(timeRemainingSeconds*1000,0.1,function(){holder.parent().css({"background-color":"transparent","z-index":-1});
A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
$(this).show().css("opacity",1);
});
}}]});
};
utils.embedAiryForChromefulPlayback=function(holder,videoHash,serverSideConfig,contextName){var foresterMetadataParams=$.extend({},serverSideConfig.foresterMetadataParams);
if(contextName!=null){foresterMetadataParams.method+="."+contextName;
}var instance=Airy.embed({parentElement:holder[0],streamingUrls:videoHash.url,contentId:videoHash.mediaObjectId,contentMinAge:Number(videoHash.minimumAge||"")||0,contentTitle:videoHash.title,swfUrl:serverSideConfig.swfUrl,foresterMetadataParams:foresterMetadataParams,slateImages:{preloadSlate:videoHash.slateUrl,postMediaSlate:videoHash.slateUrl}});
adjustAiryVolumeFromConfig(instance,serverSideConfig);
return instance;
};
utils.loadMediaIntoAiryAndSetVolume=function(airyInstance,videoHash,config){if(!airyInstance){return;
}if(airyInstance.getMediaSourceInfo()===videoHash.url){return;
}airyInstance.loadMedia({mediaSourceInfo:videoHash.url,contentId:videoHash.mediaObjectId,contentMinAge:Number(videoHash.minimumAge||"")||0,contentTitle:videoHash.title,slateImages:{preloadSlate:videoHash.slateUrl,postMediaSlate:videoHash.slateUrl}});
adjustAiryVolumeFromConfig(airyInstance,config);
};
function adjustAiryVolumeFromConfig(airyInstance,config){if(!airyInstance||config.volume==null){return;
}airyInstance.setVolume(config.volume);
config.volume=null;
}utils.setLandingColor=function(c){landingColor=c;
};
utils.resizeHappened=function(){windowResized=true;
};
utils.getMainBlockHeight=function(){var containerElem=itemContainer.get(0);
var height=0;
if(typeof containerElem!=="undefined"){if(!windowResized){height=containerElem.style.height;
}else{var width=containerElem.offsetWidth;
height=width/options.holderRatio;
height=height>options.holderMaxHeight?options.holderMaxHeight:height;
}}return height;
};
utils.loadImageManually=function(images,ctx){$(images,ctx).each(function(){var $t=$(this);
if(!$t.attr("data-a-image-already-loaded")){$t.attr("data-a-image-already-loaded",true);
var dynamicUrl=utils.loadDynamicImage($t);
var $img=$("<img>").attr("src",dynamicUrl||$t.data("a-image-source"));
$img.attr("data-a-hires",$t.data("a-hires"));
$img.attr("data-old-hires",$t.data("old-hires"));
$img.attr("data-a-manual-replacement",$t.data("a-manual-replacement"));
$img.attr("data-a-dynamic-image",JSON.stringify($t.data("a-dynamic-image")));
var classes="";
classes+=$t.attr("class");
var extraClasses=$t.data("a-extra-classes");
if(extraClasses){classes+=" "+extraClasses;
}$img.attr("class",classes);
$img.attr("id",$t.attr("id"));
$img.attr("style",$t.attr("style"));
$t.replaceWith($img);
}});
};
utils.loadImageAsynchronously=function(url,callback){if(url===null||url===undefined||typeof url!=="string"){return;
}var image=new Image();
if(callback!==null&&callback!==undefined&&typeof callback==="function"){image.onload=callback;
}image.src=url;
};
utils.loadDynamicImage=function(image){var $image=$(image);
var sizes=$image.data("a-dynamic-image");
if(!sizes||typeof sizes!=="object"){return;
}var $container=$image.data("a-dynamic-image-container");
if(typeof $container==="undefined"){$container=$image.parents(".a-dynamic-image-container");
if($container.length===0){$container=$image.parent();
}$image.data("a-dynamic-image-container",$container);
}var pixelRatio=window.devicePixelRatio?window.devicePixelRatio:1;
var width=$container.width()*pixelRatio;
var height=$container.height()*pixelRatio;
var closestSizeDiff=Number.MAX_VALUE;
var closestLargerSizeDiff=Number.MAX_VALUE;
var closestUrl=$image.attr("src")||"";
var closestLargerUrl;
var aspectRatio=width/height;
$.each(sizes,function(url,size){var proposedHeight=parseInt(size[0],10);
var proposedWidth=parseInt(size[1],10);
var heightDiff=proposedHeight-height;
var widthDiff=proposedWidth-width;
var sizeDiff=aspectRatio>=1?widthDiff:heightDiff;
if(Math.abs(sizeDiff)<closestLargerSizeDiff&&sizeDiff>=0){closestLargerSizeDiff=Math.abs(sizeDiff);
closestLargerUrl=url;
}if(Math.abs(sizeDiff)<closestSizeDiff){closestSizeDiff=Math.abs(sizeDiff);
closestUrl=url;
}});
if(closestLargerUrl){closestUrl=closestLargerUrl;
}return closestUrl;
};
function fetchChildVideos(color){var obj=options.colorToAsin[color];
if(!(obj&&obj.asin)){return;
}$.ajax({url:"/gp/product/features/apparel-main-image/videos.html",data:{asin:obj.asin,productGroupID:options.productGroupID,useAiryVideoPlayer:true,useChromelessVideoPlayer:options.useChromelessVideoPlayer,isUDP:options.isUDP},dataType:"json",timeout:4000,success:function(data){if(data){colorToVideo[color]=data;
A.trigger("image-block-video-fetch-completed",color);
}}});
}utils.getVideos=function(color){if(options.useChildVideos){if(color==landingColor){color=options.defaultColor;
}if(!colorToVideo[color]){colorToVideo[color]=[];
fetchChildVideos(color);
}return colorToVideo[color];
}return options.videos;
};
utils.getBestUrlForAvailableWidth=function(dynamicImages){var maxWidth=0;
var bestSlateImage;
$.each(dynamicImages,function(url,size){if(size[0]>maxWidth){bestSlateImage=url;
maxWidth=size[0];
}});
return bestSlateImage;
};
utils.getMaxWidthOfSlateImages=function(dynamicImages){var maxWidth=0;
$.each(dynamicImages,function(url,size){var width=parseInt(size[0],10);
if(width>maxWidth){maxWidth=width;
}});
return maxWidth;
};
utils.getMaxHeightOfSlateImages=function(dynamicImages){var maxHeight=0;
$.each(dynamicImages,function(url,size){var height=parseInt(size[1],10);
if(height>maxHeight){maxHeight=height;
}});
return maxHeight;
};
utils.getMaxWidthOfMainImage=function(mainImageHash){var maxWidth=itemContainer.width();
var imageWidth=utils.getMaxWidthOfSlateImages(mainImageHash);
if(imageWidth>0){maxWidth=Math.min(maxWidth,imageWidth);
}return maxWidth;
};
utils.getMaxHeightOfMainImage=function(mainImageHash){var maxHeight=itemContainer.height();
var imageHeight=utils.getMaxHeightOfSlateImages(mainImageHash);
if(imageHeight>0){maxHeight=Math.min(maxHeight,imageHeight);
}return maxHeight;
};
utils.getColorFromState=function(variationsState){if(!variationsState){return;
}var colorName="";
var variationLabels=DetailPage.StateController.getState()["variation_display_labels"];
$.each(options.visualDimensions,function(i,dim){var label=(options.gIsNewTwister==1)?dim:variationLabels[dim];
if(variationsState[label]){colorName+=" "+variationsState[label];
}});
return colorName&&colorName.substring(1);
};
utils.isBuyableVariation=function(dpState){if(!dpState.current_hovered_asin){var numDims=dpState.num_variation_dimensions;
return dpState.num_dimensions_selected!=numDims&&dpState.num_dimensions_hovered!=numDims;
}return true;
};
utils.showUnavailableExp=function(unavailableColor){if(unavailableColor){$("#imageBlock .unvailableVariation").html(unavailableColor);
$("#imageBlock .variationUnavailable").show();
}};
utils.hideUnavailableExp=function(){$("#imageBlock .unavailableExp").hide();
};
utils.setImageCaption=function(color,type,index,thumbnailIndex,timeoutMillis,mouseIn){if(captionTimeout){clearTimeout(captionTimeout);
}captionTimeout=null;
if(timeoutMillis){captionTimeout=setTimeout(function(){utils.setImageCaption(color,type,thumbnailIndex);
},timeoutMillis);
}var canvasCaptionEl=$("#image-canvas-caption #canvasCaption");
if(type!=="image"){canvasCaptionEl.html("");
return;
}var staticStrings=options.staticStrings;
var caption="";
if(mouseIn&&options.useIV){caption=staticStrings["clickToExpand"];
}else{if(colorImages[color]&&colorImages[color][index].hiRes&&options.useHoverZoom){if(options.hoverZoomIndicator&&options.useHoverZoomIpad){caption="<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+staticStrings["touchToZoom"];
}else{if(options.useHoverZoomIpad){caption=staticStrings["touchToZoom"];
}else{if(options.hoverZoomIndicator){caption="<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+staticStrings["rollOverToZoom"];
}else{if(options.useClickZoom){caption=staticStrings["clickToZoom"];
}else{caption=staticStrings["rollOverToZoom"];
}}}}}else{if(options.useIV){caption=staticStrings["clickToExpand"];
}}}canvasCaptionEl.html(caption);
};
utils.getSlateImage=function(color){return options.useChildVideos&&options.colorToAsin[color].slate[0];
};
utils.init=function(opts){utils.options=options=opts;
colorImages=options.colorImages;
landingColor=options.landingColor||options.defaultColor;
colorToVideo={};
colorToVideo[options.defaultColor]=options.videos;
return utils;
};
if(typeof JSON!=="object"){JSON={};
}(function(){function f(n){return n<10?"0"+n:n;
}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null;
};
String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();
};
}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
function quote(string){escapable.lastIndex=0;
return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];
return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
})+'"':'"'+string+'"';
}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];
if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key);
}if(typeof rep==="function"){value=rep.call(holder,key,value);
}switch(typeof value){case"string":return quote(value);
case"number":return isFinite(value)?String(value):"null";
case"boolean":case"null":return String(value);
case"object":if(!value){return"null";
}gap+=indent;
partial=[];
if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;
for(i=0;
i<length;
i+=1){partial[i]=str(i,value)||"null";
}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";
gap=mind;
return v;
}if(rep&&typeof rep==="object"){length=rep.length;
for(i=0;
i<length;
i+=1){if(typeof rep[i]==="string"){k=rep[i];
v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);
if(v){partial.push(quote(k)+(gap?": ":":")+v);
}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";
gap=mind;
return v;
}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;
gap="";
indent="";
if(typeof space==="number"){for(i=0;
i<space;
i+=1){indent+=" ";
}}else{if(typeof space==="string"){indent=space;
}}rep=replacer;
if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify");
}return str("",{"":value});
};
}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;
function walk(holder,key){var k,v,value=holder[key];
if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);
if(v!==undefined){value[k]=v;
}else{delete value[k];
}}}}return reviver.call(holder,key,value);
}text=String(text);
cx.lastIndex=0;
if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);
});
}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");
return typeof reviver==="function"?walk({"":j},""):j;
}throw new SyntaxError("JSON.parse");
};
}}());
return utils;
});
P.when("A","jQuery").register("imageMagnifier",function(A,$){function hoverZoomBoundInDPX(useClickZoom){var b={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};
var lc=$("#leftCol"),cc=$("#centerCol"),ccHze=$("#hover-zoom-end");
b.top=cc.offset().top;
if(!useClickZoom){b.left=lc.offset().left+lc.outerWidth();
}else{b.left=0;
}b.right=$("#rightCol").offset().left;
b.bottom=cc.outerHeight()+b.top;
if(ccHze&&ccHze.offset().top>b.bottom){b.bottom=ccHze.offset().top;
}return b;
}function parseMediaServerCodes(url){var m=url.match(/\._((\w|,|\.)+)_\.(gif|jpg|png)$/i);
var codes={};
if(m){var mediaServerCodes=m[1].split("_");
for(var i=0;
i<mediaServerCodes.length;
i++){var m2=mediaServerCodes[i].match(/^([A-Z]+)(\d+(\.\d+)?)$/);
if(m2){codes[m2[1]]=Number(m2[2]);
}}}return codes;
}$.fn.amazonMagnifier=function(options){var navImage=this;
var defaultOptions={detailImageUrl:navImage.attr("data-old-hires"),location:"over",locationElement:navImage,prelaod:"ready",zIndex:50,offsetInClickZoom:50};
options=$.extend(defaultOptions,options);
options.adjustment=[10,0,-10,0];
var zoomWindow=null;
var lens=null;
var cursorAt=null;
var navImageRect=null;
var bounds=null;
var preloaded={"null":1,"":1,"undefined":1};
var engaged=false;
var magnifierSuppressed=false;
var currentDetailImageUrl=options.detailImageUrl;
var isIE6=$.browser.msie&&parseInt($.browser.version)<=6;
var hiddenSelects;
var hoverZoomIpad=options.useHoverZoomIpad||0;
var hoverOnLoad=0;
var urlsLogged={};
var isIE=navigator.userAgent.match(/msie|trident/i);
var Lens=function(){var self=this;
var size=[0,0];
var zoomRatio=(zoomWindow.detailSize&&zoomWindow.detailSize[0]||500000000)/navImageRect[2];
var zoomHtRatio=(zoomWindow.detailSize&&zoomWindow.detailSize[1]||500000000)/navImageRect[3];
if(zoomHtRatio>zoomRatio){zoomRatio=zoomHtRatio;
}$("#magnifierLens").remove();
var jq=$("<div id='magnifierLens' />").css({backgroundImage:"url("+options.generalImageUrls.zoomLensBackground+")",position:"absolute",cursor:"pointer"});
function updateSize(ratio){var width=Math.round(Math.min(navImage.width(),zoomWindow.rect.width/ratio));
var height=Math.round(Math.min(navImage.height(),zoomWindow.rect.height/ratio));
jq.css({width:width,height:height});
size=[width,height];
}self.updatePosition=function(){var range=[navImageRect[2]-size[0],navImageRect[3]-size[1]];
var u=range[0]<=0?0.5:Math.max(0,Math.min(1,(cursorAt[0]-size[0]/2-navImageRect[0]-self.offset.left)/range[0]));
var v=range[1]<=0?0.5:Math.max(0,Math.min(1,(cursorAt[1]-size[1]/2-navImageRect[1]-self.offset.top)/range[1]));
var x=navImageRect[0]+Math.round(u*range[0]);
var y=navImageRect[1]+Math.round(v*range[1]);
jq.get(0).style.left=x+"px";
jq.get(0).style.top=y+"px";
return[u,v];
};
self.destroy=function(){jq.remove();
};
self.offset=navImage.offsetParent().offset();
updateSize(zoomRatio);
self.updatePosition();
jq.appendTo(navImage.parent());
if(!zoomWindow.detailImage[0].complete){zoomWindow.detailImage.load(function(){var zoomRatio=zoomWindow.detailImage.width()/navImageRect[2];
updateSize(zoomRatio);
self.updatePosition();
});
}};
Lens.preload=function(){navImage.preload(options.generalImageUrls.lensBackgroundUrl);
};
var ZoomWindow=function(){var zw=this;
var adjustment=options.adjustment;
$("#zoomWindow").remove();
var cropWindow=$("<div id='zoomWindow' />").css({overflow:"hidden",position:"absolute",backgroundColor:"white",zIndex:options.zIndex});
if(options.useClickZoom){if(isIE){cropWindow.css("cursor",'url("'+options.zoomOutIcon+'"), auto');
}else{cropWindow.css("cursor","-webkit-zoom-out");
cropWindow.css("cursor","-moz-zoom-out");
cropWindow.css("cursor","zoom-out");
}}function fit(){var rect=new Object();
if(options.location=="over"){if($("#centerCol").length>0){rect=hoverZoomBoundInDPX(options.useClickZoom);
}else{if($(".productImageGrid").length>0){rect=hoverZoomBound();
}else{rect.left=0;
rect.right=0;
}}}else{if(options.location=="right"){var o=navImage.offset();
rect={left:o.left+navImage.outerWidth(),top:o.top,right:o.left+navImage.outerWidth()+400,bottom:o.top+400};
}}if(options.minHeightElement){rect.bottom=Math.max(rect.bottom,rect.top+$(options.minHeightElement).outerHeight());
}rect.bottom=Math.min(rect.bottom,$(window).scrollTop()+$(window).height());
rect.left+=adjustment[0];
rect.top+=adjustment[1];
rect.right+=adjustment[2];
rect.bottom+=adjustment[3];
rect.width=rect.right-rect.left;
rect.height=rect.bottom-rect.top;
cropWindow.css({left:rect.left,top:rect.top,width:rect.width,height:rect.height});
zw.rect=rect;
return zw;
}function updateDetailSize(img){var imageObj=new Image();
imageObj.src=img.attr("src");
if(imageObj.width>0&&imageObj.height>0){zw.detailSize=[imageObj.width,imageObj.height];
return;
}else{if(options.detailImageSize){zw.detailSize=options.detailImageSize;
return;
}}var codes=parseMediaServerCodes(imageObj.src);
var aspectRatio=navImageRect[2]/navImageRect[3];
if(codes["SS"]||codes["AA"]){var size=codes["SS"]||codes["AA"];
zw.detailSize=[size,size];
}else{if(codes["SX"]){zw.detailSize=[codes["SX"],Math.round(codes["SX"]/aspectRatio)];
}else{if(codes["SY"]){zw.detailSize=[Math.round(codes["SY"]*aspectRatio),codes["SY"]];
}else{if(codes["SL"]){if(aspectRatio>=1){zw.detailSize=[codes["SL"],Math.round(codes["SL"]/aspectRatio)];
}else{zw.detailSize=[Math.round(codes["SL"]*aspectRatio),codes["SL"]];
}}else{zw.detailSize=[0,0];
imageObj.onload=function(){zw.detailSize=[imageObj.width,imageObj.height];
updateDetailPosition();
};
}}}}}zw.updateImage=function(src){var img=$("<img id='detailImg' src='"+src+"'/>").css("position","absolute");
zw.detailImage&&zw.detailImage.remove();
cropWindow.append(img);
$(document).trigger("updated.magnifier");
zw.detailImage=img;
updateDetailSize(zw.detailImage);
};
zw.refit=function(){fit();
updateDetailSize(zw.detailImage);
return zw;
};
zw.show=function(){cropWindow.show();
return zw;
};
zw.hide=function(){cropWindow.hide();
return zw;
};
zw.destroy=function(){cropWindow.remove();
return zw;
};
zw.getWindowSize=function(){return[zw.rect.left,zw.rect.top,zw.rect.width,zw.rect.height];
};
zw.updateImage(currentDetailImageUrl);
fit();
cropWindow.appendTo(document.body);
};
function updateDetailPosition(){var pos;
if(options.useClickZoom){var off=options.offsetInClickZoom;
pos=[Math.min(1,Math.max(0,cursorAt[0]-(bounds[0]+off))/(bounds[2]-2*off)),Math.min(1,Math.max(0,cursorAt[1]-(bounds[1]+off))/(bounds[3]-2*off))];
}else{pos=lens&&lens.updatePosition();
}if(pos&&zoomWindow.detailSize){var range=[zoomWindow.detailSize[0]-zoomWindow.rect.width,zoomWindow.detailSize[1]-zoomWindow.rect.height];
zoomWindow.detailImage.get(0).style.left=-(pos[0]*range[0])+"px";
zoomWindow.detailImage.get(0).style.top=-(pos[1]*range[1])+"px";
}}function locateCursor(e){var touch=hoverZoomIpad?(e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]):"";
cursorAt=hoverZoomIpad?[touch.pageX,touch.pageY]:[e.pageX,e.pageY];
}function onMouseMove(e){if(hoverZoomIpad){e.preventDefault();
}locateCursor(e);
var boundRect;
if(options.useClickZoom){boundRect=[bounds[0],bounds[1],bounds[0]+bounds[2],bounds[1]+bounds[3]];
}else{var offset=lens?lens.offset:navImage.offsetParent().offset();
boundRect=[navImageRect[0]+offset.left,navImageRect[1]+offset.top,navImageRect[0]+navImageRect[2]+offset.left,navImageRect[1]+navImageRect[3]+offset.top];
}if(cursorAt[0]<boundRect[0]||cursorAt[1]<boundRect[1]||cursorAt[0]>=boundRect[2]||cursorAt[1]>=boundRect[3]){if(!options.useClickZoom){disengage();
}}else{updateDetailPosition();
}}function hideSelects(){var selects=$(options.locationElement).find("select:visible");
if(isIE6){hiddenSelects=selects.hide();
}else{$("select").each(function(){$(this).blur();
});
}}function showSelects(){hiddenSelects&&hiddenSelects.show();
}function disengage(shouldBind){if(shouldBind){navImage.suppressMagnifier(true);
}if(!engaged){return;
}if($.browser.msie){$("#main-image-widget .holder.video").show();
}showSelects();
zoomWindow&&zoomWindow.hide();
if(lens){lens.destroy();
lens=null;
}engaged=false;
if(hoverZoomIpad){navImage.unbind("touchmove.magnifier touchstart.magnifier touchend.magnifier");
$(document).trigger("disengaged.magnifier");
}else{$(document).unbind("mousemove.magnifier").trigger("disengaged.magnifier");
}bindEvents();
if(shouldBind){navImage.one("click.magnifier touchstart.magnifier",function(e){engage(e,true);
});
}}function engage(e,shouldBind){if(shouldBind){navImage.suppressMagnifier(false);
}if(engaged||magnifierSuppressed){return;
}if(document.body){$(document.body).trigger("click");
}if(options.logMetrics){if(hoverOnLoad==0){var hoverEngageTime=new Date();
var timeDiff=hoverEngageTime-window.ue.t0;
$.imageBlock.logger.logKeyValuePair("hoverTime",timeDiff);
hoverOnLoad=1;
}if(!urlsLogged[currentDetailImageUrl]){$.imageBlock.logger.logHit("hoverMain");
urlsLogged[currentDetailImageUrl]=1;
}}navImageRect=[navImage.position().left,navImage.position().top,navImage.width(),navImage.height()];
if($.browser.msie){$("#main-image-widget .holder.video").hide();
}if(currentDetailImageUrl){if($.browser.msie&&!$.isReady){$("#main-image-widget .holder.video").show();
return;
}hideSelects();
locateCursor(e);
if(zoomWindow){zoomWindow.refit().show();
}else{zoomWindow=new ZoomWindow();
}if(!options.useClickZoom){lens=lens||new Lens();
}bounds=zoomWindow.getWindowSize();
updateDetailPosition();
}engaged=true;
if(hoverZoomIpad){navImage.unbind("touchstart.magnifier touchmove.magnifier").bind("touchmove.magnifier",onMouseMove).bind("touchend.magnifier",disengage);
$(document).trigger("engaged.magnifier");
}else{navImage.unbind("mousemove.magnifier");
$(document).trigger("engaged.magnifier").bind("mousemove.magnifier",onMouseMove);
}if(shouldBind){var zoomImage=$("#zoomWindow");
if(zoomImage.length>0){zoomImage.one("click.magnifier touchend.magnifier",function(e){disengage(true);
});
}}}function unBindEvents(){navImage.unbind("touchstart touchstart.magnifier touchmove.magnifier mousemove.magnifier");
$(document).unbind("mousemove.magnifier");
}function bindEvents(){if(options.useHoverZoom){if(hoverZoomIpad){navImage.bind("touchstart.magnifier touchmove.magnifier",engage);
}else{navImage.bind("mousemove.magnifier",engage);
}}}navImage.preload=function(urls){var urlArray=$.makeArray(urls);
var length=urlArray.length;
for(var i=0;
i<length;
i++){if(urlArray[i] instanceof Array){navImage.preload(urlArray[i]);
}else{if(typeof urlArray[i]=="string"&&urlArray[i]&&!preloaded[urlArray[i]]){preloaded[urlArray[i]]=new Image();
preloaded[urlArray[i]].src=urlArray[i];
}}}};
navImage.changeImage=function(navImageUrl,detailImageUrl){if(engaged){disengage();
}currentDetailImageUrl=detailImageUrl;
navImage.attr("src",navImageUrl);
if($.browser.msie){navImage.get(0).className=navImage.get(0).className;
}navImage.preload(navImageUrl);
navImageRect=[navImage.position().left,navImage.position().top,navImage.width(),navImage.height()];
if(detailImageUrl){if(options.preload=="immediately"){navImage.preload(detailImageUrl,true);
}else{$(window).ready(function(){navImage.preload(detailImageUrl);
});
}if(zoomWindow){zoomWindow.updateImage(detailImageUrl);
}else{navImage.attr("data-old-hires",detailImageUrl);
}}};
navImage.destroy=function(){unBindEvents();
lens&&lens.destroy();
lens=null;
zoomWindow&&zoomWindow.destroy();
zoomWindow=null;
};
navImage.detailImage=function(){return zoomWindow.detailImage;
};
navImage.suppressMagnifier=function(suppress){magnifierSuppressed=suppress;
};
navImage.isEngaged=function(){return engaged;
};
navImage.engageMagnifier=engage;
navImage.disengageMagnifier=disengage;
navImage[0].complete?bindEvents():navImage.one("load",bindEvents);
navImage.preload(this.attr("src"));
if(options.preload){var url=options.detailImageUrl;
var preloadMagnifier=function(){navImage.preload(url,true);
if(!options.useClickZoom){Lens.preload();
}};
var eventNames=options.preload;
if(eventNames.constructor!=Array){eventNames=[eventNames];
}for(var i=0;
i<eventNames.length;
i++){if(eventNames[i]=="immediately"){preloadMagnifier();
}else{if($(window)[eventNames[i]]){$(window)[eventNames[i]](preloadMagnifier);
}else{$(window).bind(eventNames[i],preloadMagnifier);
}}}}return navImage;
};
});
P.when("A","jQuery","ImageBlockBTF").register("immersiveView",function(A,$,imageBlockData){var isChromelessVideoPlayer;
var ivTitle;
var ivImageSet;
var ivVideoSet;
var ivCurrentVideoSelected;
var ivCurrentImageSelected;
var ivCurrentSelectedColor;
var ivCurrentAltImageIndexSelected=0;
var ivCurrentAltImageIndexType;
var iVData;
var ivUtils;
var ivMediaUrls;
var ivWidthAdjustment=42;
var ivHeightAdjustment=125;
var ivThumbSectionHeightAdjustment=210;
var ivVideoListHeightAdjustment=30;
var ivIsIVOpened=false;
var ivVideoInfoPopover;
var ivImageLoadState={};
var ivSpinnerLength=104;
var ivSpinnerWidth=80;
var ivLeftCol;
var ivIsImageLoading=false;
var ivIsLargeMode=false;
var ivFullImageWidth;
var ivFullImageHeight;
var ivMaxAlts=0;
var ivInitialOffset={left:0,top:0};
var ivMaxOffset={};
var ivVideoMarginSet=false;
var ivFullImageLarge;
var ivCursorStart=[0,0];
var DEFAULT_FULL_SCREEN_MOVE_FACTOR=4;
var ivFullScreenMoveFactor=DEFAULT_FULL_SCREEN_MOVE_FACTOR;
var ivAlwaysIncludeVideo=0;
var ivIsPlayingVideo=false;
var ivPlayerOnIV=new Object();
var ivDpPlayers={mediaIDs:[],playerDivs:[]};
var vidContainer;
var availableVideos=[];
var airyInstance;
var airyConfig;
var logger;
function selectThumbnail(){if(ivCurrentImageSelected>=0){$("#ivimage_"+ivCurrentImageSelected).click();
}else{if(ivCurrentVideoSelected>=0){$("#ivvideo_"+ivCurrentVideoSelected).click();
}else{$("#ivimage_0").click();
}}return;
}this.iVController=function(e,data,imageBlockUtils,imageBlockLogger){if(e==null||data==null||imageBlockUtils==null){return;
}if(!ivUtils){ivUtils=imageBlockUtils;
}if(!isIvApplicable(data)){return;
}if(!logger){logger=imageBlockLogger;
}if(shouldInitializeAgain()){initializeIV(e,data);
clearcache();
createImmersiveView();
}else{initializeSelection(e);
$("#iv_media_select").val("all");
$(".iv_thumb_videos").hide();
$(".iv_thumbs").show();
$(".iv_type_video").show();
}$.AmazonPopover.displayPopover(getIVPopoverOptions());
};
var initializeSelection=function(e){var altImageSelectedDataInfo=getAltImageIndexSelected(e);
ivCurrentAltImageIndexSelected=altImageSelectedDataInfo.thumbnailIndex;
ivCurrentAltImageIndexType=altImageSelectedDataInfo.type;
if(ivCurrentAltImageIndexType=="image"){ivCurrentImageSelected=altImageSelectedDataInfo.index;
ivCurrentVideoSelected=-1;
}else{ivCurrentImageSelected=-1;
ivCurrentVideoSelected=altImageSelectedDataInfo.index;
}};
var shouldInitializeAgain=function(){if(!ivCurrentSelectedColor){return true;
}else{if(isTwisterPage()){if(typeof DetailPage!="undefined"&&DetailPage.StateController){var currentSelectedColor=ivUtils.getColorFromState(DetailPage.StateController.getState()["selected_variations"]);
if(currentSelectedColor==ivCurrentSelectedColor){return false;
}}}else{return false;
}}return true;
};
var isTwisterPage=function(){if(typeof isTwisterPage!="undefined"&&isTwisterPage){return true;
}return false;
};
function clearcache(){if(iVData){iVData.remove();
}}var initializeIV=function(e,data){initializeSelection(e);
ivCurrentSelectedColor=getCurrentSelectedColor(data);
ivImageSet=getImages(data.colorImages);
window.ivStrings=data.staticStrings;
ivTitle=data.title;
ivMediaUrls=data.staticImages;
ivAlwaysIncludeVideo=data.alwaysIncludeVideo;
isChromelessVideoPlayer=data.useChromelessVideoPlayer;
ivMaxAlts=data.maxAlts;
airyConfig=data.airyConfig;
availableVideos=ivUtils.getVideos(ivCurrentSelectedColor)||availableVideos;
};
function constructLeftColumn(){ivLeftCol=$('<div id="iv-first-column" style="float: left; width:'+($(window).width()-ivWidthAdjustment-330)+'px;height:100%; margin-right: 15px;"/>');
var imgContainer=$('<div width="100%" id="iv-large-image" style="overflow: hidden; width: 100%; height: '+($(window).height()-ivHeightAdjustment-15)+'px;align:center; position:relative; top:0px; left:0px;"/>');
vidContainer=createVideoContainer();
if(ivCurrentAltImageIndexType!=="image"){imgContainer.css("display","none");
}ivLeftCol.append(imgContainer);
ivLeftCol.append(vidContainer);
iVData.append(ivLeftCol);
}function createVideoContainer(){return $("<div></div>").attr("id","iv-large-video").css({overflow:"hidden",width:"100%",height:"100%",align:"center"});
}function constructTitle(rightCol){var style='<style type="text/css">a.iv-title-link:link {text-decoration: none;}a.iv-title-link:visited {text-decoration: none; color: #003399}a.iv-title-link:hover {text-decoration: underline; color: orange;}</style>';
$(style).appendTo("head");
var titleHtml='<div style="text-align: left; margin-top: 10px; font-family: verdana, arial, helvetica, sans-serif; font-size: 14px; font-weight: bold; '+'word-wrap: break-word; width: 235px;" id="iv-prod-title" title="'+ivTitle+'">'+'<a class="ap_custom_close iv-title-link" href="">'+trimWithEllipsis(ivTitle,45)+"</a></div>";
var titleBar=$(titleHtml);
titleBar.find(".ap_custom_close").click(detachAiryAndSaveVolume);
rightCol.append(titleBar);
}function constructVariationColor(rightCol){if(!ivCurrentSelectedColor){return;
}if(typeof DetailPage!="undefined"&&DetailPage.StateController){var varSelectionHtml='<div style="text-align: left;"  id="iv-variation-selection">';
var pageState=DetailPage.StateController.getState();
var labels=pageState["variation_label_order"];
var labelCount=0;
for(var i in labels){var label=labels[i];
var labelValue=pageState["selected_variations"][label];
var labelKey=pageState["variation_display_labels"][label];
if(labelValue){varSelectionHtml+='<div style="padding-top:10px; padding-bottom:3px; font-family: verdana, arial, helvetica, sans-serif; font-size:11px; color:#666">'+labelKey+" : "+labelValue+"</div>";
}}varSelectionHtml+="</div>";
var variationSelection=$(varSelectionHtml);
rightCol.append(variationSelection);
}}function constructMediaSelection(rightCol){var tabHtml='<div style="width:235px; border:1px solid #C9E1F4; background-color:#EAF3FD; padding-top: 5px; padding-bottom: 5px; margin-top:15px; display: none" id="iv-tabbing">';
tabHtml+='<select id="iv_media_select" style="position:relative;left:65px">';
tabHtml+='<option id="all" value="all" selected>'+ivStrings["allMedia"]+"</option>";
tabHtml+='<option id="images" value="images">'+ivStrings["images"]+"</option>";
tabHtml+='<option id="videos" value="videos">'+ivStrings["videos"]+"</option>";
tabHtml+="</select>";
if($.browser.msie){tabHtml+='<span class="swSprite s_boxLeft" style="top: -14px; left: -102px; display: none;"> </span>  <span class="swSprite s_boxRight" style="top: -14px; left: 111px; display: none;"> </span>';
}else{tabHtml+='<span class="swSprite s_boxLeft" style="top: -12px; left: -102px; display: none;"> </span>  <span class="swSprite s_boxRight" style="top: -12px; left: 108px; display: none;"> </span>';
}tabHtml+="</div>";
var mediaSelection=$(tabHtml);
rightCol.append(mediaSelection);
}function constructThumbs(rightCol){var style='<style type="text/css">.iv_thumbs { border:1px solid #C9E1F4;width:235px;height:290px;padding-left:15px;padding-top:15px;padding-bottom:15px; overflow-y:auto; border-top:0px;position:relative; top:0px; left:0px; }.iv_thumb_videos {  border:1px solid #C9E1F4;width:235px;height:230px;padding:0px; overflow-y:auto; border-top:0px; }.iv_thumb_video_outer { float:left; width:100%; padding-top:5px; padding-bottom:5px;cursor:pointer}.iv_thumb_video_outer_hover { background-color: #EAF3FD }.iv_thumb_video { border: 1px solid #ddd;float:left; margin-left:10px;margin-right:10px;cursor:pointer; }.iv_thumb { border: 1px solid #ddd;float:left; margin-right:12px; margin-bottom:20px; cursor:pointer; }.iv_thumb_selected { border: 2px solid #E47911; }.iv_thumb_hover { border: 2px solid #004B91; }.iv_thumb_inner { padding: 1px;float:left; }.iv_thumb_inner_selected { padding: 0px; }.iv_thumb_image { float:left;position:relative;width:50px; height:50px; background-color:#ffffff}.iv_thumb_text { float:left; word-wrap:break-word; width:130px; margin-top:10px; font-family:verdana, arial, helvetica, sans-serif; font-size:11px }.iv_thumb_text_popover { font-family: verdana, arial, helvetica, sans-serif; font-size:11px }.iv_thumb_text_hover { background-color: #EAF3FD }</style>';
$(style).appendTo("head");
var thumbHtml="<div class='iv_thumbs'>";
thumbHtml+="</div>";
thumbHtml+="<div class='iv_thumb_videos' style='display: none; height: 63px;'>";
thumbHtml+="</div>";
var thumbs=$(thumbHtml);
rightCol.append(thumbs);
prefetchResources();
}function prefetchResources(){$("<img>").attr("src",""+ivMediaUrls["arrow"]+"");
$("<img>").attr("src",""+ivMediaUrls["zoomIn"]+"");
$("<img>").attr("src",""+ivMediaUrls["zoomOut"]+"");
}function constructRightColumn(){var rightCol=$('<div style="float: left; width: 235px;" id="iv-sec-column"></div>');
constructTitle(rightCol);
constructVariationColor(rightCol);
constructMediaSelection(rightCol);
constructThumbs(rightCol);
iVData.append(rightCol);
}function addHandlers(){$("#addIV-Main").click(function(){$("#iv_media_select").css("visibility","visible");
});
$(window).resize(function(){if(ivIsIVOpened){resizeIV();
}});
addThumbHandlers();
}function addThumbHandlers(){$(".iv_thumb").click(function(event){$(".iv_thumb").removeClass("iv_thumb_selected");
$(".iv_thumb").removeClass("iv_thumb_hover");
$(".iv_thumb").find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
$(this).addClass("iv_thumb_selected");
$(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
if($(this).hasClass("iv_type_video")){ivCurrentVideoSelected=$(this).attr("id").split("_")[1];
ivCurrentImageSelected=-1;
playVideo();
}else{ivCurrentImageSelected=$(this).attr("id").split("_")[1];
ivCurrentVideoSelected=-1;
changeMainImage();
}});
$(".iv_thumb_video_outer").click(function(event){$(".iv_thumb_video").removeClass("iv_thumb_selected");
$(".iv_thumb_video").removeClass("iv_thumb_hover");
$(".iv_thumb_video").find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
$(this).find(".iv_thumb_video").addClass("iv_thumb_selected");
$(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
ivCurrentVideoSelected=$(this).attr("id").split("_")[1];
ivCurrentImageSelected=-1;
playVideo();
});
$(".iv_thumb").mouseover(function(event){if(ivVideoInfoPopover){ivVideoInfoPopover.close();
}if(!$(this).hasClass("iv_thumb_selected")){$(this).addClass("iv_thumb_hover");
$(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
}if($(this).hasClass("iv_type_video")){var videoIndex=Number($(this).attr("id").split("_")[1]);
if(videoIndex>=availableVideos.length){return;
}var selectedVideo=availableVideos[videoIndex];
var videoContent="<span class='iv_thumb_text_popover'><b>"+selectedVideo.title+"</b><br>"+selectedVideo.durationTimestamp+"</span>";
var leftOffset=(($(this).offset().left-$(".iv_thumbs").offset().left)<=30)?-27:-50;
var topOffset=-11;
if($.browser.msie&&parseInt($.browser.version)==6){topOffset=-16;
}ivVideoInfoPopover=$.AmazonPopover.displayPopover({literalContent:videoContent,width:180,location:["top"],locationElement:this,locationAlign:"middle",locationOffset:[leftOffset,topOffset],zIndex:1000,hoverShowDelay:300,hoverHideDelay:300,showCloseButton:false,attached:true,modal:false});
if($.browser.msie&&parseInt($.browser.version)==6){ivVideoInfoPopover.find(".ap_footer").find(".ap_middle").css({position:"relative",height:"30px",width:"112px",top:"-2px",background:"url("+ivMediaUrls["arrow"]+") -343px -40px"});
}else{ivVideoInfoPopover.find(".ap_footer").find(".ap_middle").css({position:"relative",height:"30px",width:"112px",top:"-3px",background:"url("+ivMediaUrls["arrow"]+") -343px -43px"});
}}});
$(".iv_thumb_video_outer").mouseover(function(event){$(this).addClass("iv_thumb_video_outer_hover");
$(this).find(".iv_thumb_text").addClass("iv_thumb_text_hover");
if(!$(this).find(".iv_thumb_video").hasClass("iv_thumb_selected")){$(this).find(".iv_thumb_video").addClass("iv_thumb_hover");
$(this).find(".iv_thumb_inner").addClass("iv_thumb_inner_selected");
}});
$(".iv_thumb").mouseout(function(event){if(!$(this).hasClass("iv_thumb_selected")){$(this).removeClass("iv_thumb_hover");
$(this).find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
}if(ivVideoInfoPopover){ivVideoInfoPopover.close();
}});
$(".iv_thumb_video_outer").mouseout(function(event){$(this).removeClass("iv_thumb_video_outer_hover");
$(this).find(".iv_thumb_text").removeClass("iv_thumb_text_hover");
if(!$(this).find(".iv_thumb_video").hasClass("iv_thumb_selected")){$(this).find(".iv_thumb_video").removeClass("iv_thumb_hover");
$(this).find(".iv_thumb_inner").removeClass("iv_thumb_inner_selected");
}});
$("#ap_container").keydown(function(event){if(event.keyCode==37||event.keyCode==38||event.keyCode==39||event.keyCode==40||event.keyCode==33||event.keyCode==34){return false;
}});
}function detachAiryAndSaveVolume(){if(!airyInstance||airyInstance.isDetached()){return;
}airyConfig.volume=airyInstance.getVolume();
airyInstance.detach();
if(!!document.all&&!window.atob&&!document.addEventListener){airyInstance=null;
}}function changeMainImage(){if(airyInstance){airyInstance.hide();
}$("#iv-large-image").css("display","block");
var currentDetailImageUrl="";
if(ivImageSet&&ivImageSet[ivCurrentSelectedColor]&&ivImageSet[ivCurrentSelectedColor].images){currentDetailImageUrl=ivImageSet[ivCurrentSelectedColor].images.zoomImages[ivCurrentImageSelected];
}if(!currentDetailImageUrl){return;
}if(iVData.find(".fullScreen")){iVData.find(".fullScreen").remove();
}ivFullImageLarge="<img src='"+currentDetailImageUrl+"'class='fullScreen'/>";
var ivFullImageFit=$("<img>").attr("src",currentDetailImageUrl);
ivFullImageFit.addClass("fullScreen");
var largeImage=$("#iv-large-image");
largeImage.animate({opacity:0.4},200,function(){ivFullImageFit.load(function(){loadImage();
});
$(ivFullImageLarge).load(function(){loadImage();
});
if(!ivImageLoadState[ivFullImageFit.attr("src")]){ivIsImageLoading=true;
largeImage.empty();
var top=(ivLeftCol.height()-ivSpinnerLength)/2;
var left=(ivLeftCol.width()-ivSpinnerWidth)/2;
$("#iv-large-image").append("<img src='"+ivMediaUrls["spinner"]+"' style='position:relative;top:"+top+"px;left:"+left+"px;' />");
}else{loadImage();
}});
ivFullImageFit.load(function(){ivImageLoadState[ivFullImageFit.attr("src")]=1;
prefetchImages();
});
$(ivFullImageLarge).load(function(){ivImageLoadState[ivFullImageFit.attr("src")]=1;
prefetchImages();
});
function loadImage(){ivIsImageLoading=false;
largeImage.css("visibility","hidden");
largeImage.empty();
largeImage.animate({opacity:1},200);
largeImage.append(ivFullImageFit);
imageFit();
ivIsPlayingVideo=false;
ivImageLoadState[ivFullImageFit.attr("src")]=1;
}}function imageFit(){ivIsLargeMode=false;
var ivLargeImage=$("#iv-large-image");
var ww=ivLargeImage.width();
var wh=ivLargeImage.height();
var fullImageFit=$("#iv-large-image").find(".fullScreen");
fullImageFit.removeAttr("style");
ivFullImageWidth=fullImageFit.width();
var maxImgaeSize=ivFullImageWidth;
ivFullImageHeight=fullImageFit.height();
maxImgaeSize=maxImgaeSize>ivFullImageHeight?maxImgaeSize:ivFullImageHeight;
if(fullImageFit.length>0){if(fullImageFit[0].naturalWidth){ivFullImageWidth=fullImageFit[0].naturalWidth;
maxImgaeSize=maxImgaeSize>ivFullImageWidth?maxImgaeSize:ivFullImageWidth;
}if(fullImageFit[0].naturalHeight){ivFullImageHeight=fullImageFit[0].naturalHeight;
maxImgaeSize=maxImgaeSize>ivFullImageHeight?maxImgaeSize:ivFullImageHeight;
}}ivLeftCol.css({"cursor":"auto"});
if(maxImgaeSize>=1000){if($.browser.mozilla){ivLeftCol.css({"cursor":"-moz-zoom-in"});
}else{ivLeftCol.css({"cursor":"url('"+ivMediaUrls["zoomIn"]+"'), auto"});
}}ivFullImageWidth=ivFullImageWidth==0?1:ivFullImageWidth;
ivFullImageHeight=ivFullImageHeight==0?1:ivFullImageHeight;
var scale=Math.min(ww/ivFullImageWidth,wh/ivFullImageHeight);
var fitHeight=ivFullImageHeight*scale;
var fitWidth=ivFullImageWidth*scale;
var imgHeight;
if(fitHeight<ivFullImageHeight){imgHeight=fitHeight-20;
}else{imgHeight=ivFullImageHeight;
}fullImageFit.css("height",imgHeight);
fullImageFit.css("width",Math.min(fitWidth,ivFullImageWidth));
var left=((ww-fullImageFit.width())/2);
var top=((wh-fullImageFit.height())/2);
fullImageFit.css("margin-top",top);
fullImageFit.css("margin-left",left);
$("#iv-large-image").css("visibility","visible");
}function prefetchImages(){for(var i=-3;
i<=3;
i++){var id=parseInt(ivCurrentImageSelected)+i;
if(id<0){continue;
}var imgURL=(ivImageSet&&ivImageSet[ivCurrentImageSelected])?ivImageSet[ivCurrentImageSelected].images.zoomImages[id]:"";
if(imgURL&&ivImageLoadState[imgURL]==undefined){var imgObject=$("<img>").attr("src",imgURL);
imgObject.load(function(){ivImageLoadState[$(this).attr("src")]=1;
});
}else{if(!imgURL){break;
}}}}function resizeIV(){var height=$(window).height()-ivHeightAdjustment;
var width=($(window).width()-ivWidthAdjustment);
if(height>230){$("#IV-Main").css({"height":(height)+"px"});
$("#iv-large-image").css({"height":(height-15)+"px"});
var thumbsSecHeight=(height-ivThumbSectionHeightAdjustment);
$(".iv_thumbs").css({"height":(thumbsSecHeight)+"px"});
$(".iv_thumb_videos").css({"height":(thumbsSecHeight+ivVideoListHeightAdjustment)+"px"});
}if(width>500){$("#IV-Main").parents(".ap_popover").css({"width":(width)+"px"});
$("#iv-first-column").css({"width":(width-330)+"px"});
}if(ivCurrentVideoSelected){return;
}imageFit();
}var createImmersiveView=function(){iVData=$('<div style="display:none;height:'+($(window).height()-ivHeightAdjustment)+'px; width:100%; padding: 0px 15px 15px 15px;" id="IV-Main"></div>');
constructLeftColumn();
constructRightColumn();
iVData.append('<div style="clear:both"/>');
$("#imageBlock_feature_div").before(iVData);
iVData.find("#iv-large-image").click(function(e){if(ivIsPlayingVideo){return;
}if(ivIsImageLoading){return;
}if(ivIsLargeMode){imageFit();
}else{ivInitialOffset=getFullScreenOffset(ivInitialOffset);
if((ivFullImageWidth>=1000)||(ivFullImageHeight>=1000)){var largeImage=ivLeftCol.find("#iv-large-image");
largeImage.empty().append(ivFullImageLarge);
iVData.find(".fullScreen").load(function(){largeMode();
positionImage(e);
});
}}});
iVData.find("#iv-first-column").mousemove(function(e){if(ivIsLargeMode){positionImage(e);
}});
prefetchResources();
populateMediaSelection();
populateRightColumn();
addHandlers();
resizeIV();
};
function positionImage(e){var newLeft=ivInitialOffset.left-(e.pageX-ivCursorStart[0])*ivFullScreenMoveFactor;
var newTop=ivInitialOffset.top-(e.pageY-ivCursorStart[1])*ivFullScreenMoveFactor;
var newOffset=getFullScreenOffset({left:newLeft,top:newTop});
iVData.find(".fullScreen").css({"left":newOffset.left,"top":newOffset.top});
}function largeMode(){if(!((ivFullImageWidth>=1000)||(ivFullImageHeight>=1000))){return;
}if($.browser.mozilla){ivLeftCol.css({"cursor":"-moz-zoom-out"});
}else{ivLeftCol.css({"cursor":"url('"+ivMediaUrls["zoomOut"]+"'), auto"});
}ivIsLargeMode=true;
var largeImage=ivLeftCol.find("#iv-large-image");
setupMaxOffset();
var centerHeight=ivLeftCol.height()/2;
var centerWidth=ivLeftCol.width()/2;
ivCursorStart=[largeImage.offset().left+centerWidth,largeImage.offset().top+centerHeight];
ivInitialOffset.top=centerHeight-ivFullImageHeight/2;
ivInitialOffset.left=centerWidth-ivFullImageWidth/2;
ivLeftCol.find(".fullScreen").css({position:"relative",left:ivInitialOffset.left,top:ivInitialOffset.top});
ivFullScreenMoveFactor=Math.max(ivFullImageHeight/ivLeftCol.height(),ivFullImageWidth/ivLeftCol.width());
ivFullScreenMoveFactor=Math.max(ivFullScreenMoveFactor,DEFAULT_FULL_SCREEN_MOVE_FACTOR);
}function setupMaxOffset(){var fullImageFit=iVData.find(".fullScreen");
ivFullImageWidth=fullImageFit.width();
ivFullImageHeight=fullImageFit.height();
ivMaxOffset.left=ivLeftCol.width()-ivFullImageWidth;
ivMaxOffset.top=ivLeftCol.height()-ivFullImageHeight;
}function getFullScreenOffset(offset){var newOffset=offset;
if(ivMaxOffset.left>0){newOffset.left=ivMaxOffset.left/2;
}else{if(offset.left<ivMaxOffset.left){newOffset.left=ivMaxOffset.left;
}else{if(offset.left>0){newOffset.left=0;
}}}if(ivMaxOffset.top>0){newOffset.top=ivMaxOffset.top/2;
}else{if(offset.top<ivMaxOffset.top){newOffset.top=ivMaxOffset.top;
}else{if(offset.top>0){newOffset.top=0;
}}}return newOffset;
}function populateMediaSelection(){var imageCount=0;
if(ivImageSet&&ivImageSet[ivCurrentSelectedColor]&&ivImageSet[ivCurrentSelectedColor].images&&ivImageSet[ivCurrentSelectedColor].images.thumbnails){imageCount=ivImageSet[ivCurrentSelectedColor].images.thumbnails.length;
}var videoCount=availableVideos?availableVideos.length:0;
var ivThumbs=$(".iv_thumbs");
var ivTabbing=$("#iv-tabbing");
if(imageCount==0||videoCount==0){ivTabbing.hide();
ivThumbs.css({"margin-top":"15px","border-top":"1px solid #C9E1F4"});
return;
}var mediaSelection=$("#iv_media_select");
mediaSelection.find("#all").text(ivStrings["allMedia"]+" ("+(imageCount+videoCount)+")");
mediaSelection.find("#videos").remove();
mediaSelection.find("#images").remove();
mediaSelection.append('<option id="images" value="images">'+ivStrings["images"]+" ("+(imageCount)+")</option>");
mediaSelection.append('<option id="videos" value="videos">'+ivStrings["videos"]+" ("+(videoCount)+")</option>");
ivTabbing.show();
ivThumbs.css({"margin-top":"0px","border-top":"0px"});
mediaSelection.val("all");
addMediaSelectionEvent();
}function addMediaSelectionEvent(){$("#iv_media_select").change(function(){if($(this).val()=="all"){$(".iv_thumb_videos").hide();
$(".iv_thumbs").show();
$(".iv_type_video").show();
if(ivCurrentImageSelected>=0){ivCurrentVideoSelected=-1;
$("#ivimage_"+ivCurrentImageSelected).click();
}else{if(ivCurrentVideoSelected>=0){ivCurrentImageSelected=-1;
$("#ivvideo_"+(ivCurrentVideoSelected)).click();
}}}else{if($(this).val()=="images"){$(".iv_thumb_videos").hide();
$(".iv_thumbs").show();
$(".iv_type_video").hide();
ivCurrentVideoSelected=-1;
if(ivCurrentImageSelected>=0){$("#ivimage_"+ivCurrentImageSelected).click();
}else{ivCurrentImageSelected=0;
$("#ivimage_0").click();
}}else{if($(this).val()=="videos"){$(".iv_thumb_videos").show();
$(".iv_thumbs").hide();
ivCurrentImageSelected=-1;
if(ivCurrentVideoSelected>=0){$("#ivvideolist_"+(ivCurrentVideoSelected)).click();
}else{ivCurrentVideoSelected=0;
$("#ivvideolist_0").click();
}}}}});
}function populateRightColumn(){populateThumbNails();
populateVideoList();
}function populateVideoList(){var thumbHtml="";
$.each(availableVideos||[],function(index,videoHash){thumbHtml+="<div class='iv_thumb_video_outer' id='ivvideolist_"+index+"'>";
thumbHtml+="<div class='iv_thumb_video'>";
thumbHtml+="<div class='iv_thumb_inner'>";
thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+videoHash.thumbUrl+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="<div class='iv_thumb_text'><b>"+videoHash.title+"</b><br>"+videoHash.durationTimestamp+"<div style='clear:both'></div></div>";
thumbHtml+="</div>";
});
$(".iv_thumb_videos").html(thumbHtml);
}function populateThumbNails(){var thumbnails;
if(ivImageSet&&ivImageSet[ivCurrentSelectedColor]){thumbnails=ivImageSet[ivCurrentSelectedColor].images.thumbnails;
}var thumbHtml="";
var thumbnailNumPerRow=3;
var thumbnailIndex=0;
var thumbnailCount=(thumbnails)?thumbnails.length:0;
thumbnailCount+=(availableVideos||[]).length;
if(thumbnails){var length=thumbnails.length;
for(var i=0;
i<length;
i++){if(thumbnailIndex%thumbnailNumPerRow==0){thumbHtml+="<div style='height:75px;'>";
}thumbHtml+="<div class='iv_thumb' id='ivimage_"+i+"'>";
thumbHtml+="<div class='iv_thumb_inner'>";
thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+getResizedThumbnailURL(thumbnails[i])+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="</div>";
thumbHtml+="</div>";
if((thumbnailIndex+1)%thumbnailNumPerRow==0||thumbnailIndex==thumbnailCount-1){thumbHtml+="</div>";
}thumbnailIndex++;
}}$.each(availableVideos||[],function(index,videoHash){if(thumbnailIndex%thumbnailNumPerRow==0){thumbHtml+="<div style='height:75px;'>";
}thumbHtml+="<div class='iv_thumb iv_type_video' id='ivvideo_"+index+"'>";
thumbHtml+="<div class='iv_thumb_inner'>";
thumbHtml+="<div class='iv_thumb_image' style=\"background:url("+videoHash.thumbUrl+') center no-repeat">';
thumbHtml+="</div>";
thumbHtml+="<div id='data_ivvideo_"+index+"' value='"+videoHash.mediaObjectId+"' />";
thumbHtml+="</div>";
thumbHtml+="</div>";
if((thumbnailIndex+1)%thumbnailNumPerRow===0||thumbnailIndex===thumbnailCount-1){thumbHtml+="</div>";
}thumbnailIndex++;
});
$(".iv_thumbs").html(thumbHtml);
}function playVideo(){if(!ivCurrentVideoSelected){return;
}$("#iv-large-image").css("display","none").empty();
var videoHash=availableVideos[ivCurrentVideoSelected];
if(airyInstance){if(airyInstance.isDetached()){airyInstance.attach(vidContainer[0]);
}ivUtils.loadMediaIntoAiryAndSetVolume(airyInstance,videoHash,airyConfig);
airyInstance.show();
airyInstance.play({isAsync:true});
return;
}airyInstance=ivUtils.embedAiryForChromefulPlayback(vidContainer,videoHash,airyConfig,"ImmersiveView");
airyInstance.play({isAsync:true});
}function getResizedVideoThumbURL(url){url=url.replace(/'/g,"").replace("._SL75_","").replace(/\._(AA|SS)\d+(?!_PImini-player-shuttle-50px,BottomLeft,0,3)_/,"").replace(/\._SX3\d+_SY\d+_CR,0,0,\d+,\d+_/,"");
if(url.search("_SS50_")<0){var index=url.lastIndexOf(".");
url=url.substring(0,index)+"._SS50_PImini-player-shuttle-50px,BottomLeft,0,3_"+url.substring(index);
url=url.replace("_._","._");
}return url;
}function getResizedThumbnailURL(url){url=url.replace(/'/g,"").replace("._SL75_","").replace(/\._(AA|SS)\d+_/,"").replace(/\._SX\d+_SY\d+_CR,0,0,\d+,\d+_/,"");
url=url.replace(/\._(US)\d+_/,"").replace(/\._SR\d+,\d+_/,"");
var index=url.lastIndexOf(".");
url=url.substring(0,index)+"._AA50_"+url.substring(index);
return url;
}var getAltImageIndexSelected=function(e){var data;
if(e.action=="thumb-action"){data=e.data;
}else{if(e.action=="main-image-click"){var selectedThumb=$("altImages,.a-button-selected");
if(selectedThumb!=null&&selectedThumb.parent()!=null&&selectedThumb.parent().data()!=null){data=selectedThumb.parent().data().thumbAction;
}}}if(data==null){data.thubnailIndex=0;
data.type="image";
data.index=0;
}return data;
};
var getImages=function(imageData){var images=new Object();
$.each(imageData,function(index){images[index]={images:{thumbnails:$.map(imageData[index],function(image){return image.thumb;
}),zoomImages:$.map(imageData[index],function(image){return image.hiRes||image.large||image.main[image.main.length-1];
})}};
});
return images;
};
var isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]";
};
var isIvApplicable=function(data){var currentSelectedColor=getCurrentSelectedColor(data);
if(data.colorImages&&data.colorImages[currentSelectedColor]&&data.colorImages[currentSelectedColor].length>0&&data.useIV){return true;
}return false;
};
var getCurrentSelectedColor=function(data){var currentSelectedColor=null;
if(typeof DetailPage!="undefined"&&DetailPage.StateController){currentSelectedColor=ivUtils.getColorFromState(DetailPage.StateController.getState()["selected_variations"]);
}currentSelectedColor=currentSelectedColor||data.defaultColor;
return currentSelectedColor;
};
var getIVPopoverOptions=function(){var closeString="close";
var strings=imageBlockData["staticStrings"];
if(strings&&strings["close"]){closeString=strings["close"];
}return{localContent:"#IV-Main",width:($(window).width()-ivWidthAdjustment),location:function(popover,settings){return{left:20,top:28};
},zIndex:999,paddingLeft:0,paddingRight:0,paddingBottom:0,closeText:closeString,modal:true,group:"ImmersiveView",onShow:updateIV,onHide:resetDP};
};
function resetDP(){detachAiryAndSaveVolume();
$("#iv-large-image").empty();
$(document.body).css("overflow","auto");
$("#ap_container").unbind("keydown");
ivIsIVOpened=false;
if(ivCurrentAltImageIndexType!="image"&&ivCurrentAltImageIndexSelected){$("#altImages").find(".a-button-selected").mouseenter();
}}function updateIV(){ivIsIVOpened=true;
$(document.body).css("opacity","");
var bStyle=document.body.style;
if($.browser.msie&&bStyle&&bStyle.filter==""){bStyle.removeAttribute("filter");
}$("#IV-Main").parents(".ap_popover").css({"top":($("body").scrollTop()+28)+"px"});
selectThumbnail();
resizeIV();
}function clearAllSelections(){$(".iv_thumb").removeClass("iv_thumb_selected");
$(".iv_thumb").removeClass("iv_thumb_hover");
$(".iv_thumb_video").removeClass("iv_thumb_selected");
$(".iv_thumb_video").removeClass("iv_thumb_hover");
}function trimWithEllipsis(str,maxCharacters){str=new String(str);
var trimmedStr=str;
if(str.length>maxCharacters){try{var index=-1;
for(var i=0;
i<str.length;
i++){var c=str.charAt(i);
if(c==" "||c=="."||c=="?"||c==";"||c==","||c==":"){index=i;
}if(i==maxCharacters-4){var trimIndex=(index==-1?i:index);
trimmedStr=str.substring(0,trimIndex);
break;
}}}catch(e){trimmedStr=str.substring(0,maxCharacters-3);
}trimmedStr+="...";
}return trimmedStr;
}return this;
});
P.when("ImageBlockBTF").execute(function(imageBlockData){var airyConfig=imageBlockData.airyConfig;
P.load.js(airyConfig.jsUrl);
if(airyConfig.cssUrl){P.load.css(airyConfig.cssUrl);
}});
P.when("A","jQuery","imageBlockUtils","ImageBlockATF","ImageBlockBTF","immersiveView","imageBlockLogger","Airy").execute(function(A,$,imageBlockUtils,imageBlockInitialData,imageBlockData,immersiveView,imageBlockLogger,Airy){function ImageBlock(options,imageBlockUtils){var isAndroid=navigator.userAgent.match(/cloud9|android|silk-accelerated/i);
var isIE=navigator.userAgent.match(/msie|trident/i);
options.useHoverZoom=options.useHoverZoom&&!isAndroid;
var magnifier,landingColor=options.defaultColor,currentItem={"color":options.defaultColor,"type":"image","index":0,"thumbnailIndex":0,"variant":"MAIN"},colorImages=options.colorImages,heroImages=options.heroImage,canvas=$("#imageBlock .canvas"),itemContainer=$("#main-image-container"),heroContainer=$("#heroImage"),utils=imageBlockUtils.init(options),videoSizes=options.mainImageSizes,thumbs=$("#imageBlock #altImages ul"),useChromelessVideoPlayer=options.useChromelessVideoPlayer,isIpad=navigator.userAgent.match(/ipad/i),videoHolderRatio=0,videoHolderHeight=0,videoHolderWidth=0,isFirstImageCaption=true,logger=new window.ImageBlockclientLogger("ImageBlockUDP",true);
var airyInstance;
var airyConfig=options.airyConfig;
var videoContainer=createVideoContainer();
function createVideoContainer(){var container=$("<div></div>").attr("id","main-video-container");
var outerContainer=$("<div></div>").attr("id","video-outer-container");
container.prependTo(outerContainer);
if(useChromelessVideoPlayer){return container;
}return container.addClass("chromeful-container");
}if(options.isDebug&&window.console){console.log(options);
}initialize();
function initialize(){videoContainer.parent().prependTo(itemContainer);
setupInteraction();
P.when("dpf").execute(imageBlockTwisterInitialization);
if(amznJQ){amznJQ.available("dpf",imageBlockTwisterInitialization);
}$(window).resize(resizeCallback);
A.on("image-block-select-thumbnail",function(obj){if(!obj){return;
}if(obj.length<=0){return;
}if(isIpad){obj.click();
}else{obj.mouseover();
}});
createAndAddNewThumbnails(currentItem.color,true);
calculateHolderSize();
if(options.autoplayVideo){A.trigger("image-block-select-thumbnail",thumbs.find("img:last"));
}else{A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
}showHandSymbolIfApplicable();
}function setupInteraction(){A.declarative("thumb-action",["click",isIpad?"":"mouseenter"],selectThumbnail);
A.declarative("thumb-action",["mouseleave"],thumbImageLeave);
A.declarative("main-image-click",["click"],mainImageClick);
A.declarative("main-image-click",["mouseenter","mouseleave"],mainImageHover);
A.declarative("main-video-click",["click"],function(event){A.trigger("mainVideoClick",event);
});
}function imageBlockTwisterInitialization(){var dpState=DetailPage.StateController.getState();
var initialColor=utils.getColorFromState(dpState["selected_variations"]);
if(initialColor&&initialColor!=""){setCurrentItem(initialColor);
utils.setLandingColor(initialColor);
}A.on("image-block-twister-swatch-hover",updateMainBlockForHoveredVariation);
A.on("image-block-twister-swatch-click",updateAltImagesForSelectedVaration);
A.on("image-block-video-fetch-completed",createAndAddNewThumbnails);
}function resizeCallback(e){utils.resizeHappened();
resizeMainBlockItem();
}function resizeMainBlockItem(){var imgWrappers=canvas.find(".item .imgTagWrapper");
var mainBlockHeight=utils.getMainBlockHeight();
if(mainBlockHeight>0){itemContainer.height(mainBlockHeight);
imgWrappers.height(mainBlockHeight);
}var $dynamicImages=canvas.find("img.a-dynamic-image");
$dynamicImages.each(function(){var $t=$(this);
if($t.data("a-manual-replacement")){var url=utils.loadDynamicImage(this);
if(url){$t.attr("src",url);
}}var maxHeight,maxWidth;
if(options.useStretchyImageFix){var mainImageHash=$t.data("a-dynamic-image");
maxHeight=utils.getMaxHeightOfMainImage(mainImageHash);
maxWidth=utils.getMaxWidthOfMainImage(mainImageHash);
}else{maxHeight=itemContainer.height();
maxWidth=itemContainer.width();
}var curStyle="max-height: "+maxHeight+"px;"+" max-width: "+maxWidth+"px;";
$t.attr("style",curStyle);
});
loadMagnifier();
}function calculateHolderSize(){var containerHeight=itemContainer.height();
var maxHeight=0;
var maxWidth=0;
$.each(videoSizes,function(id,sizes){var width=sizes[0];
var height=sizes[1];
if(width>maxWidth){maxWidth=width;
maxHeight=height;
}});
if(maxHeight!=0){videoHolderRatio=maxWidth/maxHeight;
}containerHeight=Math.min(containerHeight,maxHeight);
if(containerHeight!=0){videoHolderHeight=containerHeight;
videoHolderWidth=videoHolderHeight*videoHolderRatio;
}}function createThumbnail(type,data,index,thumbnailIndex,isFirstInteraction){var item=thumbs.find(".template").clone().removeClass("template").addClass("item");
var thumb=$("<img />").attr("src",data.thumb);
if(options.autoplayVideo&&isFirstInteraction){if(type=="chromeless-video"){item.find(".a-button").addClass("a-button-selected");
}}else{if(thumbnailIndex==currentItem.thumbnailIndex){item.find(".a-button").addClass("a-button-selected");
}}item.find(".placeHolder").replaceWith(thumb);
item.find(".a-declarative").attr("data-thumb-action",'{"index":"'+index+'", "thumbnailIndex":"'+thumbnailIndex+'", "type": "'+type+'", "variant": "'+data.variant+'"}');
return item;
}function createAndAddNewThumbnails(newColor,isFirstInteraction){thumbs.find(".item").remove();
var heroImage,thumbnailIndex=0,images=colorImages[newColor],videos=utils.getVideos(newColor),videoReserve=videos.length>0&&options.alwaysIncludeVideo?1:0;
if(heroImages){heroImage=heroImages[newColor];
if(heroImage){var item=createThumbnail("hero-image",heroImage,thumbnailIndex,thumbnailIndex,isFirstInteraction);
thumbs.append(item);
thumbnailIndex++;
}}if(images){$.each(images,function(index,data){if(thumbnailIndex>=(options.maxAlts-videoReserve)){if(currentItem.index===index){A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
}return false;
}var item=createThumbnail("image",data,index,thumbnailIndex,isFirstInteraction);
thumbs.append(item);
thumbnailIndex++;
});
}$.each(videos,function(index,data){if(thumbnailIndex>=options.maxAlts){return false;
}data.thumb=options.staticImages.videoThumbIcon;
if(useChromelessVideoPlayer){var item=createThumbnail("chromeless-video",data,index,thumbnailIndex,isFirstInteraction);
}else{var item=createThumbnail("chromeful-video",data,index,thumbnailIndex);
}thumbs.append(item);
thumbnailIndex++;
});
}function preLoadAllCanvasItems(){var thumbnailIndex=0,images=colorImages[currentItem.color];
$.each(images,function(index,imageHash){getCanvasItemByIndex(currentItem.color,"image",index,thumbnailIndex++);
});
}function setCurrentItem(c,type,index,thumbnailIndex,variant){if(c){currentItem.color=c;
}if(type){currentItem.type=type;
}if(typeof index!=="undefined"){currentItem.index=index;
}if(typeof thumbnailIndex!=="undefined"){currentItem.thumbnailIndex=thumbnailIndex;
}if(variant){currentItem.variant=variant;
}}function mainImageHover(event){updateCaption(event);
}function thumbImageLeave(event){var d=event.data;
if(d&&typeof d.index!=="undefined"&&typeof d.thumbnailIndex!=="undefined"&&d.type){utils.setImageCaption(currentItem.color,d.type,d.index,d.thumbnailIndex);
}}function updateCaption(event){var mouseIn=false;
if(event.type=="mouseenter"){mouseIn=true;
}var d;
var selectedThumb=$("altImages,.a-button-selected");
if(selectedThumb!=null&&selectedThumb.parent()!=null&&selectedThumb.parent().data()!=null){d=selectedThumb.parent().data().thumbAction;
}if(d&&typeof d.index!=="undefined"&&typeof d.thumbnailIndex!=="undefined"&&d.type){utils.setImageCaption(currentItem.color,d.type,d.index,d.thumbnailIndex,0,mouseIn);
}}function showHandSymbolIfApplicable(){if(!options.useIV){return;
}canvas.css("cursor","pointer");
}function hideHandSymbolIfApplicable(){if(!options.useIV){return;
}canvas.css("cursor","default");
}function selectThumbnail(event){var eventData=event.data;
if(!eventData){return -1;
}hideNoFlashContent();
if(eventData.index==null||eventData.thumbnailIndex==null||eventData.type==null){return -1;
}var item=event.$declarativeParent.find(".a-button");
thumbs.find(".a-button").removeClass("a-button-selected");
$(item).addClass("a-button-selected").removeClass("a-button-focus");
var mainBlockItem=getCanvasItemByIndex(currentItem.color,eventData.type,eventData.index,eventData.thumbnailIndex);
if(mainBlockItem!==-1){if(airyInstance&&!(eventData.type==="chromeless-video"||eventData.type==="chromeful-video")){hideVideo();
}updateMainBlock(mainBlockItem);
var mouseIn=true;
if(isFirstImageCaption){isFirstImageCaption=false;
mouseIn=false;
}utils.setImageCaption(currentItem.color,eventData.type,eventData.index,eventData.thumbnailIndex,0,mouseIn);
setCurrentItem(currentItem.color,eventData.type,eventData.index,eventData.thumbnailIndex,eventData.variant);
resizeCallback();
if(event.type==="click"){openImmersiveView(event);
}}else{utils.showUnavailableExp();
}}function hideVideo(){if(!airyInstance){return;
}airyInstance.hide();
videoContainer.parent().css("z-index",-1);
$("#video-canvas-caption").hide();
showHandSymbolIfApplicable();
}function getCanvasItemByIndex(c,type,index,thumbnailIndex){var item;
if(type==="chromeless-video"){item=createChromelessVideoItem(c,index,thumbnailIndex);
return item;
}else{if(type==="chromeful-video"){item=createChromefulVideoItem(c,index,thumbnailIndex);
}else{if(type==="hero-image"){item=createHeroImageItem(c,index,thumbnailIndex);
}else{if(canvas.find(".item.itemNo"+thumbnailIndex).length>0){item=canvas.find(".item.itemNo"+thumbnailIndex);
}else{if(type=="image"){item=createMainImageItem(c,index,thumbnailIndex);
}}}}}return item;
}function updateMainBlock(mainBlockItem,noMagnifier){if(mainBlockItem==null){return -1;
}hideAllListItems();
if(!mainBlockItem.hasClass("fullImage")){hideHeroImage();
var containerHeight=itemContainer.css("height");
if(containerHeight!=null){mainBlockItem.find(".imgTagWrapper").css("height",containerHeight);
}mainBlockItem.addClass("selected");
if(!noMagnifier){loadMagnifier();
}}}function hideAllListItems(){canvas.find("li").removeClass("selected");
utils.hideUnavailableExp();
}function hideHeroImage(){if(heroContainer){heroContainer.addClass("hide-background");
}}function updateMainBlockForHoveredVariation(id,dpState,testColor){hideNoFlashContent();
isFirstImageCaption=true;
hideVideo();
var newColor=testColor?testColor:utils.getColorFromState(dpState.getState()["hovered_variations"]);
newColor=newColor&&newColor!=""?newColor:options.defaultColor;
var selectedColor=utils.getColorFromState(dpState.getState()["selected_variations"]);
selectedColor=selectedColor&&selectedColor!=""?selectedColor:options.defaultColor;
if(selectedColor==currentItem.color&&currentItem.color==newColor){if(options.isSwatchHoverConsistent){A.trigger("image-block-select-thumbnail",thumbs.find("img:eq("+currentItem.thumbnailIndex+")"));
}else{A.trigger("image-block-select-thumbnail",thumbs.find("img:first"));
}return;
}var imageHash,isHeroImageConsistent=false;
if(options.isSwatchHoverConsistent){if(currentItem.type==="hero-image"){imageHash=updateHeroImage(newColor);
if(currentItem.variant===imageHash.variant){isHeroImageConsistent=true;
}}else{imageHash=getAltImageHash(newColor,currentItem.variant);
}}else{imageHash=getMainImageHash(newColor,0);
}if(imageHash==-1){if(getHeroImageHash(newColor)!=-1){imageHash=updateHeroImage(newColor);
updateMainBlock(heroContainer,true);
isHeroImageConsistent=1;
}else{var firstItem=canvas.find(".item.itemNo0");
updateMainBlock(firstItem);
utils.showUnavailableExp(newColor);
return;
}}if(!isHeroImageConsistent){var shw=canvas.find(".swatchHoverExp"),newImage=createDynamicImage(imageHash),image=shw.find("img");
shw.find(".imgTagWrapper").html(newImage);
utils.loadImageManually(shw.find(".a-dynamic-image"));
updateMainBlock(shw,true);
}}function updateAltImagesForSelectedVaration(id,dpState,onloadFunction,forceColor){hideNoFlashContent();
isFirstImageCaption=true;
var newColor=forceColor?forceColor:utils.getColorFromState(dpState.getState()["selected_variations"]);
newColor=newColor&&newColor!=""?newColor:options.defaultColor;
if(newColor==currentItem.color){if(typeof onloadFunction=="function"){onloadFunction();
}return;
}var selectedItem=getSelectedVariant(newColor);
var type=selectedItem.type,index=selectedItem.index,thumbnailIndex=selectedItem.thumbnailIndex,variant=selectedItem.variant;
var item;
if(type==="hero-image"){if(!heroContainer.hasClass("twisted")){heroContainer.addClass("twisted");
}item=createHeroImageItem(newColor,index,thumbnailIndex,onloadFunction);
}else{item=createMainImageItem(newColor,index,thumbnailIndex,onloadFunction);
}if(item==-1){var imageHash=getHeroImageHash(newColor);
if(imageHash!=-1){item=createHeroImageItem(newColor,index,thumbnailIndex,onloadFunction);
type="hero-image";
variant=imageHash.variant;
thumbnailIndex=0;
}else{utils.showUnavailableExp(newColor);
return;
}}setCurrentItem(newColor,type,index,thumbnailIndex,variant);
removeAllItems();
if(!item.hasClass("fullImage")){canvas.find(".list").append(item);
}loadMagnifier();
createAndAddNewThumbnails(newColor);
}function removeAllItems(){destroyMagnifier();
canvas.find(".list .item").remove();
if(heroContainer&&currentItem.type!=="hero-image"){heroContainer.addClass("twisted");
}}function getSelectedVariant(c){var item={type:"image",index:0,thumbnailIndex:0,variant:"MAIN"};
if(currentItem.type==="hero-image"){if(getHeroImageHash(c)!==-1){item.type="hero-image";
item.variant=currentItem.variant;
}}else{var index=getIndexForVariant(c,currentItem.variant);
if(index!==-1){item.index=index;
item.thumbnailIndex=index;
item.variant=currentItem.variant;
}if(getHeroImageHash(c)!==-1){item.thumbnailIndex++;
}}return item;
}function getAltImageHash(c,variant){var index=getIndexForVariant(c,variant);
var result;
if(index===-1){result=getMainImageHash(c,0);
}else{result=getMainImageHash(c,index);
}return result;
}function getIndexForVariant(c,variant){if(colorImages.length<1){return -1;
}if(!colorImages[c]){return -1;
}if(!variant){return -1;
}var index=-1;
$.each(colorImages[c],function(key,val){if(val.variant===variant){index=key;
}});
return index;
}function getMainImageHash(c,index){if(colorImages.length<1){return -1;
}if(!colorImages[c]){return -1;
}if(!colorImages[c][index]){return -1;
}if(!colorImages[c][index].main){return -1;
}var keys=$.map(colorImages[c][index].main,function(value,key){return key;
});
if(keys.length<1){return -1;
}return colorImages[c][index];
}function updateHeroImage(c){var imageHash=getHeroImageHash(c);
if(imageHash==-1){return getMainImageHash(c,0);
}var keys=$.map(imageHash.main,function(value,key){return key;
});
var imageUrl=keys[0];
var imageSize=imageHash.main[imageUrl];
updateHeroContainer(imageUrl,imageSize);
heroContainer.addClass("twisted");
if(heroContainer.hasClass("hide-background")){heroContainer.removeClass("hide-background");
}return imageHash;
}function getHeroImageHash(c){if(heroImages.length<1){return -1;
}if(!heroImages[c]){return -1;
}if(!heroImages[c].main){return -1;
}var keys=$.map(heroImages[c].main,function(value,key){return key;
});
if(keys.length<1){return -1;
}return heroImages[c];
}function updateHeroContainer(imageUrl,imageSize){if(!heroContainer){return;
}if(!imageUrl){return;
}if(!imageSize){return;
}var width=imageSize[0];
var height=imageSize[1];
heroContainer.css({"background-image":'url("'+imageUrl+'")',"background-size":width+"px "+height+"px","max-width":width+"px","min-height":height+"px","filter":"","-ms-filter":""});
}function setSlateImageDimensions(elem){if(!elem){return;
}var tempHeight=videoHolderHeight;
if(isIpad){tempHeight=tempHeight+1;
}elem.style.width=(tempHeight*videoHolderRatio)+"px";
elem.style.height=tempHeight+"px";
}function createChromelessVideoItem(color,index,thumbnailIndex){var videoHash=utils.getVideos(currentItem.color)[index];
if(videoHash==null){return -1;
}var itemHolder=createChromelessVideoHolder(color,index,thumbnailIndex);
if(airyInstance){airyInstance.play();
}return itemHolder;
}function createChromelessVideoHolder(c,index,thumbnailIndex){var videoHash=utils.getVideos(currentItem.color)[index];
if(!videoHash){return -1;
}var chromelessVideoListItem=canvas.find(".chromeless-video");
if(chromelessVideoListItem.hasClass(utils.VIDEO_UNSUPPORTED_CLASS_NAME)){showNoFlashContent();
return chromelessVideoListItem;
}if(airyInstance){airyInstance.show();
utils.loadMediaIntoAiryAndSetVolume(airyInstance,videoHash,airyConfig);
return chromelessVideoListItem;
}airyInstance=utils.embedAiryForChromelessPlayback(videoContainer,videoHash,airyConfig,thumbs,logger,chromelessVideoListItem);
return chromelessVideoListItem;
}function createChromefulVideoItem(color,index,thumbnailIndex){var videoHash=utils.getVideos(currentItem.color)[index];
if(!videoHash){return -1;
}var holderRatio=options.holderRatio||1;
var videoWidth=parseInt(videoHash.videoWidth,10);
var videoHeight=parseInt(videoHash.videoHeight,10);
videoContainer.parent().css("z-index",2);
if(videoHeight!=0&&videoWidth!=0){var videoRatio=videoWidth/videoHeight;
if(holderRatio>videoRatio){videoContainer.css("width",(videoRatio/holderRatio*100)+"%");
}else{videoContainer.css("height",(holderRatio/videoRatio*100)+"%");
}}hideHandSymbolIfApplicable();
if(airyInstance){airyInstance.show();
$("#video-canvas-caption").show();
utils.loadMediaIntoAiryAndSetVolume(airyInstance,videoHash,airyConfig);
return videoContainer;
}airyInstance=utils.embedAiryForChromefulPlayback(videoContainer,videoHash,airyConfig);
var videoCaptionEl=$("#image-canvas-caption").clone().attr("id","video-canvas-caption");
videoCaptionEl.appendTo(videoContainer);
videoCaptionEl.find("#canvasCaption").html(options.staticStrings["playVideo"]);
return videoContainer;
}function showNoFlashContent(){if(!utils.flashNotInstalled){return;
}canvas.find(".noFlash").removeClass("a-hidden");
}function hideNoFlashContent(){if(!utils.flashNotInstalled){return;
}canvas.find(".noFlash").addClass("a-hidden");
}function createHeroImageItem(c,index,thumbnailIndex,onloadEvent){var imageHash=getHeroImageHash(c);
if(imageHash==-1){return -1;
}var keys=$.map(imageHash.main,function(value,key){return key;
});
var imageUrl=keys[0];
var imageSize=imageHash.main[imageUrl];
if(heroContainer.hasClass("twisted")){utils.loadImageAsynchronously(imageUrl,function(){if(typeof onloadEvent==="function"){onloadEvent();
}});
updateHeroContainer(imageUrl,imageSize);
heroContainer.removeClass("twisted");
if(heroContainer.hasClass("hide-background")){heroContainer.removeClass("hide-background");
}}else{if(heroContainer.hasClass("loaded")){heroContainer.removeClass("hide-background");
}else{utils.loadImageAsynchronously(imageUrl,function(){updateHeroContainer(imageUrl,imageSize);
heroContainer.addClass("loaded");
});
}}return heroContainer;
}function createMainImageItem(c,index,thumbnailIndex,onloadEvent){var imageHash=getMainImageHash(c,index);
if(imageHash==-1){return -1;
}var item=canvas.find(".mainImageTemplate").clone().removeClass("template mainImageTemplate").addClass("image item itemNo"+thumbnailIndex+" maintain-height");
var image=createDynamicImage(imageHash,false,onloadEvent);
item.find(".placeHolder").replaceWith(image);
canvas.find(".list").append(item);
utils.loadImageManually(item.find(".a-dynamic-image"));
return item;
}function createDynamicImage(imageHash,isChromeless,onloadEvent){var bestImageUrl;
var stretchDirection;
var boundImage="";
$.each(imageHash.main,function(url,size){if(!bestImageUrl){bestImageUrl=url;
}if(options.shouldApplyResizeFix){if(size[1]>0&&parseFloat(size[0]/size[1])<parseFloat(options.holderRatio)&&!stretchDirection){stretchDirection="a-stretch-vertical";
}else{if(!stretchDirection){stretchDirection="a-stretch-horizontal";
}}}else{if(size[1]>0&&parseFloat(size[0]/size[1])<=parseFloat(options.holderRatio)&&!stretchDirection){stretchDirection="a-stretch-vertical";
}else{if(!stretchDirection){stretchDirection="a-stretch-horizontal";
}}}});
var classes=" a-dynamic-image ";
if(isChromeless){classes=classes+"slateImage";
}else{classes=classes+stretchDirection;
}var maxHeight,maxWidth;
if(options.useStretchyImageFix){maxHeight=utils.getMaxHeightOfMainImage(imageHash.main);
maxWidth=utils.getMaxWidthOfMainImage(imageHash.main);
}else{maxHeight=itemContainer.height();
maxWidth=itemContainer.width();
}boundImage="max-height: "+maxHeight+"px;"+" max-width: "+maxWidth+"px;";
var image=$("<div />");
image.attr({"data-a-dynamic-image":JSON.stringify(imageHash.main),"data-old-hires":imageHash.hiRes,"class":classes,"data-a-manual-replacement":"true","style":boundImage,"onload":(typeof onloadEvent!="undefined")?onloadEvent:""});
return image;
}function mainImageClick(event){openImmersiveView(event);
}function openImmersiveView(e){if(!options.useIV){return;
}if(airyInstance){airyConfig.volume=airyInstance.getVolume();
airyInstance.pause();
}immersiveView.iVController(e,options,utils,logger);
}function destroyMagnifier(){if(magnifier){magnifier.destroy();
magnifier=undefined;
}}function loadMagnifier(){if(!options.useHoverZoom){return;
}var logMetrics=null;
P.when("imageMagnifier").execute(function(im){var opts={adjustment:[0,0,1,1],generalImageUrls:options.staticImages,location:"over",minHeightElement:"#imageBlock",preload:"ready",zIndex:190,useHoverZoomIpad:options.useHoverZoomIpad,useHoverZoom:options.useHoverZoom,logMetrics:logMetrics,useClickZoom:options.useClickZoom,zoomOutIcon:options.staticImages.zoomOutCur};
destroyMagnifier();
var navImage=canvas.find(".image.item.selected img[data-old-hires]").not("[data-old-hires='']");
if(navImage.length>0){if(options.useClickZoom){navImage.one("click.loadmagnifier touchstart.loadmagnifier",function(e){magnifier=navImage.amazonMagnifier(opts);
magnifier.engageMagnifier(e,true);
});
if(isIE){navImage.css("cursor",'url("'+options.staticImages.zoomInCur+'"), auto');
}else{navImage.css("cursor","-webkit-zoom-in");
navImage.css("cursor","-moz-zoom-in");
navImage.css("cursor","zoom-in");
}}else{magnifier=navImage.amazonMagnifier(opts);
}}});
}}if(imageBlockData&&imageBlockData["colorImages"]&&imageBlockInitialData&&imageBlockInitialData["colorImages"]){imageBlockData["colorImages"]["initial"]=imageBlockInitialData["colorImages"]["initial"];
imageBlockData["colorImages"][imageBlockData.landingAsinColor]=imageBlockInitialData["colorImages"]["initial"];
}if(imageBlockData&&imageBlockData["heroImage"]&&imageBlockInitialData&&imageBlockInitialData["heroImage"]){imageBlockData["heroImage"]["initial"]=imageBlockInitialData["heroImage"]["initial"];
imageBlockData["heroImage"][imageBlockData.landingAsinColor]=imageBlockInitialData["heroImage"]["initial"];
}if(imageBlockData&&imageBlockData["colorImages"]&&imageBlockInitialData&&imageBlockInitialData["colorToAsin"]&&imageBlockInitialData["colorToAsin"]["initial"]&&imageBlockInitialData["colorToAsin"]["initial"][0]){imageBlockData["initialColorToAsinMap"]=imageBlockInitialData["colorToAsin"]["initial"][0].main;
}if(imageBlockData&&imageBlockInitialData["holderRatio"]){imageBlockData["holderRatio"]=imageBlockInitialData["holderRatio"];
}else{imageBlockData["holderRatio"]=1;
}imageBlockData["holderMaxHeight"]=imageBlockInitialData["holderMaxHeight"];
imageBlockData["useStretchyImageFix"]=imageBlockInitialData["useStretchyImageFix"];
var imageBlock=new ImageBlock(imageBlockData,imageBlockUtils);
});
