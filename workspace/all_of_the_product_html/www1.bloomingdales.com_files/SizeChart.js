define(["jquery","underscore","backbone"],function(e,a,t){var s="/shop/catalog/product/canvassizechart/json?canvasId=";function r(e,a){var t={};var s=0;for(var r in e){if(s<a){t[r]=e[r];s++}else{break}}return t}function n(e,t,s,n){if(t&&e.chartSizes&&Object.keys(e.chartSizes).length>t){e.chartSizes=r(e.chartSizes,t)}var i=e.columns&&e.columns.length?1:0,l=a.isEmpty(e.chartSizeHeaders)?0:e.chartSizeHeaders.length,u=s-(i+l);if(s&&e.measureHeaders&&e.measureHeaders.length>u){e.measureHeaders=e.measureHeaders.slice(0,u);for(var o in e.measureSizes){e.measureSizes[o].value=r(e.measureSizes[o].value,u)}}var m=!!(!a.isEmpty(e.howToMeasure)&&e.howToMeasure.text),h=!!(!a.isEmpty(e.learnMore)&&e.learnMore.text),b=!!(!a.isEmpty(e.sizeChartImage)&&e.sizeChartImage.image);e.enableLeftColumn=!a.isEmpty(e.chartSizes);e.enableRightColumn=b||h||!n&&m;e.enableSingleColumn=e.enableLeftColumn&&!e.enableRightColumn||!e.enableLeftColumn&&e.enableRightColumn;e.enableLocaleChange=!a.isEmpty(e.localeSizes);e.enableConversion=!!(e.measureHeaders&&e.measureHeaders.length&&e.measureHeaders[0].units.length>1);if(n&&!a.isEmpty(e.howToMeasure)){var c;for(var z in e.howToMeasure.description){c=z==="0"||!(z|0);if(c){break}}e.howToMeasure.enableHeaders=c}return e}function i(e,a){e.tabsEnabled=!e.intimates&&e.tabs.length>1;e.stepsEnabled=e.intimates&&e.sizeChartData.length>1;e.maxRows=e.maxRows||50;e.maxColumns=e.maxColumns||(a?7:8);e.maxTabs=e.maxTabs||7;e.maxTabTextSize=e.maxTabTextSize||(a?25:15);if(e.tabsEnabled){if(e.tabs.length>e.maxTabs){e.tabs=e.tabs.slice(0,e.maxTabs)}for(var t=0;t<e.tabs.length;t++){if(e.tabs[t].length>e.maxTabTextSize){e.tabs[t]=e.tabs[t].substring(0,e.maxTabTextSize)}}e.tabWidth=e.tabs.length?100/e.tabs.length-.01:0;e.currentTab=0;e.currentSizeChartData=[e.sizeChartData[e.currentTab]]}else if(e.stepsEnabled){e.currentSizeChartData=e.sizeChartData}else{e.currentSizeChartData=[e.sizeChartData[0]]}return e}return t.Model.extend({initialize:function(e,a){this.url=s+e;this.isBCOM=!!a},parse:function(e){var t=this.isBCOM,s=i(e.sizeChartMedia,t);a.each(s.sizeChartData,function(e,a){e=n(e,s.maxRows,s.maxColumns,t)});return s}})});