define(["jquery","bcomHbsHelpers","backbone","bcomRecommendation/models/ProsProductThumbnail","bcomRecommendation/hbsHelpers/ProsHelpers","bcomTemplates/components/recommendation/ProsProductThumbnail","bcomRecommendation/ProsCallBackFunctions","bcomRecommendation/abtesting/ProsABTesting"],function(t,i,e,o,s,n,r,a){var d=e.View.extend({el:t("#ProsZoneA div ul"),thumbNails:[],informantIds:[],imageWidth:"",LinkType:"",isRegistryMode:"No",isInternationalMode:"No",recommendationstimeout:3500,targetId:"ProsZoneA",targetError:"ProsZoneAError",commonAssetsServer:"",attribute2:"",priceDataLegacy:{},callBackOptions:[],RecProdPos:1,initialize:function(i){this.options=i;var e="PDP_ZONE_A",s="",n="",r="BCOM-NAVAPP",a="747081278",d="No",c="US",h="",p="No",u="10",m=this;if(typeof this.options.wid!=="undefined"&&this.options.wid!==""){this.imageWidth=this.options.wid}if(typeof this.options.LinkType!=="undefined"&&this.options.LinkType!==""){this.LinkType=this.options.LinkType}if(typeof this.options.recommendationstimeout!=="undefined"&&this.options.recommendationstimeout!==""){this.recommendationstimeout=this.options.recommendationstimeout}if(typeof this.options.targetId!=="undefined"&&this.options.targetId!==""){this.el=t("#"+this.options.targetId+" div ul");this.targetId=this.options.targetId}if(typeof this.options.targetError!=="undefined"&&this.options.targetError!==""){this.targetError=this.options.targetError}if(typeof this.options.commonAssetsServer!=="undefined"&&this.options.commonAssetsServer!==""){this.commonAssetsServer=this.options.commonAssetsServer}if(typeof this.options.attribute2!=="undefined"&&this.options.attribute2!==""){this.attribute2=this.options.attribute2}if(typeof this.options.priceDataLegacy!=="undefined"&&this.options.priceDataLegacy!==""){this.priceDataLegacy=this.options.priceDataLegacy}if(typeof this.options.context!=="undefined"&&this.options.context!==""){e=this.options.context}if(typeof this.options.productId!=="undefined"&&this.options.productId!==""){s=this.options.productId}if(typeof this.options.categoryId!=="undefined"&&this.options.categoryId!==""){n=this.options.categoryId}if(typeof this.options.recvisitorId!=="undefined"&&this.options.recvisitorId!==""){a=this.options.recvisitorId}if(typeof this.options.isInternationalMode!=="undefined"&&this.options.isInternationalMode!==""){d=this.options.isInternationalMode;this.isInternationalMode=this.options.isInternationalMode}if(typeof this.options.countryCode!=="undefined"&&this.options.countryCode!==""&&this.options.countryCode!==false){c=this.options.countryCode}if(typeof this.options.zipCode!=="undefined"&&this.options.zipCode!==""&&this.options.zipCode!==false){h=this.options.zipCode}if(typeof this.options.isRegistryMode!=="undefined"&&this.options.isRegistryMode!==""){p=this.options.isRegistryMode;this.isRegistryMode=this.options.isRegistryMode}if(typeof this.options.maxRecommendations!=="undefined"&&this.options.maxRecommendations!==""){u=this.options.maxRecommendations}this.callBackOptions={context:e,targetId:this.targetId,targetError:this.targetError,LinkType:this.LinkType,categoryId:n};this.modelGetThumbnails=new o;this.modelThumbnail=new o;this.modelGetThumbnails.urlPath="/sdp/rto/request/recommendations";if(typeof s!=="undefined"&&s!==""){this.modelGetThumbnails.fetch({type:"POST",data:{productId:s,categoryId:n,context:e,requester:r,visitorId:a,isInternationalMode:d,countryCode:c,zipCode:h,isRegistryMode:p,maxRecommendations:u},timeout:this.recommendationstimeout,success:function(){var t;t=m.modelGetThumbnails.toJSON();if(t.status==="SUCCESS"&&t.recommendedItems!==null){m.thumbNails=t.recommendedItems;m.processThumbnails()}},error:function(i,e,o){t("div#"+this.targetError).append(" Service request failure - modelGetThumbnails fetch request:"+i+" - status:"+e+" - error:"+o)}})}},processThumbnails:function(){var i="",e;if(typeof this.thumbNails[0]!=="undefined"&&this.thumbNails.length>=0){this.getThumbnailData(this.thumbNails[0].productId,this.thumbNails[0].choiceId)}else{if(t(this.el).find("li").length>0){if(typeof this.options.callback!=="undefined"&&this.options.callback!==""){try{var o=this.modelThumbnail.toJSON();var s="";if(o.choiceID!=="undefined"&&o.choiceID!==""){s=o.choiceID}else{s=this.modelThumbnail.urlPath}var n=s.split("@"),a=n[2],d=a.split("$"),c=d[0];if(o.choiceID!==null&&(c!==""&&typeof c!=="undefined")&&c.indexOf("v_")<=-1&&(typeof this.options.targetId!=="undefined"&&this.options.targetId!=="")){t("#"+this.options.targetId+" h5").html(c);e=o.choiceID}}catch(h){t("div#"+this.targetError).append(h)}i=this.options.callback;r[i](this.informantIds,this.recommendationstimeout,this.attribute2,this.isInternationalMode,this.priceDataLegacy,this.callBackOptions)}}}},getThumbnailData:function(i,e){var o=this;this.thumbNails.shift();this.modelThumbnail.urlPath="/shop/catalog/product/newthumbnail/json?productId="+i+"&source=118&choiceId="+e;this.modelThumbnail.fetch({timeout:this.recommendationstimeout,success:function(){o.renderThumbnailData()},error:function(i){t("div#"+this.targetError).append(" Service request failure - modelThumbnail fetch ");o.processThumbnails()}})},getRecProdZoneDesc:function(t){var i=a,e="NULL|NULL|"+this.LinkType+"|CMIO",o;if(t!==null&&typeof t!=="undefined"){for(var s=0;s<i.length;s++){o=t.charAt(4);if(o===i[s][0]){e=i[s][1];break}}}return encodeURI(e)},renderThumbnailData:function(){var i={},e="",o=this.modelThumbnail.toJSON(),s=this;if(o.errorMessage===""&&o.productThumbnail!==null&&o.priceInfo!==null&&!o.productThumbnail.elecGiftCard&&!o.productThumbnail.suppressedForIntlShipping){e=o.productThumbnail.semanticURL;if(this.isRegistryMode==="Yes"){e=e.replace("/shop/product/","/shop/wedding-registry/product/")}i.semanticURL=e;i.categoryId=o.productThumbnail.categoryId;i.ID=o.productThumbnail.ID;i.shortDescription=o.productThumbnail.shortDescription;i.imageSource=o.productThumbnail.imageSource;i.moreColors=o.productThumbnail.moreColors;if(this.targetId==="ProsZoneA"){i.moreColorsIMG="more_colors_sm.png"}else{i.moreColorsIMG="more_colors.png"}i.numberOfReviews=o.productThumbnail.numberOfReviews;i.custRatings=o.productThumbnail.custRatings;i.commonAssetsServer=this.commonAssetsServer;i.price=o.productThumbnail.price;i.salePrice=o.productThumbnail.salePrice;i.onSale=o.productThumbnail.onSale;i.bonusOffer=o.productThumbnail.bonusOffer;i.priceLabel1=o.priceInfo.priceLabel1;i.priceLabel2=o.priceInfo.priceLabel2;i.priceLabel3=o.priceInfo.priceLabel3;i.LinkType=this.LinkType+"&RecProdZonePos=prodrec-"+this.RecProdPos+"&RecProdZoneDesc="+this.getRecProdZoneDesc(o.choiceID)+"&choiceId="+o.choiceID;i.imgWidth=this.imageWidth;i.choiceId=o.choiceID;this.RecProdPos=this.RecProdPos+1;this.callBackOptions["RecProdZoneDesc"]=this.getRecProdZoneDesc(o.choiceID);s.informantIds.push({choiceId:o.choiceID,productId:o.productThumbnail.ID});if(o.productThumbnail.available){t(this.el).append(n(i))}}this.remove();this.processThumbnails()},remove:function(){this.stopListening();return this}});return d});