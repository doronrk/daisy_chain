/* creation date: Wed, 26 Nov 2014 10:09:34 GMT
concat references:
http://usa.loccitane.com/js/OCMS.ui.floatingbag.js?20140822001
*/
var OCMS=window.OCMS=window.OCMS||{};if(!OCMS.ui){OCMS.ui={}}$(document).ready(function(){OCMS.ui.floatingbag.initDOM()});OCMS.ui.floatingbag={bag_count:typeof dataLayer!="undefined"&&dataLayer.length&&!OCMS.utils.isEmpty(dataLayer[0])&&!OCMS.utils.isEmpty(dataLayer[0].orderProductQuantities)?dataLayer[0].orderProductQuantities.length:0,scroller_init:false,in_child_elem:false,visible:false,fading:false,empty:false,timeout:0,displayed:false,initDOM:function(){OCMS.ui.floatingbag.init();OCMS.ui.floatingbag.windowResize()},init:function(){var _me=OCMS.ui.floatingbag;var imgId=OCMS.GlobalVars.Brand=="mel"?".basketimg":"#ecombagimg";if(!OCMS.GlobalVars.IsMobile&&OCMS.GlobalVars.Brand!="cdm"){$("#headerBagButton, .basketlinks, "+imgId).children().mouseover(function(){if(_me.displayed||_me.empty){return false}clearTimeout(_me.timeout)});$("#headerBagButton, .basketlinks, "+imgId).children().mouseout(function(){if(_me.displayed||_me.empty){return false}clearTimeout(_me.timeout)});$("#headerBagButton, .basketlinks, "+imgId).mouseover(function(){if(_me.displayed||_me.empty){return false}clearTimeout(_me.timeout);if(!_me.fading&&!_me.visible){_me.fading=true;$("#floatingBag").fadeIn("fast",function(){_me.fading=false;_me.visible=true;if(!_me.scroller_init){_me.scroller_init=true;_me.update()}})}});$("#headerBagButton, .basketlinks, "+imgId).mouseout(function(){if(_me.displayed||_me.empty){return false}if(!_me.fading&&_me.visible){_me.timeout=setTimeout(function(){$("#floatingBag").fadeOut("fast",function(){_me.fading=false;_me.visible=false})},1e3)}});$("#floatingBag").mouseover(function(){if(_me.displayed){return false}clearTimeout(_me.timeout)});$("#floatingBag").mousemove(function(){if(_me.displayed){return false}clearTimeout(_me.timeout)});$("#floatingBag").mouseout(function(){if(_me.displayed){return false}_me.timeout=setTimeout(function(){$("#floatingBag").fadeOut("fast",function(){_me.fading=false;_me.visible=false;clearTimeout(_me.timeout)})},400)})}$(document).bind("addToBag",function(event,sku){_me.currentModel.updateBag()})},windowResize:function(){$(window).resize(function(){OCMS.ui.floatingbag.update()})},update:function(sku){var _nanocontainers=$("#floatingBag .content, #floatingBag .nano");if(!_nanocontainers.length||!$("#floatingBag .nano").is(":visible")){return}var _height=0;$("#floatingBag .floating-bag-item").each(function(){_height+=$(this).outerHeight()});var _maxHeight=OCMS.GlobalVars.Brand=="cdm"&&!OCMS.GlobalVars.IsMobile?800:400;if(OCMS.GlobalVars.IsMobile||OCMS.GlobalVars.Brand=="cdm"){var _screenHeight=$(window).height();var _realMaxHeight=_screenHeight;var _sideCartContentContainer=$("#floatingBag").parent("#sideCartContentContainer");if(_sideCartContentContainer.length){var _sideCartTitleSection=_sideCartContentContainer.siblings("#sideCartTitleSection");if(_sideCartTitleSection.length){_realMaxHeight-=_sideCartTitleSection.outerHeight(true)}}var _totalContainer=$("#floatingBag .nano").siblings(".floating-bag-total");if(_totalContainer.length){_realMaxHeight-=_totalContainer.outerHeight(true)}var _discountsContainer=$("#floatingBag").children(".floating-bag-discount-items");if(_discountsContainer.length){_realMaxHeight-=_discountsContainer.outerHeight(true)}var _buttonsContainer=$("#floatingBag").children(".floating-bag-buttons");if(_buttonsContainer.length){_realMaxHeight-=_buttonsContainer.outerHeight(true)}if(_realMaxHeight==_screenHeight){_realMaxHeight=Math.floor(.48*_screenHeight)}_realMaxHeight-=2*$("#floatingBag .nano").get(0).offsetTop;if(_maxHeight>_realMaxHeight){_maxHeight=_realMaxHeight}}if(_height<_maxHeight){if(_height===0){_nanocontainers.height("auto")}else{_nanocontainers.height(_height)}}else{_nanocontainers.height(_maxHeight)}if(_height<_maxHeight){$("#floatingBag .nano").nanoScroller({stop:true})}else{$("#floatingBag .nano").nanoScroller();if(sku){$("#floatingBag .nano").nanoScroller({scrollTo:$("#"+sku),preventPageScrolling:true,iOSNativeScrolling:false})}else{$("#floatingBag .nano").nanoScroller({scroll:"top",preventPageScrolling:true,iOSNativeScrolling:false})}}$("#floatingBag .floating-bag-item .floating-bag-item-infos").each(function(){var _itemContainer=$(this).parent();var _siblingsWidth=0;$(this).siblings().each(function(){_siblingsWidth+=$(this).get(0).offsetWidth});var _width=_itemContainer.width()-_siblingsWidth-1;this.style.width=_width+"px"})},model:function(){var _me=OCMS.ui.floatingbag;var that=this;var isRemoving=false;that.products=ko.observableArray([]);that.bagDiscounts=ko.observableArray([]);that.total=ko.observable(0);that.bagHasDiscount=ko.observable(false);that.removeItem=function(item,event){if(!isRemoving){that.products.remove(item);createCookie("ecomBag"+OCMS.GlobalVars.C+"_"+item.sku,"",-1);$("#spEcombagTotalProducts").html(that.products().length);isRemoving=true;that.updateBag();$(document).trigger("removeFromBag",[item.sku,item])}};that.updateBag=function(noCompute){$.ajax({url:"/ajax/ecomBag_Ajax.aspx",data:{task:"getbag",c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L,nocomputeorder:noCompute,timestamp:(new Date).getTime()},dataType:"json",type:"post",success:function(data){that.products(data.products);that.bagDiscounts(data.discounts);that.total(data.total);that.bagHasDiscount(data.hasDiscount);isRemoving=false;if("undefined"!=typeof data.products){_me.empty=false}else{_me.empty=true;that.closeBag()}$("#spEcombagTotalProducts").html(data.itemCount);_me.update();_me.scroller_init=false}})};that.closeBag=function(){if(!OCMS.GlobalVars.IsMobile&&!_me.fading){_me.fading=true;$("#floatingBag").fadeOut("fast",function(){_me.fading=false;_me.visible=false})}};that.afterAdd=function(e,o,t,v){_me.update()}}};OCMS.ui.floatingbag.currentModel=new OCMS.ui.floatingbag.model;ko.applyBindings(OCMS.ui.floatingbag.currentModel,document.getElementById("floatingBag"));if(OCMS.GlobalVars.IsMobile||OCMS.GlobalVars.Brand=="cdm"){ko.applyBindings(OCMS.ui.floatingbag.currentModel,document.getElementById("sideCartEmptyBagMessageContainer"))}OCMS.ui.floatingbag.currentModel.updateBag(true)