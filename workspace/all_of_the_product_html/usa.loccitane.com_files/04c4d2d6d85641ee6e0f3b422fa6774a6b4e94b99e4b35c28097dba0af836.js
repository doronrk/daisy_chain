/* creation date: Wed, 26 Nov 2014 10:09:34 GMT
concat references:
http://usa.loccitane.com/js/_controls/popins/OCMS.controls.quick_view_popin.js?20140908003
*/
OCMS.controls.quickviewpopin={quickViewPopinOptions:{id:"quickViewPopin",content:"",displayHeader:true,displayFooter:false,activateOverlayClick:true,onBeforeOpen:function(aoComponent,aoPopinConfig){aoPopinConfig.container.find(".popinContent .popinClose").remove();OCMS.Popin.overlay.css("cursor","pointer");return true},onOpen:function(){var spinner=(new Spinner(OCMS.controls.loadingpopin.spinnerOpts)).spin(document.getElementById("spinner"))},onClose:function(aoComponent,aoPopinConfig){OCMS.events.quickviewLoaded=false}},quickViewJSON:null,quickViewSizesDataArray:[],quickViewPopinHeightOverflow:0,viewProductDetailsLabel:"",addToBagLabel:"",readMoreLabel:"",selectProductLabel:"",selectQuantityLabel:"",outOfStockLabel:"",refillLabel:"",init:function(){var _contentHTML=['<div class="popin-loading-mask">','<img src="/img/OCC/redesign/design/home_load.gif" />',"</div>",'<div class="nano">','<div class="content">','<div class="popin_left_area">','<img id="quickViewPopinProductImage" src="" alt="" />',"</div>",'<div class="popin_right_area">','<div id="quickViewPopinProductTitle" class="popin_container_title"></div>','<p id="quickViewPopinProductDesc" class="popin_container_desc"></p>','<div id="quickViewPopinProductDescReadMore">',OCMS.GlobalVars.Brand!="cdm"?'<div id="quickViewPopinProductDescReadMoreWrapper">':"",OCMS.GlobalVars.Brand=="cdm"?this.readMoreLabel:'<span id="quickViewPopinProductDescReadMoreLeft" class="left">&nbsp;</span>','<span id="quickViewPopinProductDescReadMoreRight" class="right open">'+(OCMS.GlobalVars.Brand!="cdm"?this.readMoreLabel:"")+"</span>",OCMS.GlobalVars.Brand!="cdm"?"</div>":"","</div>"].join("");if(OCMS.GlobalVars.IsEcom){_contentHTML+=['<div id="quickViewPopinPurchaseArea" class="popin_purchase_area basic_curve_shadow" style="display: none;">','<div id="quickViewPopinPurchaseAreaTitle" class="popin_purchase_area_title">',this.selectProductLabel+":","</div>",'<ul id="quickViewPopinPurchaseList"></ul>','<div class="popin_purchase_quantity_area">','<div id="quickViewPopinPurchaseQuantityAreaWrapper">',"<div>",'<img id="quickViewPopinProductImageMini" src="" alt="" />',"</div>",'<div class="popin_purchase_quantity_area_core_container">','<div id="quickViewPopinProductQuantityLabel" class="popin_purchase_quantity_label">'+this.selectQuantityLabel+":</div>",'<div id="quickViewPopinProductQuantityErrorMessage" class="popin_purchase_quantity_error_message"></div>',"</div>",'<div class="popin_purchase_quantity_container">','<select id="quickViewPopinProductQuantitySelect" disabled="disabled"></select>',"</div>","</div>","</div>",'<div class="popin_purchase_buttons_area">','<div id="quickViewPopinPurchaseButtonsAreaWrapper">','<a id="quickViewPopinLinkToProductDetails" class="button_secondary" href="javascript:void(0);">',this.viewProductDetailsLabel,'</a><a id="quickViewPopinLinkToBag" class="button_basic" href="javascript:void(0);" style="display: none;">',this.addToBagLabel,"</a>","</div>","</div>","</div>"].join("")}_contentHTML+=["</div>","</div>","</div>"].join("");this.quickViewPopinOptions.content=_contentHTML;setPopupQuickViewControls()}};function setPopupQuickViewControls(){$(document).on("click","#quickViewPopinProductDescReadMore",function(){var _quickViewPopinProductDesc=$("#quickViewPopinProductDesc");var _minHeightValue=_quickViewPopinProductDesc.attr("data-min-height");var _maxHeightValue=_quickViewPopinProductDesc.attr("data-max-height");var _arrow=$("#quickViewPopinProductDescReadMoreRight");if(_arrow.hasClass("open")){_arrow.removeClass("open");_arrow.addClass("close");_quickViewPopinProductDesc.animate({height:_maxHeightValue},500,"swing",function(){$("#quickViewPopin .nano").nanoScroller({scroll:"top",preventPageScrolling:true})})}else{_arrow.removeClass("close");_arrow.addClass("open");_quickViewPopinProductDesc.animate({height:_minHeightValue},500,"swing",function(){if(OCMS.controls.quickviewpopin.quickViewPopinHeightOverflow>0){var _quickViewPopinProductDescReadMore=$("#quickViewPopinProductDescReadMore");var _readMoreMarginTop=parseInt(_quickViewPopinProductDescReadMore.css("marginTop"),10);var _readMoreHeight=_quickViewPopinProductDescReadMore.height();var _quickViewPopinProductDescMinHeight=_maxHeightValue-OCMS.controls.quickviewpopin.quickViewPopinHeightOverflow-_readMoreHeight-_readMoreMarginTop;if(_minHeightValue>_quickViewPopinProductDescMinHeight){$("#quickViewPopin .nano").nanoScroller({scroll:"top",preventPageScrolling:true})}else{$("#quickViewPopin .nano").nanoScroller({stop:true})}}})}});$(document).on("click","#quickViewPopinPurchaseList input[name='quickViewPopinPurchaseLineSelector']",function(){var _index=$(this).val();if(_index>=0&&_index<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length){var _sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[_index];updatePopupQuickViewPurchaseArea(_sizeData)}return true});$(document).on("click","#quickViewPopinLinkToProductDetails",function(){var _selectedItem=$("#quickViewPopinPurchaseList input[name='quickViewPopinPurchaseLineSelector']:checked");if(_selectedItem!==null&&_selectedItem!==undefined){var _index=_selectedItem.val();if(_index>=0&&_index<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length){var _sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[_index];if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host}var _href=window.location.origin+"/default.aspx?";_href+="c="+OCMS.GlobalVars.C;_href+="&l="+OCMS.GlobalVars.L;_href+="&s=00000";_href+="&a="+_sizeData.ID_Article;window.location.href=_href}}return true});$(document).on("click","#quickViewPopinLinkToBag",function(){var _selectedItem=$("#quickViewPopinPurchaseList input[name='quickViewPopinPurchaseLineSelector']:checked");if(_selectedItem!==null&&_selectedItem!==undefined){var _index=_selectedItem.val();if(_index>=0&&_index<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length){var _sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[_index];var _title=_sizeData.ShortTitle;if(_sizeData.Size!==null&&_sizeData.Size!==undefined&&_sizeData.Size!==""){_title+=' <span class="nowrap">'+_sizeData.Size+"</span>"}var _quantity=parseInt($("#quickViewPopinProductQuantitySelect").val(),10);addToBagV2(_sizeData.SKU,_sizeData.ID_Article,_quantity,OCMS.GlobalVars.C,OCMS.GlobalVars.L,false,true,_title,_sizeData.Image,_sizeData.FormattedPrice);OCMS.addToDataLayer({event:"addToBasket",pageTemplate:OCMS.GlobalVars.CurrentTemplate,pageArticleTitle:_title,productPrice:_sizeData.FormattedPrice})}}return true})}function ShowPopupQuickView(aoOptions){if(OCMS.GlobalVars.IsMobile){return}OCMS.Popin.close();var o=$.extend({},OCMS.controls.quickviewpopin.quickViewPopinOptions);o.content=OCMS.Popin.renderTemplate(o.content,aoOptions);OCMS.Popin.open(o);quickViewOrderGrooveData("",true);if(typeof aoOptions.SKU!="undefined"){var _data={task:"quickview",SKU:aoOptions.SKU,c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L}}else{var _data={task:"quickview",articleId:aoOptions.articleId,c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L}}var _ajaxRequestStartTime=(new Date).getTime();$.ajax({url:"/ajax/UtilsAjax.aspx",data:_data,type:"get",success:function(aoJSON){OCMS.controls.quickviewpopin.quickViewJSON=aoJSON;var _jsonData=OCMS.utils.type(OCMS.controls.quickviewpopin.quickViewJSON.data)=="array"?OCMS.controls.quickviewpopin.quickViewJSON.data[0]:OCMS.controls.quickviewpopin.quickViewJSON.data;if(!_jsonData){return false}$("#quickViewPopinProductImage").attr("src",_jsonData.Image);$("#quickViewPopinProductTitle").html(_jsonData.ShortTitle);$("#quickViewPopinProductDesc").html(_jsonData.Content);var _quickViewPopinPurchaseArea=$("#quickViewPopinPurchaseArea");if(_quickViewPopinPurchaseArea.length){OCMS.controls.quickviewpopin.quickViewSizesDataArray=[_jsonData];OCMS.controls.quickviewpopin.quickViewSizesDataArray=OCMS.controls.quickviewpopin.quickViewSizesDataArray.concat(_jsonData.Sizes||[]);for(var i=0;i<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length;i++){var _sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[i];_sizeData["Sizes"]=null}var _list=$("#quickViewPopinPurchaseList");if(_list){_list.html("");for(var i=0;i<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length;i++){var _sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[i];var _title=_sizeData.ShortTitle;if(_sizeData.Size!==null&&_sizeData.Size!==undefined&&_sizeData.Size!==""){_title=_sizeData.Size}if(_sizeData.IsRefill){_title+="<span> "+OCMS.controls.quickviewpopin.refillLabel+"</span>"}var _discount=_sizeData.FormattedPriceBeforeDiscount!==null&&_sizeData.FormattedPriceBeforeDiscount!==undefined&&_sizeData.FormattedPriceBeforeDiscount!==""&&_sizeData.PriceBeforeDiscount!==null&&_sizeData.PriceBeforeDiscount!==undefined&&_sizeData.PriceBeforeDiscount!==""&&!isNaN(_sizeData.PriceBeforeDiscount)&&_sizeData.PriceBeforeDiscount>0;var _htmlContentList=['<li class="popin_purchase_line">','<div class="popin_purchase_line_selector_container">','<input type="radio" name="quickViewPopinPurchaseLineSelector" value="'+i+'"'+(i===0?' checked="checked"':"")+" "+quickViewOrderGrooveDynamic(_sizeData)+"/>","</div>",'<div class="popin_purchase_line_core_container">',_title,"</div>",'<div class="popin_purchase_line_price_container">',_discount?'<span class="product_price_before">'+_sizeData.FormattedPriceBeforeDiscount+"</span>":"","<span>"+_sizeData.FormattedPrice+"</span>","</div>","</li>"];_list.append(_htmlContentList.join(""));quickViewOrderGrooveData(_sizeData,false)}}_quickViewPopinPurchaseArea.show();updatePopupQuickViewPurchaseArea();OCMS.addToDataLayer({event:"productQuickview",pagetemplate:OCMS.GlobalVars.CurrentTemplate,action:_jsonData.ShortTitle})}GlobalEqualizeElements();OCMS.Popin.current.container.center();quickViewOrderGrooveEnd();setPopupQuickViewMetrics();var _ajaxRequestTotalTime=(new Date).getTime()-_ajaxRequestStartTime;if(_ajaxRequestTotalTime<=2e3){$("#quickViewPopin .popinContent .popin-loading-mask").hide()}else{$("#quickViewPopin .popinContent .popin-loading-mask").fadeOut()}$(document).trigger("quickviewLoaded",[OCMS.controls.quickviewpopin.quickViewSizesDataArray])}});return false}function hidePopupQuickView(){OCMS.Popin.close();OCMS.events.quickviewLoaded=false}function setPopupQuickViewMetrics(){setTimeout(function(){$("#quickViewPopin .nano").get(0).style.height="auto";$("#quickViewPopin .nano .content").get(0).style.height="auto";$("#quickViewPopinProductDesc").get(0).style.height="auto";var _quickViewPopinProductDescReadMore=$("#quickViewPopinProductDescReadMore");if(OCMS.GlobalVars.Brand!="cdm"){var _readMoreWidth=_quickViewPopinProductDescReadMore.get(0).parentNode.offsetWidth;$("#quickViewPopinProductDescReadMore").width(_readMoreWidth);_readMoreWidth-=$("#quickViewPopinProductDescReadMoreRight").get(0).offsetWidth;$("#quickViewPopinProductDescReadMoreLeft").width(_readMoreWidth)}var _popinHeight=$("#quickViewPopin").height();var _popinContentHeight=$("#quickViewPopin > .popinContent").get(0).offsetHeight;OCMS.controls.quickviewpopin.quickViewPopinHeightOverflow=_popinContentHeight-_popinHeight;if(OCMS.controls.quickviewpopin.quickViewPopinHeightOverflow>0){var _readMoreMarginTop=parseInt(_quickViewPopinProductDescReadMore.css("marginTop"),10);var _readMoreHeight=_quickViewPopinProductDescReadMore.outerHeight();var _quickViewPopinProductDesc=$("#quickViewPopinProductDesc");var _quickViewPopinProductDescMaxHeight=_quickViewPopinProductDesc.height();var _quickViewPopinProductDescMinHeight=_quickViewPopinProductDescMaxHeight-OCMS.controls.quickviewpopin.quickViewPopinHeightOverflow-_readMoreHeight-_readMoreMarginTop;var _realMinHeight=65;var _addedMinHeight=_realMinHeight-_quickViewPopinProductDescMinHeight;if(_addedMinHeight>0){_quickViewPopinProductDescMinHeight=_realMinHeight;if(_quickViewPopinProductDescMinHeight>_quickViewPopinProductDescMaxHeight){_quickViewPopinProductDescMinHeight=_quickViewPopinProductDescMaxHeight}}else{_addedMinHeight=0}_quickViewPopinProductDesc.height(_quickViewPopinProductDescMinHeight);_quickViewPopinProductDesc.attr("data-min-height",_quickViewPopinProductDescMinHeight);_quickViewPopinProductDesc.attr("data-max-height",_quickViewPopinProductDescMaxHeight);if(_quickViewPopinProductDescMinHeight<_quickViewPopinProductDescMaxHeight){_quickViewPopinProductDescReadMore.addClass("show")}var _popinContentInnerHeight=$($("#quickViewPopin > .popinContent")[0]).height();var _nanoMarginTop=parseInt($($("#quickViewPopin .nano")[0]).css("marginTop"),10);$("#quickViewPopin .nano").get(0).style.height=_popinContentInnerHeight-_nanoMarginTop-_addedMinHeight+"px";$("#quickViewPopin .nano .content").get(0).style.height=_popinContentInnerHeight-_nanoMarginTop-_addedMinHeight+"px";if(_addedMinHeight>0){$("#quickViewPopin .nano").nanoScroller({scroll:"top",preventPageScrolling:true})}}},0)}function quickViewOrderGroove(_data){if("undefined"!=typeof og_settings){if($("#quickViewPopinPurchaseArea #og-div").length<=0){$(".popin_purchase_quantity_area").before('<div id="og-div"></div>')}$("#quickViewPopinLinkToBag").attr("data-og-event","addToBag");$("#quickViewPopinProductQuantitySelect").attr("data-og-id","qty")}}function quickViewOrderGrooveDynamic(_data){if("undefined"!=typeof og_settings){return'data-og-product="'+_data.SKU+'" data-og-event="selectProduct"'}else{return}}function quickViewOrderGrooveData(_data,clean){if("undefined"!=typeof og_settings){if("undefined"==typeof og_settings.offer_products&&"undefined"==typeof og_settings.recommended_frequency){og_settings.offer_products=[];og_settings.recommended_frequency={}}if(clean){og_settings.offer_products=[];og_settings.recommended_frequency={}}else{og_settings.offer_products.push(_data.SKU);og_settings.recommended_frequency[_data.SKU]=_data.AutoreplenishmentFreq+"_3"}}}function quickViewOrderGrooveEnd(){if(typeof og_settings!="undefined"&&typeof OG!="undefined"&&typeof OG.QuickView_Controller!="undefined"){OG.QuickView_Controller.quick_view_loaded()}}function updatePopupQuickViewPurchaseArea(aoProductData){var _sizeData=null;if(aoProductData===null||aoProductData===undefined){var _selectedItem=$("#quickViewPopinPurchaseList input[name='quickViewPopinPurchaseLineSelector']:checked");if(_selectedItem!==null&&_selectedItem!==undefined){var _index=_selectedItem.val();if(_index>=0&&_index<OCMS.controls.quickviewpopin.quickViewSizesDataArray.length){_sizeData=OCMS.controls.quickviewpopin.quickViewSizesDataArray[_index]}}}else{_sizeData=aoProductData}if(_sizeData!=null){$("#quickViewPopinProductImageMini").attr("src",_sizeData.Image);var _errorMessage=_sizeData.InStock?"":OCMS.controls.quickviewpopin.outOfStockLabel;$("#quickViewPopinProductQuantityErrorMessage").html(_errorMessage);var _quantitySelect=$("#quickViewPopinProductQuantitySelect");var _quantitySelectContainer=_quantitySelect.parent(".popin_purchase_quantity_container");_quantitySelect.html("");if(!_sizeData.InStock){$("#quickViewPopinProductQuantityLabel").hide();_quantitySelect.attr("disabled","disabled");_quantitySelect.hide();if(_quantitySelectContainer.length){_quantitySelectContainer.hide()}$("#quickViewPopinPurchaseButtonsAreaWrapper").addClass("one_button_layout");$("#quickViewPopinLinkToBag").hide()}else{var _quantityLimit=9;if(_sizeData.QuantityLimit!==null&&_sizeData.QuantityLimit!==undefined&&_sizeData.QuantityLimit!==""&&!isNaN(_sizeData.QuantityLimit)&&_sizeData.QuantityLimit>0){_quantityLimit=_sizeData.QuantityLimit}for(var i=1;i<=_quantityLimit;i++){_quantitySelect.append("<option"+(i==1?' selected="selected"':"")+">"+i+"</option>")}$("#quickViewPopinProductQuantityLabel").show();_quantitySelect.removeAttr("disabled");_quantitySelect.show();if(_quantitySelectContainer.length){_quantitySelectContainer.show()}$("#quickViewPopinPurchaseButtonsAreaWrapper").removeClass("one_button_layout");$("#quickViewPopinLinkToBag").show()}quickViewOrderGroove(_sizeData)}}