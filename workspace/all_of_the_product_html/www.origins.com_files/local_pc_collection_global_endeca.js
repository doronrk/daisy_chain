var generic=generic||{};var site=site||{};site.endeca=site.endeca||{catalog:{},result:{},results:{},resultsgroup:{},mixins:{},instances:{},generic:{Class:generic.Class||{},cookie:generic.cookie||{},env:generic.env||{},rb:generic.rb||{},template:generic.template||{}},helpers:{array:{toInt:function(b){for(var a=0;a<b.length;a++){b[a]=parseInt(b[a])}return b},unique:function(e){var d={},b,a=e.length,c=[];for(b=0;b<a;b+=1){d[e[b]]=e[b]}for(b in d){c.push(d[b])}return c},remove:function(c,b){var a;var b=jQuery.isArray(b)?b:[b];return jQuery.grep(c,function(d){return jQuery.inArray(d,b)==-1})}},func:{bind:function(){var b=arguments[0]||null;var c=arguments[1]||this;var a=jQuery.grep(arguments,function(d,e){return e>1});return function(){return b.apply(c,a)}}},string:{toQueryParams:function(c,f){var c=c||"";var f=f||"&";var e=c.substring(c.indexOf("?")+1).split("#")[0].split(f||"&"),h={},b,a,d,g;for(b=0;b<e.length;b++){g=e[b].split("=");a=decodeURIComponent(g[0]);d=(g[1])?decodeURIComponent(g[1]):"";if(h[a]){if(typeof h[a]=="string"){h[a]=[h[a]]}h[a].push(d)}else{h[a]=d}}return h}},obj:{first:function(b){for(var a in b){return b[a]}},slice:function(c,d){var b={};for(var a=0;a<d.length;a++){if(typeof c[d[a]]!="undefined"){b[d[a]]=c[d[a]]}}return b}}}};var rb=rb||{};site.endeca.generic.rb=function(b){var d=function(f){if(f&&rb){var e=f;var g=rb[e];if(g){return g}else{return{}}}else{return{}}};var a=d(b);var c={get:function(e){if(typeof(e)!="string"){return null}var f=a[e];if(f){return f}else{return e}}};return c};site.endeca.generic.Class=generic.Class||{fn:function(e,b){var f,c,d,a=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;f=function(){if(f.prototype.initialize){f.prototype.initialize.apply(this,arguments)}};e=e||Object;c=function(){};c.prototype=e.prototype;f.prototype=new c();f.superclass=e.prototype;f.prototype.constructor=f;for(d in b){if(typeof b[d]=="function"&&typeof f.superclass[d]=="function"&&a.test(b[d])){f.prototype[d]=(function(h,g){return function(){this._super=f.superclass[h];var i=g.apply(this,arguments);return i}})(d,b[d])}else{f.prototype[d]=b[d]}}return f},create:function(){var a=arguments.length,b=Array.prototype.slice.call(arguments),c=site.endeca.generic.Class.fn;if(a==2){tgt=site.endeca.generic.Class.fn(b[0],b[1])}else{if(a==1){tgt=site.endeca.generic.Class.fn(null,b[0])}else{tgt=function(){}}}return tgt},mixin:function(b,a){var d=b;if(a&&a.length){for(var c=0;c<a.length;c++){d=site.endeca.generic.Class.mixin(d,a[c])}}else{if(a){d=site.endeca.generic.Class.create(d,a)}}return d}};site.endeca.generic.cookie=generic.cookie||function(b,m,k){var l=document.cookie;if(arguments.length==1){var g=l.match(new RegExp("(?:^|; )"+b+"=([^;]*)"));if(g){g=decodeURIComponent(g[1]);try{return jQuery.parseJSON(g)}catch(i){return g}}else{return undefined}}else{k=k||{};var f=k.expires;if(typeof f=="number"){var j=new Date();j.setTime(j.getTime()+f*24*60*60*1000);f=k.expires=j}if(f&&f.toUTCString){k.expires=f.toUTCString()}m=encodeURIComponent(m);var a=b+"="+m;for(propName in k){a+="; "+propName;var h=k[propName];if(h!==true){a+="="+h}}document.cookie=a}};site.endeca.generic.env={isIE:!!(typeof(ActiveXObject)=="function"),isIE6:!!(!!(typeof(ActiveXObject)=="function")&&(/MSIE\s6\.0/.test(navigator.appVersion))),isFF:!!(typeof(navigator.product)!="undefined"&&navigator.product=="Gecko"&&!((document.childNodes)&&(!navigator.taintEnabled))&&/firefox/.test(navigator.userAgent.toLowerCase())),isFF2:!!(typeof(navigator.product)!="undefined"&&navigator.product=="Gecko"&&!((document.childNodes)&&(!navigator.taintEnabled))&&navigator.userAgent.toLowerCase().split(" firefox/")[1]&&navigator.userAgent.toLowerCase().split(" firefox/")[1].split(".")[0]=="2"),isFF3:!!(typeof(navigator.product)!="undefined"&&navigator.product=="Gecko"&&!((document.childNodes)&&(!navigator.taintEnabled))&&navigator.userAgent.toLowerCase().split(" firefox/")[1]&&navigator.userAgent.toLowerCase().split(" firefox/")[1].split(".")[0]=="3"),isMac:!!(/macppc|macintel/.test(navigator.platform.toLowerCase())),isSafari:!!(/Safari/.test(navigator.userAgent)),domain:window.location.protocol+"//"+window.location.hostname,debug:true,parsedQuery:function(){var query=window.location.search.toString().split("?")[1]||"";var splitStr=query.split("&");var key,value,keyNameVar,tempObj,tempStr;var a={};a.n={};var main=function(){var params={};var returnArr=[];var arr=[];if(!query){return}for(var i=0;i<splitStr.length;i++){key=splitStr[i].split("=")[0];value=splitStr[i].split("=")[1];var rx=new RegExp(key);var c=splitStr[i].match(rx);if(eval("a.n."+c)){eval("a.n."+c+".e += 1");eval("a.n."+c+".v.push(value);")}else{eval('keyNameVar = { v:[], key:"'+c+'" };');eval("a.n."+c+" = keyNameVar;");eval("a.n."+c+".e = new Number(0); a.n."+c+".v.push(value);")}}for(var namespace in a.n){if(a.n[namespace].e>0){for(var n=0;n<=a.n[namespace].e;n++){arr.push(a.n[namespace].v.pop())}a.n[namespace].v=arr}tempObj=a.n[namespace].v;if(tempObj.length>1){eval("params."+namespace+"=tempObj")}else{tempStr=tempObj[0];eval("params."+namespace+"=tempStr")}}return params};var parameters=main()||{};return parameters},query:function(a){var b=site.endeca.generic.env.parsedQuery()[a]||null;return b}};site.endeca.generic.template=(function(){var that={};var templateClassName=".inline-template";var templates={};var setInternalTemplate=function(key,html){templates[key]=html;return html};var getInternalTemplate=function(key){return templates[key]};var returnTemplate=function(args){if(typeof args.object==="object"){var html=interpolate(args.template,args.object)}else{var html=args.template}if(typeof args.callback==="function"){args.callback(html)}};var interpolate=function(template,obj){var obj=obj||{};var tmpl=template,Lre=new RegExp("#{"),Rre=new RegExp("}"),tmplA=[],temp,lft,rght;tmplA=tmpl.replace(/[\r\t\n]/g," ").split(Lre);var returnString="";for(var x=0;x<tmplA.length;x++){var chunk=tmplA[x];var splitChunk=chunk.split(Rre);if(typeof splitChunk[1]!=="undefined"){var valueToInsert=eval("obj['"+splitChunk[0]+"']")||eval("obj."+splitChunk[0]);if(typeof valueToInsert==="undefined"||valueToInsert===null){valueToInsert=""}chunk=valueToInsert.toString()+splitChunk[1]}returnString+=chunk}return returnString};that.get=function(args){var key=args.path;var callback=args.callback;var forceReload=!!args.forceReload;var objectParam=args.object;var template=getInternalTemplate(key);if(template&&!forceReload){returnTemplate({template:template,object:objectParam,callback:args.callback})}else{var matchingTemplateNode=null;jQuery(templateClassName).each(function(){if(jQuery(this).html()&&(jQuery(this).attr("path")==key)){matchingTemplateNode=this}});if(matchingTemplateNode){template=setInternalTemplate(key,jQuery(matchingTemplateNode).html());returnTemplate({template:template,object:args.object,callback:args.callback})}else{jQuery.ajax({url:key,context:this,data:args.urlparams,success:function(data,textStatus,jqXHR){template=setInternalTemplate(key,jqXHR.responseText);returnTemplate({template:template,object:args.object,callback:args.callback})}})}}};return that})();site.endeca.catalog=site.endeca.generic.Class.create({initialize:function(a){this.jsonResult=null;this.resultList=[];jQuery.extend(this,a||{});if(this.jsonResult){this.parseData()}},parseData:function(){if(this.jsonResult.AggrRecords){for(var b=0;b<this.jsonResult.AggrRecords.length;b++){for(var a=0;a<this.jsonResult.AggrRecords[b].Records.length;a++){this._parseRecord(this.jsonResult.AggrRecords[b].Records[a])}}}else{if(this.jsonResult.Records){for(var b=0;b<this.jsonResult.Records.length;b++){this._parseRecord(this.jsonResult.Records[b])}}}}});site.endeca.catalog.content=site.endeca.generic.Class.create(site.endeca.catalog,{_parseRecord:function(a){this.resultList.push({Properties:{image:site.endeca.generic.rb("endeca").get("content.image_url"),title:a.Properties.p_PROD_RGN_NAME,description:a.Properties.p_DESCRIPTION,link:a.Properties.p_url,link_text:site.endeca.generic.rb("endeca").get("content.link_text"),Zone:"crawlData"}})}});site.endeca.catalog.product=site.endeca.generic.Class.create(site.endeca.catalog,{initialize:function(a){this.categoryList={};this.productList={};this.skuList={};this.parseOrderHi=0;this.parseOrderLo=0;this._super(a);this.resultList=this.getProducts()},_parseRecord:function(b){if(b.Properties.rec_type=="product"){var a={};for(var d in b.Properties){var c=b.Properties[d];if(!isNaN(c)){if(c.match(/\./)){c=parseFloat(c)}else{c=parseInt(c)}}if(d.match(/_json/)){d=d.replace(/_json/,"");c=jQuery.parseJSON(c)}if(d.match(/^([a-z])_/)){a[RegExp.$1]=a[RegExp.$1]?a[RegExp.$1]:[];a[RegExp.$1][d.substr(2)]=c}}this.addProps(a.c,a.p,a.s)}},addProps:function(a,d,j,h){var f=a.CATEGORY_ID;var b=d.PRODUCT_ID;var g=j.SKU_ID;if(!f||!b||!g){return}var i=this.skuList[g]||{};this.skuList[g]=jQuery.extend(i,j);var c=this.productList[b]||{parseOrder:++this.parseOrderHi};if(h&&c.parseOrder>0){c.parseOrder=--this.parseOrderLo}c=jQuery.extend(c,d);if(!c.skus){c.skus=[]}if(!c.skuList){c.skuList={}}if(!c.skuList[g]){c.skus.push(i)}c.skuList[g]=i;this.productList[b]=c;var e=this.categoryList[f]||{};e=jQuery.extend(e,a);if(!e.prods){e.prods=[]}e.prods.push(c);this.categoryList[f]=e},getProducts:function(){function d(f,e){if(f.parseOrder>e.parseOrder){return 1}else{if(f.parseOrder<e.parseOrder){return -1}}return 0}function c(f,e){if(f.DISPLAY_ORDER>e.DISPLAY_ORDER){return 1}else{if(f.DISPLAY_ORDER<e.DISPLAY_ORDER){return -1}}return 0}var b=[];for(var a in this.productList){this.productList[a].skus.sort(c);b.push(this.productList[a])}b.sort(d);return b},getSkus:function(){var a=[];for(var b in this.skuList){a.push(this.skuList[b])}return a},getCategory:function(a){var b=(this.categoryList?this.categoryList[a]:null);return b},getProduct:function(a){var b=(this.productList?this.productList[a]:null);return b},getSku:function(b){var a=(this.skuList?this.skuList[b]:null);return a}});site.endeca.control=site.endeca.generic.Class.create({initialize:function(a){this.configuration=a||site.endeca.configuration;this.queryString=site.endeca.generic.env.query("qs")||"";this.searchTerm=site.endeca.generic.env.query("search")||"";this.hasResults=false;this.hasSearched=0;this.customClasses={};this.results={};this.queries={};this.catalogs={};this.nodes={};if(this.configuration.queries){this.generateQueries()}if(this.configuration.results){this.generateResults()}if(this.configuration.nodes){this.generateNodes()}if(this.configuration.coremetricsEnabled){site.endeca.coremetrics.initialize({enabled:true})}},generateQueries:function(){for(var a in this.configuration.queries){this.queries[a]=new site.endeca.query(jQuery.extend({callbackCompleted:site.endeca.helpers.func.bind(this.searchCompleted,this)},this.configuration.query,this.configuration.queries[a]||{}))}},generateResults:function(){for(var resultsName in this.configuration.results){this.configuration.results[resultsName].childClass=this.configuration.results[resultsName].childClass||"";var mixins=this.configuration.mixins[this.configuration.results[resultsName].mixinKey]||this.configuration.mixins[this.configuration.results[resultsName].childClass.replace(/site\.endeca\./,"")]||this.configuration.mixins[this.configuration.results[resultsName].baseClass.replace(/site\.endeca\./,"")+"."+resultsName]||this.configuration.mixins[this.configuration.results[resultsName].baseClass.replace(/site\.endeca\./,"")];var baseClass=eval(this.configuration.results[resultsName].baseClass);var childClass=eval(this.configuration.results[resultsName].childClass)||baseClass[resultsName]||{};this.customClasses[resultsName]=site.endeca.generic.Class.create(site.endeca.generic.Class.mixin(baseClass,mixins),childClass);this.results[resultsName]=new this.customClasses[resultsName](jQuery.extend({},{mixins:this.configuration.mixins,configuration:this.configuration.results[resultsName].configuration||{}},this.configuration.results[resultsName].instanceArgs||{}))}},generateNodes:function(){for(var a in this.configuration.nodes){this.nodes[a]=this.configuration.nodes[a]}},search:function(a){var a=a||{searchTerm:null,queryString:null};this.hasSearched++;this.showLoading();this.resetQueries();var d=a.queryString||this.queryString||"";var b=(d?site.endeca.helpers.string.toQueryParams(d)["Ntt"]:a.searchTerm)||this.searchTerm||"";for(var c in this.queries){this.queries[c].searchTerm=b;this.queries[c].queryString=this.queries[c].noQueryString?"":d;this.queries[c].prepare();this.queries[c].execute();this.searchTerm=this.queries[c].searchTerm}},searchCompleted:function(a){if(this.queriesCompleted()){this.resetResults();for(var b in this.queries){this.catalogs[b]=new site.endeca.catalog[b]({jsonResult:this.queries[b].jsonResult})}this.meta=new site.endeca.meta({query:this.queries.product,jsonResult:this.queries.product.jsonResult,searchKey:this.queries.product.searchKey,configuration:{followRedirects:this.configuration.followRedirects,contentzones:this.configuration.contentzones}});if(this.meta.redirecting){return false}this.hideLoading();return true}return false},queriesCompleted:function(){for(var a in this.queries){if(!this.queries[a].completed){return false}}return true},processCoremetrics:function(){if(this.configuration.coremetricsEnabled){site.endeca.coremetrics.reset();site.endeca.coremetrics.productCount=this.meta.searchInfo.totalProductRecords;site.endeca.coremetrics.contentCount=this.meta.searchInfo.totalContentRecords;site.endeca.coremetrics.searchTerm=this.meta.searchInfo.correctedTerms&&this.meta.searchInfo.correctedTerms.length?this.meta.searchInfo.correctedTerms[0]:this.queries.product.parsedSearchTerm();site.endeca.coremetrics.numberOfPages=this.meta.pagination?this.meta.pagination.numberOfPages:1;site.endeca.coremetrics.currentPage=this.meta.pagination?this.meta.pagination.numberOfCurrentPage:1;if(this.meta.dimensions.breadcrumbs){for(var b=0;b<this.meta.dimensions.breadcrumbs.length;b++){for(var a=0;a<this.meta.dimensions.breadcrumbs[b]["Dimension Values"].length;a++){site.endeca.coremetrics.addRefinement({dimensionName:this.meta.dimensions.breadcrumbs[b]["Dimension Name"],refinement:this.meta.dimensions.breadcrumbs[b]["Dimension Values"][a]["Dim Value Name"]})}}}site.endeca.coremetrics.setPageView()}},showLoading:function(){if(this.nodes.loading){this.nodes.loading.show()}},hideLoading:function(){if(this.nodes.loading){this.nodes.loading.hide()}},displayResults:function(){if(this.nodes.resultsContainer){if(this.hasResults){this.nodes.resultsContainer.show();if(this.results.bestsellers){this.results.bestsellers.hide()}}else{this.nodes.resultsContainer.hide();if(this.results.bestsellers){this.results.bestsellers.displayResults();this.results.bestsellers.show()}}}},resetQueries:function(){for(var a in this.queries){this.queries[a].reset()}},resetResults:function(){this.hasResults=false;for(var a in this.results){this.results[a].reset()}}});site.endeca.coremetrics={enabled:false,category_id:"search",page_id:"Search Results",productCount:0,contentCount:0,searchTerm:null,refinementsList:[],numberOfPages:1,currentPage:1,dimensionNameMap:{"Skin Type":"Typ","Skin Tone":"Ton"},initialize:function(a){jQuery.extend(this,a)},addRefinement:function(a){var a=a||{};if(a.dimensionName&&a.refinement){var d;if(this.dimensionNameMap[a.dimensionName]){d=this.dimensionNameMap[a.dimensionName]}else{var c=a.dimensionName.split(" ");d=c.shift().substr(0,3);for(var b=0;b<c.length;b++){d+=c[b].charAt(0)}}this.refinementsList.push(d+":"+a.refinement)}},setPageView:function(){var d=this.page_id+" "+this.currentPage;var b=this.category_id;var a=this.searchTerm;var e=this.contentCount+this.productCount;var c=this.refinementsList.join(" > ");if(c){d="Search Results Filtered "+this.currentPage}if(this.contentCount>0&&this.productCount==0){a="*"+a}cmCreatePageviewTag(d,a,b,e.toString(),c)},contentClick:function(){cmCreatePageElementTag("CONTENT","SEARCH DROPDOWN")},productClick:function(){cmCreatePageElementTag("PRODUCTS","SEARCH DROPDOWN")},seeAllClick:function(){cmCreatePageElementTag("SEE ALL","SEARCH DROPDOWN")},reset:function(){this.refinementsList=[]}};site.endeca.omniture={enabled:false,category_id:"search",page_id:"Search Results",productCount:0,contentCount:0,searchTerm:null,refinementsList:[],numberOfPages:1,currentPage:1,dimensionNameMap:{"Skin Type":"Typ","Skin Tone":"Ton"},initialize:function(a){jQuery.extend(this,a)},addRefinement:function(a){var a=a||{};if(a.dimensionName&&a.refinement){var d;if(this.dimensionNameMap[a.dimensionName]){d=this.dimensionNameMap[a.dimensionName]}else{var c=a.dimensionName.split(" ");d=c.shift().substr(0,3);for(var b=0;b<c.length;b++){d+=c[b].charAt(0)}}this.refinementsList.push(d+":"+a.refinement)}},searchResults:function(){var d=this.page_id+" "+this.currentPage;var b=this.category_id;var a=this.searchTerm;var e=this.contentCount+this.productCount;var c=this.refinementsList.join(" > ");if(c){d="Search Results Filtered "+this.currentPage}if(this.contentCount>0&&this.productCount==0){a="*"+a}console.log("SC PAGE VIEW");omnidata=[a,this.contentCount,this.productCount,c,d];tms_page_data.tms_page_info.SEARCH=omnidata;jQuery(window).trigger("OMNISEARCH",[omnidata])},contentClick:function(){},productClick:function(a){console.log("product ",a);jQuery(window).trigger("SEARCHPRODUCTCLK",[a])},seeAllClick:function(){jQuery(window).trigger("SEARCHALLCLK")},reset:function(){this.refinementsList=[]}};site.endeca.meta=site.endeca.generic.Class.create({initialize:function(a){this.jsonResult=null;this.searchKey="all";this.redirecting=false;this.pagination=null;this.dimensions={};this.metaInfo={};this.searchInfo={};this.supplementalObjects=[];this.supplementalContent={};jQuery.extend(this,a);if(this.jsonResult){this.parseData()}},parseData:function(a){this.processSupplemental();this.processMetaInfo();this.processSearchInfo();this.processPagination();this.processDimensions()},processMetaInfo:function(){this.metaInfo=this.jsonResult.MetaInfo||this.metaInfo;this.numberOfPages=this.getMetaProp("Number of Pages",1);this.recordsReturned=this.getMetaProp("Number of Records Returned",0);this.recordsPerPage=this.getMetaProp("Number of Records per Page",0);this.totalMatchRecords=this.getMetaProp("Total Number of Matching Records",0);this.totalAggrRecords=this.getMetaProp("Total Number of Matching Aggregate Records",0)},processSearchInfo:function(b){var b=b||{totalContentRecords:0};var a=this.jsonResult&&this.jsonResult["Search Info"]?this.jsonResult["Search Info"][this.searchKey]:{};this.searchInfo.searchTerm=a["Search Term"]||"";this.searchInfo.totalContentRecords=b.totalContentRecords||0;this.searchInfo.totalProductRecords=this.totalAggrRecords||this.totalMatchRecords;this.searchInfo.contentResultText=this.searchInfo.totalContentRecords==1?site.endeca.generic.rb("endeca").get("content_result"):site.endeca.generic.rb("endeca").get("content_results");this.searchInfo.productResultText=this.searchInfo.totalProductRecords==1?site.endeca.generic.rb("endeca").get("product"):site.endeca.generic.rb("endeca").get("products");this.searchInfo.totalRecords=parseInt(this.searchInfo.totalContentRecords)+parseInt(this.searchInfo.totalProductRecords);this.searchInfo.resultText=this.searchInfo.totalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results");this.searchInfo.startingRecord=this.searchInfo.totalProductRecords?this.getMetaProp("Starting Record Number",1):0;this.searchInfo.endingRecord=this.getMetaProp("Ending Record Number",1);this.searchInfo.originalRecords=this.searchInfo.totalRecords;this.searchInfo.originalResultText=this.searchInfo.resultText;this.searchInfo.correctedTerms=[];if(a["Spell Correction"]){for(var c=0;c<a["Spell Correction"].length;c++){if(a["Spell Correction"][c]["New Term"].toLowerCase().indexOf(this.searchInfo.searchTerm.toLowerCase())<0&&a["Spell Correction"][c]["AutoPhrasing"]=="false"){this.searchInfo.correctedTerms.push(a["Spell Correction"][c]["New Term"])}}}if(this.searchInfo.correctedTerms.length){this.searchInfo.originalRecords=0;this.searchInfo.originalResultText=this.searchInfo.originalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results")}this.searchInfo.didYouMean=[];if(a["DYM Information"]){for(var c=0;c<a["DYM Information"].length;c++){if(a["DYM Information"][c]["New Term"].toLowerCase().indexOf(this.searchInfo.searchTerm.toLowerCase())<0&&a["DYM Information"][c]["AutoPhrasing"]=="false"){this.searchInfo.didYouMean.push({"Selection Link":a["DYM Information"][c]["Pivot Link"],Term:a["DYM Information"][c]["New Term"]})}}}},processPagination:function(){if(this.numberOfPages>1){var a=new site.endeca.query(jQuery.extend(true,{},site.endeca.configuration.query,{recordsPerPage:10000}));this.pagination={numberOfPages:this.numberOfPages,numberOfCurrentPage:this.getMetaProp("Page Number",1),viewAllLink:this.query.getMergedQueryString(a.toQueryString()),previousPageLink:this.getMetaProp("Previous Page Link"),nextPageLink:this.getMetaProp("Next Page Link"),directPageLinks:this.getMetaProp("Direct Page Links","")}}},processDimensions:function(){var c=[];var f=[];if(this.jsonResult.Breadcrumbs){for(var b=0;b<this.jsonResult.Breadcrumbs.length;b++){var e=this.jsonResult.Breadcrumbs[b];if(e&&e.Type=="Navigation"){for(var a=0;a<e["Dimension Values"].length;a++){e["Dimension Values"][a]["Removal Link"]=this.query.getMergedQueryString(e["Dimension Values"][a]["Removal Link"],parseInt(e["Dimension Values"][a]["Dim Value ID"]))}c.push(e)}}}if(this.jsonResult.Refinements){for(var b=0;b<this.jsonResult.Refinements.length;b++){var d=this.jsonResult.Refinements[b];if(d&&d.Dimensions&&d.Dimensions[0]&&d.Dimensions[0]["Dimension Values"]){for(var a=0;a<d.Dimensions[0]["Dimension Values"].length;a++){d.Dimensions[0]["Dimension Values"][a]["Selection Link"]=this.query.getMergedQueryString(d.Dimensions[0]["Dimension Values"][a]["Selection Link"])}f.push(d.Dimensions[0])}}}if(c.length){this.dimensions.breadcrumbs=c}if(f.length){this.dimensions.refinements=f}},processSupplemental:function(){this.supplementalObjects=this.jsonResult["Supplemental Objects"]||this.supplementalObjects;for(var b=0;b<this.supplementalObjects.length;b++){var d=this.supplementalObjects[b];if(d.Properties){if(d.Properties["DGraph.KeywordRedirectUrl"]&&this.configuration.followRedirects){this.redirecting=true;document.location.href=d.Properties["DGraph.KeywordRedirectUrl"];return false}if(d.Properties["DGraph.SeeAlsoMerchId"]){var a=d.Properties.Zone;var c=this.supplementalContent[a]||{records:[]};c.style=d.Properties.Style;c.records.push(d);this.supplementalContent[a]=c}}}},getMetaProp:function(a,b){var c=(this.metaInfo[a]||b);if(!isNaN(c)){c=parseInt(c)}return c}});site.endeca.query=site.endeca.generic.Class.create({initialize:function(a){this.configuration=a||{};this.sessionId=Math.floor(Math.random()*999999)+1;this.url="/enrpc/JSONControllerServlet.do";this.urlParams={};this.queryString=null;this.searchTerm="";this.searchKey="all";this.searchMode="matchallpartial";this.searchDimensions=true;this.computePhrasings=true;this.didYouMean=true;this.recordsPerPage=10;this.pageNumber=1;this.sortKey=null;this.rollup=true;this.rollupId="p_PRODUCT_ID";this.rollupDetail=true;this.defaultRangeFilters={skuShoppable:"s_shoppable|GT+0",skuPromotional:"s_promotional|GT+0",skuSearchable:"s_searchable|GT+0",productTrFlag:"p_TR_FLAG|LT+1",productDisplayable:"p_displayable|GT+0",productShoppable:"p_shoppable|GT+0"};this.rangeFilters=["skuShoppable","skuSearchable"];this.additionalRangeFilters=[];this.defaultRecordFilters={products:"rec_type:product",content:"rec_type:content",locale:"locale:"+(site.endeca.generic.cookie("LOCALE")||"en_US"),activeSkus:"NOT(s_INVENTORY_STATUS:5)",discontinued:"NOT(s_discontinued:1)"};this.recordFilters=[];this.additionalRecordFilters=[];this.recordId=null;this.configureLocale({props:["MDEXHost","MDEXPort","logHost","logPort","defaultDimensionIds"],locale:site.endeca.generic.cookie("LOCALE")});jQuery.extend(this,this.configuration);this.recordFilters.push("locale");this.completed=0;this.exportUrlParams=["N","Ne","Nao","Ntt","D","M"];this.setupServer()},reset:function(){this.urlParams={};this.queryString=null;this.jsonResult=null;this.completed=0},prepare:function(){this.setupServer();if(this.recordId){this.setupRecordId()}else{if(this.searchTerm){this.searchTerm=jQuery.trim(this.parsedSearchTerm());if(this.computePhrasings){this.setupPhraseComputation()}if(this.didYouMean){this.setupDidYouMean()}if(this.searchDimensions){this.setupDimensionSearch()}this.setupSearch()}}if(this.pageNumber){this.setupPage()}if(this.sortKey){this.setupSort()}if(this.rollup){this.setupRollUp()}this.setupNavigation();this.setupRangeFilters();this.setupRecordFilters();if(this.queryString){this.queryString=decodeURIComponent(this.queryString);this.processQueryString()}else{this.setupDimensionIds()}},execute:function(){var a=this.url+"?"+this.toQueryString();jQuery.ajax({url:a,type:"get",context:this,complete:this.onComplete})},onComplete:function(a){this.completed=1;this.rawResult=a.responseText;this.jsonResult=jQuery.parseJSON(this.rawResult);this.callbackCompleted()},toQueryString:function(a){var a=a||{};var b=a.urlParams?jQuery.param(a.urlParams):jQuery.param(this.urlParams);b=b.replace(/%2B/gi,"+");return b},processQueryString:function(){this.urlParams=jQuery.extend(true,this.urlParams,site.endeca.helpers.string.toQueryParams(this.queryString));this.searchTerm=this.urlParams.Ntt||"";this.setupDimensionIds();this.setupRangeFilters();this.setupRecordFilters()},getMergedQueryString:function(c,b){var e=site.endeca.helpers.string.toQueryParams(c);if(!e.Nao){e.Nao=0}var a=jQuery.extend(true,{},this.urlParams,e);var d=this._getDimensionIds({urlParams:e,oldDimensionIds:this.urlParams.Ne});d=site.endeca.helpers.array.remove(d,this.defaultDimensionIds);d=b?site.endeca.helpers.array.remove(d,b):d;a.Ne=d.join("+");return this.toQueryString({urlParams:site.endeca.helpers.obj.slice(a,this.exportUrlParams)})},setupServer:function(){this.urlParams.M="host:"+this.MDEXHost+"|port:"+this.MDEXPort+"|recs_per_page:"+this.recordsPerPage;this.urlParams.L="SESSION_ID:"+this.sessionId+"|host:"+this.logHost+"|port:"+this.logPort},setupRecordId:function(){this.urlParams.R=this.recordId},setupNavigation:function(){this.urlParams.N=""},setupDimensionIds:function(){var a=this._getDimensionIds({urlParams:this.urlParams});if(a.length){this.urlParams.Ne=a.join("+")}},setupSearch:function(a){var a=a||{};this.urlParams.Ntt=a.searchTerm||this.searchTerm;this.urlParams.Ntk=this.searchKey;this.urlParams.Ntx=this.searchMode.match(/mode\+/)?this.searchMode:("mode+"+this.searchMode)},setupDimensionSearch:function(a){var a=a||{};this.urlParams.D=a.searchTerm||this.searchTerm;this.urlParams.Dx=this.searchMode.match(/mode\+/)?this.searchMode:("mode+"+this.searchMode)},setupPhraseComputation:function(){this.urlParams.Ntpc=1;this.urlParams.Ntpr=1},setupDidYouMean:function(){this.urlParams.Nty=1},setupSort:function(){this.urlParams.Ns=this.sortKey},setupRollUp:function(){this.urlParams.Nu=this.rollupId;this.urlParams.Np=this.rollupDetail?2:1},setupPage:function(){this.urlParams.Nao=(this.pageNumber-1)*this.recordsPerPage},setupRangeFilters:function(){var a=this._getFilters(this.rangeFilters,this.additionalRangeFilters,this.defaultRangeFilters);if(a.length){this.urlParams.Nf=a.join("|")}},setupRecordFilters:function(){var a=this._getFilters(this.recordFilters,this.additionalRecordFilters,this.defaultRecordFilters);if(a.length){this.urlParams.Nr="AND("+a.join(",")+")"}},_getFilters:function(a,d,b){var c=[];jQuery.each(a,function(f,e){c.push(b[e])});jQuery.each(d,function(f,e){c.push(e)});return c},_getDimensionIds:function(a){var b=[];if(a.oldDimensionIds){b=b.concat(a.oldDimensionIds.split("+"))}if(a.addDefaultDimensionIds){b=b.concat((a.oldDimensionIds).split("+"))}b=b.concat(a.urlParams&&a.urlParams.Ne?(a.urlParams.Ne).split("+"):[]);b=b.concat(this.defaultDimensionIds);b=site.endeca.helpers.array.toInt(b);b=site.endeca.helpers.array.unique(b);return b},parsedSearchTerm:function(){var a;try{a=decodeURIComponent(this.searchTerm)}catch(b){a=this.searchTerm}return a.replace(/\+/g," ")},configureLocale:function(a){var a=a||{props:[],locale:""};for(var b=0;b<a.props.length;b++){if(typeof this.configuration[a.props[b]]=="object"&&typeof this.configuration[a.props[b]][a.locale]!="undefined"){this.configuration[a.props[b]]=this.configuration[a.props[b]][a.locale]}}}});site.endeca.result=site.endeca.generic.Class.create({initialize:function(a){this.parentNode=null;this.node=null;this.resultData=null;this.templatePath=null;jQuery.extend(this,a||{})},displayResult:function(a){var a=a||{};var c=a.parentNode||this.parentNode;var b=this;site.endeca.generic.template.get({path:b.templatePath,object:a.resultData||b.resultData,callback:function(d){d=jQuery.trim(d);if(d){b.node=jQuery(d);if(c&&b.node){c.append(b.node)}b.displayResultCallback(a)}}})},displayResultCallback:function(a){},reset:function(){if(this.node&&this.node.parentNode&&this.node!=this.parentNode){this.node.remove()}else{this.parentNode.empty()}},hide:function(){this.parentNode.hide()},show:function(){this.parentNode.show()}});site.endeca.results=site.endeca.generic.Class.create({initialize:function(a){this.parentNode=null;this.node=null;this.headerNode=null;this.contentNode=null;this.resultData=[];this.resultNodes=[];this.resultClass=null;this.configuration={};this.mixins={};jQuery.extend(this,a)},setupNodes:function(a){var a=a||{};var b=a.parentNode||this.parentNode;this.node=b||a.node;if(this.node){if(this.containerTemplatePath){this.loadContainer({parentNode:b})}this.headerNode=this.node.find(".results-header:first").length?this.node.find(".results-header:first"):null;this.contentNode=this.node.find(".results:first").length?this.node.find(".results:first"):this.node}},displayResults:function(a){var a=a||{};a.childClass=a.childClass||this.childClass;this.setupNodes(a);var b=a.resultData||this.resultData;var c=this;jQuery.each(b,function(d,e){c.createResult(jQuery.extend(a,{result:e,index:d}))})},loadContainer:function(b){var b=b||{};var a=b.containerTemplatePath||this.containerTemplatePath;var c=this;site.endeca.generic.template.get({path:a,object:b.resultData||c.resultData,callback:function(d){d=jQuery.trim(d);if(d){c.node=jQuery(d);if(b.parentNode&&c.node){b.parentNode.append(c.node)}}}})},createResult:function(a){var a=a||{};this.setResultClass(a);var b=new this.resultClass({parent:this,templatePath:a.templatePath||this.templatePath,resultData:a.result,parentNode:a.contentNode||this.contentNode,configuration:a.configuration||this.configuration,mixins:a.mixins||this.mixins});this.resultNodes.push(b)},setResultClass:function(b){var b=b||{};var a=b.baseClass||this.baseClass||site.endeca.result;if(!this.resultClass){b.childClass=b.childClass||this.childClass||"";var c=b.mixins||this.mixins["result."+b.childClass]||this.mixins.result||{};this.resultClass=b.childClass&&a[b.childClass]?site.endeca.generic.Class.create(site.endeca.generic.Class.mixin(a,c),a[b.childClass]):site.endeca.generic.Class.mixin(a,c)}},displayResultNodes:function(){for(var a=0;a<this.resultNodes.length;a++){this.resultNodes[a].displayResult()}if(this.resultNodes.length){if(this.resultNodes[0].node){this.resultNodes[0].node.addClass("first")}if(this.resultNodes[this.resultNodes.length-1].node){this.resultNodes[this.resultNodes.length-1].node.addClass("last")}}},hide:function(){this.parentNode.hide()},show:function(){this.parentNode.show()},reset:function(){if(this.containerTemplatePath){if(this.node){this.node.remove()}}else{if(this.contentNode){this.contentNode.empty()}else{if(this.node){this.node.empty()}}}this.resultData=[];this.resultNodes=[]}});site.endeca.resultsgroup=site.endeca.generic.Class.create(site.endeca.results,{initialize:function(a){this.baseClass=site.endeca.results;this._super(a)},displayResults:function(a){var a=a||{};var b=this;if(b.parentNode&&b.parentNode.length>1){b.parentNode.each(function(){a.parentNode=jQuery(this);b._super(a)})}else{b._super(a)}},createResult:function(a){var a=a||{};a.childClass=this.resultsChildClass||a.childClass;a.mixins=a.mixins||this.mixins["results."+a.childClass]||this.mixins.results;this.setResultClass(a);var b=new this.resultClass(jQuery.extend({resultData:a.result,parentNode:this.contentNode||this.node||this.parentNode,summaryResultData:this.summaryResultData,mixins:this.mixins,configuration:a.configuration||this.configuration},a.resultsArgs||this.resultsArgs||{}));this.resultNodes.push(b)},reset:function(){for(var a=0;a<this.resultNodes.length;a++){this.resultNodes[a].reset()}this._super()}});site.endeca.mixins.accordion={displayResults:function(a){this._super(a);this.setupAccordion()},setupAccordion:function(){this.accordionHeaderNode=this.node.find(".accordion-header:first");this.accordionContentNode=this.node.find(".accordion-content:first");if(this.accordionHeaderNode.length&&this.accordionContentNode.length){var a=this;this.accordionHeaderNode.unbind("click");this.accordionHeaderNode.bind("click",a,a.toggleAccordion)}},toggleAccordion:function(a){a.preventDefault();a.data.accordionHeaderNode.toggleClass("collapsed");a.data.accordionContentNode.toggle()},openAccordion:function(){if(this.accordionHeaderNode.length&&this.accordionContentNode.length){this.accordionHeaderNode.removeClass("collapsed");this.accordionContentNode.show()}},closeAccordion:function(){if(this.accordionHeaderNode.length&&this.accordionContentNode.length){this.accordionHeaderNode.addClass("collapsed");this.accordionContentNode.hide()}}};site.endeca.mixins.links={displayResultCallback:function(b){var b=b||{};b.resultData=b.resultData||this.resultData;var e=b["Selection Link"]||b.resultData["Selection Link"]||b.resultData["Removal Link"];var d=b.node||b.parentNode||this.node||this.parentNode;d=d.find(".link-mixin").length?d.find(".link-mixin"):d.find("a").length?d.find("a"):d;if(e&&d){var c=this;d.bind("click",{that:c,link:e},c.onClick);d.bind("simulate:click",{that:c,link:e},c.onClick);if(d.href){var f=site.endeca.generic.env.parsedQuery();f.qs=encodeURIComponent(e);var a=document.location.pathname+"?"+jQuery.param(f);d.href=a}}}};site.endeca.mixins.links.address=jQuery.extend({},site.endeca.mixins.links,{onClick:function(a){jQuery.address.value("?"+a.data.link);scroll(0,0);a.preventDefault();return false}});site.endeca.mixins.noReset={displayResults:function(a){if(this.resultNodes.length==0){this._super(a)}},reset:function(){}};site.endeca.mixins.selectbox={setupNodes:function(a){this._super(a);var b=this;var c=this.node.find("select").length?this.node.find("select"):this.parentNode.find("select").length?this.parentNode.find("select"):"";if(c){c.bind("change",b,b.onChange)}},onChange:function(c){var b=c.data;var a=this.options[this.selectedIndex];jQuery(a).trigger("simulate:click");c.preventDefault();return false}};site.endeca.mixins.summary={initialize:function(a){this._super(a);this.summaryResultData={totalRecords:this.resultData.length};this.summaryResultData.resultText=this.summaryResultData.totalRecords==1?site.endeca.generic.rb("endeca").get("result"):site.endeca.generic.rb("endeca").get("results")},setupNodes:function(a){var a=a||{};this._super(a);if(this.node){this.summaryNode=this.node.find(".results-summary").length?this.node.find(".results-summary"):null}},displayResults:function(a){this._super(a);this.setupSummary()},setupSummary:function(){if(this.summaryNode&&this.configuration.summaryTemplatePath&&this.summaryResultData){this.summary=new site.endeca.result({parentNode:this.summaryNode,templatePath:this.configuration.summaryTemplatePath,resultData:this.summaryResultData});this.summary.displayResult()}},reset:function(a){this._super(a);if(this.summaryNode){this.summaryNode.empty()}}};site.endeca.result.product={initialize:function(a){this.shadeResults=null;this.addButton=null;this._super(a)},displayResult:function(a){this.setupReviewData();this.setupBrandData();this._super(a)},displayResultCallback:function(a){this.setupQuickShop();this.setupAddToBag();if(this.resultData.shaded){this.setupShades()}},setupReviewData:function(){this.resultData.ratingDisplay=this.resultData.TOTAL_REVIEW_COUNT?"block":"none";this.resultData.ratingReviewWord=this.resultData.TOTAL_REVIEW_COUNT&&this.resultData.TOTAL_REVIEW_COUNT>1?site.endeca.generic.rb("language").get("reviews"):site.endeca.generic.rb("language").get("review");this.resultData.ratingRounded=this.resultData.TOTAL_REVIEW_COUNT?Math.round(this.resultData.AVERAGE_RATING*10)/10:0},setupBrandData:function(){},setupQuickShop:function(){var b=this.node.find("a.quickshop_link");if(b&&typeof brx!="undefined"){var a=this;b.bind("click",function(d){d.preventDefault();var c=brx.productView.quickshop({productData:a.resultData})});b.bind("mouseover",function(c){jQuery(this).find(".quickshop-btn").addClass("qs-active")});b.bind("mouseout",function(c){jQuery(this).find(".quickshop-btn").removeClass("qs-active")})}},setupAddToBag:function(){var b=this.node.find("a.description-add-link");var a=this.node.find("span.add-progress");if(typeof brx!="undefined"&&b.length){this.addButton=brx.productView.addButton({addButtonNode:$(b[0]),progressNode:$(a[0]),skuData:this.resultData.skus[0],itemType:"cart"})}},setupNote:function(){},setupGiftSetComponents:function(){},setupShades:function(){var a=this.node.find(".shades");var b=this.node.find(".swatches");if(a.length&&b.length){var d;if(typeof this.configuration.maxmimumShades!="undefined"&&this.resultData.skus.length>this.configuration.maxmimumShades){this.node.find(".more-shades").show();d=this.resultData.skus.slice(0,this.configuration.maxmimumShades)}else{d=this.resultData.skus.slice(0)}for(var c=0;c<d.length;c++){d[c].PRODUCT_ID=this.resultData.PRODUCT_ID;d[c].url=this.resultData.url}this.shadeResults=new site.endeca.results({resultData:d,parentNode:b,childClass:"shade",configuration:jQuery.extend({},this.configuration,{addButton:this.addButton}),mixins:this.mixins});this.shadeResults.displayResults();this.shadeResults.show();a.show()}}};site.endeca.result.refinementAdditive={onClick:function(g){var f=g.data.that;var e=f.resultData["Selection Link"];var d=site.endeca.helpers.string.toQueryParams(e)["N"];var a=site.endeca.helpers.string.toQueryParams(document.location.hash)["N"];var c=a?a.split("+"):[];for(var b=0;b<c.length;b++){if(f.parent.refinementIDs[c[b]]){c.splice(b,1)}}c.push(d);g.data.link=e.replace(/N=[0-9+]*&/,"N="+c.join("+")+"&");this._super(g)}};site.endeca.result.shade={initialize:function(a){this._super(a);this.templatePath="/templates/endeca/products/shade.tmpl";this.displayResult()},displayResultCallback:function(a){this.drawSwatch();this.initListeners()},drawSwatch:function(a){if(!this.resultData.HEX_VALUE_STRING||this.resultData.HEX_VALUE_STRING.length<1){return}var c=this.node.find(".swatch")||this.node;var b=this.resultData.HEX_VALUE_STRING.split(/,/);c.css({"background-color":b[0]})},initListeners:function(a){var b=this;this.node.bind("click",b,function(d){var c=d.data;c.node.siblings("li").removeClass("active");c.node.addClass("active");c.configuration.addButton.setSkuData(c.resultData);c.node.css({border:"1px solid #5e8a2c"});c.node.siblings("li").css({border:"1px solid #fff"})})}};site.endeca.result.summary={displayResult:function(c){var c=c||{};if(this.resultData.searchTerm==""){this.templatePath="/templates/endeca/summary/no-term.tmpl"}else{if(this.hasResults){this.templatePath="/templates/endeca/summary/results.tmpl";this.resultData.productAnchorLinkDisplay=this.resultData.totalProductRecords>0?"inline":"none";this.resultData.contentAnchorLinkDisplay=this.resultData.totalContentRecords>0?"inline":"none";this.resultData.productResultText+=this.resultData.totalContentRecords>0?",":""}else{this.templatePath="/templates/endeca/summary/no-results.tmpl"}}this._super(c);var a=this.node.find(".searchTerms");if(this.resultData.breadcrumbs&&a.length){var f=[];for(var e=0;e<this.resultData.breadcrumbs.length;e++){for(var b=0;b<this.resultData.breadcrumbs[e]["Dimension Values"].length;b++){f.push(', "'+this.resultData.breadcrumbs[e]["Dimension Values"][b]["Dim Value Name"]+'"')}}a.append(f.join(""))}var g=this.node.find("#auto-correct");if(this.resultData.correctedTerms&&this.resultData.correctedTerms.length&&g.length){this.templatePath="/templates/endeca/summary/auto-correct.tmpl";c.resultData=this.resultData;c.resultData.correctedTerm=this.resultData.correctedTerms.join(",");c.parentNode=g;this._super(c)}var d=this.node.find("#did-you-mean");if(this.resultData.didYouMean&&this.resultData.didYouMean.length&&d.length){this.templatePath="/templates/endeca/summary/did-you-mean.tmpl";c.resultData=this.resultData.didYouMean[0];c.parentNode=d;this._super(c)}},reset:function(){this.parentNode.empty()}};site.endeca.results.breadcrumbs={initialize:function(a){this.childClass="breadcrumb";this._super(a);this.resultData["Dimension Name"]=site.endeca.generic.rb("endeca").get("dimension."+(this.resultData["Dimension Name"].replace(/ /gi,"_").toLowerCase()));var c=this;var b=jQuery.map(this.resultData["Dimension Values"],function(d){return jQuery.extend(d,{"Dimension Name":c.resultData["Dimension Name"]})});this.displayResults({resultData:this.resultData["Dimension Values"]});this.displayResultNodes()}};site.endeca.results.bestsellers={initialize:function(a){this.childClass="product";this._super(a)},displayResults:function(){var a=this;this.query=new site.endeca.query(jQuery.extend({callbackCompleted:function(){var b=new site.endeca.catalog.product({jsonResult:a.query.jsonResult});a.resultData=b.resultList;a._super();a.displayResultNodes()}},site.endeca.configuration.query,this.configuration.queryArgs||{}));this.query.prepare();this.query.execute()},createResult:function(a){a.result.context="bestseller-product";this._super(a)}};site.endeca.results.contentzone=site.endeca.generic.Class.create(site.endeca.results,{displayResults:function(a){this.zoneName=this.resultData[0].Properties.Zone;this._super(a)},createResult:function(a){var a=a||{};a.templatePath=this.configuration.templatePath;this._super(a)}});site.endeca.results.contentzone.content={initialize:function(a){this._super(a);this.configuration.summaryTemplatePath="/templates/endeca/content/summary.tmpl";if(this.resultData.length){this.displayResults()}},displayResults:function(a){this._super(a);this.displayResultNodes()},createResult:function(a){a.result=a.result.Properties;a.result.target=a.result.new_window?"_blank":"";this._super(a)}};site.endeca.results.contentzone.products={initialize:function(c){this.childClass="product";this._super(c);this.query=null;var a=[];for(var d=0;d<this.resultData.length;d++){for(var b=0;b<this.resultData[d]["Records"].length;b++){a.push(this.resultData[d]["Records"][b]["Record Spec"])}}this.query=new site.endeca.query(jQuery.extend({callbackCompleted:site.endeca.helpers.func.bind(this.searchCompleted,this),searchMode:"matchany",searchTerm:a.join(" "),searchKey:"rec_id"},site.endeca.configuration.query,this.configuration.queryArgs||{}));this.query.prepare();this.query.execute()},searchCompleted:function(){var a=new site.endeca.catalog.product({jsonResult:this.query.jsonResult});this.displayResults({resultData:a.getProducts()});this.displayResultNodes()},createResult:function(a){a.result.context="featured-product";a.result.callout=site.endeca.generic.rb("endeca").get("callout.featured-product");this._super(a)}};site.endeca.results.pagination={initialize:function(a){this._super(a);this.displayResults()},displayResults:function(){if(this.resultData){this.setupNodes();if(this.resultData.viewAllLink&&this.configuration.viewAllLink){this.createResult({templatePath:"/templates/endeca/pagination/viewall.tmpl",result:{"Selection Link":this.resultData.viewAllLink}})}if(this.resultData.previousPageLink&&this.configuration.previousPageLink){this.createResult({templatePath:"/templates/endeca/pagination/previous.tmpl",result:{"Selection Link":this.resultData.previousPageLink}})}var b=this.contentNode;if(this.configuration.containerTemplatePath){this.containerTemplatePath=this.configuration.containerTemplatePath;this.setupNodes()}for(var a=0;a<this.resultData.directPageLinks.length;a++){this.createResult({templatePath:this.resultData.numberOfCurrentPage==a+1?"/templates/endeca/pagination/current.tmpl":"/templates/endeca/pagination/link.tmpl",result:{"Selection Link":this.resultData.directPageLinks[a],Content:a+1}})}this.contentNode=b;if(this.resultData.nextPageLink&&this.configuration.nextPageLink){this.createResult({templatePath:"/templates/endeca/pagination/next.tmpl",result:{"Selection Link":this.resultData.nextPageLink}})}this.displayResultNodes()}},setupSummary:function(){return;if(this.paginationSummaryNode){if(this.summaryResultData&&this.summaryResultData.totalProductRecords>1){var a="endeca.templates.pagination.summary.shown";if(this.resultData&&this.resultData.numberOfCurrentPage==1){a="endeca.templates.pagination.summary.topShown"}this.createResult({templatePath:a,result:this.summaryResultData,contentNode:this.paginationSummaryNode})}if(this.resultData&&this.resultData.nextPageLink){this.createResult({templatePath:"endeca.templates.pagination.summary.next",result:{"Selection Link":this.resultData.nextPageLink},contentNode:this.paginationSummaryNode})}if(this.summaryResultData){var c=null;var d=null;if(this.summaryResultData.startingRecord==1&&this.summaryResultData.endingRecord>10){c="endeca.templates.pagination.summary.viewLess";d={}}else{if(this.summaryResultData.totalProductRecords>10){c="endeca.templates.pagination.summary.viewAll";d={recordsPerPage:10000}}}if(c){var b=new site.endeca.base.query(d);this.createResult({templatePath:c,result:{"Selection Link":b.toQueryString()},contentNode:this.paginationSummaryNode})}}}}};site.endeca.results.products={initialize:function(a){this.childClass="product";this._super(a)},displayResults:function(a){var a=a||{};this._super(a);this.displayResultNodes()},createResult:function(a){a.templatePath=this.childTemplatePath||"/templates/endeca/products/result.tmpl";a.result.context="product";this._super(a)}};site.endeca.results.recentsearches={initialize:function(a){this.searchTerm=null;this._super(a)},displayResults:function(a){this.setupRecentSearches();this._super({templatePath:"/templates/endeca/recent-search.tmpl"});this.displayResultNodes()},setupRecentSearches:function(){var a=encodeURIComponent(this.searchTerm);var c=typeof site.endeca.generic.cookie("researches")!="undefined"?String(site.endeca.generic.cookie("researches")).split(":::"):[];if(this.searchTerm){c.unshift(a)}c=site.endeca.helpers.array.unique(c).splice(0,this.configuration.maximumRecentSearches);if(c&&c.length){site.endeca.generic.cookie("researches",c.join(":::"));for(var b=0;b<c.length;b++){this.resultData.push({searchTerm:decodeURIComponent(c[b]).replace(/\+/," "),"Selection Link":"Ntt="+c[b],"Display Link":"?search="+c[b]})}}}};site.endeca.results.refinements={initialize:function(a){this.containerTemplatePath="/templates/endeca/refinements/container.tmpl";this.childClass="refinement";this.moreRefinement=null;this.refinementIDs={};this._super(a);if(this.configuration.refinementContainerTemplates&&this.configuration.refinementContainerTemplates[this.resultData["Dimension ID"]]){this.containerTemplatePath=this.configuration.refinementContainerTemplates[this.resultData["Dimension ID"]]}this.resultData["Dimension Name RB"]=site.endeca.generic.rb("endeca").get("dimension."+(this.resultData["Dimension Name"].replace(/ /gi,"_").toLowerCase()));this.displayResults({resultData:this.resultData["Dimension Values"]});this.displayResultNodes()},createResult:function(a){a.templatePath=this.childTemplatePath||"/templates/endeca/refinements/link.tmpl";if(this.configuration.refinementTemplates&&this.configuration.refinementTemplates[this.resultData["Dimension ID"]]){a.templatePath=this.configuration.refinementTemplates[this.resultData["Dimension ID"]]}if(this.resultData["Dim Value Properties"]&&this.resultData["Dim Value Properties"]["DGraph.More"]&&a.result["Dim Value Name"]=="More..."){a.templatePath="/templates/endeca/refinements/show-all.tmpl";this.moreRefinement=a.result["Dim Value ID"]}else{this.refinementIDs[a.result["Dim Value ID"]]=1}this._super(a)}};site.endeca.resultsgroup.contentzones={initialize:function(a){this.resultData={};this.zones={};this.crawlData=[];this.hasSoloResults=false;this.totalResults=0;this.contentzones={};this._super(a)},setCrawlData:function(a){var a=a||{};if(a.crawlData&&a.crawlData.length){this.resultData.crawlData={style:"content",records:a.crawlData}}},setupNodes:function(a){var a=a||{};this.node=this.parentNode||a.node},displayResults:function(b){var b=b||{};b.baseClass=site.endeca.results.contentzone;for(var a in this.contentzones){this.resultClass=null;var d=b;var c=this.resultData[a];if(c&&c.records&&c.records.length){d.resultData=[this.resultData[a].records];d.childClass=this.resultData[a].style.match(/product/i)?"products":"content";d.node=this.contentzones[a].node;if(this.contentzones[a].solo){this.hasSoloResults=true}if(this.contentzones[a].counted){this.totalResults+=this.resultData[a].records.length}d.configuration=this.contentzones[a];d.mixins=this.mixins["results.contentzone"];this._super(d);d.node.show()}else{this.contentzones[a].node.hide()}}},hide:function(){for(var a=0;a<this.resultNodes.length;a++){this.resultNodes[a].hide()}},show:function(){for(var a=0;a<this.resultNodes.length;a++){this.resultNodes[a].show()}},reset:function(){for(var a=0;a<this.resultNodes.length;a++){this.resultNodes[a].reset()}this.totalResults=0}};site.endeca.resultsgroup.refinements={initialize:function(a){this.moreRefinements=[];this._super(a)},displayResults:function(a){var a=a||{};a.childClass="refinements";this._super(a);var b=this;jQuery(".expand-all").each(function(d,c){if(b.moreRefinements.length){if(b.displayResultCallback){b.displayResultCallback({"Selection Link":"Ne="+b.moreRefinements().join("+"),node:d})}d.show()}else{d.hide()}})},moreRefinements:function(){if(this.moreRefinements.length){return this.moreRefinements}else{for(var a=0;a<this.resultNodes.length;a++){if(this.resultNodes[a].moreRefinement){this.moreRefinements.push(this.resultNodes[a].moreRefinement)}}}},reset:function(a){this.moreRefinements=[];this._super(a)}};site.endeca.configuration={query:{MDEXHost:"localhost",MDEXPort:16200,logHost:site.endeca.generic.env.domain.match(/www/)?"njlndca01":"localhost",logPort:16204,defaultDimensionIds:[8048,8050,8051,8052,8053,8054,8061,8062,8063,8089,8095,8096,8127,8147,8155,8156,8157,8158,8159]},coremetricsEnabled:true,contentzones:{},mixins:{}};var site=site||{};site.endeca=site.endeca||{};site.endeca.instances=site.endeca.instances||{};site.endeca.instances.typeahead=site.endeca.instances.typeahead||{};site.endeca.instances.typeahead.control=site.endeca.generic.Class.create(site.endeca.control,{initialize:function(a){this._super(a);if(this.nodes.wrapper.length&&this.nodes.inputElement.length){var b=this;this.nodes.inputElement.bind("keyup",b,b.onKeyUp);this._watchToClose()}},onKeyUp:function(c){var b=c.data;var a=jQuery.trim(b.nodes.inputElement[0].value);if(a!=b.searchTerm&&a.length>=b.configuration.minSearchLength){b.searchTerm=a;c.data.search({searchTerm:a})}},_watchToClose:function(){var a=this;jQuery(document).bind("click",a,function(c){var d=c.target;var b=c.data;b.nodes.closeLinks.each(function(){if(this==d){b.nodes.wrapper.hide();return false}});if(!jQuery(d).parents(b.nodes.wrapper.selector).length&&d!=b.nodes.inputElement[0]&&d!=b.nodes.wrapper[0]){b.nodes.wrapper.hide();return}})},searchCompleted:function(){if(!this._super()){return}this.results.products.resultData=this.catalogs.product.resultList;if(this.results.products.resultData.length){this.results.products.displayResults();this.results.products.show();this.hasResults=true}else{this.results.products.hide()}this.results.content.contentzones=this.configuration.contentzones;this.results.content.resultData=this.meta.supplementalContent;this.results.content.setCrawlData({crawlData:this.catalogs.content.resultList});this.results.content.displayResults();if(!jQuery.isEmptyObject(this.results.content.resultData)){this.meta.processSearchInfo({totalContentRecords:this.results.content.totalResults});this.results.content.show();if(this.results.content.hasSoloResults){this.hasResults=true}}else{this.results.content.hide()}var a=this.nodes.wrapper.find("a.see-all-results");a.attr("href",this.configuration.fullSearchBaseUrl+this.queries.product.parsedSearchTerm());this.results.summary_text.resultData={totalProducts:this.catalogs.product.resultList.length,totalRecords:this.catalogs.product.resultList.length+this.catalogs.content.resultList.length,resultText:this.meta.searchInfo.resultText};this.results.summary_text.hasResults=this.hasResults;this.results.summary_text.displayResult();this.nodes.wrapper.show();if(this.hasResults){if(this.nodes.noResults){this.nodes.noResults.hide()}else{this.nodes.wrapper.show()}a.show();this.results.summary_text.show()}else{if(this.nodes.noResults){this.nodes.noResults.show()}else{this.nodes.wrapper.hide()}a.hide();this.results.summary_text.hide()}this.hideLoading()},showLoading:function(){this._super()}});var site=site||{};site.endeca=site.endeca||{};site.endeca.instances=site.endeca.instances||{};site.endeca.instances.typeahead=site.endeca.instances.typeahead||{};jQuery(document).ready(function(){site.endeca.instances.typeahead.configuration=jQuery.extend(true,{},site.endeca.configuration,{followRedirects:false,minSearchLength:3,fullSearchBaseUrl:"/products/search/esearch.tmpl?search=",contentzones:{},nodes:{wrapper:jQuery("#global-typeahead-search-box"),inputElement:jQuery("#globalnav-search"),loading:jQuery(".loading","#global-typeahead-search-box"),closeLinks:jQuery(".typeahead-close-link","#global-typeahead-search-box")},queries:{product:{recordFilters:["discontinued","activeSkus","products"],recordsPerPage:3,defaultDimensionIds:[]},content:{recordFilters:["content"],recordsPerPage:1}},results:{summary_text:{baseClass:"site.endeca.result",instanceArgs:{parentNode:jQuery(".summary","#global-typeahead-search-box"),templatePath:"/templates/endeca/typeahead/product-summary.tmpl"}},products:{baseClass:"site.endeca.results",instanceArgs:{parentNode:jQuery(".product-results","#global-typeahead-search-box"),childTemplatePath:"/templates/endeca/typeahead/product-result.tmpl"},configuration:{summaryTemplatePath:"/templates/endeca/typeahead/product-summary.tmpl"}},content:{baseClass:"site.endeca.resultsgroup",childClass:"site.endeca.resultsgroup.contentzones"}}});new site.endeca.instances.typeahead.control(site.endeca.instances.typeahead.configuration)});