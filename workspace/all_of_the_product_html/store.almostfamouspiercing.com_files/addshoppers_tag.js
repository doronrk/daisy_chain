/*
 (c) 2011 - 2014 Magnetic Media Online, Inc.
 Version: 0.7
 Date: 1417586431.4884925
 Privacy: http://www.magnetic.com/privacy/corporate-privacy-policy/
*/
if("undefined"==typeof _mag){var _mag={};_mag.settings={}}"undefined"==typeof console&&(console={},console.log=function(){}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){function e(){a.initSettings(),i.init(r),r.bestTemplateResults=n.init(r.templates)||{},r.intervals=r.maxTries,a.searchReady()||(a.log("starting intervals"),r.readyInterval=window.setInterval(a.searchReady,100)),r.debugMode&&(_mag.Smag=a,_mag.PixelsController=i,_mag.Parser=n)}var r="settings"in _mag?_mag.settings:{},a={initSettings:function(){a.log("init settings."),r.defaultKeywords="keyword",r.publisherKeywords="kw"in _mag?_mag.kw:null,r.ns=null,r.keywordSource="pub",r.startTime="startTime"in _mag?_mag.startTime:"0",r.tagVersion="0.7",r.executeTime=(new Date).getTime(),r.debugMode="debugMode"in r&&r.debugMode?!0:!1,r.isIFrame=~~(window!=window.top),r.isSecure="https:"==document.location.protocol,r.protocol=r.isSecure?"https:":"http:",r.currentURL=window.location,r.publicHost=a.getPublicHost(),r.refURL=a.getReferrerUrl(),r.title=document.title.substr(0,150),r.urlParams=window.location.search.substr(1),r.maxTries=1,r.readyInterval=null,r.magURL=r.protocol+"//d3ezl4ajpp2zy8.cloudfront.net",r.pixelURL=r.protocol+"//addshoppers.t.domdex.com/search.js",r.pixelFired=!1,r.queryStringObject=a.getQueryStringObject(),r.pathnameArray=a.getPathnameArray(),r.excludedTerms={search:!0},r.templates=[{id:7,keyword:"s",name:"Result Page",pairings:{},url:"youngcons.com"},{id:8,keyword:"query",name:"Result Page",pairings:{},url:"allheart.com"},{id:9,keyword:"q",name:"Result Page",pairings:{},url:"madvapes.com"},{id:10,keyword:"q",name:"Result Page",pairings:{},url:"alkosto.com"},{id:11,keyword:"q",name:"Result Page",pairings:{},url:"more-thing.com"},{id:12,keyword:"q",name:"Result Page",pairings:{},url:"babypark.nl"},{id:13,keyword:"0",name:"Result Page",pairings:{},url:"coolglow.com"},{id:14,keyword:"Ntt",name:"Result Page",pairings:{},url:"rosenberryrooms.com"},{id:15,keyword:"query",name:"Result Page",pairings:{},url:"gravitydefyer.com"},{id:16,keyword:"q",name:"Result Page",pairings:{},url:"globalindustrial.ca"},{id:17,keyword:"q",name:"Result Page",pairings:{},url:"hmall.ma"},{id:18,keyword:"q",name:"Result Page",pairings:{},url:"sunglasswarehouse.com"},{id:19,keyword:"s",name:"Result Page",pairings:{},url:"diariocolatino.com"},{id:20,keyword:"keywords",name:"Result Page",pairings:{},url:"freshwatersystems.com"},{id:21,keyword:"q",name:"Result Page",pairings:{},url:"readers.com"},{id:22,keyword:"w",name:"Result Page",pairings:{},url:"swimshop.co.uk"},{id:23,keyword:"q",name:"Result Page",pairings:{},url:"preciousmoments.com"},{id:24,keyword:"q",name:"Result Page",pairings:{},url:"ktronix.com"},{id:25,keyword:"f",name:"Result Page",pairings:{},url:"classicfirearms.com"},{id:26,keyword:"searchText",name:"Result Page",pairings:{},url:"discountwatchstore.com"},{id:27,keyword:"2",name:"Result Page",pairings:{},url:"fastgsm.com"},{id:28,keyword:"w",name:"Result Page",pairings:{},url:"emitations.com"},{id:29,keyword:"q",name:"Result Page",pairings:{},url:"hairextensionsale.com"},{id:30,keyword:"q",name:"Result Page",pairings:{},url:"thepromgirls.com"},{id:31,keyword:"keywords",name:"Result Page",pairings:{},url:"cablesandkits.com"},{id:32,keyword:"search",name:"Result Page",pairings:{},url:"goddiva.co.uk"},{id:33,keyword:"q",name:"Result Page",pairings:{},url:"lightingnewyork.com"},{id:34,keyword:"query",name:"Result Page",pairings:{},url:"mobilehomepartsstore.com"},{id:35,keyword:"q",name:"Result Page",pairings:{},url:"scottevest.com"},{id:36,keyword:"k",name:"Result Page",pairings:{},url:"primabead.com"},{id:37,keyword:"keywords",name:"Result Page",pairings:{},url:"carandtruckremotes.com"},{id:38,keyword:"q",name:"Result Page",pairings:{},url:"shopjeen.com"},{id:39,keyword:"w",name:"Result Page",pairings:{},url:"compacc.com"},{id:40,keyword:"q",name:"Result Page",pairings:{},url:"123greetings.com"},{id:41,keyword:"q",name:"Result Page",pairings:{},url:"lowrangeoffroad.com"},{id:42,keyword:"q",name:"Result Page",pairings:{},url:"directfix.com"},{id:43,keyword:"q",name:"Result Page",pairings:{},url:"herbspro.com"},{id:44,keyword:"q",name:"Result Page",pairings:{},url:"halfoffdeals.com"},{id:45,keyword:"search_query",name:"Result Page",pairings:{},url:"ceasmania.ro"},{id:46,keyword:"query",name:"Result Page",pairings:{},url:"californiapetpharmacy.com"},{id:47,keyword:"q",name:"Result Page",pairings:{},url:"sainsmart.com"},{id:48,keyword:"kw",name:"Result Page",pairings:{},url:"therawfoodworld.com"},{id:49,keyword:"q",name:"Result Page",pairings:{},url:"skincarerx.com"},{id:50,keyword:"q",name:"Result Page",pairings:{},url:"luckytacklebox.com"},{id:51,keyword:"0",name:"Result Page",pairings:{},url:"skates.co.uk"},{id:52,keyword:"keyword",name:"Result Page",pairings:{},url:"oldwillknottscales.com"},{id:53,keyword:"q",name:"Result Page",pairings:{},url:"blauer.com"},{id:54,keyword:"query",name:"Result Page",pairings:{},url:"fairhavenhealth.com"},{id:55,keyword:"searchterm",name:"Result Page",pairings:{},url:"unlocksamsungonline.com"},{id:56,keyword:"searchTerms",name:"Result Page",pairings:{},url:"healthproductsforyou.com"},{id:57,keyword:"Search",name:"Result Page",pairings:{},url:"lockpickshop.com"},{id:58,keyword:"Search",name:"Result Page",pairings:{},url:"mybabycart.com"},{id:59,keyword:"q",name:"Result Page",pairings:{},url:"veggietales.com"},{id:60,keyword:"search_query",name:"Result Page",pairings:{},url:"wishtrend.com"},{id:61,keyword:"search_query",name:"Result Page",pairings:{},url:"fitnessgiant.com"},{id:62,keyword:"query",name:"Result Page",pairings:{},url:"nobleworkscards.com"},{id:63,keyword:"SearchTerm",name:"Result Page",pairings:{},url:"golfetail.com"},{id:64,keyword:"keywords",name:"Result Page",pairings:{},url:"compressionstockings.com"},{id:65,keyword:"Search",name:"Result Page",pairings:{},url:"saelig.com"},{id:66,keyword:"search_query",name:"Result Page",pairings:{},url:"shop-agroland.ro"},{id:67,keyword:"q",name:"Result Page",pairings:{},url:"mobstyle.in"},{id:68,keyword:"search_query",name:"Result Page",pairings:{},url:"urunmerkezi.com"},{id:69,keyword:"q",name:"Result Page",pairings:{},url:"uniquemobiles.com.au"},{id:70,keyword:"search_query",name:"Result Page",pairings:{},url:"dvddeocasion.com"},{id:71,keyword:"q",name:"Result Page",pairings:{},url:"1nita.my"},{id:72,keyword:"q",name:"Result Page",pairings:{},url:"leonardo.com.ro"},{id:73,keyword:"s",name:"Result Page",pairings:{},url:"keobongda.vn"}],r.pixels_map=null,r.conversion_pixels="conversion_pixels"in _mag?_mag.conversion_pixels:[],r.retargeting_pixels="retargeting_pixels"in _mag?_mag.retargeting_pixels:[],a.log(r)},getReferrerUrl:function(){var e=document.referrer;return(void 0==e||""==e)&&(e=_mag.refUrl),void 0==e&&(e=""),e.length>147&&(e=e.substr(0,147)+"..."),a.log("Smag.getReferrerUrl: Referrer url "+e),e},searchReady:function(){if(a.log("Smag.searchReady - interval: "+r.intervals),!r.pixelFired){var e=r.bestTemplateResults.keyword;return e?a.stopSearch(e,"Smag.searchReady: found page kws: "+e+" -- clear ing interval"):(r.intervals--,r.intervals<=0&&a.stopSearch(null,"Smag.searchReady - page kws not found - forcing track without")),!0}},stopSearch:function(e,i){e&&(r.bestTemplateResults.ns=a.decodeKeywords(e)),a.log(i),a.trackQuery(),window.clearInterval(r.readyInterval)},escapeRegExp:function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},getPublicHost:function(){var e=window.location.hostname.split("."),r=e.length;return 3==r&&"uk"!=e[r-1]&&e.shift(),a.log("Smag.getPublicHost: Public host is "+e.join(".")),e.join(".")},getQueryStringObject:function(){for(var e=window.location.search.substring(1),r=e.split("&"),a={},i=0;i<r.length;i++){var n=r[i].split("=");a[n[0]]=n[1]}return a},getPathnameArray:function(){for(var e=window.location.pathname.split("/"),r=[],a=0;a<e.length;a++)e[a].trim().length&&r.push(decodeURIComponent(e[a].trim()));return r},trackQuery:function(){a.log("trackingQuery");var e=r.publisherKeywords;r.keywordSource="pub",null==e&&(e=r.defaultKeywords,r.keywordSource="defkwd"),r.bestTemplateResults.ns&&(e=r.bestTemplateResults.ns,r.keywordSource="page");var n=a.buildSearchTrackingUrl(e);document.body.appendChild(i.buildScript(n)),r.pixelFired=!0,a.log(n)},log:function(e){r.debugMode&&console.log(e)},buildSearchTrackingUrl:function(e){var i=a.decodeKeywords(e),n={k:i,ks:r.keywordSource,pk:r.publisherKeywords,s:"1",t1:r.startTime,t2:r.executeTime,t3:(new Date).getTime(),v:r.tagVersion,u:r.currentURL,r:r.refURL,ifr:r.isIFrame,tit:r.title};for(var t in r.bestTemplateResults)n[t]=r.bestTemplateResults[t];return a.log("Smag.buildSearchTrackingUrl: Search params are "+a.encodeQueryData(n)),r.pixelURL+"?"+a.encodeQueryData(n)},decodeKeywords:function(e){var r=e.replace(/\+/g," ").replace(/&/g," and ").replace(/\|/g," or ").replace(/\(|\)|\'| +(?= )/g,"").replace(/ AND | OR /g," ").replace(/"/g,"");return decodeURIComponent(r)},encodeQueryData:function(e){var r=[];for(var a in e){var i=e[a]?encodeURIComponent(e[a]):"";r.push(encodeURIComponent(a)+"="+i)}return r.join("&")}},i={init:function(e){"undefined"!=typeof e.pixels_map&&null!=e.pixels_map&&("undefined"!=typeof e.pixels_map.conversion&&null!=e.pixels_map.conversion&&e.pixels_map.conversion!=[]&&i.firePixels(e.pixels_map.conversion,e.conversion_pixels,"conversion"),"undefined"!=typeof e.pixels_map.retargeting&&null!=e.pixels_map.retargeting&&e.pixels_map.retargeting!=[]&&i.firePixels(e.pixels_map.retargeting,e.retargeting_pixels,"retargeting"))},firePixels:function(e,r){if(e.length>0&&r.length>0){var a=null;for(var n in e)~r.indexOf(e[n].pixel_id)&&(a=i.buildPixel(e[n]),null!=a&&document.body.appendChild(a))}},buildPixel:function(e){var r=null;return e.pixel_js_url?r=i.buildScript(e.pixel_js_url):e.pixel_img_url&&(r=i.buildImage(e.pixel_img_url)),r},buildScript:function(e){var r=document.createElement("script");return r.type="text/javascript",r.src=e,r},buildImage:function(e){var r=document.createElement("img");return r.src=e,r.style="display: none;",r.height=1,r.width=1,r},detectUrl:function(e){var i=r.currentURL;return i=i.split("#")[0],target_url_regex=new RegExp("^https?:\\/\\/"+e,"gi"),a.log("Smag.detectUrl: Current Url: "+i),i.match(target_url_regex)?!0:!1},detectDomain:function(e){var i=r.publicHost,n=new RegExp(e,"gi");return a.log("Smag.detectDomain: Current Domain: "+i),i.match(n)?!0:!1}},n={init:function(e){if("undefined"!=typeof e&&null!=e&&e.length>0){for(var r,a,t=null,o=0,s=0;s<e.length;s++){var l=e[s];if(i.detectDomain(l.url)){r=n.parsePairings(l);var u=n.countSuccessfulPairings(r);u>=o&&(o=u,t=l)}}return t&&(a=n.parseDOMWithTemplate(t),a.ns=n.parseKeyword(t.keyword),a.tid=t.id),a}},parseKeyword:function(e){return n.isNumeric(e)?r.pathnameArray[parseInt(e,10)]:r.queryStringObject[e]},parsePairings:function(e){var r={};for(var a in e.pairings)r[a]=n.getElementByXPath(e.pairings[a]);return r},parseBreadcrumb:function(e){var r=/(\w+.?[>\|/].?)+\w+/g,a=/(\||>|\.)/g;if(e.match(r)){var i=e.match(a),t=i.length>0?i[0]:void 0;if("undefined"!=typeof t){for(var o=e.split(t),s=0;s<o.length;s++)o[s]=n.collapseWhiteSpace(o[s]);return o}}},countSuccessfulPairings:function(e){var r=0;for(var a in e)null!==e[a]&&"undefined"!=typeof e[a]&&r++;return r},parseDOMWithTemplate:function(e){var r={};for(var a in e.pairings)switch(a){case"bc":r[a]=n.parseBreadcrumb(e.pairings[a]);break;default:r[a]=n.getTextByXPath(e.pairings[a])}return r},getElementByXPath:function(e){return document.evaluate(e,document,null,9,null).singleNodeValue},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getText:function(e){var r,a="",i=0,t=e.nodeType;if(t){if(1===t||9===t||11===t){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)a+=n.getText(e)}else if(3===t||4===t)return e.nodeValue}else for(;r=e[i++];)a+=n.getText(r);return a},collapseWhiteSpace:function(e){return e=e.replace(/\s+/g," "),e.replace(/^\s+|\s+$/g,"")},getTextByXPath:function(e){var r=n.getElementByXPath(e);if(null!==r)return n.collapseWhiteSpace(n.getText(r))}};e()}();