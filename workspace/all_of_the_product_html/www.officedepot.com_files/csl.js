var selectedItemSku;var selectedItemQty;var allItemsSku=[];var allItemsQty=[];var eQtyClicked;var eQtyAll=[];var DEFAULT_QTY=1;var INIT_QTY=DEFAULT_QTY;var addToList={skuPageElementName:'input[name^="cmd_addCSL.button.INDEX["]',enableSkuPageAddToList:function(){$(this.skuPageElementName).on("click",function(a){if($("#cslDoLogin").length){doCslLoginFromSkuDetailsPage(this,a)}else{cleanUp();eQtyClicked=$('input[name="entryFormList[0].qty"]');selectedItemQty=eQtyClicked.val();if($.trim(selectedItemQty)==""){selectedItemQty="1"}selectedItemSku=$("#skuId").val();loadCSLLightbox(a)}})},disableSkuPageAddToList:function(){$(this.skuPageElementName).off("click").on("click",function(a){a.preventDefault()})}};$(function csl_ready(){if($('input[name="addToCart_schoolList"]').length==false){INIT_QTY=""}else{$('input[name^="cmd_addList.button.INDEX["]').each(function(d){var e=$(this).attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,"");var c='input[name="entryFormList['+e+'].qty"]';$(c).val(DEFAULT_QTY)})}$('input[name^="cmd_addList.button.INDEX["]').click(function(j){if($("#cslDoLogin").length){doCslLoginFromSkuListingsPage(this,j)}else{cleanUp();var i=$(this);var f=i.closest("form");var g=i.attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,"");var d='input[name="entryFormList['+g+'].qty"]';eQtyClicked=f.find(d);selectedItemQty=eQtyClicked.val();var k="#sku_"+g;selectedItemSku=f.find(k).val();var h=$("#pickedListId");if(h.length){addToListBTS(h.text(),true);return false}loadCSLLightbox(j)}});addToList.enableSkuPageAddToList();$("#addAllToList").click(function(d){cleanUp();$('input[name^="cmd_addList.button.INDEX["]').each(function(f){var g=$(this).attr("name").replace(/^cmd_addList.button.INDEX\[|\]$/g,"");var e='input[name="entryFormList['+g+'].qty"]';var h=$(e);eQtyAll.push(h);allItemsQty.push(h.val());var j="#sku_"+g;allItemsSku.push($(j).val())});selectedItemSku=allItemsSku.join(",");selectedItemQty=allItemsQty.join(",");var c=$("#pickedListId");if(c.length){addToListBTS(c.text(),true);return false}if($("#cslDoLogin").length){var b="clickedAddAllToCSL=true&cslItemQty="+selectedItemQty+"&cslSku="+selectedItemSku;common_uielements.loadModalLoginBehavior($(this).attr("name"),"body","#accountLoginDialog",true,d,b)}else{loadCSLLightbox(d)}});$('form .quantity_box input[type="number"]').each(function(){bindQty($(this))});var a=window.location.pathname;if((a=="/checkout/confirmRouter.do")&&($("#btsBefore").length<1)){$.ajax({type:"GET",url:common_utils.appendSessionId("/mobile/schoolback/fivePercent.do"),async:false,cache:false,success:function(b){response=$.parseJSON(b);if(!$.trim(response.schoolInfo)==""){$("#fivePercentBack").show();$("#schoolInfo").html(response.schoolInfo)}else{$("#btsOffer").show()}}})}if($(".enteritem").length>0){enforceAlphaNumeric("#"+this.id)}if($("#skuNumber").length>0){enforceAlphaNumeric("#skuNumber")}if($("#skuNumber_cart").length>0){enforceAlphaNumeric("#skuNumber_cart")}});function loadCSLLightbox(b){if(b=="undefined"||!b){}else{b.preventDefault()}var a=$("#generic-form-ready-dialog");var c=$("#csl_title_chooseorcreate").val();common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap");a.load(common_utils.appendSessionId("/ajaxhtml/displayShoppingLists.do"),function(d){$("#createListButton").click(function(f){common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap");loadCreateListLightBox(f)});$(".addToListBTS").click(function(f){addToListBTS($(this).attr("id"))});$(".addToListShopping").click(function(g){common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap");var f=$(this).attr("id");$.post("/ajaxhtml/cslItemsAdd.do",buildCSLParameter(f),function(e){loadPageItemsAdded(e)})});common_uielements.hideAjaxLoading()});openCSLPopup(a,c)}function addToListBTS(b,a){if(a){openCSLPopup($("#generic-form-ready-dialog"),$("#csl_title_pleasewait").val())}common_uielements.showAjaxLoadingInsideElement("div.addlist_wrap");$.post("/ajaxhtml/tppcAddToList.do",{sku:selectedItemSku,qty:selectedItemQty,listId:b,listStyle:"tppc"},function(c){loadPageItemsAdded(c)})}function loadCreateListLightBox(b){var a=$("#generic-form-ready-dialog");a.load(common_utils.appendSessionId("/ajaxhtml/displayCreateList.do"),function(c){$("#saveListDetails").click(function(d){common_uielements.showAjaxLoadingInsideElement("div.create_list_wrap",$("#csl_title_addingtolist").val());$("#validate_message").hide();createCSLAndAddItems()});fillDataForCreateBTS();common_uielements.hideAjaxLoading()});openCSLPopup(a,$("#csl_title_createnewlist").val())}function openCSLPopup(a,b){a.dialog({modal:true,title:b,width:460,position:"center",dialogClass:"bg_white"})}function fillDataForCreateBTS(){$('#startSchoolList input[name="bts_sku"]').val(selectedItemSku);$('#startSchoolList input[name="bts_qty"]').val(selectedItemQty)}function createCSLAndAddItems(){var a=$("#validate_message");if($.trim($("#newListName").val()).length==0){common_uielements.hideAjaxLoading();a.html($("#csl_required_listname").val());a.show();return false}$.getJSON("/csl/createCslAndAddItems.do",buildCreateAndAddParams(),function(b){if(b.errorMessage){common_uielements.hideAjaxLoading();a.html(b.errorMessage);a.show()}else{$.post("/ajaxhtml/cslItemsAdded.do",{listId:b.listId,listStyle:"csl"},function(c){loadPageItemsAdded(c)})}})}function buildCreateAndAddParams(){var a=buildCSLParameter("");a.newListName=$("#newListName").val();a.newDescription=$("#newDescription").val();a.action="new";return a}function buildCSLParameter(a){var c={};c.destinationListId=a;c.listId=a;c.listStyle="csl";c.cmd_addtolist="ADD TO LIST";c.useSelected=false;c.ajax="y";if(allItemsQty.length==0){c["entryFormList[0].sku"]=selectedItemSku;c["entryFormList[0].qty"]=selectedItemQty}else{for(var b=0;b<allItemsQty.length;b++){c["entryFormList["+b+"].sku"]=allItemsSku[b];c["entryFormList["+b+"].qty"]=allItemsQty[b];c["entryFormList["+b+"].selected"]=true}}return c}function loadPageItemsAdded(b){var a=$("#generic-form-ready-dialog");a.html(b);renderItems();if($("#cslListNameAdded").length){openCSLPopup(a,sumItems()+" "+$("#csl_title_itemsadded").val())}else{openCSLPopup(a,$("#csl_title_error").val())}cleanQty();$("#continueShopping").click(function(c){a.dialog("close")});$("#viewMyList").click(function(c){window.location.href=$("#aMyList").attr("href")});$("#shareList").click(function(c){a.dialog("close");common_uielements.collabPopup($("#modalCollabSkus").text())})}function renderItems(){var b=$("#cslConfirm");var c;if(allItemsQty.length==0){c=$("span[class='added_sku_id_"+selectedItemSku+"'][title='"+getQty(selectedItemQty)+"']").first().text();b.append("<tr><td>"+c+"</td></tr>")}else{for(var a=0;a<allItemsQty.length;a++){c=$("span[class='added_sku_id_"+allItemsSku[a]+"'][title='"+getQty(allItemsQty[a])+"']").first().text();b.append("<tr><td>"+c+"</td></tr>")}}}function sumItems(){if(allItemsQty.length==0){return 1}return allItemsQty.length}function getQty(b){if(b==""){return DEFAULT_QTY}var a=b;if(typeof b!=="number"){a=parseInt(b,10)}if(isNaN(a)){a=DEFAULT_QTY}if(a==0){return a}return Math.max(a,0)}function cleanQty(){if(allItemsQty.length==0){if(eQtyClicked!==undefined){eQtyClicked.val(INIT_QTY)}}else{for(var a=0;a<eQtyAll.length;a++){eQtyAll[a].val(INIT_QTY)}}}function cleanUp(){selectedItemSku="";selectedItemQty="";allItemsSku=[];allItemsQty=[];eQtyClicked=null;eQtyAll=[]}function doCslLoginFromSkuListingsPage(g,h){cleanUp();var f=$(g).attr("name").replace("cmd_addList.button.INDEX[","");f=f.replace("]","");var d='input[name="entryFormList['+f+'].qty"]';eQtyClicked=$(d);selectedItemQty=eQtyClicked.val();if($.trim(selectedItemQty)==""){selectedItemQty="1"}var i="#sku_"+f;selectedItemSku=$(i).val();var a="clickedAddToCSL=true&cslItemQty="+selectedItemQty+"&cslSku="+selectedItemSku;common_uielements.loadModalLoginBehavior($(this).attr("name"),"body","#accountLoginDialog",true,h,a)}function doCslLoginFromSkuDetailsPage(b,c){cleanUp();eQtyClicked=$('input[name="entryFormList[0].qty"]');selectedItemQty=eQtyClicked.val();if($.trim(selectedItemQty)==""){selectedItemQty="1"}selectedItemSku=$("#skuId").val();var a="clickedAddToCSL=true&cslItemQty="+selectedItemQty+"&cslSku="+selectedItemSku;common_uielements.loadModalLoginBehavior($(b).attr("name"),"body","#accountLoginDialog",true,c,a)}function enforceAlphaNumeric(a){$(document).on("keyup",a,function(b){$(b.target).val($(b.target).val().replace(/[^A-Za-z0-9-]+/g,""))});$(document).on("blur",a,function(c){var b=$(c.target).val().replace(/^[^a-zA-Z0-9]*|[^a-zA-Z0-9]*$/g,"");$(a).val(b)})};