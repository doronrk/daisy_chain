if(typeof(SearchJS)=="undefined"||SearchJS==null||!SearchJS){SearchJS={initialized:false,autoSuggestTimer:-1,autoSuggestKeystrokeDelay:400,autoSuggestHover:false,autoSuggestPreviousTerm:"",autoSuggestURL:"",autoSelectOption:-1,historyIndex:-1,retrievedCachedSuggestions:[],myProductsShoppingListItemAdded:null,TOTAL_SUGGESTED:4,TOTAL_HISTORY:2,AUTOSUGGEST_THRESHOLD:1,DYNAMIC_AUTOSUGGEST_THRESHOLD:1,CACHED_AUTOSUGGEST_OFFSET:1000,END_OF_LIST:false,STATIC_CONTENT_SECTION_DIV:["autoSuggestStatic_1","autoSuggestStatic_2","autoSuggestStatic_3"],staticContentHeaderHistory:"",CachedSuggestionsURL:"",SearchAutoSuggestServletURL:"",searchDepartmentHoverTimeout:"",searchSuggestionHoverTimeout:"",finderType:"",finderTypes:[],form:null,myProductsWishListId:null,lastInputValue:null,setMyProductsWishListId:function(id){this.myProductsWishListId=id;},setCreatedMyProductsWishListId:function(serviceResponse){this.myProductsWishListId=serviceResponse.listId;},searchDepartmentSelect:function(categoryId,lel){byId("searchDepartmentLabel"+SearchJS.finderType).innerHTML=lel.innerHTML;byId("search_categoryId"+SearchJS.finderType).value=categoryId;this.hideSearchDepartmentList();return false;},cancelEvent:function(e){if(e.stopPropagation){e.stopPropagation();}if(e.preventDefault){e.preventDefault();}e.cancelBubble=true;e.cancel=true;e.returnValue=false;},searchDepartmentKeyPressed:function(event,pos,size,categoryId,item){if(event.keyCode==13){this.searchDepartmentSelect(categoryId,item);var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){dojo.byId("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType).focus();}else{SearchJS.form.searchTerm.focus();}}else{if(event.keyCode==38){if(pos!=0){dojo.byId("searchDepartmentList_"+(pos-1)+SearchJS.finderType).focus();this.cancelEvent(event);}}else{if(event.keyCode==40){if(pos!=size){dojo.byId("searchDepartmentList_"+(pos+1)+SearchJS.finderType).focus();this.cancelEvent(event);}}else{if(event.keyCode==27){var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){dojo.byId("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType).focus();}else{SearchJS.form.searchTerm.focus();}this.hideSearchDepartmentList();}else{if(event.shiftKey&&event.keyCode==9){var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){dojo.byId("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType).focus();}else{SearchJS.form.searchTerm.focus();}this.cancelEvent(event);this.hideSearchDepartmentList();}else{if(event.keyCode==9){dojo.byId("search_submit").focus();this.cancelEvent(event);this.hideSearchDepartmentList();}}}}}}return false;},hideSearchDepartmentList:function(){byId("searchDepartmentList"+SearchJS.finderType).style.display="none";},init:function(){if(this.initialized){return;}this.initialized=true;require(["dojo/on","dojo/_base/window","dojo/query"],function(on,win,query){try{var eventType=(Canon.Utils.has("ios")||Canon.Utils.has("android"))?Canon.Utils.touch.press:"click";Canon.Events.add(".autoSelectOption",eventType,function(e){var el=(e.target.tagName=="SPAN")?e.target.parentNode:e.target,title=Canon.Utils.domattr.get(el,"title"),productId=Canon.Utils.domattr.get(el,"data-product-id");if(title&&productId){SearchJS.selectAutoSuggest(title,productId);}else{Canon.Utils.log("Search.js line 257","Missing Title or Product ID",e,el);}});}catch(err){Canon.Utils.log("Search.js line 266",err);}});dojo.forEach(dojo.query(".searchBox"),function(node){SearchJS.finderType=dojo.attr(node,"data-finderType");SearchJS.finderTypes.push(SearchJS.finderType);SearchJS.form=new Function("return document.CatalogSearchForm"+SearchJS.finderType)();SearchJS.retrievedCachedSuggestions[(SearchJS.finderType==""?"default":SearchJS.finderType)]=false;SearchJS.declareRefreshControllers(SearchJS.finderType);dojo.connect(SearchJS.form.searchTerm,"onfocus",SearchJS,SearchJS._onFocus);dojo.connect(SearchJS.form.searchTerm,"onblur",SearchJS,SearchJS._onBlur);dojo.connect(SearchJS.form.searchTerm,"onkeyup",SearchJS,SearchJS._onKeyUp);dojo.connect(document.getElementById("searchDropdown"+SearchJS.finderType),"onkeyup",SearchJS,SearchJS._onKeyTab);});this.staticContentHeaderHistory=storeNLS["HISTORY"];},showSearchComponent:function(){var srcElement=document.getElementById("searchDropdown"+SearchJS.finderType);if(srcElement!=null){srcElement.style.display="block";}},hideSearchComponent:function(){var srcElement=document.getElementById("searchDropdown"+SearchJS.finderType);if(srcElement!=null){srcElement.style.display="none";}},_showMobileSearchComponent:function(){var srcElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(srcElement!=null){if(srcElement.style.display=="block"){DepartmentJS.close("mobileSearchDropdown"+SearchJS.finderType);srcElement.style.display="none";}else{dojo.query(".subDeptDropdown ").forEach(function(node){DepartmentJS.close(node.id);});DepartmentJS.close("departmentsDropdown");srcElement.style.display="block";}}},setCachedSuggestionsURL:function(url){this.CachedSuggestionsURL=getAbsoluteURL()+url;},setAutoSuggestURL:function(url){this.SearchAutoSuggestServletURL=getAbsoluteURL()+url;},setCurrentForm:function(evt){this.form=evt.currentTarget.form;this.finderType=dojo.attr(this.form,"data-finderType");},_onFocus:function(evt){this.setCurrentForm(evt);this.showSearchComponent();this.retrieveCachedSuggestions();this.lastInputValue=SearchJS.form.searchTerm.value;setTimeout(function(){SearchJS.form.searchTerm.value="";},200);},_MobileonFocus:function(evt){this.showSearchComponent();this.retrieveCachedSuggestions();},_onBlur:function(evt){clearTimeout(this.searchSuggestionHoverTimeout);this.searchSuggestionHoverTimeout=setTimeout("SearchJS.showAutoSuggest(false)",200);setTimeout(function(){SearchJS.form.searchTerm.value=SearchJS.lastInputValue;},200);},_MobileonBlur:function(evt){clearTimeout(this.searchSuggestionHoverTimeout);this.searchSuggestionHoverTimeout=setTimeout("SearchJS.showAutoSuggest(false)",200);},_onKeyPress:function(evt){return evt.keyCode!=dojo.keys.ENTER;},_onKeyUp:function(evt){var srcElement=document.getElementById("searchDropdown"+SearchJS.finderType);srcElement.style.display="block";this.doAutoSuggest(evt,this.SearchAutoSuggestServletURL,SearchJS.form.searchTerm.value);},_onKeyTab:function(evt){if(evt.keyCode=="9"||evt.which=="9"){dojo.byId("searchFilterButton"+SearchJS.finderType).focus();}},_MobileonKeyUp:function(evt){var srcElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);srcElement.style.display="block";this.doAutoSuggest(evt,this.SearchAutoSuggestServletURL,dojo.byId("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType).value);},_handleEnterKey:function(){if(SearchJS.finderType=="_carepak"||SearchJS.finderType=="_recycle"){return false;}SearchJS.form.searchTerm.value=trim(SearchJS.form.searchTerm.value);if(SearchJS.form.searchTerm.value.length>0){if(this.END_OF_LIST){this.gotoAdvancedSearch(byId("advancedSearch"+SearchJS.finderType).href);}else{if(this.autoSuggestURL!=""){document.location.href=this.autoSuggestURL;}else{SearchJS.form.searchTerm.value=trim(SearchJS.form.searchTerm.value);submitSpecifiedForm(SearchJS.form);}}}},_onClick:function(evt){SearchJS.form.searchTerm.value=trim(SearchJS.form.searchTerm.value);if(SearchJS.form.searchTerm.value.length>0){if(typeof TealeafWCJS!="undefined"){TealeafWCJS.processDOMEvent(evt);}submitSpecifiedForm(SearchJS.form);}return false;},_MobileonClick:function(evt){document.MobileCatalogSearchForm.searchTerm.value=trim(document.MobileCatalogSearchForm.searchTerm.value);if(document.MobileCatalogSearchForm.searchTerm.value.length>0){if(typeof TealeafWCJS!="undefined"){TealeafWCJS.processDOMEvent(evt);}submitSpecifiedForm(document.MobileCatalogSearchForm);}return false;},doDynamicAutoSuggest:function(url,searchTerm,showHeader){if(this.autoSuggestTimer!=-1){clearTimeout(this.autoSuggestTimer);this.autoSuggestTimer=-1;}this.autoSuggestTimer=setTimeout(function(){wc.render.getRefreshControllerById("AutoSuggestDisplayController"+SearchJS.finderType).url=url+"&term="+encodeURIComponent(searchTerm)+"&showHeader="+showHeader+"&finderType="+SearchJS.finderType;wc.render.updateContext("AutoSuggest_Context"+SearchJS.finderType,{});this.autoSuggestTimer=-1;},this.autoSuggestKeystrokeDelay);},gotoAdvancedSearch:function(url){var searchTerm=byId("SimpleSearchForm_SearchTerm"+SearchJS.finderType).value;document.location.href=url+"&searchTerm="+searchTerm;},showAutoSuggest:function(display){if(display==false){for(var i in this.finderTypes){var finderType=this.finderTypes[i],autoSuggest_Result_div=document.getElementById("autoSuggest_Result_div"+finderType);if(dojo.isIE<7){var autoSuggest_content_div=document.getElementById("autoSuggest_content_div"+finderType);var autoSuggestDropDownIFrame=document.getElementById("autoSuggestDropDownIFrame"+finderType);}if(autoSuggest_Result_div!=null&&autoSuggest_Result_div!="undefined"){if(dojo.isIE<7){autoSuggestDropDownIFrame.style.display="none";autoSuggestDropDownIFrame.style.height=0;}autoSuggest_Result_div.style.display="none";}}}else{var autoSuggest_Result_div=document.getElementById("autoSuggest_Result_div"+SearchJS.finderType);if(dojo.isIE<7){var autoSuggest_content_div=document.getElementById("autoSuggest_content_div"+SearchJS.finderType);var autoSuggestDropDownIFrame=document.getElementById("autoSuggestDropDownIFrame"+SearchJS.finderType);}if(autoSuggest_Result_div!=null&&autoSuggest_Result_div!="undefined"){autoSuggest_Result_div.style.display="block";if(dojo.isIE<7){autoSuggestDropDownIFrame.style.height=autoSuggest_content_div.scrollHeight;autoSuggestDropDownIFrame.style.display="block";}}}},showAutoSuggestIfResults:function(response){if(response==null&&SearchJS.finderType!=""){this.showAutoSuggest(false);}else{var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(SearchJS.finderType==""&&typeof(staticContent)!="undefined"&&document.getElementById(this.STATIC_CONTENT_SECTION_DIV[0]+SearchJS.finderType).innerHTML==""&&document.getElementById("autoSuggestHistory"+SearchJS.finderType).innerHTML==""&&document.getElementById("dynamicAutoSuggestTotalResults"+SearchJS.finderType)==null){this.showAutoSuggest(false);}else{if(scrElement!=null&&scrElement.style.display=="block"){if(document.getElementById("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType).value.length<=this.AUTOSUGGEST_THRESHOLD){this.showAutoSuggest(false);}else{this.showAutoSuggest(true);}}else{if(SearchJS.form.searchTerm.value.length<=this.AUTOSUGGEST_THRESHOLD){this.showAutoSuggest(false);}else{this.showAutoSuggest(true);}}}}},selectAutoSuggest:function(term,productId){var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){var searchBox=document.getElementById("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType);}else{var searchBox=SearchJS.form.searchTerm;}searchBox.value=term;searchBox.focus();this.autoSuggestPreviousTerm=term;if(typeof TealeafWCJS!="undefined"){TealeafWCJS.createExplicitChangeEvent(searchBox);}if("_carepak"==SearchJS.finderType){wc.render.getRefreshControllerById("carepakListLoaderController").url=getAbsoluteURL()+"CusaCarePAKPackageDisplay?langId="+WCParamJS.langId+"&storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&productId="+productId;wc.render.updateContext("carepakContext");}else{if("_recycle"==SearchJS.finderType){var controller=wc.render.getRefreshControllerById("recycleListLoaderController").url=getAbsoluteURL()+"CusaRecyclePackageDisplay?langId="+WCParamJS.langId+"&storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&productId="+productId;wc.render.updateContext("recycleContext");}else{if("_myproduct"==SearchJS.finderType){shoppingListNames="";storeParams={storeId:WCParamJS.storeId,catalogId:WCParamJS.catalogId,langId:WCParamJS.langId};catEntryParams={id:productId,quantity:1,type:"itembean"};shoppingListJS=new ShoppingListJS(storeParams,catEntryParams,shoppingListNames,"shoppingListJS");shoppingListJS.addToList(this.myProductsWishListId);this.myProductsShoppingListItemAdded=dojo.topic.subscribe("ShoppingListItem_Added",function(){window.location.reload();});}else{if("_inkfinder"==SearchJS.finderType){location.href=getAbsoluteURL()+"AllAccessoriesDisplay?langId="+WCParamJS.langId+"&storeId="+WCParamJS.storeId+"&catalogId="+WCParamJS.catalogId+"&productId="+productId;}else{submitSpecifiedForm(SearchJS.form);}}}}},highLightSelection:function(state,index){var selection=document.getElementById("autoSelectOption_"+index+SearchJS.finderType);if(selection!=null&&selection!="undefined"){if(state){selection.className="autoSuggestSelected";var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){var searchBox=document.getElementById("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType);}else{var searchBox=SearchJS.form.searchTerm;}searchBox.setAttribute("aria-activedescendant","suggestionItem_"+index+SearchJS.finderType);var totalDynamicResults=document.getElementById("dynamicAutoSuggestTotalResults"+SearchJS.finderType);if((totalDynamicResults!=null&&totalDynamicResults!="undefined"&&index<totalDynamicResults.value)||(index>=this.historyIndex)){searchBox.value=selection.title;this.autoSuggestPreviousTerm=selection.title;this.autoSuggestURL="";}else{this.autoSuggestURL=selection.href;}}else{selection.className="";}return true;}else{return false;}},enableAutoSelect:function(index){this.highLightSelection(false,this.autoSelectOption);var item=document.getElementById("autoSelectOption_"+index+SearchJS.finderType);item.className="autoSuggestSelected";this.autoSelectOption=index;},resetAutoSuggestKeyword:function(){var originalKeyedSearchTerm=document.getElementById("autoSuggestOriginalTerm"+SearchJS.finderType);if(originalKeyedSearchTerm!=null&&originalKeyedSearchTerm!="undefined"){var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){var searchBox=document.getElementById("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType);}else{var searchBox=SearchJS.form.searchTerm;}searchBox.value=originalKeyedSearchTerm.value;this.autoSuggestPreviousTerm=originalKeyedSearchTerm.value;}},clearAutoSuggestResults:function(){for(var i=0;i<staticContent.length;i++){document.getElementById(this.STATIC_CONTENT_SECTION_DIV[i]+SearchJS.finderType).innerHTML="";}this.autoSuggestPreviousTerm="";this.autoSuggestURL="";document.getElementById("autoSuggestDynamic_Result_div"+SearchJS.finderType).innerHTML="";this.showAutoSuggest(false);},doAutoSuggest:function(event,url,searchTerm){if(searchTerm.length<=this.AUTOSUGGEST_THRESHOLD){this.showAutoSuggest(false);}if(event.keyCode==dojo.keys.ENTER){this._handleEnterKey();return;}if(event.keyCode==dojo.keys.TAB){this.autoSuggestHover=true;return;}if(event.keyCode==dojo.keys.ESCAPE){this.showAutoSuggest(false);return;}if(event.keyCode==dojo.keys.UP_ARROW){var totalDynamicResults=document.getElementById("dynamicAutoSuggestTotalResults"+SearchJS.finderType);if(this.END_OF_LIST){dojo.removeClass("autoSuggestAdvancedSearch","autoSuggestSelected");this.END_OF_LIST=false;this.autoSelectOption--;if(!this.highLightSelection(true,this.autoSelectOption)){if(this.autoSelectOption==this.CACHED_AUTOSUGGEST_OFFSET&&totalDynamicResults!=null&&totalDynamicResults!="undefined"){this.autoSelectOption=totalDynamicResults.value-1;this.highLightSelection(true,this.autoSelectOption);}}}else{if(this.highLightSelection(true,this.autoSelectOption-1)){this.highLightSelection(false,this.autoSelectOption);if(this.autoSelectOption==this.historyIndex){this.resetAutoSuggestKeyword();}this.autoSelectOption--;}else{if(this.autoSelectOption==this.CACHED_AUTOSUGGEST_OFFSET&&totalDynamicResults!=null&&totalDynamicResults!="undefined"){this.highLightSelection(false,this.CACHED_AUTOSUGGEST_OFFSET);this.autoSelectOption=totalDynamicResults.value-1;this.highLightSelection(true,this.autoSelectOption);}else{this.highLightSelection(false,this.autoSelectOption);this.autoSelectOption=-1;var originalKeyedSearchTerm=document.getElementById("autoSuggestOriginalTerm"+SearchJS.finderType);this.resetAutoSuggestKeyword();}}}return;}if(event.keyCode==dojo.keys.DOWN_ARROW){if(this.highLightSelection(true,this.autoSelectOption+1)){this.highLightSelection(false,this.autoSelectOption);this.autoSelectOption++;}else{if(this.autoSelectOption<this.CACHED_AUTOSUGGEST_OFFSET&&this.highLightSelection(true,this.CACHED_AUTOSUGGEST_OFFSET)){this.highLightSelection(false,this.autoSelectOption);this.autoSelectOption=this.CACHED_AUTOSUGGEST_OFFSET;this.resetAutoSuggestKeyword();}else{if(!this.END_OF_LIST){dojo.addClass("autoSuggestAdvancedSearch","autoSuggestSelected");this.highLightSelection(false,this.autoSelectOption);this.autoSelectOption++;this.END_OF_LIST=true;var scrElement=document.getElementById("mobileSearchDropdown"+SearchJS.finderType);if(scrElement!=null&&scrElement.style.display=="block"){var searchBox=document.getElementById("MobileSimpleSearchForm_SearchTerm"+SearchJS.finderType);}else{var searchBox=SearchJS.form.searchTerm;}searchBox.setAttribute("aria-activedescendant","advancedSearch"+SearchJS.finderType);}}}return;}if(searchTerm.length>this.AUTOSUGGEST_THRESHOLD&&searchTerm==this.autoSuggestPreviousTerm){return;}else{this.autoSuggestPreviousTerm=searchTerm;}if(searchTerm.length<=this.AUTOSUGGEST_THRESHOLD){return;}if(this.autoSuggestTimer!=-1){clearTimeout(this.autoSuggestTimer);this.autoSuggestTimer=-1;}if(searchTerm!=""){this.autoSelectOption=-1;var hasResults=(SearchJS.finderType==""?this.doStaticAutoSuggest(searchTerm):false);if(searchTerm.length>this.DYNAMIC_AUTOSUGGEST_THRESHOLD){var showHeader=true;this.doDynamicAutoSuggest(url,searchTerm,showHeader);}else{document.getElementById("autoSuggestDynamic_Result_div"+SearchJS.finderType).innerHTML="";}}else{this.clearAutoSuggestResults();}},tokenizeForBidi:function(displayName,searchName,searchTerm,searchTermLower){var tokens=displayName.split(" > ");var html="";var str="";if(tokens.length>0){html=html+"<div class='category_list'>";for(i=0;i<tokens.length;i++){if(i!=0){html=html+"<span class='gt'>&nbsp; > &nbsp;</span>";}if(i==tokens.length-1){var index=searchName.toLowerCase().indexOf(searchTermLower);var subStringBefore=searchName.substr(0,index);var subStringAfter=searchName.substr(index+searchTerm.length);var highLighted="<span class='highlight'>"+searchTerm+"</span>";str=subStringBefore+highLighted+subStringAfter;}else{str=tokens[i];}html=html+str;}html=html+"</div>";}return html;},doStaticAutoSuggest:function(searchTerm){var resultList=["","","","","",""];var emptyCell=0;var searchTermLower=searchTerm.toLowerCase();var listCount=this.CACHED_AUTOSUGGEST_OFFSET;var divStart="<div class='list_section'><div";var divEnd="</div></div>";for(var i=0;i<staticContent.length;i++){var count=0;for(var j=0;j<staticContent[i].length;j++){var searchName=staticContent[i][j][0];var searchURL=staticContent[i][j][1];var displayName=staticContent[i][j][2];var index=searchName.toLowerCase().indexOf(searchTermLower);if(index!=-1){var htmlDisplayName=this.tokenizeForBidi(displayName,searchName,searchTerm,searchTermLower);resultList[i]=resultList[i]+"<ul class='autoSuggestDivNestedList'><li id='suggestionItem_"+listCount+SearchJS.finderType+"' role='listitem' tabindex='-1'><a id='autoSelectOption_"+listCount+SearchJS.finderType+"' title='"+searchName+"' onmouseout='this.className=\"\"; this.autoSuggestURL=\"\";' onclick='SearchJS.hideSearchComponent();' onmouseover='SearchJS.enableAutoSelect("+listCount+"); this.autoSuggestURL=this.href;' href=\""+searchURL+'">'+htmlDisplayName+"</a></li></ul>";count++;listCount++;if(count>=this.TOTAL_SUGGESTED){break;}}}}for(var i=0;i<staticContent.length;i++){document.getElementById(this.STATIC_CONTENT_SECTION_DIV[i]+SearchJS.finderType).innerHTML="";if(resultList[i]!=""){var heading="<ul class='autoSuggestDivNestedList'><li class='heading'><span>"+staticContentHeaders[i]+"</span></li></ul>";document.getElementById(this.STATIC_CONTENT_SECTION_DIV[emptyCell]+SearchJS.finderType).innerHTML=heading+divStart+" role='list' title='"+staticContentHeaders[i]+"' aria-label='"+staticContentHeaders[i]+SearchJS.finderType+"'>"+resultList[i]+divEnd;emptyCell++;}}var historyList="";var searchHistorySection=document.getElementById("autoSuggestHistory"+SearchJS.finderType);searchHistorySection.innerHTML="";var historyArray=new Array();this.historyIndex=listCount;try{var searchHistoryCookie=getCookie("searchTermHistory"+SearchJS.finderType);if(typeof(searchHistoryCookie)!="undefined"){var termsArray=searchHistoryCookie.split("|");var count=0;for(var i=termsArray.length-1;i>0;i--){var theTerm=termsArray[i];var theLowerTerm=theTerm.toLowerCase();if(theLowerTerm.match("^"+searchTermLower)==searchTermLower){var repeatedTerm=false;for(var j=0;j<historyArray.length;j++){if(historyArray[j]==theLowerTerm){repeatedTerm=true;break;}}if(!repeatedTerm){historyList=historyList+"<ul class='autoSuggestDivNestedList'><li id='suggestionItem_"+listCount+SearchJS.finderType+"' role='listitem' tabindex='-1'><a href='#' onmouseout='this.className=\"\"' onmouseover='SearchJS.enableAutoSelect("+listCount+");' onclick='SearchJS.selectAutoSuggest(this.title); return false;' title='"+theTerm+"' id='autoSelectOption_"+listCount+SearchJS.finderType+"'><strong>"+searchTerm+"</strong>"+theTerm.substring(searchTerm.length,theTerm.length)+"</a></li></ul>";historyArray.push(theLowerTerm);count++;listCount++;if(count>=this.TOTAL_HISTORY){break;}}}}}}catch(e){}if(historyList!=""){var heading="<ul class='autoSuggestDivNestedList'><li class='heading'><span>"+this.staticContentHeaderHistory+"</span></li></ul>";searchHistorySection.innerHTML=heading+divStart+" title='"+this.staticContentHeaderHistory+"'>"+historyList+divEnd;emptyCell++;}if(emptyCell>0){this.showAutoSuggest(true);return true;}return false;},retrieveCachedSuggestions:function(){if(!SearchJS.retrievedCachedSuggestions[(SearchJS.finderType==""?"default":SearchJS.finderType)]){wc.render.getRefreshControllerById("AutoSuggestCachedSuggestionsController"+SearchJS.finderType).url=this.CachedSuggestionsURL+"&finderType="+SearchJS.finderType;wc.render.updateContext("CachedSuggestions_Context"+SearchJS.finderType,{});}},updateSearchTermHistoryCookie:function(updatedSearchTerm){var cookieKey="searchTermHistory"+SearchJS.finderType;var cookieValue="|"+updatedSearchTerm;var searchTermHistoryCookie=getCookie(cookieKey);if(typeof(searchTermHistoryCookie)!="undefined"){cookieValue=dojo.cookie(cookieKey)+cookieValue;}dojo.cookie(cookieKey,cookieValue,{path:"/"});},updateSearchTermHistoryCookieAndRedirect:function(updatedSearchTerm,redirectURL){this.updateSearchTermHistoryCookie(updatedSearchTerm);document.location.href=redirectURL;},isValidNumber:function(n){return !isNaN(parseFloat(n))&&isFinite(n)&&n>=0;},validateForm:function(form){form["minPrice"].value=trim(form["minPrice"].value);form["maxPrice"].value=trim(form["maxPrice"].value);var minValue=form["minPrice"].value;var maxValue=form["maxPrice"].value;var minIsValid=this.isValidNumber(minValue);var maxIsValid=this.isValidNumber(maxValue);if(minValue.length>0&&!minIsValid){MessageHelper.formErrorHandleClient(form["minPrice"].id,MessageHelper.messages["EDPPaymentMethods_AMOUNT_NAN"]);return false;}else{if(maxValue.length>0&&!maxIsValid){MessageHelper.formErrorHandleClient(form["maxPrice"].id,MessageHelper.messages["EDPPaymentMethods_AMOUNT_NAN"]);return false;}else{if(minValue.length>0&&maxValue.length>0&&parseFloat(minValue)>parseFloat(maxValue)){MessageHelper.formErrorHandleClient(form["maxPrice"].id,MessageHelper.messages["ERROR_PRICE_RANGE"]);return false;}}}form["searchTerm"].value=trim(form["searchTerm"].value);form["filterTerm"].value=trim(form["filterTerm"].value);form["manufacturer"].value=trim(form["manufacturer"].value);var searchTerm=form["searchTerm"].value;var filterTerm=form["filterTerm"].value;var manufacturer=form["manufacturer"].value;if(searchTerm.length==0&&filterTerm.length==0&&manufacturer.length==0){MessageHelper.formErrorHandleClient(form["searchTerm"].id,MessageHelper.messages["ERROR_EMPTY_SEARCH_FIELDS"]);return false;}form.submit();},declareRefreshControllers:function(finderType){var finderType=finderType||"";wc.render.declareContext("CachedSuggestions_Context"+finderType,null,"");wc.render.declareRefreshController({finderType:finderType,id:"AutoSuggestCachedSuggestionsController"+this.finderType,renderContext:wc.render.getContextById("CachedSuggestions_Context"+this.finderType),url:"",formId:"",renderContextChangedHandler:function(message,widget){var controller=this;var renderContext=this.renderContext;widget.refresh(renderContext.properties);},postRefreshHandler:function(widget){var controller=this;var renderContext=this.renderContext;var response=document.getElementById("cachedSuggestions"+controller.finderType);if(response==null){document.getElementById("autoSuggestCachedSuggestions_div"+controller.finderType).innerHTML="";}else{var scripts=response.getElementsByTagName("script");var finderTypeKey=(controller.finderType==""?"default":controller.finderType);var j=scripts.length;for(var i=0;i<j;i++){var newScript=document.createElement("script");newScript.type="text/javascript";newScript.text=scripts[i].text;document.getElementById("autoSuggestCachedSuggestions_div"+controller.finderType).appendChild(newScript);}SearchJS.retrievedCachedSuggestions[finderTypeKey]=true;var scrElement=document.getElementById("mobileSearchDropdown"+controller.finderType);if(scrElement!=null&&scrElement.style.display=="block"){searchTerm=document.getElementById("MobileSimpleSearchForm_SearchTerm"+controller.finderType).value;}else{searchTerm=SearchJS.form.searchTerm.value;}if(searchTerm.length>SearchJS.AUTOSUGGEST_THRESHOLD){SearchJS.doStaticAutoSuggest(searchTerm);}}}});wc.render.declareContext("AutoSuggest_Context"+finderType,null,"");wc.render.declareRefreshController({finderType:finderType,id:"AutoSuggestDisplayController"+this.finderType,renderContext:wc.render.getContextById("AutoSuggest_Context"+this.finderType),url:"",formId:"",renderContextChangedHandler:function(message,widget){var controller=this;var renderContext=this.renderContext;widget.refresh(renderContext.properties);},postRefreshHandler:function(widget){var controller=this;var renderContext=this.renderContext;var response=document.getElementById("suggestedKeywordResults"+controller.finderType);if(response==null){document.getElementById("autoSuggestDynamic_Result_div"+controller.finderType).innerHTML="";}SearchJS.showAutoSuggestIfResults(response);}});}};}