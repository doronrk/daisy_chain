function ShoppingListJS(storeParams,catEntryParams,shoppingListNames,jsObjectName){this.storeParams=storeParams;this.catEntryParams=catEntryParams;this.catEntryParams.quantity=1;this.shoppingListNames=shoppingListNames;this.addItemAfterCreate=false;this.jsObjectName=jsObjectName;this.dropDownVisible=false;this.dropDownInFocus=false;this.dropDownOpen=false;this.exceptionFlag=false;this.mouseOnArrow=false;this.pageName="";this.itemId=-1;this.maxLength=16;var eventName="";this.shoppingListLoaded=false;this.addToDefaultList=false;this.nameToDelete="";this.orderItemId="";this.actionBeingPerformed="";if(jsObjectName!="shoppingListJS"){this.pageName=jsObjectName.replace("shoppingListJS","");eventName=this.pageName+"_";}this.setCatEntryQuantity=function(catEntryQuantity){var catEntryQuantity=dojo.fromJson(catEntryQuantity);if(dojo.isObject(catEntryQuantity)){var component=this.catEntryParams.components[catEntryQuantity.baseItemId];if(component.id!=catEntryQuantity.baseItemId&&catEntryQuantity.id!=0){component.id=catEntryQuantity.id;}component.quantity=catEntryQuantity.quantity;}else{this.catEntryParams.quantity=catEntryQuantity;}};this.setCatEntryAttributes=function(catEntryAttributes){this.catEntryParams.attributes=dojo.fromJson(catEntryAttributes);};this.setItemId=function(catEntryId){this.itemId=catEntryId;};this.hideDropDown=function(){var dropDown=dojo.byId(this.pageName+"shoppingListDropDown");if(dropDown){dropDown.style.display="none";dojo.query("#"+this.pageName+"addToShoppingListBtn .drop")[0].focus();this.dropDownVisible=false;this.dropDownInFocus=false;this.dropDownOpen=false;var contentRightBorder=dojo.query(".widget_quick_info_popup .content_right_border")[0];if(contentRightBorder!=undefined){dojo.style(contentRightBorder,"height","auto");}}};this.showDropDown=function(productId){if(!this.shoppingListLoaded){wc.render.updateContext("wishListRefreshAreaContext",{"productId":productId,"status":"load"});}else{this.enableDropDown();}};this.enableDropDown=function(){if(this.dropDownOpen==false){var contentRightBorder=dojo.query(".widget_quick_info_popup .content_right_border")[0];var ocontentRightBorderH=dojo.position(contentRightBorder).h;var dropDown=dojo.byId(this.pageName+"shoppingListDropDown");dropDown.style.display="";this.dropDownVisible=true;dojo.query("#"+this.pageName+"shoppingListDropDown.dropdown_list div").removeClass("focused");if(dojo.byId("quickInfoRefreshArea")&&dojo.byId("QuickInfoshoppingListDropDown")){var quickInfoRefreshAreaH=dojo.position(dojo.byId("quickInfoRefreshArea")).h;var shoppingListDropDownH=dojo.position(dojo.byId("QuickInfoshoppingListDropDown")).h;var contentRightBorderH=dojo.position(contentRightBorder).h;if((quickInfoRefreshAreaH+shoppingListDropDownH)>contentRightBorderH){var quickInfoPopup=dijit.byId("quickInfoPopup");dojo.style(contentRightBorder,"height",contentRightBorderH+shoppingListDropDownH+"px");quickInfoPopup.resize();if(ocontentRightBorderH<contentRightBorderH){dojo.style(contentRightBorder,"height",ocontentRightBorderH+shoppingListDropDownH+"px");quickInfoPopup.resize();}}}this.dropDownOpen=true;}else{this.hideDropDown();}};this.showPopup=function(action){this.hideDropDown();this.clearPopupText();var popup=dijit.byId(this.pageName+action+"ShoppingListPopup");this.hideErrorMessage();this.hideEditErrorMessage();if(popup!=null){popup.closeButtonNode.style.display="none";closeAllDialogs();popup.show();if(action=="create"){dojo.byId(this.pageName+"newListName").focus();}else{if(action=="edit"){dojo.byId("editListName").focus();}}}else{console.debug(action+"ShoppingListPopup"+" does not exist");}};this.showSuccessDialog=function(){var popup=dijit.byId(this.pageName+"shoppingListCreateSuccessPopup");if(popup!=null&&this.actionBeingPerformed!=""){dojo.byId(this.pageName+"successMessageAreaText").innerHTML=storeNLS["LIST_CREATED"];popup.closeButtonNode.style.display="none";popup.show();this.actionBeingPerformed="";}};this.showMessageDialog=function(message){var popup=dijit.byId(this.pageName+"shoppingListCreateSuccessPopup");if(popup!=null){dojo.byId(this.pageName+"successMessageAreaText").innerHTML=message;popup.closeButtonNode.style.display="none";popup.show();}};this.showErrorMessage=function(msg){if(document.getElementById(this.pageName+"shoppingListErrorMessageArea")&&document.getElementById(this.pageName+"shoppingListErrorMessageText")){document.getElementById(this.pageName+"shoppingListErrorMessageText").innerHTML=msg;document.getElementById(this.pageName+"shoppingListErrorMessageArea").style.display="block";}};this.hideErrorMessage=function(){if(document.getElementById(this.pageName+"shoppingListErrorMessageArea")&&document.getElementById(this.pageName+"shoppingListErrorMessageText")){document.getElementById(this.pageName+"shoppingListErrorMessageText").innerHTML="";document.getElementById(this.pageName+"shoppingListErrorMessageArea").style.display="none";}};this.showEditErrorMessage=function(msg){if(document.getElementById("editShoppingListErrorMessageArea")&&document.getElementById("editShoppingListErrorMessageText")){document.getElementById("editShoppingListErrorMessageText").innerHTML=msg;document.getElementById("editShoppingListErrorMessageArea").style.display="block";}};this.hideEditErrorMessage=function(){if(document.getElementById("editShoppingListErrorMessageArea")&&document.getElementById("editShoppingListErrorMessageText")){document.getElementById("editShoppingListErrorMessageText").innerHTML="";document.getElementById("editShoppingListErrorMessageArea").style.display="none";}};this.create=function(){var name=trim(dojo.byId(this.pageName+"newListName").value);var wishListNameInput=dojo.query(".body > form > input#newListName");if(name==""&&wishListNameInput.length>1){wishListNameInput.forEach(function(thisWishList){if(thisWishList.value!=""){name=thisWishList.value;}});}var maxlength=dojo.byId(this.pageName+"newListName").maxLength>0?dojo.byId(this.pageName+"newListName").maxLength:this.maxLength;var defaultName=storeNLS["DEFAULT_WISH_LIST_NAME"];if(this.empty(name)){this.showErrorMessage(storeNLS["ERR_NAME_EMPTY"]);}else{if(!MessageHelper.isValidUTF8length(name,maxlength)){this.showErrorMessage(storeNLS["ERR_NAME_TOOLONG"]);}else{if(name==defaultName){this.showErrorMessage(storeNLS["ERR_NAME_SHOPPING_LIST"]);}else{if(this.isDuplicate(name)){this.showErrorMessage(storeNLS["ERR_NAME_DUPLICATE"]);}else{if(!this.validateWishName(name)){this.showErrorMessage(storeNLS["INVALID_NAME_SHOPPING_LIST"]);}else{var params=this.setCommonParams();params.name=name;var popup=dijit.byId(this.pageName+"createShoppingListPopup");if(popup!=null){popup.hide();}if(!submitRequest()&&name!="myProducts"){return;}cursor_wait();wc.service.invoke("ShoppingListServiceCreate",params);this.actionBeingPerformed="create";}}}}}};this.handlePDPAddToWishList=function(productId){if(!this.shoppingListLoaded){this.addToDefaultList=true;wc.render.updateContext("wishListRefreshAreaContext",{"productId":productId,"status":"load"});}else{this.checkUserTypeAndAddToWishlist();}};this.checkUserTypeAndAddToWishlist=function(){if(dojo.byId("shoppingListUserType")&&dojo.byId("shoppingListUserType").value=="R"){var defaultList=-1;if(dojo.byId("defaultShoppingListId")){defaultList=dojo.byId("defaultShoppingListId").value;}this.createDefaultListAndAddItem(defaultList,"");}else{this.enableDropDown();}};this.createDefaultListAndAddItem=function(listId,orderItemId){if(orderItemId&&orderItemId!=""){this.orderItemId=orderItemId;}if("-1"==listId){var params=this.setCommonParams();params.name=storeNLS["DEFAULT_WISH_LIST_NAME"];if(!submitRequest()){return;}cursor_wait();this.addItemAfterCreate=true;wc.service.invoke("ShoppingListServiceCreate",params);}else{if(orderItemId&&orderItemId!=""){this.addToListAndDelete(listId,orderItemId);}else{this.addToList(listId);}}};this.setLatestWLValues=function(catEntId,name,image){this.catEntryParams.id=catEntId;this.catEntryParams.name=name;this.catEntryParams.image=image;};this.addToList=function(listId){this.hideDropDown();var params=this.setCommonParams();params.giftListId=listId;var catEntryId=this.catEntryParams.id;if(this.catEntryParams.type.toLowerCase()=="itembean"||this.catEntryParams.type.toLowerCase()=="packagebean"||this.catEntryParams.type.toLowerCase()=="dynamickitbean"){updateParamObject(params,"catEntryId",this.catEntryParams.id,false,-1);updateParamObject(params,"quantity",this.catEntryParams.quantity,false,-1);}else{if(this.catEntryParams.type.toLowerCase()=="bundlebean"){for(baseItemId in this.catEntryParams.components){updateParamObject(params,"catEntryId",this.catEntryParams.components[baseItemId].id,false,-1);updateParamObject(params,"quantity",this.catEntryParams.components[baseItemId].quantity,false,-1);}}else{var sku=this.itemId;if(sku==-1){sku=this.resolveSKU();}if(-1==sku){MessageHelper.displayErrorMessage(storeNLS["ERR_RESOLVING_SKU"]);return;}else{catEntryId=sku;updateParamObject(params,"catEntryId",sku,false,-1);updateParamObject(params,"quantity",this.catEntryParams.quantity,false,-1);}}}if(this.jsObjectName!="shoppingListJS"){QuickInfoJS.close();}if(!submitRequest()&&!(SearchJS!=null&&SearchJS!="undefined"&&("_myproduct"==SearchJS.finderType))){return;}cursor_wait();ShoppingListDialogJS.setDialogParams(this.storeParams,{catEntryId:catEntryId,thumbnail:"imgPath",name:this.catEntryParams.name,image:this.catEntryParams.image});wc.service.invoke("ShoppingListServiceAddItem",params);};this.isDuplicate=function(listName){var listName=this.escapeXml(listName,true);return(this.shoppingListNames[listName.toUpperCase()]==1);};this.updateDefaultListId=function(listId){this.shoppingListNames[storeNLS["DEFAULT_WISH_LIST_NAME"]]=1;if(dojo.byId(this.pageName+"addToShoppingList")){dojo.byId(this.pageName+"addToShoppingList").href="javascript:"+this.jsObjectName+".createDefaultListAndAddItem("+listId+");";}};this.updateShoppingList=function(listId,listName,action){var listNameEsc=this.escapeXml(listName,false);this.shoppingListNames[listNameEsc.toUpperCase()]=1;if(action&&(action=="edit"||action=="delete")){this.shoppingListNames[this.nameToDelete.toUpperCase()]=-1;}var dropdownWidgetNode=dojo.byId(this.pageName+"ShoppingListDivider");if(dropdownWidgetNode){var eventHandlerString="javascript: this.className = 'created_list';";if(this.pageName.indexOf("OI")==-1){dojo.place('<div role="menuitem" id="'+this.pageName+"ShoppingList_"+listId+'" class="created_list" onfocus="javascript:'+jsObjectName+".focusList('"+listId+'\'); "  onblur="'+eventHandlerString+'" onclick="javascript:'+jsObjectName+".addToList('"+listId+'\');"><a role="menuitem" id="'+this.pageName+"ShoppingListLink_"+listId+'" href="javascript:'+jsObjectName+".addToList('"+listId+'\');" onfocus="javascript:'+jsObjectName+".focusListLink('"+listId+"');\">"+listName+"</a></div>",this.pageName+"ShoppingListDivider","before");}else{var oiId=this.pageName.replace("OI","");dojo.place('<div role="menuitem" id="'+this.pageName+"ShoppingList_"+listId+'" class="created_list" onfocus="javascript:'+jsObjectName+".focusList('"+listId+'\'); "  onblur="'+eventHandlerString+'" onclick="javascript:'+jsObjectName+".addToListAndDelete('"+listId+"','"+oiId+'\');"><a role="menuitem" id="'+this.pageName+"ShoppingListLink_"+listId+'" href="javascript:'+jsObjectName+".addToListAndDelete('"+listId+"','"+oiId+'\');" onfocus="javascript:'+jsObjectName+".focusListLink('"+listId+"');\">"+listName+"</a></div>",this.pageName+"ShoppingListDivider","before");}}};this.clearPopupText=function(){dojo.byId(this.pageName+"newListName").value="";};this.escapeXml=function(str,fullConversion){if(fullConversion){str=str.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;");}str=str.replace(/"/gm,"&#034;").replace(/'/gm,"&#039;");return str;};this.resolveSKU=function(){if(this.catEntryParams.skus.length==1){return this.catEntryParams.skus[0].id;}for(idx=0;idx<this.catEntryParams.skus.length;idx++){var matches=0;var attributeCount=0;var attrArrayCount=0;for(indexArr in this.catEntryParams.attributes){attrArrayCount++;}if(this.catEntryParams.skus.length>=1){var catentry_id=this.catEntryParams.skus[0].id;}var attrCount=0;for(index in this.catEntryParams.skus[idx].attributes){attrCount++;}if(attrArrayCount==0&&attrCount==0){return catentry_id;}for(attribute in this.catEntryParams.skus[idx].attributes){attributeCount++;if(this.catEntryParams.attributes&&this.catEntryParams.skus[idx].attributes[attribute]==this.catEntryParams.attributes[attribute]){matches++;}else{break;}}if(0!=matches&&matches==attributeCount){return this.catEntryParams.skus[idx].id;}}return -1;};this.setCommonParams=function(){var params={};params.storeId=this.storeParams.storeId;params.catalogId=this.storeParams.catalogId;params.langId=this.storeParams.langId;return params;};this.empty=function(str){return(str==null||str==undefined||str=="");};this.redirectToSignOn=function(){var currentURL=location.href;if(true==isGuest){currentURL=getAbsoluteURL()+"OrderItemMove?continue=1&createIfEmpty=1&updatePrices=0&deleteIfEmpty=*&fromOrderId=*&toOrderId=.&page=&calculationUsageId=-1&URL="+encodeURIComponent("OrderCalculate?URL="+encodeURIComponent(currentURL));}document.location.href=getAbsoluteURL()+"LogonForm?myAcctMain=1&storeId="+this.storeParams.storeId+"&catalogId="+this.storeParams.catalogId+"&langId="+this.storeParams.langId+"&URL="+encodeURIComponent(currentURL);};this.focusList=function(listId){this.focusListByElementId(this.pageName+"ShoppingList_"+listId);};this.focusListByElementId=function(elementId){if(dojo.hasClass(elementId,"focused")){return;}dojo.byId(elementId.replace("ShoppingList","ShoppingListLink")).focus();};this.focusListLink=function(listId){dojo.query("#"+this.pageName+"shoppingListDropDown.dropdown_list div").removeClass("focused");dojo.addClass(this.pageName+"ShoppingList_"+listId,"focused");};this.updateShoppingListAndAddItem=function(serviceResponse){if(serviceResponse.listName==storeNLS["DEFAULT_WISH_LIST_NAME"]){this.updateDefaultListId(serviceResponse.listId);}else{this.updateShoppingList(serviceResponse.listId,serviceResponse.listName,serviceResponse.action);}if(this.addItemAfterCreate){this.addItemAfterCreate=false;if(this.orderItemId!=""){this.addToListAndDelete(serviceResponse.listId,this.orderItemId);}else{this.addToList(serviceResponse.listId);}}else{if(serviceResponse.action=="add"){this.showSuccessDialog();}}};this.navigateDropDown=function(event){var shoppingListObj=this;if(event.keyCode==dojo.keys.UP_ARROW){dojo.stopEvent(event);var focusChanged=false;dojo.query("#"+shoppingListObj.pageName+"shoppingListDropDown.dropdown_list div.created_list").forEach(function(node,index,arr){if(!focusChanged&&(dojo.hasClass(node,"focused"))){if(0==index){shoppingListObj.focusListByElementId(arr[arr.length-1].id);}else{shoppingListObj.focusListByElementId(arr[index-1].id);}focusChanged=true;}});}else{if(event.keyCode==dojo.keys.DOWN_ARROW){dojo.stopEvent(event);var focusChanged=false;dojo.query("#"+shoppingListObj.pageName+"shoppingListDropDown.dropdown_list div.created_list").forEach(function(node,index,arr){if(!focusChanged&&(dojo.hasClass(node,"focused"))){if(arr.length-1==index){shoppingListObj.focusListByElementId(arr[0].id);}else{shoppingListObj.focusListByElementId(arr[index+1].id);}focusChanged=true;}});}else{if(event.keyCode==dojo.keys.ESCAPE||event.keyCode==dojo.keys.TAB){dojo.stopEvent(event);this.hideDropDown();}}}};this.hideIfNoFocus=function(){if(this.dropDownVisible&&!this.dropDownInFocus&&!this.mouseOnArrow){this.hideDropDown();}};this.hasFocus=function(event){if(dojo.mouseButtons.isRight(event)){this.dropDownInFocus=false;}else{this.dropDownInFocus=true;}};this.edit=function(){var name=trim(dojo.byId("editListName").value);var maxlength=name.maxLength>0?name.maxLength:this.maxLength;var defaultName=storeNLS["DEFAULT_WISH_LIST_NAME"];if(this.empty(name)){this.showEditErrorMessage(storeNLS["ERR_NAME_EMPTY"]);}else{if(!MessageHelper.isValidUTF8length(name,maxlength)){this.showEditErrorMessage(storeNLS["ERR_NAME_TOOLONG"]);}else{if(name==defaultName){this.showEditErrorMessage(storeNLS["ERR_NAME_SHOPPING_LIST"]);}else{if(this.isDuplicate(name)){this.showEditErrorMessage(storeNLS["ERR_NAME_DUPLICATE"]);}else{if(!this.validateWishName(name)){this.showEditErrorMessage(storeNLS["INVALID_NAME_SHOPPING_LIST"]);}else{var params=this.setCommonParams();params.name=name;var dropdown=dojo.byId("multipleWishlistController_select");if((dropdown!=null&&dropdown!="undefined")&&dropdown.value!=0){params["giftListId"]=dojo.byId("multipleWishlistController_select").value;this.nameToDelete=dojo.byId("multipleWishlistController_select").options[dropdown.selectedIndex].text;}var popup=dijit.byId("editShoppingListPopup");if(popup!=null){popup.hide();}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("ShoppingListServiceUpdate",params);}}}}}};this.deleteList=function(){var params=this.setCommonParams();var dropdown=dojo.byId("multipleWishlistController_select");if((dropdown!=null&&dropdown!="undefined")&&dropdown.value!=0){params["giftListId"]=dojo.byId("multipleWishlistController_select").value;this.nameToDelete=dojo.byId("multipleWishlistController_select").options[dropdown.selectedIndex].text;}var popup=dijit.byId("deleteShoppingListPopup");if(popup!=null){popup.hide();}if(!submitRequest()){return;}cursor_wait();wc.service.invoke("ShoppingListServiceDelete",params);};this.refreshLinkState=function(){var dropdown=dojo.byId("multipleWishlistController_select");if(dropdown!=null){var wName=dojo.byId("multipleWishlistController_select").options[dropdown.selectedIndex].text;var defaultName=storeNLS["DEFAULT_WISH_LIST_NAME"];if(wName==defaultName){dojo.byId("edit_popup_link").style.display="none";dojo.byId("delete_popup_link").style.display="none";}else{dojo.byId("edit_popup_link").style.display="block";dojo.byId("delete_popup_link").style.display="block";}}};this.addToListAndDelete=function(listId,inOrderItemId){this.orderItemId=inOrderItemId;dojo.publish("modelChanged/AnalyticsConversionEvent");this.hideDropDown();var params=this.setCommonParams();params.giftListId=listId;params["catEntryId"]=this.catEntryParams.id;params["quantity"]=1;if(!submitRequest()){return;}cursor_wait();ShoppingListDialogJS.setDialogParams(this.storeParams,{catEntryId:this.catEntryParams.id,name:this.catEntryParams.name,image:this.catEntryParams.image,thumbnail:"imgPath"});wc.service.invoke("ShoppingListServiceAddItemAndRemoveFromCart",params);};this.deleteItemFromCart=function(){if(this.orderItemId!=""){var test=this.orderItemId;this.orderItemId="";if(test!=""){CheckoutHelperJS.deleteFromCart(test,true);}}};this.validateWishName=function(wishName){var invalidChars="~!@#$%^&*()+=[]{};:,<>?/|`";invalidChars+='\t"\\/';for(var i=0;i<wishName.length;i++){if(invalidChars.indexOf(wishName.substring(i,i+1))>=0){return false;}}return true;};dojo.connect(document.documentElement,"onmousedown",this,"hideIfNoFocus");}if(typeof(ShoppingListDialogJS)=="undefined"||ShoppingListDialogJS==null||!ShoppingListDialogJS){ShoppingListDialogJS={storeParams:null,dialogParams:null,setDialogParams:function(storeParams,dialogParams){this.storeParams=storeParams;this.dialogParams=dialogParams;if(this.dialogParams.image==null||this.dialogParams.image==""){this.fetchAddedItem();}else{this.displayItemAddedWithoutFetching();}},fetchAddedItem:function(){var params=this.setCommonParams();params.productId=this.dialogParams.catEntryId;params.catalogEntryId=this.dialogParams.catEntryId;dojo.xhrPost({url:getAbsoluteURL()+"GetCatalogEntryDetailsByIDView",handleAs:"json-comment-filtered",content:params,service:this,load:ShoppingListDialogJS.displayItemAddedDialog,error:function(errObj,ioArgs){console.debug("QuickInfoJS.selectItem: Unexpected error occurred during an xhrPost request.");}});},displayItemAddedDialog:function(serviceResponse,ioArgs){var itemAddedPopup=dijit.byId("shoppingListItemAddedPopup");if(itemAddedPopup!=null){dojo.byId("shoppingListItemAddedImg").src=serviceResponse.catalogEntry.description[0].thumbnail.replace("160x160","105x105");dojo.byId("shoppingListItemAddedImg").alt=serviceResponse.catalogEntry.description[0].name;dojo.byId("shoppingListItemAddedName").innerHTML=serviceResponse.catalogEntry.description[0].name;}else{console.debug("shoppingListItemAddedPopup does not exist");}},displayItemAddedWithoutFetching:function(){var itemAddedPopup=dijit.byId("shoppingListItemAddedPopup");if(itemAddedPopup!=null){dojo.byId("shoppingListItemAddedImg").src=this.dialogParams.image;dojo.byId("shoppingListItemAddedImg").alt=this.dialogParams.name;dojo.byId("shoppingListItemAddedName").innerHTML=this.dialogParams.name;}else{console.debug("shoppingListItemAddedPopup does not exist");}},showDialog:function(){var itemAddedPopup=dijit.byId("shoppingListItemAddedPopup");if(itemAddedPopup!=null){itemAddedPopup.closeButtonNode.style.display="none";itemAddedPopup.show();}else{console.debug("shoppingListItemAddedPopup does not exist");}},setCommonParams:function(){var params=new Object();params.storeId=this.storeParams.storeId;params.catalogId=this.storeParams.catalogId;params.langId=this.storeParams.langId;return params;},close:function(){dijit.byId("shoppingListItemAddedPopup").hide();}};dojo.topic.subscribe("ShoppingListItem_Added",ShoppingListDialogJS.showDialog);}function initializeShoppingListWidget(pId){dojo.addOnLoad(function(){parseWidget("wishListRefreshArea");});}