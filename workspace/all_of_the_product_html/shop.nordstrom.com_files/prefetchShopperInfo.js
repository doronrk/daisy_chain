
/* cachebust:true */ define("nord/feature/util/querystring",["jquery"],function(e){function o(e,o,t,n){var r,i=new RegExp("([?&])"+o+"=[^&$]*","i");return n="string"==typeof n?n:"?",r=0!==e.length?"&":n,e.match(i)?e.replace(i,"$1"+o+"="+t):e+r+o+"="+t}function t(o,t){var n,r={};if(t="string"==typeof t?t:"?","string"!=typeof o)throw new Error("nord/util/querystring: the deserialize method only accepts strings.");return n=o.indexOf(t),n>=0&&(o=o.substr(n+1)),e.each(o.split("&"),function(e,o){var t,n,i=o.split("=");i.length>0&&(t=decodeURIComponent(i.shift()),n=i.length>0?decodeURIComponent(i.shift()):void 0,"undefined"==typeof r[t]?r[t]=n:r[t].constructor===Array?r[t].push(n):r[t]=[r[t],n])}),r}function n(o,t){return t="string"==typeof t?t:"?",o=e.param(o),o=o?t+o:""}function r(o,t){function n(o,t){t=e.isFunction(t)?t():t?t:"",r.pairs[r.pairs.length]=encodeURIComponent(o)+"="+encodeURIComponent(t)}var i;if(Array.isArray(t))t.forEach(function(e,t){r(o+"["+t+"]",e)});else if("object"===e.type(t))for(i in t)r(o+"["+i+"]",t[i]);else n(o,t)}function i(o){return r.pairs=[],e.each(o,function(e,o){r(e,o)}),r.pairs.join("&").replace(/%20/g,"+")}return{deserialize:t,serialize:n,deepSerialize:i,updateParameter:o}}),define("nord/feature/util/cookie",["nord/config","nord/feature/util/querystring"],function(e,o){function t(e,o,t){var n="",r="",i="",a="";return"undefined"==typeof e||"undefined"==typeof o?void("warn"in window.console&&window.console.warn("Cookie: Unable to set cookie when no name or value is passed.")):("object"==typeof t&&("expires"in t&&(n="; expires="+t.expires.toUTCString()),"path"in t&&(r="; path="+t.path),"domain"in t&&(i="; domain="+t.domain),"secure"in t&&(a="; secure")),"object"==typeof JSON&&"object"==typeof o&&(o=encodeURIComponent(JSON.stringify(o))),void(document.cookie=[e,"=",o,n,r,i,a].join("")))}function n(e,t){var n;return new RegExp("(?:; )?"+(e||"__foo__")+"=([^;]*);?").test(document.cookie)?(n=decodeURIComponent(RegExp.$1),t===!0?"object"==typeof JSON&&n.match(/^(\{(.*)\})|(\[(.*)\])$/)?JSON.parse(n):o.deserialize(n):n):void 0}function r(e,o){var t,r=n(e,!0),i=typeof r;return"object"===i&&r.constructor!==Array&&(t=r[o],"undefined"==typeof t&&(t=r[o.toUpperCase()],"undefined"==typeof t&&(t=r[o.toLowerCase()]))),t}function i(r,i,a,u){var p,f=n(r,u)||"",s=typeof f,c=new Date;c.setTime(c.getTime()+31536e7),p={domain:e.getValueOrDefault("cookies.domain",document.domain),expires:c,path:"/"},"object"===s&&f.constructor!==Array?(f[i]=a,f=o.serialize(f,"")):f=o.updateParameter(f,i,a,""),t(r,f,p)}function a(o){var n={domain:e.getValueOrDefault("cookies.domain",document.domain),expires:new Date(0),path:"/"};t(o,"",n)}return{save:t,load:n,getValue:r,setValue:i,destroy:a}}),define("nord/featureSet/prefetchShopperInfo",["jquery","modernizr","nord/config","nord/feature/util/cookie"],function(e,o,t,n){function r(){var e=0,o=parseInt(t.getValueOrDefault("personalization.prefetchRetryCount",0),10),r=n.load(t.getValueOrDefault("cookies.personalization","personalization"),!0);"undefined"==typeof r||"true"===r.IsShopperInfoPrefetched.toLowerCase()&&r.ShopperId===t.getValue("shopper.id")||(e=parseInt(r.ShopperInfoPrefetchRetryCount,10),o>e&&a()&&i())}function i(){{var o=t.getValue("personalization.prefetchUrl");t.getValue("personalization.segmentEngine")}e.ajax({dataType:"json",timeout:t.getValueOrDefault("personalization.prefetchRequestTimeout",3e3),type:"GET",url:o+"?segmentEngine=CI"}).done(function(e){var o={};o.shopperId=t.getValue("shopper.id"),o.supplierStandardizedSizeFitInfo=e.ShopperStandardSizeInfo,console.log("Nordstrom.com: Shopper SizeFitInfo:",o)}).fail(function(e,o,t){console.warn("timeout"===o?"Nordstrom.com: Prefetch shopper info timed out.":"Nordstrom.com: Prefetch shopper info failed with error: "+t)})}function a(){var e=!1,o=t.getValueOrDefault("shopper.shipToCountry","US");return t.getValueOrDefault("features.prefetchShopperSegmentEnabled",!1)&&(e="US"===o||""===o),e}return{init:r}});
