
/* cachebust:true */ define("nord/feature/util/querystring",["jquery"],function(e){function n(e,n,t,i){var a,o=new RegExp("([?&])"+n+"=[^&$]*","i");return i="string"==typeof i?i:"?",a=0!==e.length?"&":i,e.match(o)?e.replace(o,"$1"+n+"="+t):e+a+n+"="+t}function t(n,t){var i,a={};if(t="string"==typeof t?t:"?","string"!=typeof n)throw new Error("nord/util/querystring: the deserialize method only accepts strings.");return i=n.indexOf(t),i>=0&&(n=n.substr(i+1)),e.each(n.split("&"),function(e,n){var t,i,o=n.split("=");o.length>0&&(t=decodeURIComponent(o.shift()),i=o.length>0?decodeURIComponent(o.shift()):void 0,"undefined"==typeof a[t]?a[t]=i:a[t].constructor===Array?a[t].push(i):a[t]=[a[t],i])}),a}function i(n,t){return t="string"==typeof t?t:"?",n=e.param(n),n=n?t+n:""}function a(n,t){function i(n,t){t=e.isFunction(t)?t():t?t:"",a.pairs[a.pairs.length]=encodeURIComponent(n)+"="+encodeURIComponent(t)}var o;if(Array.isArray(t))t.forEach(function(e,t){a(n+"["+t+"]",e)});else if("object"===e.type(t))for(o in t)a(n+"["+o+"]",t[o]);else i(n,t)}function o(n){return a.pairs=[],e.each(n,function(e,n){a(e,n)}),a.pairs.join("&").replace(/%20/g,"+")}return{deserialize:t,serialize:i,deepSerialize:o,updateParameter:n}}),define("nord/feature/util/cookie",["nord/config","nord/feature/util/querystring"],function(e,n){function t(e,n,t){var i="",a="",o="",r="";return"undefined"==typeof e||"undefined"==typeof n?void("warn"in window.console&&window.console.warn("Cookie: Unable to set cookie when no name or value is passed.")):("object"==typeof t&&("expires"in t&&(i="; expires="+t.expires.toUTCString()),"path"in t&&(a="; path="+t.path),"domain"in t&&(o="; domain="+t.domain),"secure"in t&&(r="; secure")),"object"==typeof JSON&&"object"==typeof n&&(n=encodeURIComponent(JSON.stringify(n))),void(document.cookie=[e,"=",n,i,a,o,r].join("")))}function i(e,t){var i;return new RegExp("(?:; )?"+(e||"__foo__")+"=([^;]*);?").test(document.cookie)?(i=decodeURIComponent(RegExp.$1),t===!0?"object"==typeof JSON&&i.match(/^(\{(.*)\})|(\[(.*)\])$/)?JSON.parse(i):n.deserialize(i):i):void 0}function a(e,n){var t,a=i(e,!0),o=typeof a;return"object"===o&&a.constructor!==Array&&(t=a[n],"undefined"==typeof t&&(t=a[n.toUpperCase()],"undefined"==typeof t&&(t=a[n.toLowerCase()]))),t}function o(a,o,r,s){var l,c=i(a,s)||"",u=typeof c,p=new Date;p.setTime(p.getTime()+31536e7),l={domain:e.getValueOrDefault("cookies.domain",document.domain),expires:p,path:"/"},"object"===u&&c.constructor!==Array?(c[o]=r,c=n.serialize(c,"")):c=n.updateParameter(c,o,r,""),t(a,c,l)}function r(n){var i={domain:e.getValueOrDefault("cookies.domain",document.domain),expires:new Date(0),path:"/"};t(n,"",i)}return{save:t,load:i,getValue:a,setValue:o,destroy:r}}),define("nord/feature/util/keyCode",{backspace:8,tab:9,enter:13,esc:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,del:46}),define("text",["module"],function(e){var n,t,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r="undefined"!=typeof location&&location.href,s=r&&location.protocol&&location.protocol.replace(/\:/,""),l=r&&location.hostname,c=r&&(location.port||void 0),u=[],p=e.config&&e.config()||{};return n={version:"2.0.3",strip:function(e){if(e){e=e.replace(a,"");var n=e.match(o);n&&(e=n[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,n,t;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(n=0;3>n;n+=1){t=i[n];try{e=new ActiveXObject(t)}catch(a){}if(e){i=[t];break}}return e},parseName:function(e){var n=!1,t=e.indexOf("."),i=e.substring(0,t),a=e.substring(t+1,e.length);return t=a.indexOf("!"),-1!==t&&(n=a.substring(t+1,a.length),n="strip"===n,a=a.substring(0,t)),{moduleName:i,ext:a,strip:n}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,i,a){var o,r,s,l=n.xdRegExp.exec(e);return l?(o=l[2],r=l[3],r=r.split(":"),s=r[1],r=r[0],!(o&&o!==t||r&&r.toLowerCase()!==i.toLowerCase()||(s||r)&&s!==a)):!0},finishLoad:function(e,t,i,a){i=t?n.strip(i):i,p.isBuild&&(u[e]=i),a(i)},load:function(e,t,i,a){if(a.isBuild&&!a.inlineText)return void i();p.isBuild=a.isBuild;var o=n.parseName(e),u=o.moduleName+"."+o.ext,d=t.toUrl(u),m=p.useXhr||n.useXhr;!r||m(d,s,l,c)?n.get(d,function(t){n.finishLoad(e,o.strip,t,i)},function(e){i.error&&i.error(e)}):t([u],function(e){n.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)})},write:function(e,t,i){if(u.hasOwnProperty(t)){var a=n.jsEscape(u[t]);i.asModule(e+"!"+t,"define(function () { return '"+a+"';});\n")}},writeFile:function(e,t,i,a,o){var r=n.parseName(t),s=r.moduleName+"."+r.ext,l=i.toUrl(r.moduleName+"."+r.ext)+".js";n.load(s,i,function(){var t=function(e){return a(l,e)};t.asModule=function(e,n){return a.asModule(e,l,n)},n.write(e,s,t,o)},o)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(t=require.nodeRequire("fs"),n.get=function(e,n){var i=t.readFileSync(e,"utf8");0===i.indexOf("ï»¿")&&(i=i.substring(1)),n(i)}):"xhr"===p.env||!p.env&&n.createXhr()?n.get=function(e,t,i){var a=n.createXhr();a.open("GET",e,!0),p.onXhr&&p.onXhr(a,e),a.onreadystatechange=function(){var n,o;4===a.readyState&&(n=a.status,n>399&&600>n?(o=new Error(e+" HTTP status: "+n),o.xhr=a,i(o)):t(a.responseText))},a.send(null)}:("rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(n.get=function(e,n){var t,i,a="utf-8",o=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),a)),l="";try{for(t=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),t.append(i);null!==(i=s.readLine());)t.append(r),t.append(i);l=String(t.toString())}finally{s.close()}n(l)}),n}),define("text!htmlTemplate/minibag/items.html",[],function(){return'{{#Items}}\n<li class="mini-bag-item" data-value="{{JsonValue}}" data-item-params="{{MiniBagParams}}">\n	<div class="item-image">\n		<a href="{{Url}}" title="{{StyleName}}">\n			<img src="{{Src}}" alt="{{Alt}}"/>\n		</a>\n	</div>\n	<div class="item-content">\n		<div class="item-info">\n			<h2 class="item-name">\n				<a href="{{Url}}" title="{{StyleName}}">{{StyleName}}</a>\n			</h2>\n			{{#Size}}\n			<div class="clearfix">\n				<span class="item-properties">{{Name}}:</span>\n				<span class="item-properties-values item-size">{{Value}}</span>\n			</div>\n			{{/Size}}\n			{{#Color}}\n			<div class="clearfix">\n				<span class="item-properties">{{Name}}:</span>\n				<span class="item-properties-values item-color">{{Value}}</span>\n			</div>\n			{{/Color}}\n			{{#Value}}\n			<div class="clearfix">\n				<span class="item-properties">{{Name}}:</span>\n				<span class="item-properties-values item-value">{{Value}}</span>\n			</div>\n			{{/Value}}\n			{{#Design}}\n			<div class="clearfix">\n				<span class="item-properties">{{Name}}:</span>\n				<span class="item-properties-values item-design">{{Value}}</span>\n			</div>\n			{{/Design}}\n			<div class="clearfix">\n				<span class="item-properties">Qty:</span>\n				<span class="item-properties-values item-quantity">{{Quantity}}</span>\n			</div>\n			{{#BackOrder}}\n			<div class="clearfix special-message">\n				<span class="item-properties ">Backordered item:</span>\n				<span class="item-properties-values item-backorder">Approximate ship date of {{Value}}.</span>\n			</div>\n			{{/BackOrder}}\n			{{#PreOrder}}\n			<div class="clearfix special-message">\n				<span class="item-properties ">Pre-ordered item:</span>\n				<span class="item-properties-values item-preorder">This item has an approximate ship date of {{Value}}.</span>\n			</div>\n			{{/PreOrder}}\n			{{#BOPUS}}\n			<div class="clearfix special-message">\n				<span class="item-properties">Picking up in store:</span>\n				<span class="item-properties-values item-storename">{{Value}}</span>\n			</div>\n			{{/BOPUS}}\n			{{#UnAvailable}}\n			<div class="clearfix unavailable special-message">Your selection is no longer available.</div>\n			{{/UnAvailable}}\n			<input class="item-remove clearfix button button-standard" type="button" value="Remove"/>\n		</div>\n		<div class="item-price">{{Price}}</div>\n	</div>\n	<div class="item-separator"></div>\n</li>\n{{/Items}}\n'}),define("text!htmlTemplate/minibag/empty.html",[],function(){return'<li class="mini-bag-item empty-item">\n	<div class="empty-item">There are currently no items in your Shopping Bag.</div>\n</li>'}),define("text!htmlTemplate/minibag/subtotal.html",[],function(){return'<div class="shipping-subtotal">\n	{{^isInternationalShopper}}\n		<div class="shipping-promo">\n			<img src="{{ImageUrl}}default/shop/image/common/2012/0615/mini-bag-free-shipping-promo.gif" alt="Free Shipping Promo"/>\n		</div>\n	{{/isInternationalShopper}}\n	<div class="subtotal">\n		Subtotal: <b>{{SubTotal}}</b>\n	</div>\n</div>\n<div class="edit-checkout">\n	<a id="mini-bag-shopping-bag" class="button button-standard button-small" href="{{ShoppingBagUri}}" title="Shopping Bag" name="Shopping Bag">Shopping Bag</a>\n	<a id="mini-bag-checkout" class="button button-primary button-small" href="{{CheckoutUri}}" title="Checkout" name="Checkout">Checkout</a>\n</div>\n'}),define("nord/feature/minibag/minibag",["jquery","mustache","modernizr","nord/config","nord/feature/util/cookie","nord/feature/util/keyCode","text!htmlTemplate/minibag/items.html","text!htmlTemplate/minibag/empty.html","text!htmlTemplate/minibag/subtotal.html"],function(e,n,t,i,a,o,r,s,l){function c(){T=e("#mini-bag-section"),1===T.length&&(w=e("#shopping-bag-count"),B=e("#shopping-bag-link"),I=e("#mini-bag-close"),i.getValueOrDefault("features.isEasyCheckoutEnabled",!0)===!0&&e("#shopping-bag-links").addClass("easy-checkout"),u(),v(),m())}function u(){T.on("click",j.itemRemove,function(){S(e(this).closest(j.item))}).on("click",j.checkout,function(n){e(this).hasClass("button-disabled")&&n.preventDefault()}).add(B).on("mouseover",p).on("mouseleave",d),I.on("click",function(e){e.preventDefault(),d()}),B.on("mouseover",function(){U&&cmCreateElementTag("Shopping Bag Expand Hover - Mini","Shopping Bag")}),t.touch&&B.on("click",function(e){B.hasClass("active")||(e.preventDefault(),e.stopPropagation(),B.addClass("active"),p())}),e(document).on("update.miniBag",function(n,t){n.stopPropagation(),n.preventDefault(),f(t),p(),e("html, body").animate({scrollTop:0},0),I.focus()})}function p(){B.trigger("focus").parent().addClass("active"),e(window).on("keydown.miniBag",function(e){e.which===o.esc&&d()})}function d(){B.removeClass("active").parent().removeClass("active"),e(window).off("keydown.miniBag"),h(x())}function m(){e.ajax({type:"GET",url:i.getValue("urls.store")+"mb/Get",dataType:"json",data:k()}).done(function(e){e.error?console.log("Minibag: An error occurred while getting Minibag data: "+e.error.Value):(null!==e.Items?(f(e),h(e.ShoppingBagCount)):b(),y(e.ShoppingBagCount))})}function f(t){t.isInternationalShopper=M,i.getValueOrDefault("features.isEasyCheckoutEnabled",!0)===!1&&t.ShoppingBagUri&&(t.CheckoutUri=t.ShoppingBagUri),T.find("ul").empty().append(n.render(r,t)).end().find(j.subtotalSection).empty().append(n.render(l,t)).end().find(j.checkout).on("click",function(){U&&cmCreateManualLinkClickTag(e(this).attr("href"),"Checkout")}),g(t,!0),v()}function g(e,n){if(e.hasOwnProperty("QtyAffected")&&!isNaN(parseInt(e.QtyAffected,10))){var t=n?"Added":"Removed";T.find(j.itemMessage).html(e.QtyAffected+" "+O[(1!==e.QtyAffected?"items":"item")+t])}}function h(e){T.find(j.emptyItem).length>0||T.find(j.itemMessage).html(e+" "+O[(1!==e?"items":"item")+"InBag"])}function v(){var e=T.find(j.item);e.filter(":last").addClass("last-item"),T.find(j.scrollContainer).toggleClass("three-items",e.length>2)}function b(){T.find(j.subtotalSection).empty().end().find("ul").empty().append(s).end().find(j.itemMessage).empty()}function y(n){w.html(n),a.setValue(i.getValueOrDefault("cookies.nordstrom","nordstrom"),"bagcount",n),isNaN(n)||1>n?e("#mini-bag-checkout").addClass("button-disabled"):e("#mini-bag-checkout").removeClass("button-disabled")}function S(n){e.ajax({type:"POST",url:i.getValue("urls.store")+"mb/Remove",dataType:"json",data:n.data("value")}).done(function(e){e.error?(console.log("Minibag: An error occurred while removing an item from the Minibag: "+e.error.Value),"Unable to Remove item from MiniBag"===e.error.Value&&m()):(n.remove(),y(e.ShoppingBagCount),null!==e.Items?(g(e,!1),T.find(j.subtotal).html(e.SubTotal)):b(),v(),U&&cmCreateElementTag("Remove Item - Mini","Shopping Bag"))})}function x(){var e=parseInt(a.getValue(i.getValueOrDefault("cookies.nordstrom","nordstrom"),"bagcount"),10);return isNaN(e)?0:e}function k(){var e=a.load("minibag");return"undefined"!=typeof e&&e.hasOwnProperty("MiniBagHash")?e.MiniBagHash:(new Date).getTime().toString()}function C(n){var t=T.find(j.item).not(j.emptyItem);U&&(t.each(function(){var n,t=e(this).data("itemParams"),i="";t&&(t.OutfitId&&""!==t.OutfitId&&(i=t.StyleId+"_"+t.OutfitId),n=t.SiteLocationId.substr(t.SiteLocationId.indexOf("*")).split("*").join("-_-"),cmCreateShopAction5Tag(t.StyleId,t.StyleName,t.Quantity,t.UnitPrice,t.CategoryId,i,"","",t.PickUpInStore,t.StoreNumber,"",n),cmDisplayShop5s())}),t.length>0&&cmCreateConversionEventTag(n,"2","Checkout Button"))}var w,B,T,I,O={itemAdded:"item has been added to your Shopping Bag",itemsAdded:"items have been added to your Shopping Bag",itemRemoved:"item has been removed from your Shopping Bag",itemsRemoved:"items have been removed from your Shopping Bag",itemInBag:"item in Shopping Bag",itemsInBag:"items in Shopping Bag"},j={checkout:"#mini-bag-checkout",emptyItem:".empty-item",item:".mini-bag-item",itemMessage:".item-message",itemRemove:".item-remove",scrollContainer:".mini-bag-section-content-scroll",subtotal:".subtotal b",subtotalSection:".mini-bag-section-content-bottom"},U=!!window.cmCreateElementTag,N=a.getValue("internationalshippref","preferredcountry"),M="US"!==N;return{init:c,open:p,close:d,throwShopAction5Tags:C}}),define("nord/featureSet/minibag",["nord/feature/minibag/minibag"],function(e){return e})