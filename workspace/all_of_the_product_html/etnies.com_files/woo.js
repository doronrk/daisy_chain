/* 
	Woobox Javascript SDK
	2013 Woobox, LLC
*/
var Woo={};
(function(){Woo=new function(){function q(b,a){var c=b;f&&(c=c.replace("{host}",f));for(var d in a)c="host"!=d?c.replace("{"+d+"}",encodeURIComponent(a[d])):c.replace("{"+d+"}",a[d]);return c}function r(b,a){for(var c in a)"object"!=typeof a[c]?b[c]=a[c]:("undefined"==typeof b[c]&&(b[c]=a[c]),r(b[c],a[c]))}function s(b){if(t){if(b.origin!=window.location.protocol+"//"+f)return!1;var a={};try{if(a=JSON.parse(b.data),a.pid&&"undefined"!=typeof m[a.pid])return m[a.pid].receiveMessage(b,a)}catch(c){}}return!1}function n(b,
a,c,d){return t?(a={t:u,k:p,pid:a},r(a,c),d||(d=window.location.protocol+"//"+f),b.postMessage(JSON.stringify(a),d),!0):!1}function v(b){if("undefined"!=typeof b.consts){if("undefined"!=typeof b.consts.defaultCSS)for(var a in b.consts.defaultCSS)b.el.style[a]=b.consts.defaultCSS[a];if(b.type&&"undefined"!=typeof b.consts.classCSSMap[b.type])for(a in b.consts.classCSSMap[b.type])b.el.style[a]=b.consts.classCSSMap[b.type][a];for(a in{width:!0,height:!0})"undefined"!=typeof b.consts[a]&&(0<b.consts[a].indexOf("%")?
b.el.style[a]=b.css[a]:b.el.style[a]=b.css[a]+"px");return!0}return!1}function g(b,a){this.inited=!1;this.parent=b;this.fid=a;this.el=document.createElement("iframe");this.consts=h.plugin.frames[this.fid];this.el.setAttribute("id",this.parent.pid+"_"+this.fid);this.el.setAttribute("scrolling","no");this.el.className=this.parent.pid+"_"+this.fid;this.css={};this.clicked=this.over=!1}function e(b,a){this.inited=!1;this.consts=h.plugin;this.type=a;this.el=b;this.pid=this.el.getAttribute(this.consts.classIDMap[this.type]);
"undefined"==typeof k[this.pid]?k[this.pid]=0:k[this.pid]++;this.pid=this.pid+"_"+k[this.pid];this.el.id=this.pid;this.opts={};this.frames={};this.loading=!1;this.cssLink=null;if(this.consts.classFrameMap[this.type].length)for(var c=0;c<this.consts.classFrameMap.length;c++)this.frames[this.consts.classFrameMap[c]]=new g(this,this.consts.classFrameMap[c])}if(arguments.callee._singletonInstance)return arguments.callee._singletonInstance;arguments.callee._singletonInstance=this;var h={logging:"//{host}/plugins/log",
plugin:{classes:["woobox-offer"],options:{},frames:{offer:{src:"//{host}/plugins/offer/{pid}/{params}",width:"100%",height:"determine",defaultCSS:{border:"none",WebkitBorderRadius:"3px",MozBorderRadius:"3px",OBorderRadius:"3px",borderRadius:"3px",WebkitTransition:"height 0.2s ease-out",MozTransition:"height 0.2s ease-out",OTransition:"height 0.2s ease-out",transition:"height 0.2s ease-out"},eventHandlers:{}}},classIDMap:{"woobox-offer":"data-offer"},classOptionMap:{"woobox-offer":[]},classFrameMap:{"woobox-offer":["offer"]},
classCSSMap:{"woobox-offer":{display:"inline-block",width:"100%",maxWidth:"810px"}},defaultCSS:{position:"relative",border:"none"},defaultCSSLink:"//{host}/css/plugins/{class}.css"},errors:{}},f,p,u,t=!!window.postMessage,l=!!window.addEventListener;(function(){for(var b=3,a=document.createElement("div"),c=a.all||[];a.innerHTML="\x3c!--[if gt IE "+ ++b+"]><br><![endif]--\x3e",c[0];);return 4<b?b:!b})();var m={},k={};this.box=function(b,a,c){if(c)f=c;else{c=document.getElementById("woobox-sdk").getAttribute("src");
var d=document.createElement("a");d.setAttribute("href",c);f=d.hostname}u=b;p=a;l?window.addEventListener("message",s,!1):window.attachEvent("onmessage",s);b=document.getElementsByTagName("div");for(a=0;a<b.length;a++)for(c=0;c<h.plugin.classes.length;c++)b[a].className==h.plugin.classes[c]&&(d=new e(b[a],h.plugin.classes[c]),m[d.pid]=d,d.init())};g.prototype.init=function(){if("undefined"!=typeof this.parent.pid){var b=this.parent.el.getAttribute("data-params"),b=q(this.consts.src,{pid:this.parent.pid,
k:p,params:b});this.el.setAttribute("src",b);this.parent.el.appendChild(this.el);for(var a in{width:!0,height:!0})"determine"!=this.consts[a]&&(this.css[a]=this.consts[a]);this.setCSS();var c=this;if("undefined"!=typeof this.consts.eventHandlers.mouseover)var d=function(a){c.consts.eventHandlers.mousemove(a,c)};l?this.el.addEventListener("mousemove",d,!1):this.el.attachEvent("onmousemove",d);a=function(a){c.over=!0;"undefined"!=typeof c.consts.eventHandlers.mouseover&&c.consts.eventHandlers.mouseover(a,
c)};l?this.el.addEventListener("mouseover",a,!1):this.el.attachEvent("onmouseover",a);a=function(a){c.over=!1;"undefined"!=typeof c.consts.eventHandlers.mouseout&&c.consts.eventHandlers.mouseout(a,c)};l?this.el.addEventListener("mouseout",a,!1):this.el.attachEvent("onmouseout",a);this.inited=!0}};g.prototype.setCSS=function(){return v(this)};g.prototype.reload=function(){this.loaded=!1;this.el.setAttribute("src",this.el.src)};e.prototype.sendData=function(b,a,c){return n(b.el.contentWindow,this.pid,
{receive:a,data:c})};e.prototype.sendRequest=function(b,a,c){return n(b.el.contentWindow,this.pid,{request:a,data:c})};e.prototype.returnTarget=function(b,a){var c={receive:"target",data:null};a.frame&&(c.request="dims",c.frame=a.frame);return n(b.source,this.pid,c,b.origin)};e.prototype.receiveMessage=function(b,a){if("undefined"!=typeof a.receive)switch(a.receive){case "dims":if("undefined"!=typeof a.frame&&"undefined"!=typeof this.frames[a.frame]){for(var c in a.data.dims)this.frames[a.frame].css[c]=
a.data.dims[c];return this.frames[a.frame].setCSS()}return!1}if("undefined"!=typeof a.request)switch(a.request){case "target":return this.returnTarget(b,a)}};e.prototype.init=function(){this.setOpts();this.setCSS();var b=this,a=window.setInterval(function(){b.inited&&(b.setCSSLink(),window.clearInterval(a))},100);this.setFrames()};e.prototype.setCSS=function(){return v(this)};e.prototype.setCSSLink=function(){this.cssLink=document.createElement("link");if("undefined"!=typeof this.opts.css)var b=this.opts.css;
else return!1;this.cssLink.setAttribute("rel","stylesheet");this.cssLink.setAttribute("type","text/css");this.cssLink.setAttribute("href",b);this.cssLink.setAttribute("id","c_"+this.pid);document.getElementsByTagName("head")[0].appendChild(this.cssLink)};e.prototype.setOpts=function(){this.opts.css=q(this.consts.defaultCSSLink,{"class":this.type});this.setInlineOpts();return!0};e.prototype.setFrames=function(){for(var b=0;b<this.consts.classFrameMap[this.type].length;b++)for(var a in this.consts.frames)this.consts.classFrameMap[this.type][b]==
a&&(this.frames[a]=new g(this,a),this.frames[a].init())};e.prototype.setInlineOpts=function(){for(var b=this.el.attributes,a=0;a<b.length;a++)for(var c=0;c<this.consts.classOptionMap[this.type].length;c++)if(this.consts.classOptionMap[this.type][c]==b[a].name){this.opts[this.consts.options[this.consts.classOptionMap[this.type][c]]]=b[a].value;break}};e.prototype.setLoading=function(){this.loading=!0};e.prototype.clearLoading=function(){this.loading=!1}};Woo.box()})();
