/* Script imported from http://www.ralphlauren.com/js/poloColor2.js */
var POLO=POLO||{};(function($){$.fn.centerX=function(){this.css("left",($(window).width()-this.width())/2+$(window).scrollLeft()+"px");return this;};$(document).ready(function(){var leftNav=$("#left-nav");leftNav.appendTo("#hamburger");$("#hamburger").on({mouseover:function(){if(leftNav.is(":hidden")){leftNavtapHamburger();}leftNav.stop(true,true).delay(200).show(1);},mouseout:function(){leftNav.stop(true,true).delay(200).hide(1);},click:function(){if(leftNav.is(":visible")){leftNav.hide(1);}else{leftNav.show(1);}}});if(isProductAvailable){POLO.Product.init();POLO.CustomizeDropdown($("#narrow-by"));}});POLO.Product={layoutType:null,isAltImgSlotOn:poloIsAltImgSlotOn,altSelectType:"Select",initialized:false,init:function(){var _this=this,firstColor;if(!this.isPricedBySku()){POLO.SizeSplitter.init();}if(selColorFilter){this.filterColorsByGenericColor(selColorFilter);if($("#color-swatches li.hidden").length){$("#color-swatches").append('<li id="more-colors" title="More Colors">&#43; More</li>');}}firstColor=$("#color-swatches li:not(.hidden)").eq(0).attr("data-value");this.setLayoutType(firstColor);this.bindEvents();setTimeout(function(){_this.resetSelections();_this.setSizeWidths();_this.positionProductActions();$("#addToBag label").html("QTY.");$(".product-actions").css("visibility","visible");_this.initialized=true;if(isAddedToWishlist){_this.showItemAddedMessage("wishlist");}},100);},bindEvents:function(){var _this=this;$("#color-swatches li:not(#more-colors)").on({click:function(){var colorId=$(this).attr("data-value"),colorTitle=$(this).attr("title");if(colorId){$("#colors_0").val(colorId);$("#color-title").html(colorTitle);$("#color-title").attr("title",colorTitle);_this.updateProductImages(colorId);_this.updateSwatchStates();_this.setSKUStatus();if(POLO.SizeSplitter.isEnabled){POLO.SizeSplitter.updateSizeAvailability();}}},mouseenter:function(){$("#color-title").html($(this).attr("title"));},mouseleave:function(){$("#color-title").html($("#color-title").attr("title"));}});$("#color-swatches #more-colors").on("click",function(){$("#color-swatches li.hidden").each(function(){$(this).removeClass("hidden");});$(this).remove();_this.positionProductActions();});$("#narrow-by").on("change",function(){var genericColor=$(this).val();_this.filterColorsByGenericColor(genericColor);if(genericColor!=="All Colors"){narrowByColor(genericColor);}_this.positionProductActions();});$("#size-swatches li").on("click",function(){var sizeId=$(this).attr("data-value");$("#sizes_0").val(sizeId);_this.updateSwatchStates();_this.setSKUStatus();});$("#addToCart, #addToWishlist").on({mouseover:function(){var hoverTxt=$(this).attr("data-hover");if(hoverTxt){$(this).addClass("hover-msg").text(hoverTxt);}},mouseout:function(){$(this).removeClass("hover-msg").text($(this).attr("title"));}});},updateProductImages:function(colorId){var colorId=colorId||$("#colors_0").val(),imageMap=imageMap_0[colorId]||null,zoomPrefix="http://s7d2.scene7.com/is/image/PoloGSI/",zoomSuffix="?wid=2000&hei=2000",alt1Main=alt1Zoom=alt2Main="",hasAlt1=hasAlt2=false,prodImg2,prodImg3;persistantSwapimagescolorId=colorId;persistantSwapimagesREGPath=imageMap.v400?imageMap.v400:imageMap.reg;persistantSwapimagesENHPath=imageMap.enh;persistantSwapimagesTHUMBPath=imageMap.thumb;currentItemZoomURL=Scene7Map["c"+colorId];currentItemZoomImage=Scene7Map["s7"+colorId];swapImages(persistantSwapimagesREGPath,persistantSwapimagesENHPath,colorId,persistantSwapimagesTHUMBPath);AltImages.init(colorId,null,true);$("#zoomDiv, #flyout").hide();$(".smooth_zoom_preloader, #prod-img-zoom").remove();$(altImages[colorId]).each(function(i,val){if(this.name=="alternate1"){alt1Main=this.v400?this.v400:this.main;alt1Zoom=this.t940?this.t940:zoomPrefix+this.zoom+zoomSuffix;hasAlt1=true;}else{if(this.name=="alternate2"){alt2Main=this.v400?this.v400:this.main;hasAlt2=true;}}});if(this.layoutType==3){prodImg2=alt2Main?alt2Main:this.defaults.prodImg2;prodImg3=alt1Zoom?alt1Zoom:this.defaults.prodImg3;$("#prod-alt-2").attr("src",prodImg2).show();$("#prod-alt-3").attr("src",prodImg3).show();$(".prod-alt-2, .prod-alt-3").show();}else{if(this.layoutType==2){if(hasAlt1){prodImg2=alt1Main?alt1Main:this.defaults.prodImg2;$("#prod-alt-2").attr("src",prodImg2).show();}else{prodImg2=alt2Main?alt2Main:this.defaults.prodImg2;$("#prod-alt-2").attr("src",prodImg2).show();}$(".prod-alt-2").show();}}setZoomIcon(colorId);setZoomColor(colorId);if(isScene7Enabled&&currentItemZoomImage!=undefined&&currentItemZoomImage!=""){if(isTablet){initS7PinchZoom(currentItemZoomImage);}else{initS7Flyout(currentItemZoomImage);}}else{$("#imageDiv, #prod-img").show();}},setLayoutType:function(selectedColor){var alt1Main=alt1Zoom=alt2Main="",hasAlt1=hasAlt2=false,zoomPrefix="http://s7d2.scene7.com/is/image/PoloGSI/",zoomSuffix="?wid=2000&hei=2000",layoutClass;$(altImages[selectedColor]).each(function(){if(this.name==="alternate1"){alt1Main=this.main;alt1Zoom=zoomPrefix+this.zoom+zoomSuffix;hasAlt1=true;}else{if(this.name==="alternate2"){alt2Main=this.main;hasAlt2=true;}}});if(altImages.product&&(!hasAlt1||!hasAlt2)){$(altImages.product).each(function(){if(!hasAlt1&&this.name==="alternate1"){alt1Main=this.main;alt1Zoom=zoomPrefix+this.zoom+zoomSuffix;hasAlt1=true;}if(!hasAlt2&&this.name==="alternate2"){alt2Main=this.main;hasAlt2=true;}});}this.defaults={};if(hasAlt1&&hasAlt2){layoutClass="layout-2";if(this.isAltImgSlotOn){this.layoutType=3;this.defaults.prodImg2=alt2Main;this.defaults.prodImg3=alt1Zoom;}else{this.layoutType=2;this.defaults.prodImg2=alt1Main;}}else{if(hasAlt1||hasAlt2){layoutClass="layout-2";this.layoutType=2;if(hasAlt1){this.defaults.prodImg2=alt1Main;}else{this.defaults.prodImg2=alt2Main;}}else{layoutClass="layout-1";this.layoutType=1;}}$(".prod-wrapper").removeClass("layout-1").addClass(layoutClass);},positionProductActions:function(){var productActions=$(".product-actions");productActions.removeClass("fixed");if($(".prod-summary").outerHeight()<=640){productActions.addClass("fixed");}},setSizeWidths:function(){var largestSizeWidth=0;$("#size-swatches li").each(function(){if($(this).innerWidth()>largestSizeWidth){largestSizeWidth=$(this).innerWidth();}});$("#size-swatches li").each(function(){$(this).innerWidth(largestSizeWidth);});},updateSwatchStates:function(){var _this=this,selectedColor=$("#colors_0").val(),selectedSize=$("#sizes_0").val(),isPricedBySku=this.isPricedBySku(),crossOff='<img class="crossoff" src="/images/product/crossoff_35x35.png" />',availableColorIds=[],availableSizeIds=[];if(selectedSize){availableColorIds=_this.getAvailableColorsBySize(selectedSize);}availableSizeIds=_this.getAvailableSizeIdsByColorId(selectedColor);$("#color-swatches li, #size-swatches li").each(function(){$(this).removeClass("active").removeClass("disabled");});$("#color-swatches .crossoff, #size-swatches .crossoff").each(function(){$(this).remove();});$("#color-swatches li:not(#more-colors)").each(function(){var colorId=$(this).attr("data-value");if(colorId===selectedColor){$(this).addClass("active");}if(selectedSize){if($.inArray(colorId,availableColorIds)==-1){$(this).addClass("disabled").append($(crossOff));}}});$("#size-swatches li").each(function(){var sizeId=$(this).attr("data-value"),sizeTitle=this.title,sizePrice;if(isPricedBySku){sizePrice=_this.getPriceByColorAndSize(selectedColor,sizeId)||"";if(sizePrice){sizeTitle+=" - "+sizePrice;}$(this).html(sizeTitle);}if(sizeId===selectedSize){$(this).addClass("active");}if($.inArray(sizeId,availableSizeIds)==-1){$(this).addClass("disabled").append($(crossOff));}});resetAddToBag();},setSKUStatus:function(){var selectedColor=$("#colors_0").val(),selectedSize=$("#sizes_0").val(),cartButton=$("#addToCart"),wishListButton=$("#addToWishlist"),size1,size2,releaseDate,skuStatus="NO_SKU";$(".product-actions").removeClass("fixed");if(selectedColor&&selectedSize){$.each(itemMap,function(i,sku){if(sku.cId===selectedColor&&sku.sId===selectedSize){releaseDate=sku.releaseDate;skuStatus=sku.avail;}});}else{if(POLO.SizeSplitter.isEnabled){size1=$("#size1_0").val();size2=$("#size2_0").val();if(!size1&&!size2){skuStatus="NO_SIZE_SELECTED";}else{if(!size1&&size2){skuStatus="NO_SIZE_1_SELECTED";}else{if(size1&&!size2){skuStatus="NO_SIZE_2_SELECTED";}}}}else{skuStatus="NO_SIZE_SELECTED";}}cartButton.attr({"title":"Add To Shopping Bag","data-hover":""}).removeClass("out-of-stock disabled").html("Add To Shopping Bag");wishListButton.attr({"title":"Add To Wishlist","data-hover":""}).removeClass("out-of-stock disabled").html("Add To Wishlist").show();$("#preorder-message").remove();switch(skuStatus){case"NO_SIZE_SELECTED":cartButton.attr("data-hover","Please Select a Size").addClass("disabled");wishListButton.attr("data-hover","Please Select a Size").addClass("disabled");break;case"NO_SIZE_1_SELECTED":var label=$("#size1-label").text();cartButton.attr("data-hover","Please Select a "+label).addClass("disabled");wishListButton.attr("data-hover","Please Select a "+label).addClass("disabled");break;case"NO_SIZE_2_SELECTED":var label=$("#size2-label").text();cartButton.attr("data-hover","Please Select a "+label).addClass("disabled");wishListButton.attr("data-hover","Please Select a "+label).addClass("disabled");break;case"RELEASE_DATED":var preOrderMessage='<div id="preorder-message">'+"<strong>PRE-ORDER</strong><br/>"+"You will not be charged for the item until it ships to you.<br/>"+"This item is expected to ship no later than <strong>"+releaseDate+"</strong>."+"</div>";$(".cart-messaging").append($(preOrderMessage));if(this.initialized){preOrderInlineFrmPdp();}case"IN_STOCK":wishListButton.show();break;case"OUT_OF_STOCK":case"NO_SKU":default:$(".addToBagTooltip").hide();cartButton.attr("title","Out Of Stock").html("Out Of Stock").addClass("out-of-stock disabled");wishListButton.hide();}if(this.initialized){this.positionProductActions();}return skuStatus;},resetSelections:function(){$("#sizes_0").val("");$("#preorder-message").remove();$("#addToCart").removeClass("added");$("#color-swatches li:not(.hidden)").eq(0).click();if(POLO.SizeSplitter.isEnabled){$("#size1_0").val("");$("#size2_0").val("");POLO.SizeSplitter.updateSizeAvailability();POLO.SizeSplitter.setSizeSelection();}this.updateSwatchStates();if($("#size-swatches li").length==1){$("#size-swatches li").eq(0).click();}},showItemAddedMessage:function(addedTo){var addedTo=addedTo||"bag",button=addedTo=="bag"?"#addToCart":"#addToWishlist",message="Item Added To "+(addedTo=="bag"?"Bag":"Wishlist"),origText=$(button).text();$(button).html(message).addClass("added");if(addedTo!="bag"){setTimeout(function(){$(button).html(origText).removeClass("added");},5000);}},getColorIdsFromGenericColor:function(genericColor){var colorArray=[];$.each(orderedImageMap_0,function(i,slice){$.each(slice.genColor,function(j,genColor){if(genColor===genericColor){colorArray.push(slice.cId);}});});return colorArray;},getAvailableSizeIdsByColorId:function(colorId){var sizeArray=[];$.each(itemMap,function(i,sku){if(sku.cId==colorId&&(sku.avail=="IN_STOCK"||sku.avail=="RELEASE_DATED")){if($.inArray(sku.sId,sizeArray)===-1){sizeArray.push(sku.sId);}}});return sizeArray;},getAvailableSizeNamesByColorId:function(colorId){var sizeArray=[];$.each(itemMap,function(i,sku){if(sku.cId==colorId&&(sku.avail=="IN_STOCK"||sku.avail=="RELEASE_DATED")){if($.inArray(sku.sId,sizeArray)==-1){sizeArray.push(sku.sDesc);}}});return sizeArray;},getAvailableColorsBySize:function(sizeId){var colorArray=[];$.each(itemMap,function(i,sku){if(sku.sId===sizeId&&(sku.avail==="IN_STOCK"||sku.avail=="RELEASE_DATED")){if($.inArray(sku.cId,colorArray)===-1){colorArray.push(sku.cId);}}});return colorArray;},getPriceByColorAndSize:function(colorId,sizeId){var price,i,sku;for(i=0;i<itemMap.length;i++){sku=itemMap[i];if(sku.cId==colorId&&sku.sId==sizeId){return sku.price;}}return price;},filterColorsByColorId:function(colorArray){var colorArr=colorArray||[];$("#color-swatches li:not(#more-colors)").each(function(){var thisColorId=$(this).attr("data-value");$(this).removeClass("hidden");if(colorArr.length>0){if($.inArray(thisColorId,colorArr)==-1){$(this).addClass("hidden");}}});$("#color-swatches li:not(.hidden)").eq(0).click();},filterColorsByGenericColor:function(genericColor){var colorIdsArr=this.getColorIdsFromGenericColor(genericColor)||[];this.filterColorsByColorId(colorIdsArr);},isPricedBySku:function(){var lastPrice,i;for(i=0;i<itemMap.length;i++){if(lastPrice&&itemMap[i].price!=lastPrice){return true;}else{lastPrice=itemMap[i].price;}}return false;}};POLO.SizeSplitter={sizePatternArray:[{pattern:/^([\d\.]+)(x)([\d\/]+)$/,labels:["Neck","Sleeve"]},{pattern:/^([\d\.]+)(X)([\d\/]+)$/,labels:["Neck","Sleeve"]},{pattern:/^([\d\.]+)( )([\d\/]+)$/,labels:["Neck","Sleeve"]},{pattern:/^((?:Woman |Petite )*[\d\.]+W)(x)([\d\/]+L)$/,labels:["Waist","Length"]},{pattern:/^([\d\.]+)( )(Short|Regular|Long|X-Long)$/,labels:["Measurement","Length"]}],debug:false,isEnabled:false,sizePatternIndex:-1,delimeter:"",allSize1:[],allSize2:[],sizeMap:[],orderedSizes:[],init:function(){var _this=this;$("#size-swatches li").each(function(){_this.orderedSizes.push({id:$(this).attr("data-value"),desc:$(this).text()});});if(this.isSplittable()){this.isEnabled=true;this.populateSizeMap();this.renderSizeSwatches();this.bindEvents();}},bindEvents:function(){var _this=this;$("#size1 li").on("click",function(){var sizeId=$(this).attr("data-value");$("#size1_0").val(sizeId);_this.updateSizeAvailability();_this.setSizeSelection();POLO.Product.updateSwatchStates();POLO.Product.setSKUStatus();});$("#size2 li").on("click",function(){var sizeId=$(this).attr("data-value");$("#size2_0").val(sizeId);_this.updateSizeAvailability();_this.setSizeSelection();POLO.Product.updateSwatchStates();POLO.Product.setSKUStatus();});},populateSizeMap:function(){var pattern=this.sizePatternArray[this.sizePatternIndex].pattern;for(var i=0;i<this.orderedSizes.length;i++){var matches=this.orderedSizes[i].desc.match(pattern),delimeter,size1,size2;if(matches){delimeter=matches[2],size1=matches[1],size2=matches[3];this.sizeMap.push({desc:matches[0],size1:size1,size2:size2});this.pushUnique(size1,this.allSize1);this.pushUnique(size2,this.allSize2);if(this.delimeter===""){this.delimeter=delimeter;}}}this.allSize1.naturalSort();this.allSize2.naturalSort();},updateSizeAvailability:function(){var _this=this,crossOff='<img class="crossoff" src="/images/product/crossoff_35x35.png" />',colorId=$("#colors_0").val(),selectedSize1=$("#size1_0").val(),selectedSize2=$("#size2_0").val(),availableSizeNames=POLO.Product.getAvailableSizeNamesByColorId(colorId),pattern=this.sizePatternArray[this.sizePatternIndex].pattern,availSize1=[],availSize2=[];for(var i=0;i<availableSizeNames.length;i++){var matches=availableSizeNames[i].match(pattern),size1,size2;if(matches){size1=matches[1];size2=matches[3];if(selectedSize1){if(selectedSize1&&selectedSize1==size1){this.pushUnique(size2,availSize2);}}else{this.pushUnique(size2,availSize2);}if(selectedSize2){if(selectedSize2&&selectedSize2==size2){this.pushUnique(size1,availSize1);}}else{this.pushUnique(size1,availSize1);}}}$("#size1 li, #size2 li").each(function(){$(this).removeClass("disabled");});$(".size-swatches .crossoff").each(function(){$(this).remove();});$("#size1 li").each(function(){var sizeId=$(this).attr("data-value");if($.inArray(sizeId,availSize1)==-1){$(this).addClass("disabled").append($(crossOff));}});$("#size2 li").each(function(){var sizeId=$(this).attr("data-value");if($.inArray(sizeId,availSize2)==-1){$(this).addClass("disabled").append($(crossOff));}});},setSizeSelection:function(){var _this=this,selectedSize1=$("#size1_0").val(),selectedSize2=$("#size2_0").val(),fullSize=selectedSize1+this.delimeter+selectedSize2,foundSize=false;$("#size1 li, #size2 li").each(function(){$(this).removeClass("active");});$("#size1 li").each(function(){var sizeId=$(this).attr("data-value");if(sizeId===selectedSize1){$(this).addClass("active");}});$("#size2 li").each(function(){var sizeId=$(this).attr("data-value");if(sizeId===selectedSize2){$(this).addClass("active");}});$.each(this.sizeMap,function(k,val){if(val.desc===fullSize){foundSize=true;}});if(foundSize){$("#sizes_0").val(this.getSizeIdByName(fullSize));}else{$("#sizes_0").val("");}},getSizeIdByName:function(sizeName){for(i=0;i<this.orderedSizes.length;i++){if(this.orderedSizes[i].desc===sizeName){return this.orderedSizes[i].id;}}},renderSizeSwatches:function(){var sizeLabels=this.sizePatternArray[this.sizePatternIndex].labels,size1Render='<div id="size1-label" class="label">'+sizeLabels[0]+"</div>",size2Render='<div id="size2-label" class="label">'+sizeLabels[1]+"</div>";$("#size-swatches").remove();size1Render+='<input id="size1_0" name="size1_0" type="hidden" value="" />';size1Render+='<ul id="size1" class="size-swatches">';$.each(this.allSize1,function(i,val){size1Render+='<li data-value="'+val+'">'+val+"</li>";});size1Render+="</ul>";size2Render+='<input id="size2_0" name="size2_0" type="hidden" value="" />';size2Render+='<ul id="size2" class="size-swatches">';$.each(this.allSize2,function(i,val){size2Render+='<li data-value="'+val+'">'+val+"</li>";});size2Render+="</ul>";$($(size1Render+size2Render)).insertAfter("#sizes_0");},isSplittable:function(){for(p=0;p<this.sizePatternArray.length;p++){var pattern=this.sizePatternArray[p].pattern,allMatch=true;for(i=0;i<this.orderedSizes.length;i++){if(!this.orderedSizes[i].desc.match(pattern)){allMatch=false;break;}}if(allMatch){this.sizePatternIndex=p;return true;}}return false;},pushUnique:function(value,array){if($.inArray(value,array)==-1){array.push(value);}}};POLO.CustomizeDropdown=function(htmlSelect,zIndex){var select=htmlSelect;if(select.find("option").length>0){var selectBoxContainer=$("<div>",{"class":"custom-dropdown "+htmlSelect.attr("class"),html:'<div class="select-box"></div>'});selectBoxContainer.css("z-index",zIndex);var dropDown=$("<ul>",{"class":"dropdown"});var selectBox=selectBoxContainer.find(".select-box");var widest=null;select.find("option").each(function(i){var option=$(this);var optionText=option.text();if(optionText.length>21){if(optionText[17]==" "){optionText=optionText.substring(0,17)+"...";}else{optionText=optionText.substring(0,18)+"...";}}var li=$("<li>",{html:optionText,"data-text":optionText});if(htmlSelect.hasClass("cross-sell-colors")&&option.attr("value")!=""){li.html('<img src="'+option.attr("data-swatch")+'"/>');}if(i==0){selectBox.html('<span class="label">'+select.attr("data-type")+'</span><span class="selected">'+optionText+"</span>");if(!htmlSelect.hasClass("narrow-by")){li.addClass("hidden");}else{li.addClass("first");}}else{if(i==1){if(!htmlSelect.hasClass("narrow-by")){li.addClass("first");}}else{if(i==select.find("option").length-1){li.addClass("last");}}}if(option.attr("selected")=="selected"){selectBox.html('<span class="label">'+select.attr("data-type")+'</span><span title="'+option.text()+'" class="selected">'+optionText+"</span>");dropDown.find("li.selected").removeClass("selected");li.addClass("selected");}li.click(function(e){if(!$(this).hasClass("selected")){selectBox.html('<span class="label">'+select.attr("data-type")+'</span><span title="'+option.text()+'" class="selected">'+optionText+"</span>");selectBox.find("span span").each(function(){$(this).css({"display":"block"});});dropDown.trigger("collapse");dropDown.find("li.selected").removeClass("selected");$(this).addClass("selected");select.val(option.val());$(select).trigger("change");}return false;});dropDown.append(li);});selectBoxContainer.append(dropDown.hide());select.hide().after(selectBoxContainer);selectBoxContainer.find(".select-box span span").each(function(){$(this).css({"display":"block"});});dropDown.bind("expand",function(){$("ul.dropdown").each(function(){$(this).trigger("collapse");});selectBoxContainer.addClass("expanded");dropDown.show();}).bind("collapse",function(){selectBoxContainer.removeClass("expanded");dropDown.hide();});selectBoxContainer.click(function(e){if(selectBoxContainer.hasClass("expanded")){dropDown.trigger("collapse");}else{dropDown.trigger("expand");}return false;});$(document).click(function(){dropDown.trigger("collapse");});}};POLO.GetCrossSells=function(crossSellData){params="";for(i=0;i<crossSellData.length;i++){params=params+"&productId="+crossSellData[i].productId;}jQuery(document).ready(function(){new Ajax.Request("/svc/CatalogServices/ProductData?format=json&appId=rlpolo&stoken=33BrvOs219QLIeOh%2B6Kkmg==&locale=en_US&storeCode=POLO"+params,{method:"get",onSuccess:function(response){JSONObj=response.responseText.evalJSON();relatedProducts=JSONObj["products"]["product"];allProductData=[];for(i=0;i<relatedProducts.length;i++){var product=relatedProducts[i];var sizeUniqueValue=[];var sizeCounter=0;var sizeUniqueIndex=0;var sizeFound=false;var isOnSale=false;var productData={title:product.productTitle,brandId:product.productBrand.id,productId:product.productId,skuData:[],padAttribs:[],sizeSlices:[],longDesc:product.productLongDescription,productURL:product.productBaseURL+"productId="+product.productId,prodDisplay:crossSellData[i].prodDisplay,fitToggle:"",materials:"",care:"",lowestSkuPrice:0,highestSkuPrice:0,lowestBaseSkuPrice:0,highestBaseSkuPrice:0,defaultPrice:""};if(product.productSlices.productSizes){for(var j=0;j<product.productSlices.productSizes.productSize.length;j++){var sizeSlice=product.productSlices.productSizes.productSize[j];productData.sizeSlices.push(sizeSlice.text.toLowerCase());}}product["skus"]["sku"].each(function(v,index){if(v.qty!=""&&v.available=="IN_STOCK"){var sizeIndex;var size=v.sizeid;var price="";var color="";var colorFound=false;var colorId="";sizeFound=false;if(sizeUniqueValue.length>0){sizeCounter=0;sizeUniqueValue.each(function(v){if(!sizeFound&&v.size==size){sizeFound=true;sizeUniqueIndex=sizeCounter;}else{if(!sizeFound){sizeCounter++;}}});}if(!sizeFound){sizeUniqueValue.push({"size":size.toLowerCase()});sizeIndex=sizeCounter;}else{sizeIndex=sizeCounter;}var parser=new ZParse(Implementation);parser.parse(document.getElementById("price-template").innerHTML);var thisPrice={};if(v["price"].displayHint.toUpperCase()=="S"){thisPrice.price=v["price"].currentPrice;}else{if(v["price"].currentPrice<v["price"].basePrice){isOnSale=true;if(productData.lowestBaseSkuPrice==0){productData.lowestBaseSkuPrice=v["price"].basePrice;}else{if(v["price"].basePrice<productData.lowestBaseSkuPrice){productData.lowestBaseSkuPrice=v["price"].basePrice;}}if(v["price"].basePrice>productData.highestBaseSkuPrice){productData.highestBaseSkuPrice=v["price"].basePrice;}}if(isOnSale){thisPrice.base=v["price"].basePrice;}thisPrice.price=v["price"].currentPrice;}price=parser.process(thisPrice);if(productData.lowestSkuPrice==0){productData.lowestSkuPrice=v["price"].currentPrice;}else{if(v["price"].currentPrice<productData.lowestSkuPrice){productData.lowestSkuPrice=v["price"].currentPrice;}}if(v["price"].currentPrice>productData.highestSkuPrice){productData.highestSkuPrice=v["price"].currentPrice;}var thumbnailImageURL="";var swatchURL="";var imageType="ENH";var swatchType="T50";var imageView="main";var swatchView="pattern";var productSlices=product["productSlices"]["productColors"]["productColor"];if(!Object.isUndefined(productSlices[0])){for(slice in productSlices){currentSlice=productSlices[slice];var type=typeof currentSlice;if(type=="object"){for(sliceSku in currentSlice.skus["sku"]){if(currentSlice.skus["sku"][sliceSku].id==v.id&&(thumbnailImageURL==""||swatchURL=="")){for(sliceImage in currentSlice["images"]["image"]){currentImage=currentSlice["images"]["image"][sliceImage];if(currentImage.type==swatchType&&currentImage.view==swatchView&&swatchURL==""){swatchURL=currentImage.url;}if(currentImage.type==imageType&&currentImage.view==imageView&&thumbnailImageURL==""){thumbnailImageURL=currentImage.url;}if(thumbnailImageURL!=""&&swatchURL!=""){break;}}}if(currentSlice.skus["sku"][sliceSku].id==v.id&&!colorFound){color=currentSlice.title;colorFound=true;colorId=currentSlice.id;}}if(thumbnailImageURL!=""&&swatchURL!=""){break;}}}}if(thumbnailImageURL!=""){newSku={"color":color,"colorId":colorId,"sku":product.productId+"|"+v.id,"size":v.description,"sizeIndex":sizeIndex,"imageURL":thumbnailImageURL,"swatchURL":swatchURL,"price":price};productData.skuData.push(newSku);productData.index=i;}}});var priceParser=new ZParse(Implementation);priceParser.parse(document.getElementById("price-template").innerHTML);var defaultPrice={};if(product["productPrice"].type.toUpperCase()=="S"){defaultPrice.price=product["productPrice"].current;}else{if(productData.lowestSkuPrice<productData.highestSkuPrice){defaultPrice.priceRange=[];defaultPrice.priceRange.push(productData.lowestSkuPrice);defaultPrice.priceRange.push(productData.highestSkuPrice);if(isOnSale){defaultPrice.baseRange=[];defaultPrice.baseRange.push(productData.lowestBaseSkuPrice);defaultPrice.baseRange.push(productData.highestBaseSkuPrice);}}else{if(isOnSale){defaultPrice.base=product["productPrice"].base;defaultPrice.price=productData.lowestSkuPrice;}else{defaultPrice.price=product["productPrice"].current;}}}productData.defaultPrice=priceParser.process(defaultPrice);var materialsFound=false;product["pads"]["pad"].each(function(v,index){if(v.tag.indexOf("BulletPoint")!=-1){if(v.value.indexOf("###")>-1){if(!materialsFound){productData.materials=v.value.replace("###","");materialsFound=true;}else{productData.care=v.value.replace("###","");}}else{productData.padAttribs.push(v);}}else{if(v.tag=="poloFitToggle"){productData.fitToggle=v.value;}}});allProductData.push(productData);}for(x=0;x<allProductData.length;x++){cross_sell=new POLO.CrossSell().init(allProductData[x]);}}.bind(this)});});};POLO.CrossSell=function(){};POLO.CrossSell.prototype={init:function(crossSellData){this.title=crossSellData.title;this.productId=crossSellData.productId;this.brandId=crossSellData.brandId;this.productURL=crossSellData.productURL;this.isCartable=false;this.skus=crossSellData.skuData;this.sizeSlices=crossSellData.sizeSlices;this.details=crossSellData.padAttribs;this.longDesc=crossSellData.longDesc;this.index=crossSellData.index;this.prodDisplay=crossSellData.prodDisplay;this.skus.sort(this.colorSort);this.wrapper=$("#cross-sells-wrap");this.materials=crossSellData.materials;this.care=crossSellData.care;this.fitToggle=crossSellData.fitToggle;this.mainProductId=$(".style-num").text();this.defaultPrice=crossSellData.defaultPrice;this.doPriceUpdate=false;this.wrapper.append(this.renderCrossSell());$("#cross-sells").show();this.element=this.wrapper.find("#cross-sell-"+this.productId);this.zoomButton=this.element.find(".cross-sell-zoom a");this.detailsLink=this.element.find(".more-details-link");if(this.prodDisplay=="poloColor"){this.colorSelect=this.element.find("select.cross-sell-colors");this.sizeSelect=this.element.find("select.cross-sell-sizes");this.bagButton=this.element.find(".cross-sell-to-bag");this.colorInit();this.sizeInit();this.updateState();}this.events();if(this.prodDisplay=="poloColor"){this.element.find(".custom-dropdown ul li").eq(1).trigger("click");}},events:function(){var _this=this;this.zoomButton.on("click",function(e){e.preventDefault();var zoomColorId=_this.colorSelect.find("option:selected").attr("data-colorId");var zoomAlt=0;openEnhancedZoom(_this.productId,zoomColorId,zoomAlt);crossSellEnlargeImage(_this.productId);});if(this.prodDisplay=="poloColor"){this.colorSelect.on("change",function(e){_this.updateSelects(e.target);});this.sizeSelect.on("change",function(e){_this.updateSelects(e.target);});this.bagButton.on("click",function(){var omnitureParams="&crossSellPid=yes&primaryPid="+_this.mainProductId;if(_this.isCartable){skuId=_this.sizeSelect.val().split("|")[1];_this.bagButton.text("Adding item...").addClass("waiting");new Ajax.Request("/cartHandler/entry.jsp?action0=skuAddToCart&prod0="+_this.productId+"&sku0="+skuId+"&qty0=1&giftOption0=no&layoutId0=&customization0=&wlName0=no&prodCounter=1&format=json"+omnitureParams,{method:"post",onSuccess:function(response){cartResponse=response.responseJSON;if(cartResponse.bag.added[0].status){updateCartItemDisplay(cartResponse.bag.nb,"");var myAjax=new Ajax.Request("/minicart/index.jsp",{method:"get",parameters:"t="+new Date().getTime(),onComplete:updateCart});_this.bagButton.text("Item Added to Bag").delay(5000).queue(function(){_this.bagButton.text(_this.bagButton.attr("title")).removeClass("waiting");});}else{_this.bagButton.text("Could Not Add Item").delay(5000).queue(function(){_this.bagButton.text(_this.bagButton.attr("title")).removeClass("waiting");});}}.bind(this)});}});this.bagButton.hover(function(){if(!$(this).hasClass("waiting")){var hoverTxt=$(this).attr("data-hover");if(hoverTxt){$(this).text(hoverTxt);}}},function(){if(!$(this).hasClass("waiting")){$(this).text($(this).attr("title"));}});}this.detailsLink.on("click",function(e){e.preventDefault();content=$(this).attr("data-content");crossSellMoreDetails(_this.productId);jQuery.blockUI({baseZ:2500,message:$(content),css:{padding:0,margin:0,top:"20%",left:"30%",width:"700px",paddingBottom:"40px",border:"none",backgroundColor:"#fff",cursor:"default",textalign:"left"}});jQuery(".blockOverlay").click(function(){jQuery.unblockUI();});jQuery(".details-popup-close").click(function(){jQuery.unblockUI();});$(".blockUI.blockMsg").centerX();});},updateSelects:function(trigger){var dropDownTracker={};if($(trigger).attr("id")==this.colorSelect.attr("id")){this.skus.sort(this.sizeSort(this.sizeSlices));triggered=this.colorSelect;rebuild=this.sizeSelect;rebuildType="size";triggeredType="color";}else{this.skus.sort(this.colorSort);triggered=this.sizeSelect;rebuild=this.colorSelect;rebuildType="color";triggeredType="size";}rebuildCurrent=rebuild.find("option:selected").text();triggeredCurrent=triggered.find("option:selected").text();rebuildValueKey="sku";if(triggeredCurrent=="Select"||triggeredCurrent=="Select"){this.colorInit();this.sizeInit();}else{this.element.find("div."+rebuild.attr("class")).remove();rebuild.find("option[value!='']").remove();var count=0;var currentIndex=0;this.skus.each(function(sku){if(sku[triggeredType]==triggeredCurrent){rebuild.append($("<option></option>").attr("value",sku[rebuildValueKey]).attr("data-text",sku[rebuildType]).attr("data-swatch",sku.swatchURL).attr("data-colorId",sku.colorId).text(sku[rebuildType]));count+=1;if(sku[rebuildType]==rebuildCurrent){currentIndex=count;}}});rebuild.find("option").eq(currentIndex).attr("selected",true);POLO.CustomizeDropdown(rebuild,100-this.index);this.resizeColors();}if(this.doPriceUpdate){this.updatePrice();}this.updateImage();this.updateState();this.doPriceUpdate=true;},updateImage:function(){var obj=this;var color=this.colorSelect.find("option:selected").text();var imageURL=this.element.find("img.cross-sell-image").attr("src");var imageChanged=false;this.skus.each(function(sku){if(sku.color==color&&sku.imageURL){imageURL=sku.imageURL;imageChanged=true;}});if(imageChanged){this.element.find("img.cross-sell-image").attr("src",imageURL);}},updatePrice:function(){_this=this;var color=this.colorSelect.find("option:selected").text();var size=this.sizeSelect.find("option:selected").text();var price="";this.isCartable=false;this.skus.each(function(sku){if(sku.color==color&&sku.size==size){price=sku.price;_this.isCartable=true;}});if(price==""){price=this.skus[0].price;}this.element.find("p.price").html(price);},updateState:function(){this.bagButton.attr("class","cross-sell-to-bag disabled");if(this.isCartable){this.bagButton.attr("data-hover","");this.bagButton.removeClass("disabled");this.bagButton.attr("data-hover",this.bagButton.attr("title"));}else{if(this.colorSelect.find("option:selected").text()=="Select"&&this.sizeSelect.find("option:selected").text()=="Select"){this.bagButton.attr("data-hover","Please Select a Color & Size");}else{if(this.colorSelect.find("option:selected").text()=="Select"){this.bagButton.attr("data-hover","Please Select a Color");}else{if(this.sizeSelect.find("option:selected").text()=="Select"){this.bagButton.attr("data-hover","Please Select a Size");}}}}},colorInit:function(){var currentValue=this.colorSelect.find("option:selected").text();this.skus.sort(this.colorSort);this.colorSelect.find("option[value!='']").remove();var currentOption="";var count=0;var currentIndex=0;var colorSelect=this.colorSelect;this.element.find("div.cross-sell-colors").remove();this.skus.each(function(sku){if(sku.color!=currentOption){colorSelect.append($("<option></option>").attr("data-text",sku.color).attr("value",sku.sku).attr("data-swatch",sku.swatchURL).attr("data-colorId",sku.colorId).text(sku.color));currentOption=sku.color;count+=1;if(currentValue==currentOption){currentIndex=count;}}});colorSelect.find("option").eq(currentIndex).attr("selected",true);POLO.CustomizeDropdown(colorSelect,100-this.index);this.resizeColors();},sizeInit:function(){var currentValue=this.sizeSelect.find("option:selected").text();this.skus.sort(this.sizeSort(this.sizeSlices));this.sizeSelect.find("option[value!='']").remove();var currentOption="";var count=0;var currentIndex=0;var sizeSelect=this.sizeSelect;this.element.find("div.cross-sell-sizes").remove();this.skus.each(function(sku){if(sku.size!=currentOption){sizeSelect.append($("<option></option>").attr("value",sku.sku).attr("data-text",sku.size).text(sku.size));currentOption=sku.size;count+=1;if(currentValue==currentOption){currentIndex=count;}}});sizeSelect.find("option").eq(currentIndex).attr("selected",true);POLO.CustomizeDropdown(sizeSelect,100-this.index);},resizeColors:function(){var colorDropdown=this.element.find("div.cross-sell-colors ul");var colorsWidth=0;colorDropdown.find("li").each(function(i){if(i!=0){colorsWidth+=$(this).outerWidth(true);}});if(colorsWidth>415){colorsWidth=415;}colorDropdown.css("width",(colorsWidth+10)+"px");},colorSort:function(a,b){return(a.color<b.color)?-1:1;},sizeSort:function(slices){return function(a,b){if(slices.length){return(slices.indexOf(a.size.toLowerCase())<slices.indexOf(b.size.toLowerCase()))?-1:1;}else{return(a.size<b.size)?-1:1;}};},renderCrossSell:function(){var parser=new ZParse(Implementation);parser.parse(document.getElementById("cross-sell-template").innerHTML);return parser.process(this);}};})($j);function setZoomIcon(colorId){setZoomIconByURL(Scene7Map["c"+colorId]);}function setZoomIconByURL(izURL){var zoomicon=document.getElementById("zoomIcon");if(izURL!=null){zoomicon.style.visibility="visible";zoomicon.style.display="block";}else{zoomicon.style.visibility="hidden";zoomicon.style.display="none";}}function swapImageOnLoad(REGPath,ENHPath,colorId){sort_filtersApplied=true;var selcolor=selColorFilter;var selsize=selSizeFilter;if(selcolor!=""||selsize!=""){swapImagesOnClick(REGPath,ENHPath,colorId);}var sizeField=document.orderForm.prod_0;if(sizeField&&selsize!=""){for(var i=0;i<sizeField.length;i++){if((sizeField.options[i].text).toLowerCase()==selsize.toLowerCase()){sizeField.options[i].selected=true;syncCmfilterSelection(sizeField);break;}}}}function swapImagesOnClickAlt(ALTZOOMPath,REGPath,ENHPath,colorId,THUMBPath){persistantSwapimagesREGPath=REGPath;persistantSwapimagesENHPath=ENHPath;persistantSwapimagescolorId=colorId;persistantSwapimagesTHUMBPath=THUMBPath;swapImages(REGPath,ENHPath,colorId,THUMBPath,false);var zoomframe=document.getElementById("zoomFrame");var zoomdiv=document.getElementById("zoomDiv");jQuery("#zoomDiv, #flyout").hide();currentItemZoomURL=Scene7Map["c"+colorId];altItemZoomImage=Scene7Map["s7"+orderedImageMap_0[0].cId];currentItemZoomImage=ALTZOOMPath;setZoomIcon(colorId);if(isScene7Enabled&&currentItemZoomImage!=undefined&&currentItemZoomImage!=""){if(isTablet){initS7PinchZoom(currentItemZoomImage);}else{initS7Flyout(currentItemZoomImage);}}else{jQuery("#imageDiv, #prod-img").show();}}function swapImagesOnClick(REGPath,ENHPath,colorId,THUMBPath){persistantSwapimagesREGPath=REGPath;persistantSwapimagesENHPath=ENHPath;persistantSwapimagescolorId=colorId;persistantSwapimagesTHUMBPath=THUMBPath;swapImages(REGPath,ENHPath,colorId,THUMBPath,true);var zoomframe=document.getElementById("zoomFrame");var zoomdiv=document.getElementById("zoomDiv");jQuery("#zoomDiv, #flyout").hide();currentItemZoomURL=Scene7Map["c"+colorId];currentItemZoomImage=Scene7Map["s7"+colorId];setZoomIcon(colorId);AltImages.init(colorId);setZoomColor(colorId);if(isScene7Enabled&&currentItemZoomImage!=undefined&&currentItemZoomImage!=""){if(isTablet){initS7PinchZoom(currentItemZoomImage);}else{initS7Flyout(currentItemZoomImage);}}else{jQuery("#imageDiv, #prod-img").show();}}function swapImages(REGPath,ENHPath,colorId,THUMBPath){thisProdShot=window.document.prodShot_0;var timestamp=new Date().getTime();if(REGPath!=""){thisProdShot.src=REGPath;}thisEnh=document.orderForm.enh_0;if(thisEnh&&ENHPath!=""){thisEnh.value=ENHPath;}thisThumb=document.orderForm.thumb_0;if(thisThumb&&THUMBPath!=""){thisThumb.value=THUMBPath;}}function syncFields(thisField){var dropName=thisField.name.split("_");if(dropName!=null&&dropName.length>1&&dropName[1]!=null){imageCounterField=eval("document.orderForm.imageIndex_"+dropName[1]);}}function showEnhanced(prodIndex){omniImpl("Enlargeimage");remote=open("/contentPopup/index.jsp?productId="+productId,"largeImage","width=805,height=617,left=0,top=0");}function showEmbeddedZoom(){if(currentItemZoomURL!=null){var zoomframe=document.getElementById("zoomFrame");var imagediv=document.getElementById("imageDiv");var zoomdiv=document.getElementById("zoomDiv");imagediv.style.display="none";imagediv.style.visibility="hidden";zoomdiv.style.display="block";zoomdiv.style.visibility="visible";zoomframe.src=currentItemZoomURL;}else{showEnhanced("0");}}function setGiftMessage(formObject){var tempMsgStr="";if(formObject.messageA&&formObject.messageA.value!=""){tempMsgStr=formObject.messageA.value+"\n";}if(formObject.messageB&&formObject.messageB.value!=""){tempMsgStr+=formObject.messageB.value+"\n";}if(formObject.messageC&&formObject.messageC.value!=""){tempMsgStr+=formObject.messageC.value+"\n";}if(formObject.messageD&&formObject.messageD.value!=""){tempMsgStr+=formObject.messageD.value;}formObject.message.value=tempMsgStr;}function toggleVisibility(id,NNtype,IEtype,WC3type,height){if(document.getElementById){eval('document.getElementById(id).style.visibility = "'+WC3type+'"');document.getElementById(id).style.height=height;}else{if(document.layers){document.layers[id].visibility=NNtype;document.layers[id].height=height;}else{if(document.all){eval("document.all."+id+'.style.visibility = "'+IEtype+'"');eval("document.all."+id+".style.height = "+height);}}}}function initS7Flyout(currentItemZoomImage){var flyout=flyout||new s7js.flyout.AdvancedFlyout();if(currentItemZoomImage!=undefined&&currentItemZoomImage!=""){jQuery("#imageDiv").hide();jQuery("#flyout").empty();jQuery("#flyout").css({width:"470px",height:"588px"});flyout.setTargetId("flyout");flyout.setParameter("serverUrl","http://s7d2.scene7.com/is/image/");flyout.setParameter("useFixedCursor","false");flyout.setParameter("asset","PoloGSI/"+currentItemZoomImage+"?cropN=0.12,0,0.7993,1");flyout.setParameter("modifier","$flyout_main$");flyout.setParameter("swatchModifier","$flyout_thumb$");jQuery("#zoomDiv, #flyout").show();jQuery(document).ready(function(){flyout.init();});}}function initS7PinchZoom(currentItemZoomImage){var zoomPrefix="http://s7d2.scene7.com/is/image/PoloGSI/",zoomParams="?wid=2000&hei=2000",zoomRatio=null,zoomRatioOut=null,zoomImg;if(currentItemZoomImage!=undefined&&currentItemZoomImage!=""){jQuery("#prod-img").hide();jQuery(".smooth_zoom_preloader, #prod-img-zoom").remove();zoomImg=jQuery("<img/>",{id:"prod-img-zoom"}).appendTo(jQuery("#imageDiv"));zoomImg.attr("src",zoomPrefix+currentItemZoomImage+zoomParams).css({width:"2000px",height:"2000px"});zoomImg.smoothZoom({width:470,height:590,responsive:true,responsive_maintain_ratio:true,max_WIDTH:"",max_HEIGHT:"",zoom_OUT_TO_FIT:false,zoom_BUTTONS_SHOW:false,pan_BUTTONS_SHOW:false,on_ZOOM_PAN_COMPLETE:setZoomRatio,zoom_MAX:100});function setZoomRatio(){zoomRatio=zoomImg.smoothZoom("getZoomData").ratio;if(zoomRatioOut==null){zoomRatioOut=zoomRatio;}}zoomImg.touchwipe({min_move_x:150,preventDefaultEvents:true,wipeLeft:function(){if(zoomRatio==zoomRatioOut){var nextIndex=getAltIndex("next");POLO.Product.altSelectType="Swipe";jQuery(".altImages li:eq("+nextIndex+")").click();}},wipeRight:function(){if(zoomRatio==zoomRatioOut){var prevIndex=getAltIndex("prev");POLO.Product.altSelectType="Swipe";jQuery(".altImages li:eq("+prevIndex+")").click();}}});}}function getAltIndex(direction){var altImages=jQuery(".altImages li"),altIndex=jQuery(".altImages li.active").index(),prevIndex=altIndex-1,nextIndex=altIndex+1;if(prevIndex<0){prevIndex=$(altImages).length-1;}if(nextIndex==$(altImages).length){nextIndex=0;}if(direction=="prev"){return prevIndex;}else{if(direction=="next"){return nextIndex;}}}Array.prototype.naturalSort=function(){var a,b,a1,b1,rx=/(\d+)|(\D+)/g,rd=/\d+/;return this.sort(function(as,bs){a=String(as).toLowerCase().match(rx);b=String(bs).toLowerCase().match(rx);while(a.length&&b.length){a1=a.shift();b1=b.shift();if(rd.test(a1)||rd.test(b1)){if(!rd.test(a1)){return 1;}if(!rd.test(b1)){return -1;}if(a1!=b1){return a1-b1;}}else{if(a1!=b1){return a1>b1?1:-1;}}}return a.length-b.length;});};