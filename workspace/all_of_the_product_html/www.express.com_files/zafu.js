/*

 Copyright 2013-2014 Zafu, Inc.

 @author
 brenton@zafu.com

*/
!function(z,a,f,u){z[a]=z[a]||function(){(z[a].q=z[a].q||[]).push(arguments)};z[a].l=z[a].l||1*new Date;z[a].Log=z[a].Log||function(z){var a=0,r=function(b,r,t,e,d){if(z&&!(a>b)){var f=((new Date).getTime()-Zafu.l)/1E3;b=Math.floor(f);f=(f-b).toPrecision(4);f=String("   "+b).slice(-Math.max(3,String(b).length))+String(f).slice(1,5);e="[Zafu:"+t+":"+f+"] "+e;if("function"==typeof z[r])z[r](e);else"function"!=typeof z.log&&"object"!=typeof z.log||z.log(e);d&&z.trace&&z.trace()}};return{debug:function(z){r(1,
"debug","DEBUG",z)},fn:function(z){r(0,"debug","FN   ",z)},info:function(z){r(2,"info","INFO ",z)},warn:function(z){r(3,"warn","WARN ",z,!0)},error:function(z){r(4,"warn","ERROR",z,!0)},production:function(){a=3}}}(z.console);z[a].Site=z[a].Site||function(){return{getParam:function(z){z=RegExp("[?&]"+escape(z)+"=([^&#?]*)","");z=location.href.match(z);return!z||2>z.length?null:z[1]},setCookie:function(a,c){var r=new Date,b=/[^.]+[.]([a-z]{2}[.][a-z]{2}|[a-z]{2,})$/i.exec(document.domain),b=b&&b[0]?
b[0]:b=document.domain;r.setDate(r.getDate()+365);document.cookie=a+"="+escape(c)+";expires="+r.toUTCString()+";path=/;domain="+b;"zafu-id"==a&&"undefined"!==typeof z[f]&&"undefined"!==typeof z[f].callbackProfileId&&eval(z[f].callbackProfileId+"(value);")},getCookie:function(z){var a,r,b=document.cookie.split(";");for(a=0;a<b.length;a++)if(r=b[a].substr(0,b[a].indexOf("=")),r=r.replace(/^\s+|\s+$/g,""),r==z)return z=b[a].substr(b[a].indexOf("=")+1),unescape(z)}}}();z[a].load=z[a].load||function(z,
a){var r,b,f;b=!1;r=document.createElement("script");r.type="text/javascript";r.src=z;r.onload=r.onreadystatechange=function(){b||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(b=!0,"function"==typeof a&&a())};f=document.getElementsByTagName("script")[0];(f.parentElement?f.parentElement:f.parent).insertBefore(r,f)};z[a].loaded=z[a].loaded||function(f,c,r){z[a].loaded.modules=z[a].loaded.modules||{};z[a].loaded.ready=z[a].loaded.ready||{};if("undefined"==typeof c)z[a].loaded.ready[f]=
!0;else{if("undefined"!=typeof z[a].loaded.modules[f]){if("undefined"==typeof r||!r)throw"Not loading previously loaded: "+c;return!0}z[a].loaded.modules[f]=!0;z[a].Log.debug(c);return!1}};0<z[a].Site.getParam("debug")||0<z[a].Site.getCookie("debug")||z[a].Log.production();z[a].loaded("zafu-common","Loading: Zafu Common",!0)||(z[f]=z[f]||{},z[a].Loader=z[a].Loader||function(){return{ready:function(){var f=!0;"undefined"==typeof z[a].$&&(f=!1);"undefined"==typeof z[a].Log&&(f=!1);if(!f)return!1;for(var c=
0,r=arguments.length;c<r;c++){var b=arguments[c];try{b="if(typeof "+b+" != 'object' && typeof "+b+" != 'function') { success = false; throw 'resource not ready'; };","function"==typeof window.eval?window.eval(b):"undefined"!=typeof window.execScript&&window.execScript(b)}catch(p){return!1}}return f}}}(),z[a].Common=function(){var s={},c=function(){return parseInt(z[f].partnerId,10)},r=function(r){z[f].profileId||(z[f].profileId=z[a].Site.getCookie("p"+c())||z[a].Site.getCookie("zafu-id"),z[a].Log.debug("profileId="+
z[f].profileId));r&&b(r);return z[f].profileId},b=function(f){if(!s[f]){s[f]=!0;z[a].Log.fn("refreshProfileId("+f+")");var b="//api.zafu.com/s/remote?action=refresh-cookies",d=r(f);d&&(b=b+"&profile_id="+escape(d));f&&(b=b+"&use="+escape(f));b=b+"&partner_id="+c();z[a].$.getJSON(b+"&callback=?",function(z){if(!z||!z.responseData)return!1})}},p=function(b,e){if(b){p=!0;s[b]=!0;z[a].Log.fn("touchProfileId("+b+")");var d=r(b);if(d)return"function"==typeof e&&e(),d;d="//api.zafu.com/s/remote?action=touch-profile&use="+
escape(b);d=d+"&partner_id="+c();"undefined"!=typeof z[f].store&&(d=d+"&store="+escape(z[f].store));"undefined"!=typeof z[f].productType&&(d=d+"&product_type="+escape(z[f].productType));z[a].$.getJSON(d+"&callback=?",function(z){if(!z||!z.responseData||!z.responseData.content)return!1;eval(z.responseData.content);"function"==typeof e&&e()})}};return{getParam:z[a].Site.getParam,getPartnerId:c,getProfileId:r,refreshProfileId:b,touchProfileId:p,getDomainCookie:z[a].Site.getCookie,setDomainCookie:z[a].Site.setCookie}}(),
z[a].loaded("zafu-common"))}(window,"Zafu","ZafuSettings");
