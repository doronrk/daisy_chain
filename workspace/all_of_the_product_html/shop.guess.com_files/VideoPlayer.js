/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
s7sdk.pkg("s7sdk.video");s7sdk.Util.require("s7sdk.common.ItemDesc");s7sdk.Util.require("s7sdk.common.IS");s7sdk.Util.require("s7sdk.common.IconEffect");s7sdk.Util.require("s7sdk.common.Enumeration");s7sdk.Util.require("s7sdk.common.WebVtt");s7sdk.Util.require("s7sdk.event.Event");if(!s7sdk.video.VideoPlayerControl){s7sdk.video.VideoPlayerControl=function(a){arguments.callee.superclass.apply(this,[a,s7sdk.video.VideoPlayerControl.NS,a.constructor,s7sdk.video.VideoPlayer.RESTRICTED_STYLES]);delete this.dynamicModifiers.posterimage};s7sdk.video.VideoPlayerControl.NS="s7sdk.video.VideoPlayerControl";s7sdk.video.VideoPlayerControl.prototype.setModifier=function(g){var a;for(var e in g){var b=e.toLowerCase();if(b=="navigation"){value=g[e];if(value){var d,c=true;prevVal=this.component.navigation.file+","+(this.component.enableNavigation?"1":"0");var f=value.split(",");if(f&&f.length>0){d=f[0];if(f.length>1){c=parseInt(f[1])!=0}if(d&&d.length>0){this.component.setNavigation(d,c);this.dispatchEvent(new s7sdk.event.ControlComponentEvent(s7sdk.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{id:this.component.getId(),oldvalue:prevVal,newvalue:d+","+(c?"1":"0"),property:b},false))}}}}else{if(!a){a={}}a[e]=g[e]}}if(a){this.superclass.prototype.setModifier.apply(this,[a])}};s7sdk.video.VideoPlayerControl.prototype.rebuild=function(g){if(this.component){var d=this.component.getVolume();var f=this.component.muted();var c=this.component.assetSpecificPosterImage;var b=g.posterimage;g.posterimage=b?b:this.component.posterimage;var e=g.asset;var a;if(e){a=e;delete g.asset}else{a=this.component.getCurrentAsset()}this.listenerProxy=s7sdk.Util.copyListeners(this.component);this.unload();this.component=new this.componentconstructor(this.parentId,g,this.compId,true);s7sdk.Util.assignListeners(this.listenerProxy,this.component);delete g.posterimage;if(this.component.assetSpecificPosterImage){c=this.component.assetSpecificPosterImage}this.component.setCurrentAsset(a,c);this.component.setVolume(d);if(f){this.component.mute()}else{this.component.unmute()}}}}s7sdk.Class.inherits(s7sdk.video.VideoPlayerControl.NS,"s7sdk.ControlComponent");if(!s7sdk.video.VideoPlayer){s7sdk.video.VideoPlayer=function VideoPlayer(a,f,d){var g=!!arguments[3];arguments.callee.superclass.apply(this,[d,a,"div","s7videoplayer",f,!g]);this.createElement();this.container=s7sdk.Util.byId(a);if(this.videoServerUrl.lastIndexOf("/")!=(this.videoServerUrl.length-1)){this.videoServerUrl+="/"}this.compId=(s7sdk.Util.isNull(d)?"":d);this.videoItem=null;this.serverDuration=undefined;this.curMilestone=undefined;this.seekTime=undefined;this.methodCallQueue=[];this.setRequestLoaded=true;this.assetSpecificPosterImage=undefined;this.endNotificationSent=false;this.videoCapabilityState=new s7sdk.VideoCapabilityState();this.wid=this.size.width;this.hei=this.size.height;if(this.wid==0||this.hei==0){this.wid=parseInt(s7sdk.Util.css.getCss("s7videoplayer","width",this.compId,null,this.container));this.hei=parseInt(s7sdk.Util.css.getCss("s7videoplayer","height",this.compId,null,this.container));if(!s7sdk.Util.isNumber(this.wid)||!s7sdk.Util.isNumber(this.hei)||this.wid<=0||this.hei<=0){if("clientHeight" in this.container&&"clientWidth" in this.container){this.wid=this.container.clientWidth;this.hei=this.container.clientHeight}if(this.wid==0||this.hei==0){this.wid=400;this.hei=300}}}this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(("ipad"==s7sdk.browser.device.name)||("iphone"==s7sdk.browser.device.name)||("android"==s7sdk.browser.device.name)){this.autoplay=false}this.clickToPlay=0;if((/play/i).test(this.singleclick)){this.clickToPlay=1}if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}var c=this.getParent();if(this.obj.parentNode!=c){c.appendChild(this.obj)}var b=this;this.videoProxy=this.resolveVideoProxy();if(this.clickToPlay&&!this.hasNativeControls()){this.divClickElement=document.createElement("div");this.obj.appendChild(this.divClickElement);this.divClickElement.style.width=this.wid+"px";this.divClickElement.style.height=this.hei+"px";this.divClickElement.style.position="absolute";this.divClickElement.style.top="0px";this.divClickElement.style.left="0px";if(s7sdk.browser.name=="ie"){if(s7sdk.browser.version.minor<9){this.divClickElement.style.backgroundColor="#000";this.divClickElement.style.filter="alpha(opacity=0)"}else{this.divClickElement.style.opacity=0;this.divClickElement.style.filter=""}if(s7sdk.browser.version.minor==9||s7sdk.browser.version.minor==10){this.divClickElement.style.backgroundColor="#000000"}}if("ontouchstart" in window){s7sdk.Event.addDOMListener(this.divClickElement,"touchend",function(h){b.ovlInTouch=true},false);s7sdk.Event.addDOMListener(this.obj,"click",function(h){if(b.ovlInTouch){b.togglePause()}b.ovlInTouch=false},false)}else{s7sdk.Event.addDOMListener(this.obj,"click",function(h){b.togglePause()},false)}}if(!this.hasNativeControls()){s7sdk.Event.addDOMListener(this.obj,"click",function(h){s7sdk.Event.dispatch(b.obj,s7sdk.Event.CLICK,false)},false)}this.createIconEffect();var e=unescape(this.asset);if(e!=""){this.setAsset(e,this.posterimage)}if(this.posterimage&&this.posterimage!=""){if(this.posterimage.indexOf("?")!=0&&this.posterimage!="none"){this.assetSpecificPosterImage=this.posterimage;this.posterimage=""}else{this.assetSpecificPosterImage=undefined}}this.addEventListener(s7sdk.event.CapabilityStateEvent.NOTF_VIDEO_CAPABILITY_STATE,function(h){b.onCapabilityState(h)},false);this.setCaption(this.caption.file);this.setCaptionEnabled(this.caption.enabled);this.setNavigation(this.navigation.file,this.navigation.enabled);if(!g){return new s7sdk.video.VideoPlayerControl(this)}else{return this}};s7sdk.Class.inherits("s7sdk.video.VideoPlayer","s7sdk.UIComponent");s7sdk.video.VideoPlayer.prototype.symbols={ERROR:"Your Browser does not support HTML5 Video tag or the video cannot be played."};s7sdk.video.VideoPlayer.prototype.setModifier=function(a){throw new Error("Trying to use setModifier on the Core class (VideoPlayer) is unsupported! Please refer to SDK documentation on using setModifier.")};s7sdk.video.VideoPlayer.prototype.modifiers={serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},videoServerUrl:{params:["value"],defaults:["/is/content/"]},contentUrl:{params:["value"],defaults:["/is/content/"]},size:{params:["width","height"],defaults:[0,0],ranges:["0:","0:"]},asset:{params:["value"],defaults:[""]},autoplay:{params:["enabled"],defaults:[true]},singleclick:{params:["singleclick"],defaults:["playPause"],ranges:[["none","playPause"]]},posterimage:{params:["posterimage"],defaults:[""]},iconEffect:{params:["enabled","count","fade","autoHide"],defaults:[true,1,0.3,3],ranges:[null,"-1:","0:","0:"]},playback:{params:["type","controls"],defaults:["auto",false],ranges:[["auto","native"]]},progressivebitrate:{params:["value"],defaults:[700]},caption:{params:["file","enabled"],defaults:["",false]},navigation:{params:["file","enabled"],defaults:["",true]},smoothing:{params:["enabled"],defaults:[false]},initialbitrate:{params:["value"],defaults:[0]},loop:{params:["enabled"],defaults:[false]}};s7sdk.video.VideoPlayer.RESTRICTED_STYLES={width:"width",height:"height"};s7sdk.video.VideoPlayer.prototype.addEventListener=function(c,b,a){this.superproto.addEventListener.apply(this,[c,b,a])};s7sdk.video.VideoPlayer.prototype.getCurrentAsset=function(){return this.currentAsset};s7sdk.video.VideoPlayer.prototype.setCurrentAsset=function(b,a){this.assetSpecificPosterImage=a;if(typeof(b)=="string"){this.setAsset(b,a)}else{if(this.isReq){this.isReq.cancelHttpReq()}this.currentAsset=b;this.createViewer(b)}};s7sdk.video.VideoPlayer.prototype.onCapabilityState=function(a){var b=a.s7event.state;if(b.hasCapability(s7sdk.VideoCapabilityState.PAUSE)){if(this.iconEffectObj){this.iconEffectObj.hide()}}if(b.hasCapability(s7sdk.VideoCapabilityState.PLAY)){if(this.iconEffectObj){this.iconEffectObj.show(this.wid,this.hei);s7sdk.Util.css.setCSSAttributeSelector(this.iconEffectObj.obj,"state","play")}}if(b.hasCapability(s7sdk.VideoCapabilityState.REPLAY)){if(this.iconEffectObj){this.iconEffectObj.show(this.wid,this.hei);s7sdk.Util.css.setCSSAttributeSelector(this.iconEffectObj.obj,"state","replay")}}};s7sdk.video.VideoPlayer.prototype.getWidth=function(){return this.wid};s7sdk.video.VideoPlayer.prototype.getHeight=function(){return this.hei};s7sdk.video.VideoPlayer.prototype.resize=function(a,b){if(a==this.wid&&b==this.hei){return}this.wid=a>0?a:1;this.hei=b>0?b:1;this.videoProxy.resize(this.wid,this.hei);this.obj.style.width=this.wid+"px";this.obj.style.height=this.hei+"px";if(this.divClickElement){this.divClickElement.style.width=this.wid+"px";this.divClickElement.style.height=this.hei+"px"}if(this.iconEffectObj&&this.iconEffectObj.enabled){this.iconEffectObj.centerOverlay(a,b)}if(this.captionContainerDiv){this.obj.removeChild(this.captionContainerDiv);this.captionContainerDiv=undefined}s7sdk.UIComponent.prototype.resize.apply(this,[a,b]);s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.resize( %0 %1 )",a,b)};s7sdk.video.VideoPlayer.prototype.supportsInline=function(){s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.supportsInline() = %0",!((s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version<4)||s7sdk.browser.device.name=="iphone"));return !((s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version<4)||s7sdk.browser.device.name=="iphone")};s7sdk.video.VideoPlayer.prototype.getAsset=function(){var a=(this.videoItem==null?null:this.videoItem.name);s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.getAsset() = %0",a);return a};s7sdk.video.VideoPlayer.prototype.setAsset=function(b,a){this.setRequestLoaded=false;this.methodCallQueue.splice(0,this.methodCallQueue.length);this.invalidateNavigation();this.assetSpecificPosterImage=a;this.currentAsset=b;this.loadAsset(b);s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.setAsset( %0 )",b+(a?", "+a:""))};s7sdk.video.VideoPlayer.prototype.setCaption=function(a){this.caption.file=a;this.captionCues=[];if(s7sdk.Util.isNonEmptyString(this.caption.file)){this.loadWebVTT()}};s7sdk.video.VideoPlayer.prototype.setNavigation=function(a){var b=true;if(arguments.length>1){b=arguments[1]}this.navigation.file=a;this.enableNavigation=b;this.navigationCues=null;if(s7sdk.Util.isNonEmptyString(this.navigation.file)){this.loadNavigationWebVTT()}};s7sdk.video.VideoPlayer.prototype.loadAsset=function(a){s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.loadAsset");var b=this.serverUrl+"/"+s7sdk.MediaSetParser.parseAssetForSetReq(a).req;if(s7sdk.Util.isNonEmptyString(this.locale)){b+="&locale="+this.locale}if(this.isReq){this.isReq.cancelHttpReq()}this.isReq_=new s7sdk.IS(this.serverUrl,a);this.isReq_.getHttpReq(b,function(d,c){s7sdk.video.VideoPlayer.prototype.setRequestComplete.apply(c,[d])},function(d,c){s7sdk.video.VideoPlayer.prototype.setRequestError.apply(c,[d,a])},this)};s7sdk.video.VideoPlayer.prototype.invalidateNavigation=function(){if(this.videoItem){s7sdk.Logger.log(s7sdk.Logger.INFO,"Invalidate navigation content");var a=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_NAVIGATION,null,true);this.dispatchEvent(a,false)}this.navigationCues=null};s7sdk.video.VideoPlayer.prototype.loadNavigationWebVTT=function(){var a;if(/^\s*http[s]?:\/\//.test(this.navigation.file)){a=this.navigation.file}else{var c=this.settings.get("contentURL","/is/content");a=c+"/"+this.navigation.file}a+="?req=CONTENT,json,utf-8";if(this.navigationReq){this.navigationReq.cancelHttpReq()}var b=this;this.navigationReq=new s7sdk.IS();this.navigationReq.getHttpReq(a,function(f,d){b.navigationCues=s7sdk.common.WebVtt.parse(f,s7sdk.common.WebVtt.TYPE_NAVIGATION);var g=(b.enableNavigation)?b.navigationCues:null;var e=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_NAVIGATION,g,true);b.dispatchEvent(e,false)},function(d){s7sdk.Logger.log(s7sdk.Logger.WARNING,"Error loading navigation file: %0",b.navigation.file)},this)};s7sdk.video.VideoPlayer.prototype.loadWebVTT=function(){var a;if(/^\s*http[s]?:\/\//.test(this.caption.file)){a=this.caption.file}else{var b=this.settings.get("contentURL","/is/content");a=b+"/"+this.caption.file}a+="?req=CONTENT,json,utf-8";if(this.captionReq){this.captionReq.cancelHttpReq()}this.captionReq=new s7sdk.IS();this.captionReq.getHttpReq(a,function(e,c){var d=s7sdk.common.WebVtt.parse(e,s7sdk.common.WebVtt.TYPE_CAPTION).getItems();for(i in d){var f=d[i];c.captionCues.push({start:f.start,end:f.end,caption:f.data,settings:f.settings})}c.checkCaptions(c.getCurrentTime())},function(c){s7sdk.Logger.log(s7sdk.Logger.ERROR,"Error loading caption file: %0",this.caption.file)},this)};s7sdk.video.VideoPlayer.prototype.setRequestComplete=function(b){var f=this.videoItem;var a=b.set;if(a==null){return}var d=s7sdk.MediaSetParser.parse(a,"");switch(d.type){case s7sdk.ItemDescType.VIDEO_SET:this.createViewer(d);break;case s7sdk.ItemDescType.VIDEO:this.createViewer(d.items[0]);break;default:throw new Error("parsed media set is of wrong type: "+d.type)}this.setRequestLoaded=true;while(this.methodCallQueue.length>0){var c=this.methodCallQueue[0];this.methodCallQueue.splice(0,1);this[c.func].apply(this,c.args)}if(f!=null){var e=new s7sdk.UserEvent(s7sdk.UserEvent.SWAP,[0,this.videoItem],true);this.dispatchEvent(e,false)}};s7sdk.video.VideoPlayer.prototype.createViewer=function(a){this.endNotificationSent=false;this.setAssetInternal(a);this.settings.trackLoad(this);this.checkCaptions(this.getCurrentTime());var c=new s7sdk.UserEvent(this.autoplay?s7sdk.UserEvent.PLAY:s7sdk.UserEvent.PAUSE,this.videoProxy.getCurrentTime(),true);this.dispatchEvent(c,false);var b=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.ASSET_CHANGED,a,this.getIndexFromItem(a),true);this.dispatchEvent(b)};s7sdk.video.VideoPlayer.prototype.getIndexFromItem=function(d){if(d.parent!=null){var c=-1;var b=d.parent.items;for(var a=0;a<b.length;a++){if(b[a].name==d.name){c=a;break}}return c}else{return 0}};s7sdk.video.VideoPlayer.prototype.createIconEffect=function(){if(this.clickToPlay&&!this.hasNativeControls()){this.iconEffectObj=new s7sdk.IconEffect(this,this.iconEffect.enabled,this.iconEffect.count,this.iconEffect.fade,this.iconEffect.autoHide);if(this.autoplay){this.iconEffectObj.hide()}}};s7sdk.video.VideoPlayer.prototype.hasNativeControls=function(){if(s7sdk.browser.supportflash()&&this.playback.type=="auto"){return false}else{if((s7sdk.browser.device.name=="android"&&s7sdk.browser.device.version<4)||this.playback.controls){return true}else{return false}}};s7sdk.video.VideoPlayer.prototype.setCaptionEnabled=function(a){var b=!this.enableCaptions&&a&&this.videoProxy.paused();this.enableCaptions=a;if(!this.enableCaptions){if(this.currentCaption){this.hideCaption();this.currentCaption=null}}else{if(b&&this.videoProxy){this.checkCaptions(this.videoProxy.getCurrentTime())}}};s7sdk.video.VideoPlayer.prototype.getCaptionEnabled=function(){return this.enableCaptions};s7sdk.video.VideoPlayer.prototype.checkCaptions=function(b){if(this.captionCues.length==0){return}if(!this.enableCaptions){return}var a=this.findCaption(b);if(this.currentCaption&&a&&this.currentCaption.start==a.start){return}this.currentCaption=a;if(a){this.showCaption(a.caption,a.settings)}else{this.hideCaption()}};s7sdk.video.VideoPlayer.prototype.showCaption=function(j,c){if(!this.captionContainerDiv){this.captionContainerDiv=document.createElement("div");this.captionContainerDiv.style.position="absolute";this.captionContainerDiv.style.visibility="hidden";this.captionContainerDiv.style.overflow="hidden";if(this.iconEffectObj.hiddenState_){this.obj.appendChild(this.captionContainerDiv)}else{this.obj.insertBefore(this.captionContainerDiv,this.iconEffectObj.iconEffectDiv_)}this.captionDiv=document.createElement("div");this.captionDiv.className="s7caption";this.captionDiv.style.visibility="hidden";this.captionContainerDiv.appendChild(this.captionDiv);this.captionDiv.style.position="relative";this.captionDiv.style.display="table"}else{this.captionDiv.style.visibility="hidden"}this.captionContainerDiv.style.width=this.wid+"px";this.captionDiv.innerText=j;this.captionDiv.textContent=j;var g=this.captionDiv.offsetHeight;var e=this.captionDiv.offsetWidth;var h,b,a;if(c.vertical=="rl"){h=Math.round((100-parseInt(c.lineSize))/2);this.captionContainerDiv.style.top=h+"%";this.captionContainerDiv.style.height=c.lineSize;this.captionContainerDiv.style.left=c.linePosition}else{if(c.vertical=="lr"){h=Math.round((100-parseInt(c.lineSize))/2);this.captionContainerDiv.style.top=h+"%";this.captionContainerDiv.style.height=c.lineSize;b=(100-parseInt(c.linePosition));this.captionContainerDiv.style.left=b+"%"}else{e=Math.min(Math.round(parseInt(c.lineSize)*this.wid/100),e);this.captionContainerDiv.style.width=e+"px";e=this.captionDiv.offsetWidth;b=Math.round(((parseInt(c.textPosition)/100)*this.wid)-e/2);b=b<0?0:b;if((b+e)>this.wid){b=this.wid-e}this.captionContainerDiv.style.left=b+"px";g=this.captionDiv.offsetHeight;var f=(g/this.hei)*100;if(c.linePosition){if(c.linePosition.indexOf("%")>0){var d=parseInt(c.linePosition);h=d-(f)/2;a=d+f;if(f>100){h=0}else{if(h<0){h=0}else{if(a>100){if(f>100){h=0}else{h=100-f}}}}if((f+h)>100){f=100-h}this.captionContainerDiv.style.top=h+"%"}else{this.captionContainerDiv.style.bottom=(g*(c.linePosition-1))+"px"}this.captionContainerDiv.style.height=f+"%"}else{if(f>85){this.captionContainerDiv.style.top="0"}else{this.captionContainerDiv.style.top=(85-f)+"%"}this.captionContainerDiv.style.bottom="15%"}}}if(c.vertical=="rl"){this.captionDiv.style.writingMode="tb-rl"}else{if(c.vertical=="lr"){this.captionDiv.style.writingMode="tb-rl"}}if(c.textAlign=="left"){this.captionDiv.style.textAlign="left"}else{if(c.textAlign=="right"){this.captionDiv.style.textAlign="right"}else{if(c.textAlign=="middle"){this.captionDiv.style.textAlign="center"}}}this.captionDiv.style.visibility="visible";this.captionContainerDiv.style.visibility="visible"};s7sdk.video.VideoPlayer.prototype.hideCaption=function(){if(this.captionContainerDiv){this.captionDiv.style.visibility="hidden";this.captionContainerDiv.visibility="hidden";this.captionDiv.innerText="";this.captionDiv.textContent=""}};s7sdk.video.VideoPlayer.prototype.findCaption=function(c){for(var a in this.captionCues){if(!this.captionCues.hasOwnProperty(a)){continue}var b=this.captionCues[a];if(!b){continue}if(b.start<=c&&c<=b.end){return b}}return null};s7sdk.video.VideoPlayer.prototype.getNavigation=function(){return this.navigationCues};s7sdk.video.VideoPlayer.prototype.getNavigationEnabled=function(){return this.enableNavigation};s7sdk.video.VideoPlayer.prototype.resolveVideoProxy=function(){var b;if(s7sdk.browser.device.name=="iphone"){b=this.buildIphoneVideoProxy()}else{if((s7sdk.browser.supportflash()&&this.playback.type=="auto")&&(s7sdk.browser.device.name!=="android")&&!((s7sdk.browser.name=="safari")&&(s7sdk.browser.device.name=="desktop")&&(s7sdk.browser.version.minor>6))){b=this.buildFlashVideoProxy()}else{if((s7sdk.browser.name=="ie")&&(s7sdk.browser.version.minor<9)){return b=this.buildNOOPVideoProxy()}else{b=this.buildHTML5VideoProxy()}}}var a=this;b.onCurrentTime=function(){a.checkCaptions(a.videoProxy.getCurrentTime());if(!a.endNotificationSent){a.checkTimingEvents()}a.checkState();if(!a.endNotificationSent){var c=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_CURRENT_TIME,a.videoProxy.getCurrentTime(),true);a.dispatchEvent(c,false);if(a.pendingStopNotification||a.videoProxy.ended()){a.pendingStopNotification=false;var e=new s7sdk.UserEvent(s7sdk.UserEvent.STOP,a.videoProxy.getCurrentTime(),true);a.dispatchEvent(e,false)}if(a.videoProxy.ended()){a.endNotificationSent=true;var d=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_VIDEO_END,a.videoProxy.getCurrentTime(),true);a.dispatchEvent(d,false)}}};b.onDuration=function(){a.checkState();var d=new s7sdk.event.UserEvent(s7sdk.UserEvent.METADATA,["DURATION",a.videoProxy.getDuration()],true);a.dispatchEvent(d,false);var c=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_DURATION,a.videoProxy.getDuration(),true);a.dispatchEvent(c,false)};b.onLoadProgress=function(){a.checkState();var c=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_LOAD_PROGRESS,a.videoProxy.getLoadedPosition(),true);a.dispatchEvent(c,false)};b.onVolume=function(){a.checkState();var c=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_VOLUME,a.videoProxy.getVolume(),true);a.dispatchEvent(c,false)};b.onSeeked=function(){var d=a.videoProxy.getCurrentTime();if(d!=a.videoProxy.getDuration()){if(a.videoProxy.paused()){a.iconEffectObj.show(this.wid,this.hei)}}if(d!=this.seekTime){var e=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_SEEK,a.videoProxy.getCurrentTime(),true);a.dispatchEvent(e,false);var c=new s7sdk.event.UserEvent(s7sdk.UserEvent.METADATA,["SEEK",a.videoProxy.getCurrentTime()],true);a.dispatchEvent(c,false)}this.seekTime=a.videoProxy.getCurrentTime()};b.onStateChange=function(){a.checkState()};return b};s7sdk.video.VideoPlayer.prototype.resolvePosterUrl=function(b){var c=(this.assetSpecificPosterImage!=undefined)?this.assetSpecificPosterImage:this.posterimage;var d="";if(c==""||c.indexOf("?")==0){d=c;c=s7sdk.video.VideoPlayer.parseMovieUrl(b.name)}var a=null;if(c!=null&&c!=""&&c!="none"){var e=(c.indexOf("?")>=0)?"&":"?";if(d!=""){if(d.indexOf("?")==0){e=d}else{e+=d}e+="&"}e+="fit=constrain,1&wid="+this.wid+"&hei="+this.hei;a=c+e}return a};s7sdk.video.VideoPlayer.prototype.buildHTML5VideoProxy=function(){return new s7sdk.video.HTML5VideoProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.loop,this.getLocalizedText("ERROR"))};s7sdk.video.VideoPlayer.prototype.buildFlashVideoProxy=function(){return new s7sdk.video.FlashVideoProxy(this.obj,(this.compId!="")?this.compId+"_"+s7sdk.Util.createUniqueId():"flashVideo_"+s7sdk.Util.createUniqueId(),this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.smoothing,this.initialbitrate,this.loop)};s7sdk.video.VideoPlayer.prototype.buildNOOPVideoProxy=function(){return new s7sdk.video.NOOPVideoProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.autoplay,this.playback,this.progressivebitrate,this.loop,this.getLocalizedText("ERROR"))};s7sdk.video.VideoPlayer.prototype.buildIphoneVideoProxy=function(){return new s7sdk.video.IPhoneProxy(this.obj,this.wid,this.hei,this.serverUrl,this.videoServerUrl,this.playback,this.progressivebitrate,this.loop,this.getLocalizedText("ERROR"))};s7sdk.video.VideoPlayer.prototype.setRequestError=function(a){s7sdk.Logger.log(s7sdk.Logger.ERROR,"setRequestError %0",a)};s7sdk.video.VideoPlayer.prototype.setAssetInternal=function(a){this.videoItem=a;this.serverDuration=s7sdk.video.VideoPlayer.getDurationFromItem(a);this.videoProxy.serverDuration=this.serverDuration;if(!s7sdk.Util.isNull(this.serverDuration)){var b=new s7sdk.event.VideoEvent(s7sdk.event.VideoEvent.NOTF_DURATION,this.serverDuration,true);this.dispatchEvent(b,false)}this.videoProxy.setAsset(a,this.resolvePosterUrl(a));if(this.autoplay){this.videoProxy.play()}};s7sdk.video.VideoPlayer.prototype.setItem=function(a){s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.setItem( %0 )",a);if(this.isReq){this.isReq.cancelHttpReq()}if(!((a instanceof s7sdk.VideoDesc&&a.type==s7sdk.ItemDescType.VIDEO)||(a instanceof s7sdk.MediaSetDesc&&a.type==s7sdk.ItemDescType.VIDEO_SET))){throw new Error("Item must be a video!")}this.currentAsset=a;if(this.asset!=""){this.assetSpecificPosterImage=undefined}this.invalidateNavigation();this.createViewer(a);this.asset=""};s7sdk.video.VideoPlayer.prototype.getVolume=function(){if(this.supportsVolumeControl()){return this.videoProxy.getVolume()}else{return 1}};s7sdk.video.VideoPlayer.prototype.setVolume=function(a){if(this.supportsVolumeControl()){this.videoProxy.setVolume(a);this.checkState()}};s7sdk.video.VideoPlayer.prototype.getCurrentTime=function(){return this.videoProxy.getCurrentTime()};s7sdk.video.VideoPlayer.prototype.getLoadedPosition=function(){return this.videoProxy.getLoadedPosition()};s7sdk.video.VideoPlayer.prototype.getDuration=function(){if(!s7sdk.Util.isNull(this.videoProxy.getDuration())){return this.videoProxy.getDuration()}else{if(!s7sdk.Util.isNull(this.serverDuration)){return this.serverDuration}else{return undefined}}};s7sdk.video.VideoPlayer.prototype.getCapabilityState=function(){s7sdk.Logger.log(s7sdk.Logger.INFO,"VideoPlayer.getCapabilityState() = %0 ",this.videoCapabilityState);return this.videoCapabilityState};s7sdk.video.VideoPlayer.prototype.checkState=function(){var a=this.videoCapabilityState;this.videoCapabilityState=new s7sdk.VideoCapabilityState();if(this.videoProxy.paused()&&!this.videoProxy.ended()){this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.PLAY);if(this.videoProxy.getCurrentTime()>0){this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.STOP)}}if(!this.videoProxy.paused()&&!this.videoProxy.ended()){if(((s7sdk.browser.name=="chrome")||((s7sdk.browser.name=="safari")&&(s7sdk.browser.version.minor==6)))&&(s7sdk.browser.device.name=="desktop")&&this.divClickElement){this.divClickElement.style.opacity=0;this.divClickElement.style.opacity=1}this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.PAUSE);this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.STOP)}this.videoProxy.muted()?this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.UNMUTE):this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.MUTE);if(this.videoProxy.ended()){this.videoCapabilityState.setCapability(s7sdk.VideoCapabilityState.REPLAY)}if((a==null)||(a.state!=this.videoCapabilityState.state)){this.dispatchEvent(new s7sdk.event.CapabilityStateEvent(s7sdk.event.CapabilityStateEvent.NOTF_VIDEO_CAPABILITY_STATE,this.videoCapabilityState))}};s7sdk.video.VideoPlayer.prototype.ended=function(){return this.videoProxy.ended()};s7sdk.video.VideoPlayer.prototype.supportsFullScreen=function(){return this.videoProxy.supportsFullScreen()};s7sdk.video.VideoPlayer.prototype.enterFullScreen=function(){return this.videoProxy.enterFullScreen()};s7sdk.video.VideoPlayer.prototype.play=function(){if(!this.setRequestLoaded){this.fillMethodQueue("play");return}if(!this.videoProxy.ended()){this.videoProxy.play();var a=new s7sdk.UserEvent(s7sdk.UserEvent.PLAY,this.videoProxy.getCurrentTime(),true);this.dispatchEvent(a,false);this.endNotificationSent=false}};s7sdk.video.VideoPlayer.prototype.pause=function(){if(!this.setRequestLoaded){this.fillMethodQueue("pause");return}this.videoProxy.pause()};s7sdk.video.VideoPlayer.prototype.stop=function(){if(!this.setRequestLoaded){this.fillMethodQueue("stop");return}this.videoProxy.pause();this.videoProxy.seek(0);this.pendingStopNotification=true};s7sdk.video.VideoPlayer.prototype.togglePause=function(){if(this.videoCapabilityState!=null){if(this.videoCapabilityState.hasCapability(s7sdk.VideoCapabilityState.PLAY)||this.videoCapabilityState.hasCapability(s7sdk.VideoCapabilityState.REPLAY)){var a=this.getDuration()-this.getCurrentTime();if(a<=1){this.seek(0)}this.play()}else{if(this.videoCapabilityState.hasCapability(s7sdk.VideoCapabilityState.PAUSE)){this.pause()}}}};s7sdk.video.VideoPlayer.prototype.seek=function(a){if(!this.setRequestLoaded){this.fillMethodQueue("seek",[a]);return}this.videoProxy.seek(a);this.endNotificationSent=false};s7sdk.video.VideoPlayer.prototype.muted=function(){if(this.supportsVolumeControl()){return this.videoProxy.muted()}else{return false}};s7sdk.video.VideoPlayer.prototype.mute=function(){if(this.supportsVolumeControl()){this.videoProxy.mute(true);this.checkState()}};s7sdk.video.VideoPlayer.prototype.unmute=function(){if(this.supportsVolumeControl()){this.videoProxy.mute(false);this.checkState()}};s7sdk.video.VideoPlayer.prototype.checkTimingEvents=function(){var a=this.videoProxy.getDuration();if(s7sdk.Util.isNull(a)||a==0){return}var c=s7sdk.Util.isNull(this.videoProxy.getCurrentTime())?0:this.videoProxy.getCurrentTime();c=25*Math.floor((c*4)/a);if(c!=this.curMilestone){this.curMilestone=c;var b=new s7sdk.UserEvent(s7sdk.UserEvent.MILESTONE,this.curMilestone,true);this.dispatchEvent(b,false)}};s7sdk.video.VideoPlayer.prototype.fillMethodQueue=function(b,a){this.methodCallQueue.push({func:b,args:a})};s7sdk.video.VideoPlayer.parseMovieUrl=function(b){var a=null;if(b){a=b.replace(/[\\]/g,"/");ar=a.split(".");if(ar.length>1){a=ar[0]}ar=a.split(":");if(ar.length>1){a=ar[1]}ar=a.split("/");a=ar.length>1?ar[0]+"/"+ar[ar.length-1]:a}return a};s7sdk.video.VideoPlayer.prototype.supportsVolumeControl=function(){var a=true;if(("ipad"==s7sdk.browser.device.name)||("iphone"==s7sdk.browser.device.name)||("android"==s7sdk.browser.device.name)){a=false}return a};s7sdk.video.VideoPlayer.prototype.setCSS=function(c,b,a){if(s7sdk.video.VideoPlayer.RESTRICTED_STYLES[b]){throw new Error("You cannot set "+c+" : "+b+" CSS property for this component ")}else{this.superproto.setCSS.apply(this,[c,b,a])}};s7sdk.video.VideoPlayer.prototype.dispose=function(){this.cleanUp();if(this.obj){if(this.obj.parentElement){this.obj.parentElement.removeChild(this.obj)}}};s7sdk.video.VideoPlayer.prototype.cleanUp=function(){if(this.isReq_){this.isReq_.cancelHttpReq();this.isReq_=null}this.methodCallQueue.splice(0,this.methodCallQueue.length);if(this.iconEffectObj){this.iconEffectObj=null}if(this.caption){this.caption=null}if(this.videoProxy){for(var a in this.videoProxy){if(typeof(this.videoProxy[a])=="function"){this.videoProxy[a]=function(){}}}}s7sdk.Util.removeTags(this.obj)};s7sdk.video.VideoPlayer.getDurationFromItem=function(b){if(b.type==s7sdk.ItemDescType.VIDEO_SET){var a=b.items[0];if(a.userData&&a.userData.Video_Length){return parseFloat(a.userData.Video_Length)*1000}else{if((a.userData instanceof Array)&&a.userData[0].Video_Length){return parseFloat(a.userData[0].Video_Length)*1000}}}else{if(b.userData&&b.userData.Video_Length){return parseFloat(b.userData.Video_Length)*1000}else{if((b.userData instanceof Array)&&b.userData[0].Video_Length){return parseFloat(b.userData[0].Video_Length)*1000}}}return undefined};s7sdk.VideoPlayer=s7sdk.video.VideoPlayer;(function addDefaultCSS(){var c=s7sdk.Util.css.createCssRuleText;var b=s7sdk.Util.css.createCssImgUrlText;var a=c(".s7videoplayer",{position:"absolute","background-color":"#000000","-webkit-touch-callout":"none","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)"})+c(".s7videoplayer div[role='button']",{position:"relative","z-index":"1"})+c(".s7videoplayer .s7iconeffect",{width:"120px",height:"120px","-webkit-transform":"translateZ(0px)","background-repeat":"no-repeat","background-position":"center"})+c(".s7videoplayer .s7iconeffect[state='play']",{"background-image":b("videoplayicon.png")})+c(".s7videoplayer .s7iconeffect[state='replay']",{"background-image":b("videoreplayicon.png")})+c(".s7videoplayer .s7videoposter",{top:"0px",left:"0px",position:"absolute","background-repeat":"no-repeat","background-position":"center center","background-size":"contain"})+c(".s7videoplayer .s7caption",{"font-family":"sans-serif","font-size":"large",color:"#ffffff","-webkit-transform":"translateZ(0px)",margin:"0 auto"});s7sdk.Util.css.addDefaultCSS(a,"VideoPlayer")})()}if(!s7sdk.video.HTML5VideoProxy){s7sdk.video.HTML5VideoProxy=function HTML5VideoProxy(j,f,h,a,k,c,b,e,d,g){s7sdk.Logger.log(s7sdk.Logger.INFO,"HTML5VideoProxy constructor");this.serverUrl=a;this.videoServerUrl=k;this.curTime=undefined;this.bufTime=undefined;this.serverDuration=undefined;this.videoDuration=undefined;this.fallbackmessage=g;this.volume=1;this.mutedValue=false;this.playback=b;this.progressivebitrate=e*1024;this.inWidth=f;this.inHeight=h;this.callQueue=[];this.proxyIsReady=false;this.loop=d;this.inContainer=j;this.inAutoPlay=c;this.inWidth=f;this.inHeight=h;this.firstAsset=true;this.createVideoElement()};s7sdk.video.HTML5VideoProxy.prototype.createVideoElement=function(){if(this.videoElement){this.inContainer.removeChild(this.videoElement)}this.videoElement=s7sdk.Util.createObj(null,"video",null,null);this.videoElement.volume=this.volume;this.videoElement.muted=this.mutedValue;this.videoElement.style.position="absolute";this.resize(this.inWidth,this.inHeight);this.videoElement.preload="auto";if(s7sdk.browser.name=="ie"){this.videoElement.preload="none"}this.inContainer.insertBefore(this.videoElement,this.inContainer.firstChild);if(this.inAutoPlay){this.videoElement.autoplay=true}if(this.playback.controls){this.videoElement.controls=true}else{if(("ipad"==s7sdk.browser.device.name)||(("blackberry"==s7sdk.browser.device.name)&&(s7sdk.browser.device.version==10))){this.videoElement.setAttribute("webkit-playsinline",1)}}if(this.loop){this.videoElement.loop=true}var a=this;s7sdk.Event.addDOMListener(this.videoElement,"timeupdate",function(){var b=a.curTime;a.curTime=a.videoElement.currentTime;if(a.videoElement.ended&&(a.videoDuration!=a.curTime)){a.curTime=a.videoDuration}if(b!=a.curTime){a.onCurrentTime()}},true);s7sdk.Event.addDOMListener(this.videoElement,"loadstart",function(){a.onLoadProgress()},true);s7sdk.Event.addDOMListener(this.videoElement,"loadedmetadata",function(){a.proxyIsReady=true;while(a.callQueue.length>0){var b=a.callQueue[0];a.callQueue.splice(0,1);a[b.func].apply(a,b.args)}a.onLoadProgress()},true);s7sdk.Event.addDOMListener(this.videoElement,"progress",function(){a.onLoadProgress()},true);s7sdk.Event.addDOMListener(this.videoElement,"durationchange",function(){var b=a.videoElement.duration;if(("android"==s7sdk.browser.device.name)&&(4==s7sdk.browser.device.version)&&(a.videoElement.readyState<4)){return}if((s7sdk.browser.name=="safari")&&(a.serverDuration)&&((b==Math.floor(a.serverDuration))||(b==Math.ceil(a.serverDuration)))){b=a.serverDuration}if(b!=a.videoDuration){a.videoDuration=b;a.onDuration()}},true);s7sdk.Event.addDOMListener(this.videoElement,"volumechange",function(){a.onVolume()},true);s7sdk.Event.addDOMListener(this.videoElement,"seeked",function(){a.onSeeked()},true);s7sdk.Event.addDOMListener(this.videoElement,"play",function(){a.onStateChange()},true);s7sdk.Event.addDOMListener(this.videoElement,"pause",function(){a.onStateChange()},true);s7sdk.Event.addDOMListener(this.videoElement,"ended",function(){if(a.videoDuration!=a.curTime){a.curTime=a.videoDuration;a.onCurrentTime()}a.onStateChange()},true)};s7sdk.video.HTML5VideoProxy.prototype.setAsset=function(b,a){this.callQueue.splice(0,this.callQueue.length);this.proxyIsReady=false;this.serverDuration=s7sdk.video.VideoPlayer.getDurationFromItem(b)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}var f=s7sdk.MediaSetParser.resolveVideoAsset(b,this.playback,this.progressivebitrate);if(b.items){this.videoWidth=b.items[0].width;this.videoHeight=b.items[0].height}else{if(b.width){this.videoWidth=b.width;this.videoHeight=b.height}}if(this.firstAsset){this.firstAsset=false}else{this.createVideoElement()}if(a!=null){this.videoElement.poster=this.serverUrl+a}var d=s7sdk.Util.resolveURL(this.videoServerUrl,f);while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var e=document.createElement("source");e.src=d;var c=document.createElement("p");c.innerHTML=this.fallbackmessage;this.videoElement.appendChild(c);this.videoElement.appendChild(e);this.resize(this.inWidth,this.inHeight)};s7sdk.video.HTML5VideoProxy.prototype.getVolume=function(){return this.videoElement.volume};s7sdk.video.HTML5VideoProxy.prototype.setVolume=function(a){if(this.videoElement.muted){this.mutedValue=this.videoElement.muted=false}this.volume=a;this.videoElement.volume=a};s7sdk.video.HTML5VideoProxy.prototype.mute=function(a){this.mutedValue=this.videoElement.muted=a};s7sdk.video.HTML5VideoProxy.prototype.muted=function(){return this.videoElement.muted};s7sdk.video.HTML5VideoProxy.prototype.getLoadedPosition=function(){return((this.videoElement.buffered&&this.videoElement.buffered.length>0)?this.videoElement.buffered.end(0)*1000:0)};s7sdk.video.HTML5VideoProxy.prototype.getDuration=function(){if(s7sdk.Util.isNull(this.videoDuration)){return undefined}else{return this.videoDuration*1000}};s7sdk.video.HTML5VideoProxy.prototype.ended=function(){return this.videoElement.ended};s7sdk.video.HTML5VideoProxy.prototype.supportsFullScreen=function(){if(("ipad"==s7sdk.browser.device.name)||("safari"==s7sdk.browser.name)||("chrome"==s7sdk.browser.name)){return this.videoElement.webkitSupportsFullscreen}if("firefox"==s7sdk.browser.name){return document.mozFullScreenEnabled}return false};s7sdk.video.HTML5VideoProxy.prototype.enterFullScreen=function(){if(this.supportsFullScreen()){if("firefox"==s7sdk.browser.name){this.videoElement.mozRequestFullScreen()}if(this.videoElement.webkitSupportsFullscreen){this.videoElement.webkitEnterFullScreen()}}};s7sdk.video.HTML5VideoProxy.prototype.getWidth=function(){return this.inWidth};s7sdk.video.HTML5VideoProxy.prototype.getHeight=function(){return this.inHeight};s7sdk.video.HTML5VideoProxy.prototype.resize=function(b,c){var a,d;this.inWidth=b;this.inHeight=c;if(this.videoHeight&&this.videoWidth){a=b*this.videoHeight/this.videoWidth;if(a>c){d=this.videoWidth*c/this.videoHeight;a=c}else{d=b}}else{a=c;d=b}this.videoElement.width=d*s7sdk.browser.device.pixelratio;this.videoElement.height=a*s7sdk.browser.device.pixelratio;this.videoElement.style.width=d+"px";this.videoElement.style.height=a+"px";this.videoElement.style.left=(b-d)/2+"px";this.videoElement.style.top=(c-a)/2+"px"};s7sdk.video.HTML5VideoProxy.prototype.play=function(){this.videoElement.play()};s7sdk.video.HTML5VideoProxy.prototype.paused=function(){return this.videoElement.paused};s7sdk.video.HTML5VideoProxy.prototype.pause=function(){this.videoElement.pause()};s7sdk.video.HTML5VideoProxy.prototype.getCurrentTime=function(){return this.curTime*1000};s7sdk.video.HTML5VideoProxy.prototype.seek=function(b){if(!this.proxyIsReady){this.fillMethodQueue("seek",[b]);return}var a=(!this.videoElement.paused);this.videoElement.currentTime=b/1000;this.curTime=b/1000;if((s7sdk.browser.device.name=="ipad")&&(s7sdk.browser.device.version==6)&&b==0){if(a){this.videoElement.play()}}};s7sdk.video.HTML5VideoProxy.prototype.onLoadProgress=function(){};s7sdk.video.HTML5VideoProxy.prototype.onCurrentTime=function(){};s7sdk.video.HTML5VideoProxy.prototype.onDuration=function(){};s7sdk.video.HTML5VideoProxy.prototype.onSeeked=function(){};s7sdk.video.HTML5VideoProxy.prototype.onVolume=function(){};s7sdk.video.HTML5VideoProxy.prototype.onStateChange=function(){};s7sdk.video.HTML5VideoProxy.prototype.fillMethodQueue=function(b,a){this.callQueue.push({func:b,args:a})}}if(!s7sdk.video.FlashVideoProxy){s7sdk.video.FlashVideoProxy=function FlashVideoProxy(r,c,n,p,e,o,d,b,k,h,m,j){s7sdk.Logger.log(s7sdk.Logger.INFO,"FlashVideoProxy constructor");this.viewerReady=false;this.seekPosition=0;var a=s7sdk.Util.lib.root.substring(0,s7sdk.Util.lib.root.indexOf("/js"));if(a!=""){a+="/"}a+="flash/VideoPlayer.swf";var q=document.URL.indexOf("https://")==0?"https":"http";var f="videoserverurl="+o+"&serverurl="+e+"&autoplay="+d+"&stagesize="+n+","+p+"&smoothing="+h+"&initialbitrate="+m+"&loop="+j+"&streaming=true&singleclick=none";var g='<object style="max-width:none; max-height:none;"	classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+q+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0"  width="'+n+'" height="'+p+'" 	id="'+c+'" name = "'+c+'" align="middle"> ';g+=' <param name="allowScriptAccess" value="always" />';g+='<PARAM NAME="movie" VALUE="'+a+'" />';g+='<PARAM NAME="flashVars" value="'+f+'"/>';g+='<PARAM NAME="quality" VALUE="high" />';g+='<PARAM NAME="bgcolor" VALUE="#ffffff" />';g+='<PARAM NAME="wmode" VALUE="transparent" />';g+='<PARAM NAME="allowScriptAccess" VALUE="always" />';g+='<PARAM NAME="allowFullScreen" value="true" />';g+=' <embed type="application/x-shockwave-flash"';g+=' pluginspage="http://www.adobe.com/go/getflashplayer"';g+=' name="'+c+'"';g+=' id="'+c+'"';g+=' allowScriptAccess="always"';g+=' quality="high"';g+=' bgcolor="#ffffff"';g+=' width="'+n+'"';g+=' height="'+p+'"';g+=' wmode="transparent"';g+=' allowFullScreen="true"';g+=' src="'+a+'"';g+=' flashVars="'+f+'">';g+=" </embed>";g+=" </object>";r.innerHTML=g;this.callQueue=[];this.flash=s7sdk.video.FlashVideoProxy.getSWF(c);var l=this;this.flash.onCurrentTimeUpdate=function(s){l.onCurrentTime()};this.flash.onDurationUpdate=function(s){l.onDuration()};this.flash.onLoadProgressUpdate=function(s){l.onLoadProgress()};this.flash.onVolumeUpdate=function(s){l.onVolume()};this.flash.onSeekUpdate=function(s){l.onSeeked()};this.flash.onCapabilityStateUpdate=function(s){l.onStateChange()};this.flash.onViewerReady=function(){l.viewerReady=true;while(l.callQueue.length>0){var s=l.callQueue[0];l.callQueue.splice(0,1);l.flash[s.func].apply(l.flash,s.args)}};this.playback=b;this.progressivebitrate=k*1024};s7sdk.video.FlashVideoProxy.VIDEO_POLLING_RATE=100;s7sdk.video.FlashVideoProxy.prototype.setAsset=function(b,a){var c=s7sdk.MediaSetParser.resolveVideoAsset(b,this.playback,this.progressivebitrate);this.protectedCall("setAsset",[c,a])};s7sdk.video.FlashVideoProxy.prototype.getVolume=function(){if(this.viewerReady){return this.flash.getVolume()}else{return 1}};s7sdk.video.FlashVideoProxy.prototype.setVolume=function(a){if(this.viewerReady){if(this.flash.muted()){this.mute(false)}}this.protectedCall("setVolume",[a])};s7sdk.video.FlashVideoProxy.prototype.mute=function(a){this.protectedCall("muteVideo",[a])};s7sdk.video.FlashVideoProxy.prototype.muted=function(){if(this.viewerReady){return this.flash.muted()}else{return false}};s7sdk.video.FlashVideoProxy.prototype.getLoadedPosition=function(){if(this.viewerReady){return this.flash.getLoadedPosition()}else{return 0}};s7sdk.video.FlashVideoProxy.prototype.getDuration=function(){if(this.viewerReady&&!isNaN(this.flash.getDuration())){return this.flash.getDuration()}else{return undefined}};s7sdk.video.FlashVideoProxy.prototype.ended=function(){if(this.viewerReady){if(isNaN(this.flash.getDuration())){return this.flash.ended()}else{var a=Math.max(this.seekPosition,this.flash.getCurrentTime());return a>=this.flash.getDuration()}}else{return false}};s7sdk.video.FlashVideoProxy.prototype.getWidth=function(){return this.inWidth};s7sdk.video.FlashVideoProxy.prototype.getHeight=function(){return this.inHeight};s7sdk.video.FlashVideoProxy.prototype.resize=function(a,b){this.protectedCall("resize",[a,b]);this.flash.style.width=a+"px";this.flash.style.height=b+"px";this.flash.width=a;this.flash.height=b};s7sdk.video.FlashVideoProxy.prototype.play=function(){this.protectedCall("playVideo",[])};s7sdk.video.FlashVideoProxy.prototype.paused=function(){if(this.viewerReady){return this.flash.paused()}else{return false}};s7sdk.video.FlashVideoProxy.prototype.pause=function(){this.protectedCall("pauseVideo",[])};s7sdk.video.FlashVideoProxy.prototype.getCurrentTime=function(){if(this.viewerReady){return this.flash.getCurrentTime()}else{return 0}};s7sdk.video.FlashVideoProxy.prototype.seek=function(a){this.seekPosition=a;this.protectedCall("seekVideo",[a])};s7sdk.video.FlashVideoProxy.prototype.onLoadProgress=function(){};s7sdk.video.FlashVideoProxy.prototype.onCurrentTime=function(){};s7sdk.video.FlashVideoProxy.prototype.onDuration=function(){};s7sdk.video.FlashVideoProxy.prototype.onSeeked=function(){};s7sdk.video.FlashVideoProxy.prototype.onVolume=function(){};s7sdk.video.FlashVideoProxy.prototype.onStateChange=function(){};s7sdk.video.FlashVideoProxy.getSWF=function(a){var b=navigator.userAgent.toLowerCase();if(b.indexOf("gecko")!=-1){return document.embeds[a]}else{if(s7sdk.browser.name=="ie"){return document.getElementById(a)}else{return window[a]}}};s7sdk.video.FlashVideoProxy.prototype.protectedCall=function(b,a){if(this.viewerReady){this.flash[b].apply(this.flash,a)}else{this.callQueue.push({func:b,args:a})}}}if(!s7sdk.video.NOOPVideoProxy){s7sdk.video.NOOPVideoProxy=function NOOPVideoProxy(j,f,h,a,k,c,b,e,d,g){s7sdk.Logger.log(s7sdk.Logger.INFO,"NOOPVideoProxy constructor");this.inContainer=j;this.fallbackmessage=g;this.createVideoElement()};s7sdk.video.NOOPVideoProxy.prototype.createVideoElement=function(){this.videoElement=s7sdk.Util.createObj(null,"div",null,null);this.inContainer.appendChild(this.videoElement);var a=document.createElement("p");a.innerHTML=this.fallbackmessage;this.videoElement.appendChild(a)};s7sdk.video.NOOPVideoProxy.VIDEO_POLLING_RATE=100;s7sdk.video.NOOPVideoProxy.prototype.setAsset=function(b,a){};s7sdk.video.NOOPVideoProxy.prototype.getVolume=function(){};s7sdk.video.NOOPVideoProxy.prototype.setVolume=function(a){};s7sdk.video.NOOPVideoProxy.prototype.mute=function(a){};s7sdk.video.NOOPVideoProxy.prototype.muted=function(){};s7sdk.video.NOOPVideoProxy.prototype.getLoadedPosition=function(){};s7sdk.video.NOOPVideoProxy.prototype.getDuration=function(){};s7sdk.video.NOOPVideoProxy.prototype.ended=function(){};s7sdk.video.NOOPVideoProxy.prototype.supportsFullScreen=function(){};s7sdk.video.NOOPVideoProxy.prototype.enterFullScreen=function(){};s7sdk.video.NOOPVideoProxy.prototype.getWidth=function(){};s7sdk.video.NOOPVideoProxy.prototype.getHeight=function(){};s7sdk.video.NOOPVideoProxy.prototype.resize=function(a,b){};s7sdk.video.NOOPVideoProxy.prototype.play=function(){};s7sdk.video.NOOPVideoProxy.prototype.paused=function(){};s7sdk.video.NOOPVideoProxy.prototype.pause=function(){};s7sdk.video.NOOPVideoProxy.prototype.getCurrentTime=function(){};s7sdk.video.NOOPVideoProxy.prototype.seek=function(a){};s7sdk.video.NOOPVideoProxy.prototype.onLoadProgress=function(){};s7sdk.video.NOOPVideoProxy.prototype.onCurrentTime=function(){};s7sdk.video.NOOPVideoProxy.prototype.onDuration=function(){};s7sdk.video.NOOPVideoProxy.prototype.onSeeked=function(){};s7sdk.video.NOOPVideoProxy.prototype.onVolume=function(){};s7sdk.video.NOOPVideoProxy.prototype.onStateChange=function(){}}if(!s7sdk.video.IPhoneProxy){s7sdk.video.IPhoneProxy=function IPhoneProxy(h,e,g,a,j,b,c,d,f){s7sdk.Logger.log(s7sdk.Logger.INFO,"IPhoneProxy constructor");this.inContainer=h;this.fallbackmessage=f;this.width=e;this.height=g;this.playback=b;this.progressivebitrate=c;this.firstAsset=true;this.serverUrl=a;this.videoServerUrl=j;this.serverDuration=undefined;this.videoDuration=undefined;this.loop=d;this.createPosterElement(e,g);this.createVideoElement()};s7sdk.video.IPhoneProxy.prototype.createVideoElement=function(){if(this.videoElement){this.inContainer.removeChild(this.videoElement);this.videoElement=null}this.videoElement=s7sdk.Util.createObj(null,"video",null,null);this.videoElement.style.position="absolute";this.videoElement.style.width="1px";this.videoElement.style.height="1px";var a=document.createElement("p");a.innerHTML=this.fallbackmessage;this.videoElement.appendChild(a);if(this.loop){this.videoElement.loop=true}this.inContainer.insertBefore(this.videoElement,this.inContainer.firstChild);var b=this;this.videoElement.addEventListener("pause",function(d){var c=new s7sdk.UserEvent(s7sdk.UserEvent.PAUSE,b.getCurrentTime(),true);s7sdk.Event.dispatch(b.inContainer,c)},false);this.videoElement.addEventListener("play",function(d){var c=new s7sdk.UserEvent(s7sdk.UserEvent.PLAY,b.getCurrentTime(),true);s7sdk.Event.dispatch(b.inContainer,c)},false);this.videoElement.addEventListener("timeupdate",function(c){var d=b.curTime;b.curTime=b.videoElement.currentTime;if(b.videoElement.ended&&(b.videoDuration!=b.curTime)){b.curTime=b.videoDuration}if(d!=b.curTime){b.onCurrentTime()}},false);this.videoElement.addEventListener("loadstart",function(c){b.onLoadProgress()},false);this.videoElement.addEventListener("loadedmetadata",function(c){b.onLoadProgress()},false);this.videoElement.addEventListener("progress",function(c){b.onLoadProgress()},false);this.videoElement.addEventListener("durationchange",function(d){var c=b.videoElement.duration;if((s7sdk.browser.name=="safari")&&(b.serverDuration)&&((c==Math.floor(b.serverDuration))||(c==Math.ceil(b.serverDuration)))){c=b.serverDuration}if(c!=b.videoDuration){b.videoDuration=c;b.onDuration()}},false);this.videoElement.addEventListener("play",function(c){b.onStateChange()},false);this.videoElement.addEventListener("pause",function(c){b.onStateChange()},false);this.videoElement.addEventListener("ended",function(c){if(b.videoDuration!=b.curTime){b.curTime=b.videoDuration;b.onCurrentTime()}b.onStateChange()},false)};s7sdk.video.IPhoneProxy.prototype.createPosterElement=function(a,b){if(this.divPosterElement){this.inContainer.removeChild(this.divPosterElement)}this.divPosterElement=s7sdk.Util.createObj(null,"div",null,null);this.divPosterElement.className="s7videoposter";this.divPosterElement.style.width=a+"px";this.divPosterElement.style.height=b+"px";this.inContainer.insertBefore(this.divPosterElement,this.videoElement)};s7sdk.video.IPhoneProxy.prototype.setAsset=function(c,a){var e=s7sdk.MediaSetParser.resolveVideoAsset(c,this.playback,this.progressivebitrate);this.serverDuration=s7sdk.video.VideoPlayer.getDurationFromItem(c)/1000;if(this.serverDuration){this.videoDuration=this.serverDuration}if(this.firstAsset){this.firstAsset=false}else{this.createPosterElement(this.width,this.height);this.createVideoElement()}var b=this;s7sdk.Event.addDOMListener(this.videoElement,"webkitendfullscreen",function(f){b.onStateChange()},false);if(a!=null){this.divPosterElement.style.backgroundImage="url('"+this.serverUrl+a+"')"}videoUrl=s7sdk.Util.resolveURL(this.videoServerUrl,e);while(this.videoElement.firstChild){this.videoElement.removeChild(this.videoElement.firstChild)}var d=document.createElement("source");d.src=videoUrl;this.videoElement.appendChild(d);this.resize(this.width,this.height);this.videoElement.load()};s7sdk.video.IPhoneProxy.prototype.getVolume=function(){return 1};s7sdk.video.IPhoneProxy.prototype.setVolume=function(a){};s7sdk.video.IPhoneProxy.prototype.mute=function(a){};s7sdk.video.IPhoneProxy.prototype.muted=function(){return this.videoElement.muted};s7sdk.video.IPhoneProxy.prototype.getLoadedPosition=function(){return((this.videoElement.buffered&&this.videoElement.buffered.length>0)?this.videoElement.buffered.end(0)*1000:0)};s7sdk.video.IPhoneProxy.prototype.getDuration=function(){if(s7sdk.Util.isNull(this.videoDuration)){return undefined}else{return this.videoDuration*1000}};s7sdk.video.IPhoneProxy.prototype.ended=function(){return this.videoElement.ended};s7sdk.video.IPhoneProxy.prototype.supportsFullScreen=function(){return false};s7sdk.video.IPhoneProxy.prototype.enterFullScreen=function(){};s7sdk.video.IPhoneProxy.prototype.getWidth=function(){return this.width};s7sdk.video.IPhoneProxy.prototype.getHeight=function(){return this.height};s7sdk.video.IPhoneProxy.prototype.resize=function(a,b){this.width=a;this.height=b;this.divPosterElement.style.width=a+"px";this.divPosterElement.style.height=b+"px"};s7sdk.video.IPhoneProxy.prototype.play=function(){this.videoElement.play()};s7sdk.video.IPhoneProxy.prototype.paused=function(){return this.videoElement.paused};s7sdk.video.IPhoneProxy.prototype.pause=function(){this.videoElement.pause()};s7sdk.video.IPhoneProxy.prototype.getCurrentTime=function(){return this.curTime*1000};s7sdk.video.IPhoneProxy.prototype.seek=function(a){};s7sdk.video.IPhoneProxy.prototype.onLoadProgress=function(){};s7sdk.video.IPhoneProxy.prototype.onCurrentTime=function(){};s7sdk.video.IPhoneProxy.prototype.onDuration=function(){};s7sdk.video.IPhoneProxy.prototype.onSeeked=function(){};s7sdk.video.IPhoneProxy.prototype.onVolume=function(){};s7sdk.video.IPhoneProxy.prototype.onStateChange=function(){}};