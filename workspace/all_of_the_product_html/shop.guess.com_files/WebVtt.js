/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
s7sdk.pkg("s7sdk.common");if(!s7sdk.common.WebVtt){s7sdk.common.WebVtt=function WebVtt(b,a){s7sdk.Logger.log("s7sdk.Logger.FINE s7sdk.common.WebVtt type=%0, items=%1",b,a);this.type=b;this.items=a};s7sdk.common.WebVtt.parse=function parse(c,b){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.common.WebVtt.parse type=%0, content=\n%1",b,c);var a=new s7sdk.common.WebVttParser(b).parseData(c);return new s7sdk.common.WebVtt(b,a)};s7sdk.common.WebVtt.TYPE_UNKNOWN="unknown";s7sdk.common.WebVtt.TYPE_CAPTION="caption";s7sdk.common.WebVtt.TYPE_NAVIGATION="navigation";s7sdk.common.WebVtt.TYPE_METADATA="metadata";s7sdk.common.WebVtt.prototype.getType=function(){return this.type};s7sdk.common.WebVtt.prototype.getItems=function(){return this.items};s7sdk.common.WebVttParser=function WebVttParser(a){this.items=null;this.parseTextFcn=null;this.type=a;if(a==s7sdk.common.WebVtt.TYPE_CAPTION){this.parseTextFcn=this.parseCueText}else{if(a==s7sdk.common.WebVtt.TYPE_NAVIGATION){this.parseTextFcn=this.parseCueText}else{if(a==s7sdk.common.WebVtt.TYPE_METADATA){this.parseTextFcn=this.parseJSON}else{throw new Error("s7sdk.common.WebVtt cannot handle unsupported content type: "+a)}}}};s7sdk.common.WebVttParser.prototype.parseData=function(f){s7sdk.Logger.log(s7sdk.Logger.FINE,"WebVttParser.parseData: %0",f);this.items=[];var k=f.split("\n");var d=0;var h=0;var c=true;var b="",a="",g="";var i=false;for(var e in k){if(!k.hasOwnProperty(e)){continue}var j=k[e].toString().trim();if(c){if(e==0){continue}else{if(j.length==0){continue}}c=false}if(j.length==0){if(h>1){if(b.length>0){this.addData(b,a,g)}else{}}d+=1;h=0;b=a=g=""}else{if(h<2&&b.length==0){if(/(\d\d\:\d\d[.,]\d\d\d)\s+--\>/.test(j)){i=true;b=j;a=""}else{g=j;if(!i){if(a.length>0){a+="\n"}a+=j}}}else{if(a.length>0){a+="\n"}a+=j}h+=1}}if(h>1){this.addData(b,a,g)}return this.items};s7sdk.common.WebVttParser.prototype.parseCueSettings=function(e){var d={lineSize:"100%",textPosition:"50%",textAlign:"middle",vertical:""};var a=b(e);if(a.hasOwnProperty("region")){}if(a.hasOwnProperty("D")){if(a.D=="vertical-lr"){d.vertical="lr"}else{if(a.D=="vertical-rl"){d.vertical="rl"}}}if(a.hasOwnProperty("L")){if(/-?\d*%?/.test(a.L)){d.linePosition=a.L}}if(a.hasOwnProperty("T")){if(/\d%/.test(a.T)){var c=parseInt(a.T);if(c>=0&&c<=100){d.textPosition=a.T}}}if(a.hasOwnProperty("S")){d.lineSize=a.S}if(a.hasOwnProperty("A")){if(/(left)|(right)/.test(a.A)){d.textAlign=a.A}else{if(a.A=="end"){d.textAlign="right"}else{if(a.A=="start"){d.textAlign="left"}}}}return d;function b(j){var h=j.split(" ");var g=0,f=[];for(;g<h.length;g++){var i=h[g].split(":",2);if(i&&i.length>0){f[i[0].replace(/^\s*?/,"")]=i.length>1?i[1]:""}}return f}};s7sdk.common.WebVttParser.prototype.parseCueText=function(b){var a="";a=b.replace(/(<(\d\d\:)?\d\d\:\d\d[.,]\d\d\d>)/g," ");return a};s7sdk.common.WebVttParser.prototype.parseJSON=function(c){var b=null;try{b=JSON&&JSON.parse(c)}catch(a){s7sdk.Logger.log(s7sdk.Logger.WARNING,"Cannot parse JSON object in WebVtt content of type %0: %1\n%2",this.type,a,c)}if(!b){throw new Error("Invalid JSON object in WebVtt content")}return b};s7sdk.common.WebVttParser.prototype.addData=function(d,f,e){if(d.length==0||f.length==0){return}var a=d.match(/((\d\d\:)?\d\d\:\d\d[.,]\d\d\d)/g);if(a.length<2){return}var c=d.substring(d.indexOf(a[1])+a[1].length);this.items.push(new s7sdk.common.WebVttItem(b(a[0]),b(a[1]),this.parseTextFcn.apply(this,[f]),this.parseCueSettings(c),e));function b(j){var k=j.split(":");var g=0,h=0,i=0;if(k.length>0){i=parseFloat(k[k.length-1])}else{return -1}if(k.length>1){h=parseInt(k[k.length-2])}if(k.length>2){g=parseInt(k[k.length-3])}return Number(((g*60+h)*60+i)*1000).toFixed(0)}}}if(!s7sdk.common.WebVttItem){s7sdk.common.WebVttItem=function WebVttItem(e,a,c,b,d){this.start=e;this.end=a;this.data=c;if(b){this.settings=b}if(d){this.id=d}};s7sdk.common.WebVttItem.prototype.toString=function(){function a(b){if(typeof(b)=="object"){if(JSON){return JSON.stringify(b)}}return b.toString()}return this.start+" --> "+this.end+", data="+a(this.data)+", id="+this.id+", settings="+a(this.settings)}};