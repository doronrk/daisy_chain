!function(a,b){b.ExternalAccounts&&b.ExternalAccounts.loaded||(b.ExternalAccounts=b.ExternalAccounts||{},b.ExternalAccounts.loaded=!0,b.ExternalAccounts.LinkageType={User:"user",Shop:"shop"},b.ExternalAccounts.Providers={Facebook:"facebook",Twitter:"twitter"},b.ExternalAccounts.ShareTypes={FavoriteListing:"favorite_item"},a.extend(b.ExternalAccounts,function(){var c="/api/v2/ajax/external-account",d=function(c,d,g,h,i,k,l,m,n){k=k||{},l=e(l,c,d,g,h,!1,i),m=e(m,c,d,g,h,!0,!1),f(d,h);var o=a.extend({_nnc:b.csrf_nonce,external_account_type_name:h,owner_type_name:d},k);c&&(o.owner_id=c),i?o.external_account_id=g:o.method="DELETE",j(o,l,m,n)},e=function(a,c,d,e,f,g,h){var i;return i=g?"connected_accounts_link_error":h?"connected_accounts_link":"connected_accounts_unlink",function(c,e){var h={php_event_name:i,service:f,object_type:d,user_id:c.etsyUid};c.shopId&&(h.shop_id=c.shopId),g&&c.errorType&&(h.error_type=c.errorType),b.EventLogger.logEvent(h),a(c,e)}},f=function(a,c){if(g(c),!i(a,b.ExternalAccounts.LinkageType))throw new Error("Linkage for object type: "+a+" is not supported")},g=function(a){if(!i(a,b.ExternalAccounts.Providers))throw new Error("External type: "+a+" is not supported")},h=function(a){if(!i(a,b.ExternalAccounts.ShareTypes))throw new Error("Share type: "+a+" is not supported")},i=function(a,b){if(void 0==a||null==a)return!1;for(var c in b)if(b[c]==a)return!0;return!1},j=function(b,d,e,f,g){g=g?"/"+g:"",a.ajax({url:c+g,data:b,dataType:"json",type:"POST",success:function(a){var b=a.results;b.success?d(b,f):e(b,f)},error:function(a){e(a,f)}})},k=function(a,c,d,e,f,i,k,l){g(a),h(e),l=l||"POST";var m={_nnc:b.csrf_nonce,share_type:e,method:l};j(m,f,i,k,a+"/"+c+"/"+d+"/shares/")};return{connectAccounts:function(a,b,c,e,f,g,h,i){d(c,e,a,b,!0,h,f,g,i)},disconnectAccounts:function(a,b,c,e,f,g){d(b,c,null,a,!1,null,e,f,g)},checkAccountLinkedToUser:function(a,c,d,e,f){var g={_nnc:b.csrf_nonce,external_account_type_name:c};j(g,d,e,f,"account-linked-to-user/")},checkAccountIsValid:function(a,c,d,e,f,h){g(d);var i={_nnc:b.csrf_nonce,email:a.email||"",name:a.name||"",external_account_id:c,external_account_type_name:d};j(i,e,f,h,"is-valid/"+c)},setAccountShare:function(a,b,c,d,e,f,g){k(a,b,c,d,e,f,g)},deleteAccountShare:function(a,b,c,d,e,f,g){k(a,b,c,d,e,f,g,"DELETE")}}}()))}(window.jQuery||window.Zepto,window.Etsy),window.Etsy.loader.loaded("common/etsy.external-accounts.20141104214314.js"),function(a,b){b.Facebook&&b.Facebook.loaded||(b.Facebook=b.Facebook||{},b.Facebook.loaded=!0,a.extend(b.Facebook,function(){var c="en_US",d=a('meta[property="fb:app_id"]').attr("content"),e="facebook",f=["email"],g=!1,h="default",i=b.Facebook,j=null,k=function(b){var c=a(b).data("context");return c?c:h},l=function(a){return _.uniq(a).sort()},m=function(a){return l(a).join(",")};return{load:function(f){if(f=f||function(){},g)a(document).bind("facebook:load",function(a,b){f(b)});else if(i.isConnected())f(!0);else{g=!0,window.fbAsyncInit=function(){g=!1,FB.init({appId:d,status:!0,cookie:!0,xfbml:!0,oauth:!0,channelUrl:document.location.protocol+"//"+document.location.hostname+"/fb/channel.html"}),a(document).trigger("facebook:load",[!0]),a(document).unbind("facebook:load")},a(document).bind("facebook:load",function(a,b){f(b)});var h=a("#fb-root").attr("data-locale"),j="//connect.facebook.net/"+(h?h:c)+"/all.js";a.getScript(j),a(document).bind("facebook:connect",function(a,c,d,f){var g=k(c);d&&f?b.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_accept",source:g,service:e,xauid:i.getUid(),perms:i.getPerms()}):b.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_refuse",source:g,service:e,perms:i.getPerms()})})}},isConnected:function(){return"undefined"!=typeof window.FB},login:function(c,d){if(!i.isConnected())throw"Facebook sdk not loaded";c||j?c&&i.setPerms(c):i.extendDefaultPerms(),i.checkPermissions(function(c){c?a(document).trigger("facebook:connect",[d,!0,c]):(b.EventLogger.logEvent({php_event_name:"connected_accounts_oauth_open",source:k(d),service:e,perms:i.getPerms()}),FB.login(function(b){b.authResponse?i.checkPermissions(function(b){a(document).trigger("facebook:connect",[d,!0,b])}):a(document).trigger("facebook:connect",[d,!1,!1])},{scope:i.getPerms()}))})},isLoggedIn:function(a){if(!i.isConnected())throw"Facebook SDK not loaded";FB.getLoginStatus(function(b){var c=null!==b.authResponse;a&&a(c)})},logout:function(a){FB.logout(function(){a&&a()})},getAccessToken:function(){var a=FB.getAuthResponse();return a?a.accessToken:null},getUid:function(){var a=FB.getAuthResponse();return a?a.userID:null},eventSubscribe:function(a,b){FB.Event.subscribe(a,b)},getProfilePictureUrl:function(a,b){return"http://graph.facebook.com/"+(a||this.getUid())+"/picture?type="+(b||"large")},postToFeed:function(b,c,d,e){if(!i.isConnected())throw"Facebook sdk not loaded";if(!b)throw"Etsy.Facebook.postToFeed: link is a required argument";c=c||{},c=a.each(c,function(a,b){(null==b||void 0==b)&&delete c.key});var f={method:"feed",link:b};a.extend(f,c),FB.ui(f,function(a){a&&a.post_id?"function"==typeof d&&d(a):"function"==typeof e&&e(a)})},extendDefaultPerms:function(a){var b=[];return a&&(b=a.split(",")),b=b.concat(f),j=m(b)},setPerms:function(a){var b=[];return a&&(b=a.split(",")),j=m(b)},getPerms:function(){return j},getDefaultPerms:function(){return f},reset:function(){g=!1,h="default",j=null},checkPermissions:function(b,c){var d,e=!1;i.isLoggedIn(function(f){return f?(c?c=l(c):(d=i.getPerms(),d||(d=i.extendDefaultPerms()),c=d.split(",")),!c||c.length<1?(e=!0,b.apply(i,[e])):(FB.api("/me/permissions",function(d){if(!d.error&&d.data&&d.data.length){var f=d.data[0];a.each(c,function(a,b){return e="undefined"!=typeof f[b]})}b.apply(i,[e])}),void 0)):b.apply(i,[e])})},setContext:function(a){h=a}}}()),a.extend(b.Facebook,function(){var c=700,d=5,e=b.Facebook,f=function(a,g){g=g||0,null!==FB.getAuthResponse()?g>=d?(b.Logger.error("Could not reset Facebook JS SDK after "+d+" attempts.",FB.getAuthResponse()),a.apply(e,[!1])):(g++,setTimeout(function(){FB.init(),f(a,g)},c*g)):a.apply(e,[!0])},g=function(c){a(document).trigger("facebook:account-disconnect-begin"),b.ExternalAccounts.disconnectAccounts(b.ExternalAccounts.Providers.Facebook,null,b.ExternalAccounts.LinkageType.User,function(){f(function(){a(document).trigger("facebook:account-disconnect",[c,!0])})},function(){a(document).trigger("facebook:account-disconnect",[c,!1])})},h=function(a,c,d,f){var g=b.ExternalAccounts.Providers.Facebook,h=b.ExternalAccounts.LinkageType.User,i=e.getUid();c?b.ExternalAccounts.setAccountShare(g,i,h,a,d,f):b.ExternalAccounts.deleteAccountShare(g,i,h,a,d,f)};return{initLoginButton:function(b,c){b&&("object"!=typeof b||b.length)&&(a(b).bind("click",function(a){a.preventDefault(),e.login(c,b)}),a(b).trigger("facebook:connect-button-active"))},initConnectButton:function(c,d,f,g){c&&("object"!=typeof c||c.length)&&("undefined"==typeof d&&(d=!0),g=g||"",f=f||{},a(c).bind("click",function(h){h.preventDefault(),d&&a(document).one("facebook:connect",function(d,g,h,i){if(h&&i&&(b.Mobile&&"undefined"!=typeof b.Mobile.isSignedIn?b.Mobile.isSignedIn:b.isSignedIn())){var j=[c];b.ExternalAccounts.connectAccounts(e.getUid(),b.ExternalAccounts.Providers.Facebook,null,b.ExternalAccounts.LinkageType.User,function(){a(document).trigger("facebook:account-connect",a.merge(j,arguments))},function(){a(document).trigger("facebook:account-connect-error",a.merge(j,arguments))},f)}}),e.extendDefaultPerms(g),e.login(e.getPerms(),c)}),a(c).trigger("facebook:connect-button-active"))},initDisconnectButton:function(b){a(b).bind("click",function(a){a.preventDefault(),g(b)})},accountConnected:function(a){b.ExternalAccounts.checkAccountLinkedToUser(e.getUid(),b.ExternalAccounts.Providers.Facebook,function(b){b.success?a.apply(null,[b.linked]):a.apply(null,[!1])},function(){a.apply(null,[!1])})},addShareOfType:function(c,d,e){a(document).one("facebook:connect",function(a,b,f,g){f&&g?h(c,!0,d,e):e()}),b.Facebook.login("publish_actions",null)},removeShareOfType:function(a,b,c){h(a,!1,b,c)}}}()))}(window.jQuery||window.Zepto,window.Etsy),"function"==typeof define&&define.amd&&define("common/etsy.facebook",[],function(){return window.Etsy.Facebook}),window.Etsy.loader.loaded("common/etsy.facebook.20141104214314.js"),function(a,b){function c(a){return function(){var c={php_event_name:"share_facebook",button_name:a};e&&(c.source=e),f&&(c.post_to_page=f),b.EventLogger.logEvent(c)}}if(!b.Facebook||!b.Facebook.likeButtonInitialized){var d=a("fb\\:like"),e=d.data("share_from"),f=d.data("fb_page_url");b.Facebook.load(function(){b.Facebook.eventSubscribe("edge.create",c("like")),b.Facebook.eventSubscribe("message.send",c("send")),e&&"listing"==e&&b.Context.data.listingId&&b.Facebook.eventSubscribe("edge.create",function(){jQuery.ajax({type:"post",url:"/api/v2/ajax/track-stats/shared_listing_facebook/"+b.Context.data.listingId,data:{_nnc:b.csrf_nonce},dataType:"json"})}),b.Facebook.likeButtonInitialized=!0})}}(window.jQuery||window.Zepto,window.Etsy);