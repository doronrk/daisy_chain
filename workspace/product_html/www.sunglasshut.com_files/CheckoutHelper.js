dojo.require("dojox.collections.ArrayList");dojo.require("wc.widget.Tooltip");var globalAddressUpdateIdentifier="";CheckoutHelperJS={langId:"-1",storeId:"",catalogId:"",orderId:"",shipmentTypeId:"",orderItemIds:[],updateWaitTimeOut:1500,keyPressCount:{},ajaxCheckOut:true,singlePageCheckout:true,selectedAddressesArray:{},dataDirty:{},fieldDirtyFlag:false,resetRequestedShipDateValue:"1970-01-01T00:00:00.000Z",shoppingCartPage:false,pendingOrderDetailsPage:false,RequestShippingDateAction:false,shipChargeEnabled:false,tempOrderId:"",tempUserType:"",tempEmailAddresses:"",tempIsQuote:false,tempOrderTotal:"0",tempPaymentInstructions:{},orderPrepared:"false",appliedPromoCodes:{},applingPromoCodeIndex:0,quickCheckoutClick:"",setOrderPrepared:function(inPrepareIndicator){this.orderPrepared=inPrepareIndicator},isOrderPrepared:function(){return this.orderPrepared},saveCheckoutOrderParameters:function(orderId,userType,addressListForMailNotification,isQuote){this.tempOrderId=orderId;this.tempUserType=userType;this.tempEmailAddresses=addressListForMailNotification;this.tempIsQuote=isQuote},setOrderPayments:function(orderTotal,paymentInstructions){this.tempOrderTotal=orderTotal+0;this.tempPaymentInstructions=paymentInstructions},isOrderPaymentFullyAllocated:function(){var allocatedAmount=0;if(this.tempPaymentInstructions.length>=1){for(var i=0;i<this.tempPaymentInstructions.length;i++){allocatedAmount=allocatedAmount+this.tempPaymentInstructions[i].amount.value}}if(allocatedAmount==this.tempOrderTotal){return true}else{if(allocatedAmount<this.tempOrderTotal){MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_CANNOT_RECONCILE_PAYMENT_AMT);return false}else{if(allocatedAmount>this.tempOrderTotal){MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_PAYMENT_AMOUNT_LARGER_THAN_ORDER_AMOUNT);return false}else{MessageHelper.displayErrorMessage(MessageHelper.messages.EDPPaymentMethods_PAYMENT_AMOUNT_PROBLEM);return false}}}},getSavedParameter:function(paramName){return this[paramName]},setShipChargeEnabled:function(enabled){this.shipChargeEnabled=enabled},updateParamObject:function(params,key,value,toArray,index){if(params==null){params=[]}if(params[key]!=null&&toArray){if(dojo.lang.isArrayLike(params[key])){if(index!=null&&index!=""){params[key][index]=value}else{params[key].push(value)}}else{var tmpValue=params[key];params[key]=[];params[key].push(tmpValue);params[key].push(value)}}else{if(index!=null&&index!=""&&index!=-1){params[key+"_"+index]=value}else{if(index==-1){var i=1;while(params[key+"_"+i]!=null){i++}params[key+"_"+i]=value}else{params[key]=value}}}return params},checkRequestShippingDateBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){checkBoxName=checkBoxName+"_"+suffix;divName=divName+"_"+suffix}var checkBox=dojo.byId(checkBoxName);if(checkBox.checked){dojo.byId(divName).style.visibility="visible";dojo.byId(divName).style.display="block"}else{dojo.byId(divName).style.visibility="hidden";dojo.byId(divName).style.display="none";if(this.shipmentTypeId=="1"){dojo.byId("requestedShippingDate").blur()}else{if(this.shipmentTypeId=="2"){dojo.byId("MS_requestedShippingDate_"+suffix).blur()}}}var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value}else{if(this.shipmentTypeId=="2"){addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.")}}if(!checkBox.checked&&this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);if(dijit.byId("requestedShippingDate")!=null||dijit.byId("MS_requestedShippingDate_"+suffix)!=null){this.updateParamObject(params,"requestedShipDate",this.resetRequestedShipDateValue,false,-1)}var orderItemId=null;var qty=-1;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null){qty=document.getElementById("qty_"+(i+1)).value}orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(qty!=-1){if(this.shipmentTypeId=="1"){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""&&orderItemId==suffix){this.updateParamObject(params,"orderItemId",orderItemId,false,-1);break}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.")}}}}if(!submitRequest()){return}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.invoke("OrderItemAddressShipMethodUpdate",params)}},checkShippingInstructionsBox:function(checkBoxName,divName,suffix){var thisCheckBoxName;var thisDivName;if(suffix!=null&&suffix!=""){thisCheckBoxName=checkBoxName+"_"+suffix;thisDivName=divName+"_"+suffix}else{thisCheckBoxName=checkBoxName;thisDivName=divName}var thisCheckBox=dojo.byId(thisCheckBoxName);if(thisCheckBox.checked){dojo.byId(thisDivName).style.visibility="visible";dojo.byId(thisDivName).style.display="block"}else{dojo.byId(thisDivName).style.visibility="hidden";dojo.byId(thisDivName).style.display="none"}var addressId,shipModeId="";if(this.shipmentTypeId=="1"){addressId=document.getElementById("singleShipmentAddress").value;shipModeId=document.getElementById("singleShipmentShippingMode").value}else{if(this.shipmentTypeId=="2"){var orderItemId,tempAddressId,tempShipModeId="";addressId=document.getElementById("MS_ShipmentAddress_"+suffix).value;shipModeId=document.getElementById("MS_ShippingMode_"+suffix).value;var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;tempAddressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;tempShipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(tempShipModeId==shipModeId&&tempAddressId==addressId){var tempDivName=divName+"_"+orderItemId;var tempCheckBoxName=checkBoxName+"_"+orderItemId;if(thisCheckBox.checked){dojo.byId(tempDivName).style.visibility="visible";dojo.byId(tempDivName).style.display="block";dojo.byId(tempCheckBoxName).checked="checked"}else{dojo.byId(tempDivName).style.visibility="hidden";dojo.byId(tempDivName).style.display="none";dojo.byId(tempCheckBoxName).checked=""}}}}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.")}}if(this.isAjaxCheckOut()){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;if(this.shipmentTypeId=="1"){orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"addressId",addressId,false);this.updateParamObject(params,"orderItemId",orderItemId,false)}else{if(this.shipmentTypeId=="2"){if(suffix!=null&&suffix!=""){this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"orderItemId",suffix,false);this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,"")}}else{console.debug("shipmentTypeId is undefined. Single shipment has Id 1; multiple shipment has Id 2.")}}if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)}},initializeShipmentPage:function(shipmentTypeId){this.shipmentTypeId=shipmentTypeId},setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId},deleteFromCart:function(orderItemId,forWishlist){if(!this.isAjaxCheckOut()){return}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=(this.orderId!=null&&this.orderId!="undefined"&&this.orderId!="")?this.orderId:".";params.orderItemId=orderItemId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var x=document.getElementById("totalNumberOfItems").value;var y=x;for(var i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));if(qtyObj!=null||qtyObj!=undefined){qty=qtyObj.value;if(qty!=null&&qty!=undefined&&qty==-1){y=y-1}}}if(!submitRequest()){return}cursor_wait();if(y==1){wc.service.invoke("AjaxDeleteOrderItem1",params)}else{if(forWishlist){wc.service.invoke("AjaxDeleteOrderItemFromCart",params)}else{if(this.shoppingCartPage||this.pendingOrderDetailsPage){wc.service.invoke("AjaxDeleteOrderItem",params)}else{wc.service.invoke("AjaxDeleteOrderItemForShippingBillingPage",params)}}}},addToWishListAndDeleteFromCart:function(catEntryIdentifier,orderItemId){if(!this.isAjaxCheckOut()){return}var params=[];params.catEntryId=catEntryIdentifier;params.URL="SuccessfulAJAXRequest";params.orderItemId=orderItemId;params.updateable=0;params.langId=this.langId;params.storeId=this.storeId;params.catalogId=this.catalogId;if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxInterestItemAddAndDeleteFromCart",params)},updateAddressIdOFItemsOnCreateEditAddress:function(addressId){var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.addressId=addressId;if(this.shipmentTypeId=="1"&&cartVersionA){params.addressId=addressId}else{var orderItemId=null;$(".allOrderItemIds").each(function(){CheckoutHelperJS.updateParamObject(params,"orderItemId",$(this).val(),false,-1)})}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxUpdateOrderItemsAddressId",params)},saveOrderItemsList:function(orderItemId,addressId){if(orderItemId=="-1"){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value}}else{if(orderItemId==0&&this.shipmentTypeId=="1"){if(document.getElementById("singleShipmentAddress")){if(addressId==document.getElementById("singleShipmentAddress").value){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){this.orderItemIds[i]=document.getElementById("orderItem_"+(i+1)).value}}else{this.orderItemIds=[]}}else{this.orderItemIds=[]}return}else{var totalItems=document.getElementById("totalNumberOfItems").value;var temp=null;var orderItemId=null;var j=0;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){temp=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(temp==addressId){this.orderItemIds[j++]=orderItemId}}}}}},setShippingInstuctionsForAllOtherItems:function(addressId,shipModeId,shipInstructions){var orderItemId,addressId1,shipModeId1="";var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){orderItemId=document.getElementById("orderItem_"+(i+1)).value;addressId1=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;shipModeId1=document.getElementById("MS_ShippingMode_"+orderItemId).value;if(shipModeId1==shipModeId&&addressId1==addressId){document.getElementById("MS_shipInstructions_"+orderItemId).value=shipInstructions}}}},shipAsComplete:function(checkBox){if(!this.isAjaxCheckOut()){return}var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"ShipAsComplete","Y",true);orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)},updateAddressIdForOrderItem:function(addressId){if(addressId==null||addressId.length==0){return true}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"addressId",addressId,false);wc.service.invoke("AjaxSetAddressIdOfOrderItems",params)},updateAddressIdForOrderItemCustom:function(addressId,orderItemIdString){if(addressId==null||addressId.length==0){return true}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";if(orderItemIdString!=null){var orderItemsIdList=orderItemIdString.split(",");for(var i=0;i<=orderItemsIdList.length;i++){var x=i+1;params["orderItemId_"+x]=orderItemsIdList[i]}}this.updateParamObject(params,"addressId",addressId,false);wc.service.invoke("AjaxSetAddressIdOfOrderItems",params)},updateAddressIdForOrderItemFornonAjax:function(addressId){if(addressId==null||addressId.length==0){return true}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";params.addressId=addressId;var orderItemId=null;$(".allOrderItemIds").each(function(){CheckoutHelperJS.updateParamObject(params,"orderItemId",$(this).val(),false,-1)});wc.service.invoke("SetAddressIdOfOrderItemsForNonAjax",params)},updateShipModeIdForOrder:function(shipModeId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.shipModeId=shipModeId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";wc.service.invoke("AjaxSetShipModeIdForOrder",params)},applyPromotionCode:function(formName,returnView){var form=document.forms[formName];var promoValue=form.promoCode.value;form.promoCode.value=promoValue.toUpperCase();$("#promoCodeMessage").html("");var pcValid=$(form).valid();if(!pcValid){return}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(form.URL!=null){}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage")}else{if(returnView==null||returnView==""||returnView=="undefined"){if(cartVersionA){returnView="OrderShippingBillingView"}else{returnView="CheckoutSingleShipmentShippingView"}}var input=document.createElement("INPUT");input.setAttribute("type","hidden");input.setAttribute("name","errorViewName");input.setAttribute("value",returnView);form.appendChild(input);form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-3&calculationUsageId=-7&URL="+returnView+"?appliedPromo="+form.promoCode.value;var promoCode=promoValue;document.getElementById("promoCodeNonAjax").value=promoCode;if(!submitRequest()){return}form.submit()}},applyPromotionCodeOnLoad:function(index,formName){this.applingPromoCodeIndex=index;var promoCode=this.appliedPromoCodes[index];var form=document.forms[formName];form.promoCode.value=promoCode.toUpperCase();service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(form.URL!=null){form.URL.value=""}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage")},removePromotionCode:function(formName,promoCode,returnView){var form=document.forms[formName];form.taskType.value="R";form.promoCode.value=promoCode;$("#promoCodeMessage").html("");if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxPromotionCodeManage");service.formId=formName;if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxPromotionCodeManage")}else{if(returnView==null||returnView==""||returnView=="undefined"){if(cartVersionA){returnView="OrderShippingBillingView"}else{returnView="CheckoutSingleShipmentShippingView"}}form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;if(!submitRequest()){return}form.submit()}},applyCoupon:function(formName,returnView,couponId){var form=document.forms[formName];form.setAttribute("action","CouponsAddRemove");form.couponId.value=couponId;form.taskType.value="A";if(!submitRequest()){return}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove")}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit()}},removeCouponFromOrder:function(formName,returnView,couponId){var form=document.forms[formName];form.setAttribute("action","CouponsAddRemove");form.couponId.value=couponId;form.taskType.value="R";if(!submitRequest()){return}if(this.isAjaxCheckOut()){service=wc.service.getServiceById("AjaxCouponsAddRemove");service.formId=formName;cursor_wait();wc.service.invoke("AjaxCouponsAddRemove")}else{form.URL.value="OrderCalculate?updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-7&URL="+returnView;form.submit()}},setAjaxCheckOut:function(ajaxCheckOut){this.ajaxCheckOut=ajaxCheckOut},isAjaxCheckOut:function(){return this.ajaxCheckOut},setSinglePageCheckout:function(singlePageCheckout){this.singlePageCheckout=singlePageCheckout},isSinglePageCheckout:function(){return this.singlePageCheckout},checkoutOrder:function(orderId,userType,addressListForMailNotification,isQuote){if(isQuote==undefined||isQuote==null){isQuote=false}if(this.isOrderPrepared()=="false"){this.saveCheckoutOrderParameters(orderId,userType,addressListForMailNotification,isQuote);wc.service.invoke("AjaxPrepareOrderForSubmit");return}params=[];params.orderId=orderId;params.notifyMerchant=1;params.notifyShopper=1;params.notifyOrderSubmitted=1;params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return}}}params.purchaseorder_id=purchaseOrderNumber;if(userType=="G"){addressListForMailNotification=trim(addressListForMailNotification);var emailList=[];emailList=addressListForMailNotification.split(" ");var uniqueList=[];for(var j=0;j<emailList.length;j++){uniqueList[emailList[j]]=emailList[j]}var totalLength=0;for(i in uniqueList){totalLength=totalLength+1}var temp="";var k=0;for(i in uniqueList){k=k+1;temp=temp+uniqueList[i];if(k<totalLength){temp=temp+","}}params.notify_EMailSender_recipient=temp;var smsOrderNotificationCheckbox=document.getElementById("sendMeSMSNotification");if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){var mobileCountryCode=document.getElementById("mobileCountryCode");var mobilePhone1=document.getElementById("mobilePhone1");if(mobileCountryCode!=null&&mobileCountryCode!="undefined"&&mobilePhone1!=null&&mobilePhone1!="undefined"){params.SMS=mobileCountryCode.value+mobilePhone1.value}}}}if(!submitRequest()){return}cursor_wait();if(!isQuote){wc.service.invoke("AjaxSubmitOrder",params)}else{params.URL="";this.setOrderId(orderId);wc.service.invoke("AjaxSubmitQuote",params)}},prepareOrderSchedule:function(){if(document.getElementById("scheduleOrderInputSection")!=null){var scheduleOrderStartDateObj=dijit.byId("ScheduleOrderStartDate");if(!this.validateDate(scheduleOrderStartDateObj,"ScheduleOrderStartDate")){return}var interval=dojo.byId("ScheduleOrderFrequency").value;var key1="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_strStartDate";var key2="WC_ScheduleOrder_"+document.getElementById("orderIdToSchedule").value+"_interval";if((interval=="undefined")&&(scheduleOrderStartDateObj.value==null)){dojo.cookie(key1,null,{expires:-1});dojo.cookie(key2,null,{expires:-1})}else{var t=dojo.date.stamp.fromISOString(scheduleOrderStartDateObj);var now=new Date();t.setHours(now.getHours(),now.getMinutes(),now.getSeconds(),now.getMilliseconds());t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true});dojo.cookie(key1,t);dojo.cookie(key2,interval)}}},scheduleOrder:function(orderId,isRecurring,userType){if(userType==="G"&&isRecurring){MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_GUEST_USER_SUBMIT_RECURRING_ORDER);return}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=orderId;if(isRecurring!=undefined&&isRecurring==true){params.startDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate");if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="1"){params.fulfillmentInterval="1";params.fulfillmentIntervalUOM="DAY";params.timePeriod="1";params.timePeriodUOM="DAY"}else{if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="2"){params.fulfillmentInterval="1";params.fulfillmentIntervalUOM="DAY"}else{if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="3"){params.fulfillmentInterval="1";params.fulfillmentIntervalUOM="WEE"}else{if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="4"){params.fulfillmentInterval="2";params.fulfillmentIntervalUOM="WEE"}else{if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="5"){params.fulfillmentInterval="3";params.fulfillmentIntervalUOM="WEE"}else{if(dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")=="6"){params.fulfillmentInterval="4";params.fulfillmentIntervalUOM="WEE"}}}}}}}else{params.strStartDate=dojo.cookie("WC_ScheduleOrder_"+orderId+"_strStartDate");params.interval=dojo.cookie("WC_ScheduleOrder_"+orderId+"_interval")}var purchaseOrderForm=document.forms.purchaseOrderNumberInfo;if(purchaseOrderForm){var purchaseOrderNumber=purchaseOrderForm.purchase_order_number.value;if(purchaseOrderForm.purchaseOrderNumberRequired.value=="true"&&purchaseOrderForm.purchase_order_number.value==""){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberEmpty);return}else{if(!MessageHelper.isValidUTF8length(purchaseOrderForm.purchase_order_number.value,128)){MessageHelper.formErrorHandleClient(purchaseOrderForm.purchase_order_number,MessageHelper.messages.ERROR_PONumberTooLong);return}}params.purchaseorder_id=purchaseOrderNumber}if(!submitRequest()){return}cursor_wait();if(isRecurring!=undefined&&isRecurring==true){wc.service.invoke("SubmitRecurringOrder",params)}else{wc.service.invoke("ScheduleOrder",params)}},validateDate:function(dateObj,elementId){var now=new Date();if(dateObj.getValue()!=null&&(dateObj.compare(dateObj.getValue(),now)<0)){if(now.toDateString()===dateObj.getValue().toDateString()){return true}if((elementId!=null)&&(document.getElementById(elementId)!=null)){MessageHelper.formErrorHandleClient(document.getElementById(elementId).id,MessageHelper.messages.PAST_DATE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.PAST_DATE_ERROR)}return false}else{return true}},createAddress:function(orderItemId,addressType){this.saveOrderItemsList(orderItemId,"-1");if(!submitRequest()){return}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});if(cartVersionA){this.showHideDivs("editAddressContents","mainContents")}else{this.showHideDivs("editAddressContents","mainContents");this.showHideDivs("second-heading","first-heading");$(".billing .required-note").hide();$("#editAddressContents").height($(document).height()).show();$("#footer").css("z-index","0")}},showHideDivs:function(showArea,hideArea){if(hideArea){if(document.getElementById(hideArea)){document.getElementById(hideArea).style.display="none"}}if(showArea){if(document.getElementById(showArea)){document.getElementById(showArea).style.display="block"}}},restorePreviousAddressDetails:function(){var valueRestored=false;if(!this.isAjaxCheckOut()){for(i in this.selectedAddressesArray){if(document.getElementById(i)!=null&&document.getElementById(i).value==-1){document.getElementById(i).value=this.selectedAddressesArray[i];valueRestored=true;if(this.shipmentTypeId=="1"){this.displayAddressDetails(document.getElementById("singleShipmentAddress").value,"Shipping")}}}}if(this.isAjaxCheckOut()||!valueRestored){if(this.shipmentTypeId=="2"){for(var i=0;i<this.orderItemIds.length;i++){var orderItemId=this.orderItemIds[i];var element=document.getElementById("MS_ShipmentAddress_"+orderItemId);if(element!=null&&element.value==-1){element.value=document.getElementById("addressId_"+orderItemId).value}}}else{if(this.shipmentTypeId=="1"){var element=document.getElementById("singleShipmentAddress");if(element!=null&&document.getElementById("addressId_all")){if(!this.isAjaxCheckOut()){this.displayAddressDetails(element.value,"Shipping")}}}}}for(var i=1;i<4;i++){if(document.getElementById("PaymentForm"+i)!=null){var paymentForm=document.getElementById("PaymentForm"+i);if(paymentForm.billing_address_id.value==-1){paymentForm.billing_address_id.value=document.getElementById("selectedAddressId_"+i).value;if(!this.isAjaxCheckOut()){CheckoutPayments.displayBillingAddressDetailsWeb10(paymentForm.billing_address_id,i)}}if(wc.render.getContextById("billingAddressDropDownBoxContext").properties["billingAddress"+i]==-1){wc.render.getContextById("billingAddressDropDownBoxContext").properties["billingAddress"+i]=paymentForm.billing_address_id.value}}}},editAddress:function(addressSelectBoxName,orderItemId,profileshipping,profilebilling){var opts=$('select[name="'+addressSelectBoxName+'"]').find("option");opts.each(function(index){if($(this).is(":selected")){$(document).data("currentShippingIndex",index);$(document).data("shippingAddressCount",opts.length)}});globalAddressUpdateIdentifier="editShipping";var addressBox=document.getElementById(addressSelectBoxName);this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressSelectBoxName!=null){MessageHelper.formErrorHandleClient(addressSelectBoxName,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}return}if(!submitRequest()){return}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value});var $container=$("#editAddressContents");if(phoneFields==3&&!cartVersionA){var phone11=$container.find("[name=phone1_1]"),phone12=$container.find("[name=phone1_2]"),phone13=$container.find("[name=phone1_3]");setupPhoneFields(phone11,phone12,phone13)}if(cartVersionA){this.showHideDivs("editAddressContents","mainContents")}else{this.showHideDivs("editAddressContents","mainContents");this.showHideDivs("second-heading","");$(".billing .required-note").hide();this.showHideDivs("","ContinueToBilling");$container.show();$("#footer").css("z-index","0")}editingShippingAddress=(addressSelectBoxName=="singleShipmentAddress")},editBillingAddress:function(orderItemId,paymentArea,profileshipping,profilebilling){var form=document.forms["PaymentForm"+paymentArea];var addressBox=form.billing_address_id;this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressBox!=null){MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}return}if(!submitRequest()){return}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value});if(cartVersionA){this.showHideDivs("editAddressContents","mainContents")}else{$("#editAddressContents").height($(document).height()).show();$("#footer").css("z-index","0")}editingShippingAddress=false},editBillingAddressCustom:function(orderItemId,paymentArea,profileshipping,profilebilling){globalAddressUpdateIdentifier="editBilling";var addressBox=document.getElementById("billing_address_id");this.saveOrderItemsList(orderItemId,addressBox.value);if(addressBox.options[addressBox.selectedIndex].text==profileshipping||addressBox.options[addressBox.selectedIndex].text==profilebilling){if(addressBox!=null){MessageHelper.formErrorHandleClient(addressBox,MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_QUICKCHECKOUT_ADDRESS_CHANGE)}return}if(!submitRequest()){return}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:addressBox.value});if(cartVersionA){this.showHideDivs("editAddressContents","mainContents")}else{this.showHideDivs("editAddressContents","mainContents");this.showHideDivs("second-heading","");$(".billing .required-note").hide();this.showHideDivs("","paymentSection1");$("#editAddressContents").show();$("#footer").css("z-index","0");$("#WC_AccountDisplay_links_3").hide();$("p.right.billing").hide()}editingShippingAddress=false},cancelEditAddress:function(){this.showHideDivs("mainContents","editAddressContents");this.showHideDivs("","second-heading");$(".billing .required-note").show();this.showHideDivs("","third-heading");if(document.getElementById("paymentSection1")){this.showHideDivs("paymentSection1","")}$("#footer").css("z-index","10");this.restorePreviousAddressDetails()},getShipmentTypeId:function(){return this.shipmentTypeId},paymentDataDirty:function(paymentAreaNumber,flag){this.dataDirty[paymentAreaNumber]=flag;console.debug("Information in payment area "+paymentAreaNumber+" has been modified.")},isPaymentDataDirty:function(paymentAreaNumber){return this.dataDirty[paymentAreaNumber]},displayStoreAddressDetails:function(addressSelectBox){var selectedAddressId=addressSelectBox.value;for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block"}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none"}}},updateStoreAddressForAllItems:function(addressSelectBox){if(!this.isAjaxCheckOut()){return}var addressId=addressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";var orderItemId=null;var totalItems=document.getElementById("totalNumberOfItems").value;var addressId=document.getElementById("singleShipmentAddress").value;for(var i=0;i<totalItems;i++){orderItemId=document.getElementById("orderItem_"+(i+1)).value;this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"physicalStoreId",addressId,false,-1)}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params)},updateShippingModeAndAddressForOrderItem:function(shippingModeSelectBox,orderItemId,pickUpInStoreShipMode){if(!this.isAjaxCheckOut()){return}var selectedShippingMode=shippingModeSelectBox.value;if(pickUpInStoreShipMode==selectedShippingMode){document.getElementById("MS_ShipMode_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="nodisplay";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className=""}else{document.getElementById("MS_ShipMode_Section_"+orderItemId).className="";document.getElementById("MS_ShipAdvancedOptions_Section_"+orderItemId).className="";document.getElementById("MS_ShippingAddress_Section_"+orderItemId).className="";document.getElementById("MS_StoreAddress_Section_"+orderItemId).className="nodisplay"}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.shipModeId=selectedShippingMode;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(pickUpInStoreShipMode==selectedShippingMode){var physicalStoreId=document.getElementById("MS_StoreSelectBox_"+orderItemId).value;params.physicalStoreId=physicalStoreId}else{if(document.getElementById("MS_ShipmentAddress_"+orderItemId)){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params.addressId=addressId}}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params)},updateStoreAddressForOrderItem:function(storeAddressSelectBox,orderItemId){if(!this.isAjaxCheckOut()){return}var selectedPickUpStoreId=storeAddressSelectBox.value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.orderItemId=orderItemId;params.physicalStoreId=selectedPickUpStoreId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxUpdateOrderItem",params)},setFieldDirtyFlag:function(value){this.fieldDirtyFlag=value},getFieldDirtyFlag:function(){return this.fieldDirtyFlag},checkForDirtyFlag:function(){if(this.getFieldDirtyFlag()){if(document.getElementById("ShoppingCart_NonAjaxUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("ShoppingCart_NonAjaxUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST_SHOPPING_CART);return true}else{if(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("MultipleShipment_NonAjaxShipInfoUpdate"),MessageHelper.messages.ERROR_UPDATE_FIRST);return true}else{if(document.getElementById("SingleShipment_NonAjaxShipInfoUpdate")!=null){$(".update-error").show();return true}else{MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_UPDATE_FIRST);return true}}}}return false},showHideCheckoutSMS:function(checkboxElementId,smsElementId){var smsOrderNotificationCheckbox=document.getElementById(checkboxElementId);if(smsOrderNotificationCheckbox!=null&&smsOrderNotificationCheckbox!="undefined"){if(smsOrderNotificationCheckbox.checked){showElementById(smsElementId)}else{hideElementById(smsElementId)}}},getCountryArray:function(){if(document.countries==null){countries=new Array();var theDiv=document.getElementById("countryListSelectionHelper");if(typeof theDiv=="undefined"){return null}var divJSON=eval("("+theDiv.innerHTML+")");var countriesObject=divJSON.countries;for(var i=0;i<countriesObject.length;i++){var countryObject=countriesObject[i];countries[countryObject.code]=new Object();countries[countryObject.code].name=countryObject.displayName;countries[countryObject.code].countryCallingCode=countryObject.callingCode;if(countryObject.states.length>0){countries[countryObject.code].states=new Object();for(var j=0;j<countryObject.states.length;j++){var state=countryObject.states[j];countries[countryObject.code].states[state.code]=state.displayName}}}}return countries},loadCountryCode:function(countryDropDownId,countryCallingCodeId){this.getCountryArray();var countryCode=document.getElementById(countryDropDownId).value;document.getElementById(countryCallingCodeId).value=countries[countryCode].countryCallingCode},expediteShipping:function(checkBox,inputOrderItemId){if(!this.isAjaxCheckOut()){return}var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;if(checkBox.checked){this.updateParamObject(params,"isExpedited","Y",true)}else{this.updateParamObject(params,"isExpedited","N",true)}if(inputOrderItemId!=null){this.updateParamObject(params,"orderItemId",inputOrderItemId,false)}if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)},updateCartWait:function(quantityBox,orderItemId,event){if(event.keyCode==dojo.keys.TAB){return}if(!this.isAjaxCheckOut()){return}if(this.keyPressCount[orderItemId]==null&&isNaN(this.keyPressCount[orderItemId])){this.keyPressCount[orderItemId]=0}this.keyPressCount[orderItemId]=parseInt(this.keyPressCount[orderItemId])+1;setTimeout(dojo.hitch(this,"updateCart",quantityBox,orderItemId,this.keyPressCount[orderItemId]),this.updateWaitTimeOut)},updateCart:function(quantityBox,orderItemId,keyPressCountValue){if(keyPressCountValue<this.keyPressCount[orderItemId]){return}var quantity=(quantityBox.value);if(!isNonNegativeInteger(quantity)){MessageHelper.formErrorHandleClient(quantityBox,MessageHelper.messages.QUANTITY_INPUT_ERROR)}else{var params=[];params.orderId=".";params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"quantity",quantity,false,-1);if(!submitRequest()){return}cursor_wait();if(quantity==0){var x=document.getElementById("totalNumberOfItems").value;var y=x;for(var i=0;i<x;i++){var qtyObj=document.getElementById("freeGift_qty_"+(i+1));if(qtyObj!=null||qtyObj!=undefined){qty=qtyObj.value;if(qty!=null&&qty!=undefined&&qty==-1){y=y-1}}}if(y==1){wc.service.invoke("AjaxUpdateOrderItem1",params)}else{wc.service.invoke("AjaxUpdateOrderItem",params)}}else{wc.service.invoke("AjaxUpdateOrderItem",params)}}},initDojoEventListenerShoppingCartPage:function(){if(document.getElementById("totalNumberOfItems")!=null){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){for(var i=0;i<totalItems;i++){var object=dojo.byId("quantity_"+(i+1));if(object!=null){dojo.connect(object,"onchange",setDirtyFlag)}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return}}},updateShoppingCart:function(form,validateQuantityOnly){if(validateQuantityOnly!=undefined&&validateQuantityOnly==true&&!this.isAjaxCheckOut()){return true}MessageHelper.hideAndClearMessage();var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null){for(var i=0;i<totalItems;i++){var quantity=null;if(form!=undefined){quantity=form["quantity_"+(i+1)]}else{if(dojo.byId("qty_"+(i+1))!=null){quantity=dojo.byId("qty_"+(i+1))}}if(quantity!=null||quantity!=undefined){var v=quantity.value;if(!isNonNegativeInteger(v)){MessageHelper.formErrorHandleClient(quantity.id,MessageHelper.messages.QUANTITY_INPUT_ERROR);return}}}if(validateQuantityOnly!=undefined&&validateQuantityOnly==true){return true}if(!submitRequest()){return}var beginIndex=wc.render.getContextById("ShopCartPaginationDisplay_Context").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0}form.URL.value=form.URL.value+"&beginIndex="+beginIndex;form.submit();this.setFieldDirtyFlag(false)}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return}},canCheckoutContinue:function(userType){if(document.getElementById("recurringOrder")&&document.getElementById("recurringOrder").checked&&document.getElementById("shipTypeOnline")&&document.getElementById("shipTypeOnline").checked){if(document.getElementById("nonRecurringOrderItems")&&document.getElementById("nonRecurringOrderItems").value!=""){MessageHelper.displayErrorMessage(MessageHelper.messages.RECURRINGORDER_ERROR);return false}else{if(userType!=undefined&&userType==="G"){MessageHelper.displayErrorMessage(MessageHelper.messages.ERROR_GUEST_USER_SUBMIT_RECURRING_ORDER);return false}}}return true},updateCartWithQuickCheckoutProfile:function(quickOrderId){var params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.toOrderId=".";params.shippingAddressFromOrderProfile="1";params.shippingModeFromOrderProfile="1";params.URL="dummy";params.payInfoFrom=quickOrderId;wc.service.declare({id:"QuickCheckOutOrderCopy",actionId:"QuickCheckOutOrderCopy",url:"AjaxOrderCopy",successHandler:function(serviceResponse){cursor_clear();var returnView;if(cartVersionA){returnView="OrderShippingBillingView"}else{returnView="CheckoutBillingView"}document.location.href="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL="+returnView+"?langId="+CheckoutHelperJS.langId+"&storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&quickCheckoutProfileForPayment=true"},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){MessageHelper.displayErrorMessage(serviceResponse.errorMessage)}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey)}}cursor_clear()}});if(!submitRequest()){return}cursor_wait();wc.service.invoke("QuickCheckOutOrderCopy",params)},addNewShippingAddress:function(addressType){globalAddressUpdateIdentifier="createShipping";this.displayAddressDetails(-1,addressType)},updateAddressForAllItems:function(addressSelectBox){globalAddressUpdateIdentifier="updateAddressAllItems";if(addressSelectBox.value!=-1){this.selectedAddressesArray[addressSelectBox.name]=addressSelectBox.value}if(!this.isAjaxCheckOut()){return}var addressId=addressSelectBox.value;if(addressId==-1){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=document.getElementById("singleShipmentAddress").value;params.addressId=addressId;if(typeof updateGiftRegistrantAddressForItemsExt!="undefined"&&typeof updateGiftRegistrantAddressForItemsExt!=null){}var enabledShipInstructions=false;var shipInstructions;if(document.getElementById("shipInstructions")!=null){shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions=""}enabledShipInstructions=true}if(!submitRequest()){return}cursor_wait();if(!enabledShipInstructions||shipInstructions==undefined||shipInstructions==""){wc.service.invoke("OrderItemAddressShipMethodUpdate",params)}else{wc.service.invoke("OrderItemAddressShipInstructionsUpdate",params)}},updateShipModeForAllItems:function(shipmentSelectBox){var shipModeId=shipmentSelectBox.value;if(shipModeId==-1){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"shipModeId",shipModeId,false);if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},updateShipModeForAllItemsIgnoreGiftWrap:function(shipmentSelectBox){var shipModeId=shipmentSelectBox.value;if(shipModeId==-1){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"shipModeId",shipModeId,false);params.ignoreGiftCardCheck=(cartVersionA)?false:true;if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},updateShippingInstructionsForAllItems:function(){if(!this.isAjaxCheckOut()){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";var orderItemId=null;var shipInstructions="";if(document.getElementById("shipInstructions")!=null){shipInstructions=document.getElementById("shipInstructions").value}reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions=""}if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);this.updateParamObject(params,"shipInstructions",shipInstructions,false);cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)},updateShippingInstructionsForAllItemsForNonAjax:function(){params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";if($("#shipInstructions").length>0){var shipInstructions=document.getElementById("shipInstructions").value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions=""}if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}this.updateParamObject(params,"shipInstructions",shipInstructions,false)}var orderItemId=document.getElementById("orderItem_1").value;this.updateParamObject(params,"orderItemId",orderItemId,false);cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)},updateShippingChargeForShipModeAjax:function(curOrderId,shipModeId,shipChargeType,shipAcctNum){if(!this.isAjaxCheckOut()){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=curOrderId;params.URL="";params.shipModeId=shipModeId;params.shipChargTypeId=shipChargeType;if(shipAcctNum!=null&&shipAcctNum!=undefined){params.shipCarrAccntNum=shipAcctNum}else{params.shipCarrAccntNum=""}if(!submitRequest()){return}cursor_wait();wc.service.invoke("AjaxOrderShipChargeUpdate",params)},updateShippingChargeForShipMode:function(myForm){if(this.isAjaxCheckOut()){return}var returnUrl;if(cartVersionA){returnUrl="OrderShippingBillingView"}else{returnUrl="CheckoutSingleShipmentShippingView"}myForm.URL.value="OrderProcessServiceOrderPrepare?storeId="+CheckoutHelperJS.storeId+"&catalogId="+CheckoutHelperJS.catalogId+"&langId="+CheckoutHelperJS.langId+"&orderId=.&URL="+returnUrl+"?forceShipmentType=2";myForm.submit()},hideShipChargeAccountField:function(selectValue,acctFieldId){if(document.getElementById(selectValue).value.indexOf("ByCarrier")>-1){document.getElementById(acctFieldId).style.display="block"}else{document.getElementById(acctFieldId).style.display="none"}},updateRequestedShipDate:function(jsDate){if(jsDate==null||jsDate.getDisplayedValue()==null){return}var now=new Date();var checkbox=dojo.byId("requestShippingDateCheckbox");if(checkbox.checked&&jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}return}if(!this.isAjaxCheckOut()){return}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true})}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue}}jsDate._close();this.updateShippingDateForAllItems(t)},updateShippingDateForAllItems:function(date){params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";this.updateParamObject(params,"requestedShipDate",date,false);if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},displayAddressDetails:function(addressSelectBoxValue,addressType){if(!this.isAjaxCheckOut()){this.displayAddressDetailsWeb10(addressSelectBoxValue,addressType)}else{if(addressSelectBoxValue!=-1){if(!submitRequest()){return}var checkForOpera=true;cursor_wait(checkForOpera);wc.render.updateContext("shippingAddressContext",{shippingAddress:addressSelectBoxValue})}else{this.createAddress(-1,addressType)}}},displayAddressDetailsWeb10:function(addressSelectBoxValue,addressType){var selectedAddressId=addressSelectBoxValue;var addressSelectBox=dojo.byId("singleShipmentAddress");if(cartVersionA){for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block"}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none"}}}else{if(selectedAddressId!=-1){$(".shipping_address_content .shipAddress").css("display","none");for(j=0;j<addressSelectBox.options.length;j++){if(addressSelectBox.options[j].value==selectedAddressId){dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="block"}else{dojo.byId("addressDetails_"+addressSelectBox.options[j].value).style.display="none"}}}}if(selectedAddressId==-1){this.createAddress(-1,addressType)}},initDojoEventListenerSingleShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){if(dojo.byId("singleShipmentAddress")!=null){dojo.connect(dojo.byId("singleShipmentAddress"),"onchange",setDirtyFlag)}if(dojo.byId("WC_ShippingAddressSelectSingle_div_2")!=null){dojo.connect(dojo.byId("WC_ShippingAddressSelectSingle_div_2"),"onclick",setDirtyFlag)}if(dojo.byId("singleShipmentShippingMode")!=null){dojo.connect(dojo.byId("singleShipmentShippingMode"),"onchange",setDirtyFlag)}if(dojo.byId("shippingInstructionsCheckbox")!=null){dojo.connect(dojo.byId("shippingInstructionsCheckbox"),"onclick",setDirtyFlag)}if(dojo.byId("requestShippingDateCheckbox")!=null){dojo.connect(dojo.byId("requestShippingDateCheckbox"),"onclick",setDirtyFlag)}if(dojo.byId("shipInstructions")!=null){dojo.connect(dojo.byId("shipInstructions"),"onchange",setDirtyFlag)}if(dojo.byId("expediteShipping")!=null){dojo.connect(dojo.byId("expediteShipping"),"onchange",setDirtyFlag)}if(dojo.byId("giftMessageTo")!=null){dojo.connect(dojo.byId("giftMessageTo"),"onchange",setDirtyFlag)}if(dojo.byId("giftMessageFrom")!=null){dojo.connect(dojo.byId("giftMessageFrom"),"onchange",setDirtyFlag)}if(dojo.byId("giftMessage")!=null){dojo.connect(dojo.byId("giftMessage"),"onchange",setDirtyFlag)}if(dojo.query(".giftWrapped")!=null){$(".giftWrapped").change(setDirtyFlag)}if(dojo.byId("expediteShipping_1")!=null){for(var i=0;i<totalItems;i++){if(dojo.byId("qty_"+(i+1))!=null&&dojo.byId("qty_"+(i+1)).value!="-1"){var object=dojo.byId("expediteShipping_"+(i+1));dojo.connect(object,"onchange",setDirtyFlag)}}}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return}},updateSingleShipmentShoppingCart:function(form){var formAction="OrderChangeServiceShipInfoUpdate?";var nextUrl="OrderShippingBillingView";var instructions=null;var t=null;if(dojo.byId("shippingInstructionsCheckbox")!=null){if(dojo.byId("shippingInstructionsCheckbox").checked){if(document.getElementById("shipInstructions")!=null&&document.getElementById("shipInstructions").value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("shipInstructions").value,4000)){instructions=document.getElementById("shipInstructions").value}else{MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}}}else{if(document.getElementById("shipInstructions")!=null){instructions=""}}}if(dojo.byId("requestShippingDateCheckbox")!=null){var jsDateObj=dijit.byId("requestedShippingDate");if(dojo.byId("requestShippingDateCheckbox").checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}return}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true})}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue}}}if(document.getElementById("singleShipmentAddress")&&document.getElementById("singleShipmentAddress").value!=-1){formAction+="addressId="+document.getElementById("singleShipmentAddress").value}else{MessageHelper.formErrorHandleClient(document.getElementById("singleShipmentAddress").id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return}if($("#giftMessageArea").is(":visible")&&!$("#giftForm").valid()){return}formAction=formAction+"&shipModeId="+document.getElementById("singleShipmentShippingMode").value;if(this.shipChargeEnabled){formAction=formAction+"&shippingChargeType="+document.getElementById("shipChargTypeId_1").value;formAction=formAction+"&shipCarrAccntNum="+document.getElementById("shipCarrAccntNum_1").value}var shipInstructions="";if(instructions!=null){shipInstructions="shipInstructions="+instructions+"&orderItemId_1="+document.getElementById("orderItem_1").value}if(t!=null){formAction=formAction+"&requestedShipDate="+t}formAction=formAction+"&ShipAsComplete=Y";if($("#giftMessageArea").is(":visible")){this.trimGiftMessage();$("#giftForm :input").each(function(index,element){formAction+="&"+$(element).attr("name")+"="+encodeURIComponent($(element).val())})}$(".orderItemIds").each(function(index,element){formAction+="&"+$(element).attr("name")+"="+encodeURIComponent($(element).val())});$("input.giftWrapped").each(function(index,element){var value="";if($(element).is(":checked")){value=$(element).val()}formAction+="&"+$(element).attr("name")+"="+encodeURIComponent(value)});if(document.getElementById("expediteShipping_1")!=null){var totalNumberOfItemsOnPage=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalNumberOfItemsOnPage;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!="-1"){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId}var object=document.getElementById("expediteShipping_"+(i+1));if(object.checked){document.getElementById("isExpedited_"+(i+1)).value="Y"}else{document.getElementById("isExpedited_"+(i+1)).value="N"}}}}var beginIndex=wc.render.getContextById("traditionalShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0}var updateUrl="OrderShippingBillingView";formAction+="&requestedShipDate*=&shipModeId*=&orderItemId*=&"+shipInstructions+"&allocate=***&backorder=***&remerge=***&check=*n&URL="+updateUrl+"?&beginIndex="+beginIndex;form.action=formAction;form.URL.value=nextUrl;if(!submitRequest()){return}form.submit()},updateSingleShipmentShoppingCartRedesign:function(form,newAddress,updateAddress,addressForm,stateDivName){var formAction="OrderChangeServiceShipInfoUpdate?";var nextUrl="CheckoutBillingView";var instructions=null;var t=null;if(document.getElementById("shipInstructions")!=null&&document.getElementById("shipInstructions").value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("shipInstructions").value,4000)){instructions=document.getElementById("shipInstructions").value}else{MessageHelper.formErrorHandleClient(document.getElementById("shipInstructions").id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}}else{instructions=""}if(dojo.byId("requestShippingDateCheckbox")!=null){var jsDateObj=dijit.byId("requestedShippingDate");if(dojo.byId("requestShippingDateCheckbox").checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("requestedShippingDate")!=null){MessageHelper.formErrorHandleClient(document.getElementById("requestedShippingDate").id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}return}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true})}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue}}}var updatedAddressId="";if(newAddress){var async=false;cursor_wait();AddressHelper.saveUnregisteredCheckoutAddressForNew(addressForm,stateDivName,async);requestSubmitted=false;if(document.getElementById("newShippingAddressId")&&document.getElementById("newShippingAddressId").value!=-1){formAction+="addressId="+document.getElementById("newShippingAddressId").value;updatedAddressId=document.getElementById("newShippingAddressId").value}else{return false}}else{if(updateAddress){var async=false;cursor_wait();AddressHelper.saveAddress("AjaxUpdateAddressForPersonCartB",addressForm,async);requestSubmitted=false;if(document.getElementById("newShippingAddressId")&&document.getElementById("newShippingAddressId").value!=-1){formAction+="addressId="+document.getElementById("newShippingAddressId").value;updatedAddressId=document.getElementById("newShippingAddressId").value}else{return false}}else{formAction+="addressId="+document.getElementById("singleShipmentAddress").value;updatedAddressId=document.getElementById("singleShipmentAddress").value}}formAction=formAction+"&shipModeId="+document.getElementById("singleShipmentShippingMode").value;if(this.shipChargeEnabled){formAction=formAction+"&shippingChargeType="+document.getElementById("shipChargTypeId_1").value;formAction=formAction+"&shipCarrAccntNum="+document.getElementById("shipCarrAccntNum_1").value}var shipInstructions="";if(instructions!=null){shipInstructions="shipInstructions="+instructions+"&orderItemId_1="+document.getElementById("orderItem_1").value}if(t!=null){formAction=formAction+"&requestedShipDate="+t}formAction=formAction+"&ShipAsComplete=Y";if($("#giftMessageArea").is(":visible")){this.trimGiftMessage();$("#giftForm :input").each(function(index,element){formAction+="&"+$(element).attr("name")+"="+encodeURIComponent($(element).val())})}$(".orderItemIds").each(function(index,element){formAction+="&"+$(element).attr("name")+"="+encodeURIComponent($(element).val())});$("input.giftWrapped").each(function(index,element){var value="";if($(element).is(":checked")){value=$(element).val()}formAction+="&"+$(element).attr("name")+"="+encodeURIComponent(value)});if(document.getElementById("expediteShipping_1")!=null){var totalNumberOfItemsOnPage=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalNumberOfItemsOnPage;i++){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!="-1"){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId}var object=document.getElementById("expediteShipping_"+(i+1));if(object.checked){document.getElementById("isExpedited_"+(i+1)).value="Y"}else{document.getElementById("isExpedited_"+(i+1)).value="N"}}}}if(document.getElementById("deliverySignatureCheckBoxObj")!=null){var deliverSignatureCheckBoxObj=document.getElementById("deliverySignatureCheckBoxObj");if($(deliverSignatureCheckBoxObj).is(":checked")){$("#deliverSignature_pAttrValue_0").val("true");$("#deliverySignature").val("true")}else{$("#deliverSignature_pAttrValue_0").val("false");$("#deliverySignature").val("false")}}var beginIndex=wc.render.getContextById("traditionalShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0}var updateUrl="CheckoutBillingView";formAction+="&requestedShipDate*=&shipModeId*=&orderItemId*=&"+shipInstructions+"&allocate=***&backorder=***&remerge=***&check=*n&URL="+updateUrl+"?&beginIndex="+beginIndex;form.action=formAction;form.URL.value=nextUrl;cursor_wait();this.updateAddressIdForOrderItemFornonAjax(updatedAddressId)},trimGiftMessage:function(e){var length=(giftMessageLength!="undefined")?giftMessageLength:150,$message=$("#giftMessage"),tval=$message.val(),tlength=tval.length,remain=parseInt(length-tlength);if(remain<=0&&e.which!==0&&e.charCode!==0){$message.val((tval).substring(0,tlength-1))}},moveAllItemsToSingleShipment:function(){var orderItemId=document.getElementById("orderItem_1").value;var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";if(addressId==-3){var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=2;i<=totalItems;i++){if(document.getElementById("orderItem_"+i)!=null&&document.getElementById("orderItem_"+i)!="undefined"){var giftOrderItemId=document.getElementById("orderItem_"+i).value;var validAddressId=document.getElementById("MS_ShipmentAddress_"+giftOrderItemId).value;if(validAddressId!=-3){this.updateParamObject(params,"addressId",validAddressId,false);break}}else{break}}}else{this.updateParamObject(params,"addressId",addressId,false)}if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate1",params)},addNewShippingAddressForMS:function(orderItemId){this.updateAddressIdForThisItem(-1,orderItemId);this.orderItemIds.push(orderItemId)},updateAddressIdForThisItem:function(addressBoxValue,orderItemId){if(addressBoxValue!=-1){var addressBox=dojo.byId("MS_ShipmentAddress_"+orderItemId);this.selectedAddressesArray[addressBox.name]=addressBoxValue}if(addressBoxValue==-1){return}if(!this.isAjaxCheckOut()){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";var addressId=addressBoxValue;this.updateParamObject(params,"shipToRegistrant","0",false,-1);this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"orderItemId",orderItemId,false,-1);if(typeof updateGiftRegistrantAddressForThisItemExt!="undefined"&&typeof updateGiftRegistrantAddressForThisItemExt!=null){params=updateGiftRegistrantAddressForThisItemExt(params,addressId)}if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},updateShipModeForThisItem:function(shipModeBox,orderItemId){var shipModeId=shipModeBox.value;if(shipModeId==-1){return}if(!this.isAjaxCheckOut()){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},updateShippingInstructionsForThisItem:function(textArea,orderItemId){var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;var shipInstructions=textArea.value;reWhiteSpace=new RegExp(/^\s+$/);if(reWhiteSpace.test(shipInstructions)){shipInstructions=""}if(this.isAjaxCheckOut()){if(!MessageHelper.isValidUTF8length(shipInstructions,4000)){MessageHelper.formErrorHandleClient(textArea.id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}}this.setShippingInstuctionsForAllOtherItems(addressId,shipModeId,shipInstructions);if(!this.isAjaxCheckOut()){return}params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";this.updateParamObject(params,"addressId",addressId,false,-1);this.updateParamObject(params,"shipModeId",shipModeId,false,-1);this.updateParamObject(params,"shipInstructions",shipInstructions,false,-1);this.updateParamObject(params,"orderItemId",orderItemId,false,-1);if(!submitRequest()){return}cursor_wait();wc.service.invoke("OrderShippingInfoUpdate",params)},updateRequestedShipDateForThisItem:function(jsDate,orderItemId){if(jsDate==null||jsDate.getDisplayedValue()==null){return}var now=new Date();var checkbox=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(checkbox.checked&&jsDate.compare(jsDate.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}return}if(!this.isAjaxCheckOut()){return}var t="";if(jsDate.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDate);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true})}else{if(jsDate.getDisplayedValue()==""){t=this.resetRequestedShipDateValue}}jsDate._close();var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;var shipModeId=document.getElementById("MS_ShippingMode_"+orderItemId).value;params=[];params.storeId=this.storeId;params.catalogId=this.catalogId;params.langId=this.langId;params.orderId=".";this.updateParamObject(params,"orderItemId",orderItemId,false,-1);this.updateParamObject(params,"requestedShipDate",t,false,-1);params.calculationUsage="-1,-2,-3,-4,-5,-6,-7";params.allocate="***";params.backorder="***";params.remerge="***";params.check="*n";if(!submitRequest()){return}cursor_wait();CheckoutHelperJS.RequestShippingDateAction=true;wc.service.invoke("OrderItemAddressShipMethodUpdate",params)},createAddressForMS:function(orderItemId,addressType){if(!submitRequest()){return}cursor_wait();wc.render.updateContext("editShippingAddressContext",{shippingAddress:"-1",addressType:addressType});if(cartVersionA){this.showHideDivs("editAddressContents","mainContents")}else{$("#editAddressContents").height($(document).height()).show();$("#footer").css("z-index","0")}},displayAddressDetailsForMSHelper:function(orderItemId,addressType){this.displayAddressDetailsForMS(-1,orderItemId,addressType)},displayAddressDetailsForMS:function(addressSelectBoxValue,orderItemId,addressType){if(this.isAjaxCheckOut()){if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType)}}else{if(addressSelectBoxValue==-1){this.createAddressForMS(orderItemId,addressType)}else{dojo.byId("MS_shippingAddressDisplayArea_"+orderItemId).innerHTML=dojo.byId("addressDetails_"+addressSelectBoxValue).innerHTML}}},initDojoEventListenerMultiShipmentPage:function(){var totalItems=document.getElementById("totalNumberOfItems").value;if(totalItems!=null&&totalItems>0){var list_clickable=new dojox.collections.ArrayList([]);var list_editable=new dojox.collections.ArrayList([]);for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;var object="";if(orderItemId!=null){object=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object)}object=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(object!=null){list_clickable.add(object)}object=dojo.byId("editAddressButton");if(object!=null){list_clickable.add(object)}object=dojo.byId("MS_expediteShipping_"+orderItemId);if(object!=null){list_clickable.add(object)}object=dojo.byId("MS_ShipmentAddress_"+orderItemId);if(object!=null){list_editable.add(object)}object=dojo.byId("MS_ShippingMode_"+orderItemId);if(object!=null){list_editable.add(object)}object=dojo.byId("MS_shipInstructions_"+orderItemId);if(object!=null){list_editable.add(object)}object=dojo.byId("qty_"+(i+1));if(object!=null){list_editable.add(object)}}else{var j=i+1;console.debug("error: element 'orderItem_'"+j+" was expected but undefined.")}}for(var i=0;i<list_clickable.count;i++){var item=list_clickable.item(i);dojo.connect(item,"onclick",setDirtyFlag)}for(var i=0;i<list_editable.count;i++){var item=list_editable.item(i);dojo.connect(item,"onchange",setDirtyFlag)}}else{console.debug("error: element 'totalNumberOfItems' was expected but undefined.");return}},updateMultiShipmentShoppingCart:function(form){var updateShippingAction="OrderChangeServiceShipInfoUpdate";var updateShippingURL;if(cartVersionA){updateShippingURL="OrderShippingBillingView?"}else{updateShippingURL="CheckoutSingleShipmentShippingView?"}var totalItems=document.getElementById("totalNumberOfItems").value;for(var i=0;i<totalItems;i++){var orderItemId=document.getElementById("orderItem_"+(i+1)).value;if(document.getElementById("orderItemId_"+(i+1))!=null){document.getElementById("orderItemId_"+(i+1)).value=orderItemId}var addressId=document.getElementById("MS_ShipmentAddress_"+orderItemId).value;if(addressId!=-1){if(document.getElementById("addressId_"+(i+1))!=null){document.getElementById("addressId_"+(i+1)).value=addressId}}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_ShipmentAddress_"+orderItemId).id,MessageHelper.messages.SHIPPING_INVALID_ADDRESS);return}if(form.elements["shipModeId_"+(i+1)]!=null){form.elements["shipModeId_"+(i+1)].value=document.getElementById("MS_ShippingMode_"+orderItemId).value}var instructions=null;var t=null;var shippingInstructionsCheckbox=dojo.byId("MS_shippingInstructionsCheckbox_"+orderItemId);if(shippingInstructionsCheckbox!=null){if(shippingInstructionsCheckbox.checked){if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null&&document.getElementById("MS_shipInstructions_"+orderItemId).value!=null){if(MessageHelper.isValidUTF8length(document.getElementById("MS_shipInstructions_"+orderItemId).value,4000)){instructions=document.getElementById("MS_shipInstructions_"+orderItemId).value}else{MessageHelper.formErrorHandleClient(document.getElementById("MS_shipInstructions_"+orderItemId).id,MessageHelper.messages.ERROR_ShippingInstructions_TooLong);return}}}else{if(document.getElementById("MS_shipInstructions_"+orderItemId)!=null){instructions=""}}}var requestShippingDateCheckbox=dojo.byId("MS_requestShippingDateCheckbox_"+orderItemId);if(requestShippingDateCheckbox!=null){t=this.resetRequestedShipDateValue;var jsDateObj=dijit.byId("MS_requestedShippingDate_"+orderItemId);if(requestShippingDateCheckbox.checked){if(jsDateObj!=null&&jsDateObj.getDisplayedValue()!=null){var now=new Date();if(jsDateObj.compare(jsDateObj.getValue(),now)<=0){if(document.getElementById("MS_requestedShippingDate_"+orderItemId)!=null){MessageHelper.formErrorHandleClient(document.getElementById("MS_requestedShippingDate_"+orderItemId).id,MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}else{MessageHelper.displayErrorMessage(MessageHelper.messages.REQUESTED_SHIPPING_DATE_OUT_OF_RANGE_ERROR)}return}var t="";if(jsDateObj.getDisplayedValue()!=""){t=dojo.date.stamp.fromISOString(jsDateObj);t.setHours(12);t=dojo.date.stamp.toISOString(t,{selector:"%Y-%m-%dT%H:%m:%S.%SZ",zulu:true,milliseconds:true})}else{if(jsDateObj.getDisplayedValue()==""){t=this.resetRequestedShipDateValue}}}}else{if(jsDateObj!=null){t=this.resetRequestedShipDateValue}}}if(instructions!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("shipInstructions_"+(i+1))!=null){document.getElementById("shipInstructions_"+(i+1)).value=instructions}}}if(t!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("requestedShipDate_"+(i+1))!=null){document.getElementById("requestedShipDate_"+(i+1)).value=t}}}if(document.getElementById("MS_expediteShipping_"+orderItemId)!=null&&document.getElementById("isExpedited_"+(i+1))!=null){if(document.getElementById("qty_"+(i+1))!=null&&document.getElementById("qty_"+(i+1)).value!=-1){if(document.getElementById("MS_expediteShipping_"+orderItemId).checked){document.getElementById("isExpedited_"+(i+1)).value="Y"}else{document.getElementById("isExpedited_"+(i+1)).value="N"}}}}document.getElementById("ShipAsComplete").value="Y";updateShippingURL=updateShippingURL+"orderItemId*=";updateShippingURL=updateShippingURL+"&quantity*=";updateShippingURL=updateShippingURL+"&addressId*=";updateShippingURL=updateShippingURL+"&shipModeId*=";updateShippingURL=updateShippingURL+"&shipInstructions*=";updateShippingURL=updateShippingURL+"&requestedShipDate*=";updateShippingURL=updateShippingURL+"&isExpedited*=";updateShippingURL=updateShippingURL+"&ShipAsComplete*=";updateShippingURL=updateShippingURL+"&orderItem*=";updateShippingURL=updateShippingURL+"&MS_ShipmentAddress*=";updateShippingURL=updateShippingURL+"&MS_ShippingMode*=";updateShippingURL=updateShippingURL+"&MS_shippingInstructionsCheckbox*=";updateShippingURL=updateShippingURL+"&MS_shipInstructions*=";updateShippingURL=updateShippingURL+"&MS_requestShippingDateCheckbox*=";updateShippingURL=updateShippingURL+"&MS_requestedShippingDate*=";updateShippingURL=updateShippingURL+"&MS_expediteShipping*=";updateShippingURL=updateShippingURL+"&qty*=";updateShippingURL=updateShippingURL+"&shipAsComplete*=";var beginIndex=wc.render.getContextById("multipleShipmentDetailsContext").properties.beginIndex;if(beginIndex==null||beginIndex==""){beginIndex=0}updateShippingURL=updateShippingURL+"&beginIndex="+beginIndex;form.action=updateShippingAction;form.URL.value=updateShippingURL;if(!submitRequest()){return}form.submit()},showHideEditAddressLink:function(addressSelectBox,orderItemId){if(addressSelectBox.value=="-3"){if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){dojo.byId("editAddressLink_"+orderItemId).style.display="none"}return}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editAddressLink_"+orderItemId).style.display="none";break}else{dojo.byId("editAddressLink_"+orderItemId).style.display="block"}}}}else{if(dojo.byId("editAddressLink_"+orderItemId)!=null&&dojo.byId("editAddressLink_"+orderItemId)!="undefined"){dojo.byId("editAddressLink_"+orderItemId).style.display="block"}}},showHideEditBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break}else{dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block"}}}}else{if(dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("editBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none"}}},setOrderId:function(orderId){this.orderId=orderId},getOrderId:function(){return this.orderId},showHideCreateBillingAddressLink:function(addressSelectBox,orderItemId,paymentAreaNumber){if(addressSelectBox.value=="-2"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";return}var orgAddressList=document.getElementById("shippingOrganizationAddressList");if(orgAddressList){var orgAddressArray=[];orgAddressArray=orgAddressList.value.toString().split(",");for(var i=0;i<orgAddressArray.length;i++){if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){if(addressSelectBox.value==orgAddressArray[i]){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none";break}else{dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="block"}}}}else{if(dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!=null&&dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId)!="undefined"){dojo.byId("createBillingAddressLink"+paymentAreaNumber+"_"+orderItemId).style.display="none"}}},getShippingMode:function(selectBox){if(dojo.isString(selectBox)){selectBox=dojo.byId(selectBox)}var option=null;for(var i=0;i<selectBox.options.length;i++){if(selectBox[i].selected){option=selectBox[i]}}if(option){return{id:option.value,code:option.getAttribute("shipModeCode"),description:option.text}}},callOrderItemUpdate:function(newPageLink,qtyId,statuscount){if(dojo.byId(qtyId).value==""){return}if(!submitRequest()){return}newPageLink+="&quantity="+dojo.byId(qtyId).value;if(window.utag_data){var originalQty_id="original_qty_"+statuscount;var originalqty=dojo.byId(originalQty_id).value;var updatedqty=dojo.byId(qtyId).value;var productid=[utag_data.product_id[statuscount-1]];var unit_price=[utag_data.product_unit_price[statuscount-1]];var qty=updatedqty-originalqty+"";var quantity=[qty];if(window.utag){if(updatedqty<originalqty){utagLinkSafe({link_name:"cartRemove",product_id:productid})}if(updatedqty>originalqty){utagLinkSafe({link_name:"cartAdd",product_id:productid,product_quantity:quantity,product_list_price:unit_price})}}}document.location.href=newPageLink},callOrderItemUpdateCheckPromotions:function(newPageLink,qtyId,oldQty,messageText){var currQty=dojo.byId(qtyId).value;if(currQty==""){return}if(!submitRequest()){return}newPageLink+="&quantity="+currQty;if(currQty<oldQty){displayPromoModal(messageText,newPageLink)}else{document.location.href=newPageLink}},orderItemDelete:function(orderItemDeleteUrl,index){setPageLocation(orderItemDeleteUrl);return false},ajaxLogonService:function(form){var f=$(form);$("#logonErrorMessage").hide();var logonId=form.logonId.value;var data=f.serializeArray(),newData=[],originalURL=null;logonCartURL=null;orderitemURL=null;for(var i=0;i<data.length;i++){var d=data[i];if(d.name=="reLogonURL"){newData.push({name:"reLogonURL",value:"LogonAjaxView"})}else{if(d.name=="redirecturl"){originalURL=d.value;newData.push({name:"redirecturl",value:"LogonAjaxView"})}else{if(d.name=="logonCartURL"){logonCartURL=d.value;newData.push({name:"logonCartURL",value:"LogonAjaxView"})}else{if(d.name=="URL"){orderitemURL=d.value;newData.push({name:"URL",value:"LogonAjaxView"})}else{newData.push(d)}}}}}$.ajax({url:getAbsoluteURL(true)+"LogonAjax",type:"GET",data:newData,dataType:"jsonp",crossDomain:true,success:function(data){if(data.passwordExpired&&data.passwordExpired=="1"){redirectURL=getAbsoluteURL(true)+"ChangePassword?storeId="+storeId+"&catalogId="+catalogId+"&langId="+langId;document.location.href=redirectURL}else{if(data.success){$.cookie("logonId",logonId,{path:"/"});if(data.redirectTo){originalURL=originalURL.replace("UserAccountDetailsView",data.redirectTo);logonCartURL=logonCartURL.replace("UserAccountDetailsView",data.redirectTo)}if(originalURL.length&&originalURL.charAt(originalURL.length-1)=="#"){originalURL=originalURL.substring(0,originalURL.length-1)}if(data.fromLogin=="true"){document.location.href=logonCartURL}else{document.location.href=originalURL}}else{$("#logonErrorMessage").html("There is a problem with the email address and/or password you entered. Please ensure all fields are completed properly.");$("#logonErrorMessage").show();if(document.getElementById("WC_CheckoutLogon_FormInput_logonId")){document.getElementById("WC_CheckoutLogon_FormInput_logonId").value=""}if(document.getElementById("WC_CheckoutLogon_FormInput_logonPassword")){document.getElementById("WC_CheckoutLogon_FormInput_logonPassword").value=""}}}},error:function(jqXHR,textStatus,errorThrown){document.getElementById("logonErrorMessage").innerHTML="There is a problem with the email address and/or password you entered. Please ensure all fields are completed properly.";if(document.getElementById("WC_CheckoutLogon_FormInput_logonId")){document.getElementById("WC_CheckoutLogon_FormInput_logonId").value=""}if(document.getElementById("WC_CheckoutLogon_FormInput_logonPassword")){document.getElementById("WC_CheckoutLogon_FormInput_logonPassword").value=""}}})},ajaxCheckoutContinueLogonService:function(form){var f=$(form);var logonId=form.logonId.value;var data=f.serializeArray(),newData=[],originalURL=null;logonCartURL=null;orderitemURL=null;for(var i=0;i<data.length;i++){var d=data[i];if(d.name=="reLogonURL"){newData.push({name:"reLogonURL",value:"LogonAjaxView"})}else{if(d.name=="redirecturl"){originalURL=d.value;newData.push({name:"redirecturl",value:"LogonAjaxView"})}else{if(d.name=="logonCartURL"){logonCartURL=d.value;newData.push({name:"logonCartURL",value:"LogonAjaxView"})}else{if(d.name=="URL"){orderitemURL=d.value;newData.push({name:"URL",value:"LogonAjaxView"})}else{newData.push(d)}}}}}$.ajax({url:getAbsoluteURL(true)+"LogonAjax",type:"GET",data:newData,dataType:"jsonp",crossDomain:true,success:function(data){console.log(data.passwordExpired);if(data.passwordExpired&&data.passwordExpired=="1"){redirectURL=getAbsoluteURL(true)+"ChangePassword?checkoutLogin=true";document.location.href=redirectURL}else{if(data.success){$.cookie("logonId",logonId,{path:"/"});if(data.redirectTo){originalURL=originalURL.replace("UserAccountDetailsView",data.redirectTo);logonCartURL=logonCartURL.replace("UserAccountDetailsView",data.redirectTo)}if(originalURL.length&&originalURL.charAt(originalURL.length-1)=="#"){originalURL=originalURL.substring(0,originalURL.length-1)}if(data.fromLogin=="true"){document.location.href=logonCartURL}else{document.location.href=originalURL}}else{$("#logonErrorMessage").css("color","red");document.getElementById("logonErrorMessage").innerHTML="There is a problem with the email address and/or password you entered. Please ensure all fields are completed properly.";if(document.getElementById("WC_CheckoutLogon_FormInput_logonId")){document.getElementById("WC_CheckoutLogon_FormInput_logonId").value=""}if(document.getElementById("WC_CheckoutLogon_FormInput_logonPassword")){document.getElementById("WC_CheckoutLogon_FormInput_logonPassword").value=""}}}},error:function(jqXHR,textStatus,errorThrown){$("#logonErrorMessage").css("color","red");document.getElementById("logonErrorMessage").innerHTML="There is a problem with the email address and/or password you entered. Please ensure all fields are completed properly.";if(document.getElementById("WC_CheckoutLogon_FormInput_logonId")){document.getElementById("WC_CheckoutLogon_FormInput_logonId").value=""}if(document.getElementById("WC_CheckoutLogon_FormInput_logonPassword")){document.getElementById("WC_CheckoutLogon_FormInput_logonPassword").value=""}}})},populatefields:function(){var lookUpAddressModalInput=$("#lookUpAddressModalInput1");if(lookUpAddressModalInput.val()!=""){var b=lookUpAddressModalInput.val()}else{var b=$("#lookUpAddressModalInput1","#AddressForm1").val()}var temp=new Array();if(b==""){$("#addressError").show();return false}else{$("#addressError").hide();temp=b.split(",");var form=$("#AddressForm");if(form){form.find('[name= "address1"]').val(temp[0]);form.find('[name= "address2"]').val(temp[1]);form.find('[name= "city"]').val(temp[2]);form.find('[name= "zipCode"]').val(temp[3])}var form=$("#AddressForm1");if(form){form.find('[name= "address1"]').val(temp[0]);form.find('[name= "address2"]').val(temp[1]);form.find('[name= "city"]').val(temp[2]);form.find('[name= "zipCode"]').val(temp[3])}var form=$("#QuickCheckout");if(form){if(CheckoutHelperJS.quickCheckoutClick=="billing"){form.find('[name= "billing_address1"]').val(temp[0]);form.find('[name= "billing_address2"]').val(temp[1]);form.find('[name= "billing_city"]').val(temp[2]);form.find('[name= "billing_zipCode"]').val(temp[3])}else{form.find('[name= "shipping_address1"]').val(temp[0]);form.find('[name= "shipping_address2"]').val(temp[1]);form.find('[name= "shipping_city"]').val(temp[2]);form.find('[name= "shipping_zipCode"]').val(temp[3])}}var form=$("#shopcartAddressForm");if(form){form.find('[name= "address1"]').val(temp[0]);form.find('[name= "address2"]').val(temp[1]);form.find('[name= "city"]').val(temp[2]);form.find('[name= "zipCode"]').val(temp[3])}var form=$("#shippingAddressCreateEditFormDiv_1");if(form){form.find('[name= "address1"]').val(temp[0]);form.find('[name= "address2"]').val(temp[1]);form.find('[name= "city"]').val(temp[2]);form.find('[name= "zipCode"]').val(temp[3])}var form=$("#billingAddressCreateEditFormDiv_1");if(form){form.find('[name= "address1"]').val(temp[0]);form.find('[name= "address2"]').val(temp[1]);form.find('[name= "city"]').val(temp[2]);form.find('[name= "zipCode"]').val(temp[3])}var $container=$("#editAddressContents");if($container){$("#editAddressContents").css("display","block")}$(".ui-dialog-content").dialog("close")}},updatePostCodeLookupAddressUpdate:function(value){$("#zipError").remove();if(value!=null&&value!=undefined){CheckoutHelperJS.quickCheckoutClick=value}var params=[];params.storeId=ServicesDeclarationJS.storeId;params.catalogId=ServicesDeclarationJS.catalogId;params.langId="-1";var zipCodeId;var zipErrorId=$("#zipError");if(value=="billing"){zipCodeId=$("#billing_zipCode1");zipErrorCodeId=zipCodeId}else{if(value=="shipping"){zipCodeId=$("#shipping_zipCode1");zipErrorCodeId=zipCodeId}else{zipCodeId=$("#zipCode");zipErrorCodeId=zipCodeId}}var zipRegex=new RegExp(zipCodeRegex);var isPostalCodeValid=false;var pCode=" ";var postCodeInvalid=$('<div id="zipError"><p><font color="red">Please enter a valid post code</font><p></div>');var zipErrorCodeId;if(zipCodeId.is(":visible")){pCode=pCode+zipCodeId.val();params.zipCode=zipCodeId.val();zipErrorCodeId=zipCodeId}else{zipCodeId=$("#WC__ShoppingCartAddressEntryForm_shippingAddressCreateEditFormDiv_1_zipCode_1");if(zipCodeId.is(":visible")){pCode=pCode+zipCodeId.val();params.zipCode=zipCodeId.val();zipErrorCodeId=zipCodeId}zipCodeId=$("#WC__ShoppingCartAddressEntryForm_billingAddressCreateEditFormDiv_1_zipCode_1");if(zipCodeId.is(":visible")){pCode=pCode+zipCodeId.val();params.zipCode=zipCodeId.val();zipErrorCodeId=zipCodeId}zipCodeId=$("#zipCode1");if(zipCodeId.is(":visible")){pCode=pCode+zipCodeId.val();params.zipCode=zipCodeId.val();zipErrorCodeId=zipCodeId}zipCodeId=$("#QuickCheckout");if(zipCodeId.is(":visible")){pCode=pCode+zipCodeId.val();params.zipCode=zipCodeId.val();zipErrorCodeId=zipCodeId}}if(pCode&&zipRegex.test($.trim(pCode))){isPostalCodeValid=true}else{if(!$("#zipError").is(":visible")){zipErrorCodeId.parent().append(postCodeInvalid)}return false}params.URL="AddressSearchByPostalCodeResponseView";params.ERRORURL="AddressSearchByPostalCodeFailureView";params.NO_ADDR_URL="AddressSearchByPostalCodeNoAddrView";cursor_wait();wc.service.invoke("AjaxAddressSearchByPostalCodeCmd",params)},setCardTypeField:function(cardNumber){var cartType="";var visaIdentifier="Visa";var masterIdentifier="MasterCard";var amexIdentifier="AmericanExpress";var discoverIdentifier="DiscoverCard";var jcbIdentifier="JCB";var dinersIdentifier="DinersClub";var visaRegx=/^4[0-9]{12}(?:[0-9]{3})?$/g;var masterCardRegx=/^5[1-5][0-9]{14}$/g;var amexRegx=/^3[47][0-9]{13}$/g;var discoverRegx=/^6(?:011|5[0-9]{2})[0-9]{12}$/g;var jcbRegx=/^(?:2131|1800|35\d{3})\d{11}$/g;var dinersRegx=/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/g;if(visaRegx.test(cardNumber)&&usableCards.indexOf(visaIdentifier)!=-1){cartType=visaIdentifier}else{if(masterCardRegx.test(cardNumber)&&usableCards.indexOf(masterIdentifier)!=-1){cartType=masterIdentifier}else{if(amexRegx.test(cardNumber)&&usableCards.indexOf(amexIdentifier)!=-1){cartType=amexIdentifier}else{if(discoverRegx.test(cardNumber)&&usableCards.indexOf(discoverIdentifier)!=-1){cartType=discoverIdentifier}else{if(jcbRegx.test(cardNumber)&&usableCards.indexOf(jcbIdentifier)!=-1){cartType=jcbIdentifier}else{if(dinersRegx.test(cardNumber)&&usableCards.indexOf(dinersIdentifier)!=-1){cartType=dinersIdentifier}}}}}}document.forms.PaymentForm1.cc_brand.value=cartType},modifyGiftMessage:function(){document.getElementById("newCheckoutShowGiftMessageArea").style.display="none";document.getElementById("newCheckoutGiftMessageArea").style.display="block";return false}};$(document).ready(function(){if($("#singleShipmentShippingMode_PayPal")){$("#PayPalShipMode").val($("#singleShipmentShippingMode_PayPal").val());$("#singleShipmentShippingMode_PayPal").change(function(){$("#PayPalShipMode").val($(this).val());$("#WC_SingleShipmentOrderTotalsSummary_td_8").html($("#singleShipmentShippingMode_PayPal option:selected").attr("rel"));$("#WC_SingleShipmentOrderTotalsSummary_td_10").html($("#singleShipmentShippingMode_PayPal option:selected").attr("class"))})}if(isPOBoxAddress){$("#PayPalShipMode").val(poboxIdentifier);$("#WC_SingleShipmentOrderTotalsSummary_td_8").html(poboxAmountText);$("#WC_SingleShipmentOrderTotalsSummary_td_10").html(militaryTotalAmountText)}if(isMilitaryAddress){$("#PayPalShipMode").val(militaryIdentifier);$("#WC_SingleShipmentOrderTotalsSummary_td_8").html(militaryAmountText);$("#WC_SingleShipmentOrderTotalsSummary_td_10").html(militaryTotalAmountText)}});