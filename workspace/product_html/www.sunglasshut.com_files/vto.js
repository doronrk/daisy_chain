var selectedImage="none";var strImageUrl="none";var selectedVideo="none";var strVideoUrl="none";var isDisplayAsset=false;var isDisplayTargets=false;var isDisplayPhoto=false;var isDisplayImage=false;var isBackgroundImage=false;var isScreenshotImage=false;var scaleValue=1;var scaleModifier=0.01;var width=320;var height=240;var mode;var checkInterval;var menuOpen=false;var currentLocation=document.location.href;currentLocation=currentLocation.substring(0,currentLocation.lastIndexOf("/")+1);strRootUrl=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/db_sgh/";var photoFileName;function SetNumViewports(){var numViewport=$("#SelectNumViewports").val();window.frames.ti_trylive_iframe.ExecuteCommand("ti_setNumViewports '"+numViewport+"'");for(var k=1;k<=4;k++){if(k<=parseInt(numViewport)){$("#displayInViewRadio"+k).removeAttr("disabled")}else{$("#displayInViewRadio"+k).attr("disabled","disabled")}}}function selectAsset(){var selectedIndex=document.getElementById("ti_asset_select").selectedIndex;var selectedAsset=document.getElementById("ti_asset_select").options[selectedIndex].text;var selectedAssetConfig=document.getElementById("ti_asset_select").options[selectedIndex].value;if(selectedAsset!="Select Alias"){var displayNumViewport=$("input[type=radio][name=displayInViewRadio]:checked").attr("value");var cmd="ti_setAssets '";cmd+=selectedAsset+"'";cmd+=strRootUrl+selectedAssetConfig+"'";cmd+=displayNumViewport+"'";window.frames.ti_trylive_iframe.ExecuteCommand(cmd)}}function setDefaultAsset(){var selectedAsset=document.getElementById("ti_asset_select").options[1].text;var selectedAssetConfig=document.getElementById("ti_asset_select").options[1].value;var displayNumViewport=1;var cmd="ti_setAssets '";cmd+=selectedAsset+"'";cmd+=strRootUrl+selectedAssetConfig+"'";cmd+=displayNumViewport+"'";window.frames.ti_trylive_iframe.ExecuteCommand(cmd)}function OnAssetsLoadingStatusChanged(status){}function ScalePlus(){scaleValue+=scaleModifier;window.frames.ti_trylive_iframe.ExecuteCommand("ti_scaleAssets '"+scaleValue+"'")}function ScaleMinus(){scaleValue-=scaleModifier;window.frames.ti_trylive_iframe.ExecuteCommand("ti_scaleAssets '"+scaleValue+"'")}function ResetScale(){scaleValue=1;window.frames.ti_trylive_iframe.ExecuteCommand("ti_scaleAssets '"+scaleValue+"'")}function RotationUp(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_rotateAssets 'Up'")}function RotationDown(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_rotateAssets 'Down'")}function RotationLeft(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_rotateAssets 'Left'")}function RotationRight(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_rotateAssets 'Right'")}function RotationReset(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_rotateAssets 'Reset'")}function ShowAsset(value){if(value!=null){isDisplayAsset=value}else{isDisplayAsset=!isDisplayAsset}window.frames.ti_trylive_iframe.ExecuteCommand("ti_showAssets '"+isDisplayAsset.toString()+"'")}function TakePhoto(mode){window.frames.ti_trylive_iframe.ExecuteCommand("ti_takePhoto '"+mode+"'");$(".snapshotButton").removeClass("redesignVTO-btn_camera_black").addClass("redesignVTO-btn_camera")}function ShowPhoto(value){$(".snapshotButton").addClass("redesignVTO-btn_camera_black").removeClass("redesignVTO-btn_camera");if(value!=null){isDisplayPhoto=value}else{isDisplayPhoto=!isDisplayPhoto}window.frames.ti_trylive_iframe.ExecuteCommand("ti_showPhoto '"+isDisplayPhoto.toString()+"'")}function UploadPhoto(){$(".snapshotButton").addClass("redesignVTO-btn_camera_black").removeClass("redesignVTO-btn_camera");window.frames.ti_trylive_iframe.ExecuteCommand("ti_uploadPhoto")}function UpdatePhotoUrl(strPhotoUrl){photoFileName=strPhotoUrl}function OnPhotoStatusChanged(strPhotoStatus){$(".snapshotButton").addClass("redesignVTO-btn_camera_black").removeClass("redesignVTO-btn_camera");if(strPhotoStatus=="taken"){hideShowElements($(".wearing, #productsToCompare, #vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs, .top-controls, .changeModel"),$("#social, .returnToMirror, .anotherPicture"));$("#webcamFlashContainer").addClass("no-tabs");ShowPhoto()}}function SetPhotoMode(value){if(value!=null){strImageUrl=value}else{var selectedIndex=document.getElementById("ti_image_select").selectedIndex;selectedImage=document.getElementById("ti_image_select").options[selectedIndex].text;if(selectedImage!="Select Alias"){strImageUrl=currentLocation+"upload/photo/"+selectedImage}else{strImageUrl="none"}}ShowPhoto(false);ShowAsset(true);ShowTargets(false);window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'photo'"+strImageUrl+"'")}function ShowTargets(value){if(value!=null){isDisplayTargets=value}else{isDisplayTargets=!isDisplayTargets}window.frames.ti_trylive_iframe.ExecuteCommand("ti_showTargets '"+isDisplayTargets.toString()+"'")}function UploadTargets(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_uploadTargets '"+currentLocation+"ti/php/uploadTargets.php'")}function SetLiveMode(){ShowPhoto(false);ShowAsset(true);window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'webcam'")}function SetVideoMode(value){if(value!=null){strVideoUrl=value}else{var selectedIndex=document.getElementById("ti_video_select").selectedIndex;selectedVideo=document.getElementById("ti_video_select").options[selectedIndex].text;if(selectedVideo!="Select Alias"){strVideoUrl=currentLocation+"upload/video/"+selectedVideo}else{strVideoUrl="none"}}ShowPhoto(false);ShowAsset(true);window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'video'"+strVideoUrl+"'")}function SetPupillaryDistanceMode(){ShowPhoto(false);window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'pupillaryDistance'")}function SetRefObjectSize(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_setRefObjectSize '"+window.document.getElementById("sizeObject").value+"'"+window.document.getElementById("shiftObject").value+"'")}function SavePupillaryDistanceValue(dpTotal,dpLeft,dpRight){}function EndPupillaryDistance(){var strUploaderUrl=window.location.protocol+"//"+window.location.host+"/webapp/wcs/stores/servlet/us/VirtualTryOnPhotoUpload";window.frames.ti_trylive_iframe.ExecuteCommand("ti_endPupillaryDistance '"+strUploaderUrl+"'")}function SetTrueToScaleMode(){ShowPhoto(false);window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'trueToScale'")}function EndTrueToScale(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_endTrueToScale")}function ResetTrueToScale(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_resetTrueToScale")}function setImage(visible,background,screenshot){if(visible!=null){isDisplayImage=visible}else{isDisplayImage=!isDisplayImage}if(background!=null){isBackgroundImage=background}else{isBackgroundImage=!isBackgroundImage}if(screenshot!=null){isScreenshotImage=screenshot}else{isScreenshotImage=!isScreenshotImage}window.frames.ti_trylive_iframe.ExecuteCommand("ti_setImage 'TryLive_Eyewear_Logo.png'"+isDisplayImage.toString()+"'"+window.document.getElementById("posxImage").value+"'"+window.document.getElementById("posyImage").value+"'"+window.document.getElementById("scalexImage").value+"'"+window.document.getElementById("scaleyImage").value+"'"+isBackgroundImage.toString()+"'"+isScreenshotImage.toString()+"'")}function Recalibrate(){window.frames.ti_trylive_iframe.ExecuteCommand("ti_recalibrate")}function OnTrackingStatusChanged(value){}function OnErrorsStatusChanged(status){}function RedimPlus(){width=640;height=480;Redim()}function RedimMinus(){width=320;height=240;Redim()}function Redim(){var iframe=window.frames.ti_trylive_iframe;var movie=iframe.thisMovie(iframe.movieName);$("#ti_trylive_iframe").css("width",width);$("#ti_trylive_iframe").css("height",height);$("#ti_frame").css("width",width);$("#ti_frame").css("height",height);movie.setAttribute("width",width);movie.setAttribute("height",height)}function checkFrames(){if(vtoFramesJSON!=null){hideVTOLoader();clearInterval(checkInterval)}}function OnInitializationFinished(){if(vtoFramesJSON!=null){hideVTOLoader()}else{checkInterval=setInterval("checkFrames()",100)}if(mode!=null&&mode!=""){if(mode=="photo_male"){lastVideo=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/images/virtualTryOn/lui.flv";viewerInitialized=true;readVTOCookie();SetVideoMode(lastVideo)}else{lastVideo=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/images/virtualTryOn/lei.flv";viewerInitialized=true;readVTOCookie();SetVideoMode(lastVideo)}}else{viewerInitialized=true;readVTOCookie()}var strLanguage="en";window.frames.ti_trylive_iframe.ExecuteCommand("ti_setLanguage '"+strLanguage+"'");window.frames.ti_trylive_iframe.ExecuteCommand("ti_setPlayerConfig '"+strRootUrl+"player/config.json'");window.frames.ti_trylive_iframe.ExecuteCommand("ti_setCustomerConfig '"+strRootUrl+"customer/config.json'");var strUploaderUrl=window.location.protocol+"//"+window.location.host+"/webapp/wcs/stores/servlet/us/VirtualTryOnPhotoUpload";window.frames.ti_trylive_iframe.ExecuteCommand("ti_setUploaderUrl '"+strUploaderUrl+"'");document.getElementById("ti_asset_select").options[0]=new Option("Select Alias","Select Alias");var strCatalogueUrl=strRootUrl+"rayban.json";$.getJSON(strCatalogueUrl,function(data){var items=[];var i=1;$.each(data,function(text,value){document.getElementById("ti_asset_select").options[i]=new Option(text,value.assets_url);i++});setDefaultAsset()})}var strCatalogueUrl=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/db_sgh/sgh.json";var strAssetUrl=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/db_sgh/";function showFrame(upc,viewport){if(viewport==null){viewport=1}window.frames.ti_trylive_iframe.ExecuteCommand("ti_setAssets '"+upc+"'"+strAssetUrl+getAsset(upc)+"'"+viewport+"'")}function addVtoTrackedProduct(catentryId){if(catentryId!=null&&catentryId.length){var currentProducts=getVtoTrackedProducts();if(currentProducts&&currentProducts.length){currentProducts+=","+catentryId}else{currentProducts=catentryId}setVtoTrackedProducts(currentProducts)}}function getVtoTrackedProducts(){return dojo.cookie("vtoTrackedProducts")}function setVtoTrackedProducts(products){if(products==null||products.length==0){dojo.cookie("vtoTrackedProducts",products,{path:"/",expires:-1})}else{dojo.cookie("vtoTrackedProducts",products,{path:"/"})}}function getAsset(upc){return jsonObj[upc].assets_url}function takePhoto(){$(".snapshotButton").removeClass("redesignVTO-btn_camera_black").addClass("redesignVTO-btn_camera");UpdatePhotoUrl(null);window.frames.ti_trylive_iframe.ExecuteCommand("ti_takePhoto 'all'")}var currentlyViewing;function getCurrentlyViewing(){return currentlyViewing}function setCurrentlyViewing(current){currentlyViewing=current}function setTotalViewports(numViewport){window.frames.ti_trylive_iframe.ExecuteCommand("ti_setNumViewports '"+numViewport+"'")}function loadPhotoMode(initialPhoto){window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'photo'"+initialPhoto+"'")}function loadVideoMode(initialVideo){window.frames.ti_trylive_iframe.ExecuteCommand("ti_setTryMode 'video'"+initialVideo+"'")}var currentTab="",currentFacet="",currentScreen="",isCompare=false,totalViewports=1,firstSelection=false,comparedUPCS=[],mode="",viewerInitialized=false,modelURL,vtoUPC="",vtoInterval,firstView=false,vtoLocale="",albumName="Virtual Mirror",checkPhotoUploadStatusInterval=null,vtoSimilarFramesJSON={};function init(){categoryDisplayJS.storeId=constants.ajaxParams.storeId;categoryDisplayJS.catalogId=constants.ajaxParams.catalogId;checkLocale();setupControls();setupTabClick();setupLeftBar();setupRightBar();setupModelControls();setupValidation();setupCompareControls();setupProductDelete()}function setupControls(){if($.cookie("vtoCookie")==null){$(".info-header").bind("click",function(){var $this=$(this);hideShowElements($("#setupScreen"),$("#vtoContainerWSidebar"));$("#webcamFlashContainer").removeClass("move");setupCarousels();setupCarouselNavigation();if($this.hasClass("webcam")){$("#vtoLeftBar").show();$("#vtoMain").addClass("active");openTab("webcam");currentScreen="webcam";currentTab=$(".onYou");currentTab.addClass("selected");hideShowElements(null,$("#webcamScreen"));$("#webcamFlashContainer").removeClass("move");vtoTrack("use your webcam");if(vtoUPC!=""){setGlasses(vtoUPC);setItemFromVTO(vtoUPC);$("#vtoModal .product").removeClass("first")}}else{openTab("model");currentScreen="model";currentTab=$(".onModel");currentTab.addClass("selected");hideShowElements($("#vtoBottom, #vtoRightBar"),$("#modelScreen"));$("#webcamFlashContainer").addClass("move");vtoTrack("use model picture");if(vtoUPC!=""){setGlasses(vtoUPC);setItemFromVTO(vtoUPC);$("#vtoModal .product").removeClass("first")}}$("#setupScreen").remove();$(".info-container").unbind("click");createVTOCookie();return false})}}function setupTabClick(){$("#vtoTabs a").click(function(){var $this=$(this);openTab($this.attr("rel"));currentScreen=$this.attr("rel");currentTab.removeClass("selected");currentTab=$this;currentTab.addClass("selected");createVTOCookie();return false})}function checkPhotoUploadStatus(){if(photoFileName!=null){clearInterval(checkPhotoUploadStatusInterval);document.getElementById("vtoUploadImage").src=photoURI+photoFileName;var objectsToHide=$("#vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs, .returnToMirror, .wearing, #productsToCompare"),objectsToShow=$("#social, #webcamScreen, #emailForm, #onYou");hideShowElements(objectsToHide,objectsToShow);$("#webcamFlashContainer").addClass("move");$("#vtoTabContent").addClass("no-tabs");$("#vtoLeftBar .email").parents(".section").addClass("active");hideVTOLoader();vtoTrack("VTO email share")}}function setupLeftBar(){$("#vtoLeftBar .save-account").click(function(){hideShowElements($("#vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs, .returnToMirror"),$("#accountForm"));$("#webcamFlashContainer").addClass("move");$("#vtoTabContent").addClass("no-tabs");$(this).parents(".section").addClass("active");return false});$("#vtoLeftBar .email").click(function(){$(".anotherPicture").hide();UploadPhoto();showVTOLoader();checkPhotoUploadStatusInterval=setInterval("checkPhotoUploadStatus()",100);return false});$(".cancel").click(function(){if(currentScreen=="webcam"){hideShowElements($("#accountForm, #emailForm, #social, #modelScreen"),$("#vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs"));$("#webcamFlashContainer").removeClass("move")}else{hideShowElements($("#accountForm, #emailForm, #social, #webcamScreen"),$("#vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs, #modelScreen"));if(!$("#modelSelector").is(":visible")){$("#webcamFlashContainer").removeClass("move")}}showHideCompare();ShowPhoto();$("#vtoTabContent").removeClass("no-tabs");$("#vtoLeftBar .email").parents(".section").removeClass("active");return false});$(".mirror-return").click(function(){hideShowElements($("#social, #accountForm, #emailForm, .returnToMirror, .anotherPicture"),$("#vtoBottom, #vtoRightBar, #webcamScreen ul, #vtoTabs"));$("#webcamFlashContainer").removeClass("no-tabs");if(currentScreen=="model"){hideShowElements(null,$(".changeModel"))}showHideCompare();ShowPhoto();return false});$("#vtoLeftBar .facebook").click(function(){facebookLogin();vtoTrack("VTO facebook share");return false});$(document).on("click",".single-view",function(){var upc=$(this).closest("#vtoModal .product").attr("id");isCompare=false;hideShowElements($("#productsToCompare"),$(".wearing"));$(".single").addClass("active");$(".compare").removeClass("active");setSingleProduct(upc);setTotalViewports(1);showFrame(upc);for(i=0;i<comparedUPCS.length;i++){$("#carousels").find("#"+comparedUPCS[i]).removeClass("selected")}$("#carousels").find("#"+upc).addClass("selected");vtoProductTrack("VTO_Frame_Tried_On",upc);return false})}function setupRightBar(){$(".block a.compare").click(function(){if(!isCompare){isCompare=true;hideShowElements($(".wearing"),$("#productsToCompare"));$(".compare").addClass("active");$(".single").removeClass("active");for(i=0;i<comparedUPCS.length;i++){$("#carousels").find("#"+comparedUPCS[i]).addClass("selected");if(i==0){showFrame(comparedUPCS[i]);setTotalViewports(2)}else{totalViewports=i+1;showFrame(comparedUPCS[i],totalViewports);setTotalViewports(totalViewports)}}}doHideDeleteButton();return false});$(".block a.snapPhoto").click(function(){takePhoto();return false})}function setupModelControls(){$(".close","#vtoModal").click(function(){if(menuOpen){$("#main-navigation-container").addClass("active")}$("#vtoModal").hide()});$(".changeModel").click(function(){hideShowElements($("#modelScreen ul, .wearing, #vtoBottom, #vtoRightBar, #productsToCompare, #calibrationControls"),$("#modelSelector, #chooseModel"));$("#webcamFlashContainer").addClass("move");if($("#carousels").find(".selected").length>0&&firstView){showFrame($("#carousels").find(".selected").attr("id"))}return false});$(".modelSelect, .model-link").click(function(){$("#vtoLeftBar").show();$("#vtoMain").addClass("active");if($(this).hasClass("male")){mode="photo_male";$(".model-link.female").show();$(".model-link.male").hide();if(viewerInitialized){modelURL=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/images/virtualTryOn/lui.flv";loadVideoMode(modelURL)}vtoTrack("use male model");$(".wearing h2").html("He's <br/> Wearing")}else{mode="photo_female";$(".model-link.female").hide();$(".model-link.male").show();if(viewerInitialized){modelURL=window.location.protocol+"//"+window.location.host+"/wcsstore/MadisonsStorefrontAssetStore/images/virtualTryOn/lei.flv";loadVideoMode(modelURL)}vtoTrack("use female model");$(".wearing h2").html("She's <br/> Wearing")}createVTOCookie();if(!firstView&&vtoUPC!=""){setGlasses(vtoUPC)}hideShowElements($("#modelSelector, #chooseModel"),$("#modelScreen ul, #vtoBottom, #vtoRightBar, #calibrationControls"));showHideCompare();$("#webcamFlashContainer").removeClass("move");return false})}function setupCarouselNavigation(){$("#vtoBottom .selectors a").on("click",function(){var $this=$(this);if($this.hasClass("selected")){return false}$this.parents(".owl-wrapper").find(".selected").removeClass("selected");$this.addClass("selected");if($this.hasClass("allStyles")&&$this.hasClass("selected")){hideShowElements($("#carousels #similarStyles"),$("#carousels #allStyles"));vtoTrack("All VTO Frames tab")}else{hideShowElements($("#carousels #allStyles"),$("#carousels #similarStyles"));vtoTrack("Similar Frames tab")}return false});$("#narrowBy .drop").on("click",function(){var $this=$(this);if($this.hasClass("selected")){$this.removeClass("selected").next("ul").hide();currentFacet=$this;return false}if(currentFacet!=""){currentFacet.removeClass("selected").next("ul").hide()}currentFacet=$this;currentFacet.addClass("selected").next("ul").show();return false});$("#narrowBy a").on("click",function(){var $this=$(this);if($this.hasClass("disabled")){return false}var prevValue=$(".drop.selected").html(),prevValueArray=prevValue.split("<span></span>"),selectedValue="";prevValue=prevValueArray[0];if($this.find(".text").length>0){selectedValue=$this.find(".text").html();$(".drop.selected").html($this.find(".text").html()+"<span />").removeClass("selected").next("ul").hide()}else{selectedValue=$this.html();$(".drop.selected").html($this.html()+"<span />").removeClass("selected").next("ul").hide()}var parent=$this.parent().parent().parent().attr("class");var genderVar=$("li.gender").children(".drop").text();var brandVar=$("li.brand").children(".drop").text();var frameVar=$("li.frame").children(".drop").text();if(parent=="gender"){vtoTrack("VTO Gender filter dropdown");vtoFramesUrl=vtoFramesUrlOriginal;if(selectedValue.indexOf("Gender")==-1){vtoFramesUrl=vtoFramesUrlOriginal+"&gender="+selectedValue}if(brandVar.indexOf("Brand")==-1){vtoFramesUrl=vtoFramesUrl+"&brand="+brandVar}if(frameVar.indexOf("Frame Shape")==-1){vtoFramesUrl=vtoFramesUrl+"&frameShape="+frameVar}}if(parent=="brand"){vtoTrack("VTO Brand filter dropdown");vtoFramesUrl=vtoFramesUrlOriginal;if(selectedValue.indexOf("Brand")==-1){vtoFramesUrl=vtoFramesUrlOriginal+"&brand="+selectedValue}if(genderVar.indexOf("Gender")==-1){vtoFramesUrl=vtoFramesUrl+"&gender="+genderVar}if(frameVar.indexOf("Frame Shape")==-1){vtoFramesUrl=vtoFramesUrl+"&frameShape="+frameVar}}if(parent=="frame"){vtoTrack("VTO Style filter dropdown");vtoFramesUrl=vtoFramesUrlOriginal;if(selectedValue.indexOf("Frame Shape")==-1){vtoFramesUrl=vtoFramesUrlOriginal+"&frameShape="+selectedValue}if(brandVar.indexOf("Brand")==-1){vtoFramesUrl=vtoFramesUrl+"&brand="+brandVar}if(genderVar.indexOf("Gender")==-1){vtoFramesUrl=vtoFramesUrl+"&gender="+genderVar}}$.getJSON(vtoFramesUrl,function(json){vtoFramesJSONKey=[];$.each(json,function(key,val){vtoFramesJSONKey.push(key.toString())});vtoFramesJSON=json;setupCarousels()});createVTOCookie();return false})}function getSimilarStylesData(upc){var similarStylesUrl=vtoFramesUrl;if(upc&&upc!=""){similarStylesUrl+="&similarStyles=true&upc="+encodeURI(upc)}var promise;if(vtoSimilarFramesJSON[upc]){promise=$(vtoSimilarFramesJSON[upc]).promise()}else{promise=$.getJSON(similarStylesUrl,function(json){vtoSimilarFramesJSON[upc]=json})}return promise}function setupAllStylesCarousel(){var counter=-1,itemWrapper='<div id="vtoSlider1"><div class="carousel-item">';$("#vtoSlider1").remove();for(i=0;i<vtoFramesJSONKey.length;i++){counter++;var itemString='<div rel="'+i+'" class="item" id="'+vtoFramesJSONKey[i]+'"><div class="img"><img border="0" alt="'+vtoFramesJSON[vtoFramesJSONKey[i]].brand+" - "+vtoFramesJSON[vtoFramesJSONKey[i]].name+'" src="http://s7d3.scene7.com/is/image/LuxotticaRetail/'+vtoFramesJSONKey[i]+'_shad_fr??$m_pdpSet$&layer=0&color=F3F2F2&wid=370" /></div><div class="info"><span class="brand">'+vtoFramesJSON[vtoFramesJSONKey[i]].brand+'</span><span class="style">'+vtoFramesJSON[vtoFramesJSONKey[i]].name+"</span></div></div>";if(counter>=3){counter=0;itemWrapper+='</div><div class="carousel-item">'+itemString}else{itemWrapper+=itemString}}itemWrapper+="</div></div>";$("#vtoSlider1Container").html(itemWrapper);if($("#vtoSlider1 .item").length>3){$("#vtoSlider1").owlCarousel({singleItem:true,navigation:true,items:1})}}function setupCarousels(){setupAllStylesCarousel();$(document).on("click","#carousels .item",function(){var $this=$(this),index=$this.attr("rel"),upc=$this.attr("id");if($this.hasClass("selected")){return false}if(!isCompare){$this.closest(".owl-wrapper").find(".selected").removeClass("selected");showFrame(upc);setSingleProduct(upc);setProductInfo(0,upc);showFrame(upc);$("#vtoModal .product").removeClass("first");for(i=0;i<comparedUPCS.length;i++){if(comparedUPCS[i]==upc){comparedUPCS.splice(i,1)}}comparedUPCS[0]=upc}else{if($this.hasClass("selected")){return false}if(totalViewports>=4){showWarning(true);return false}if($("#vtoModal .product").hasClass("first")){$("#vtoModal .product").removeClass("first");setProductInfo(0,upc);doHideDeleteButton();showFrame(upc);setTotalViewports(2)}else{var clonedProduct=$("#productsToCompare .product").eq(0).clone();clonedProduct.insertBefore("#productsToCompare .product.pick:first");$("#productsToCompare .product.pick:first").remove();setProductInfo(totalViewports,upc);checkProductCount();totalViewports++;setTotalViewports(totalViewports);doHideDeleteButton();showFrame(upc,totalViewports)}comparedUPCS.push(upc)}$this.addClass("selected");vtoProductTrack("VTO_Frame_Tried_On",upc);for(i=0;i<comparedUPCS.length;i++){$("#carousels").find("#"+comparedUPCS[i]).addClass("selected")}createVTOCookie();doHideDeleteButton();return false})}function setSingleProduct(upc){$(".wearing .img img").attr("src","http://s7d3.scene7.com/is/image/LuxotticaRetail/"+upc+"_shad_fr??$m_pdpSet$&layer=0&color=F3F2F2&wid=136");$(".wearing .info .brand").html(vtoFramesJSON[upc].brand);$(".wearing .info .style").html(vtoFramesJSON[upc].name);$(".wearing .info .price").html(currencySymbol+vtoFramesJSON[upc].price);if(vtoFramesJSON[upc].inStock=="false"){$(".wearing .out-of-stock").show();$(".wearing #myCartButton").hide()}else{$(".wearing #myCartButton").show();$(".wearing .out-of-stock").hide()}$(".wearing #myCartButton").attr("href",'javascript:ServicesDeclarationJS.setCatentryId("'+vtoFramesJSON[upc].catentryId+'");setCurrentId("myCartButton"); categoryDisplayJS.AddItem2ShopCartAjax("'+vtoFramesJSON[upc].catentryId+'", 1); addVtoTrackedProduct("'+vtoFramesJSON[upc].catentryId+'")');$(".wearing .myWishlistButton").attr("href",'javascript:ServicesDeclarationJS.setCatentryId("'+vtoFramesJSON[upc].catentryId+'"); handleAddtoFav("'+vtoFramesJSON[upc].catentryId+'")');$(".wearing .myFindStoreButton").attr("href","/webapp/wcs/stores/servlet/AjaxStoreLocatorDisplayView?catalogId="+constants.ajaxParams.catalogId+"&langId="+constants.ajaxParams.langId+"&storeId="+constants.ajaxParams.storeId+"&productId="+vtoFramesJSON[upc].catentryId+"&fromPage=ProductDetails&type=item");$(".wearing .full-details").attr("href",window.location.protocol+"//"+window.location.host+"/"+vtoLocale+"/"+vtoFramesJSON[upc].catentryId)}function setProductInfo(index,upc){$("#productsToCompare .product").eq(index).attr("id",upc);$("#productsToCompare .product").eq(index).find(".img img").attr("src","http://s7d3.scene7.com/is/image/LuxotticaRetail/"+upc+"_shad_fr??$m_pdpSet$&layer=0&color=F3F2F2&wid=100");$("#productsToCompare .product").eq(index).find(".info .brand").html(vtoFramesJSON[upc].brand);$("#productsToCompare .product").eq(index).find(".info .style").html(vtoFramesJSON[upc].name);$("#productsToCompare .product").eq(index).find(".info .price").html(currencySymbol+vtoFramesJSON[upc].price);$("#productsToCompare .product").eq(index).find(".smallAddToCartButton, .addToCartVTO").attr("href",'javascript:ServicesDeclarationJS.setCatentryId("'+vtoFramesJSON[upc].catentryId+'");setCurrentId("myCartButton"); categoryDisplayJS.AddItem2ShopCartAjax("'+vtoFramesJSON[upc].catentryId+'", 1); addVtoTrackedProduct("'+vtoFramesJSON[upc].catentryId+'");');$("#productsToCompare .product").eq(index).find(".myWishlistButton").attr("href",'javascript:ServicesDeclarationJS.setCatentryId("'+vtoFramesJSON[upc].catentryId+'"); handleAddtoFav("'+vtoFramesJSON[upc].catentryId+'")');$("#productsToCompare").eq(index).find(".myFindStoreButton").attr("href","/webapp/wcs/stores/servlet/AjaxStoreLocatorDisplayView?catalogId="+constants.ajaxParams.catalogId+"&langId="+constants.ajaxParams.langId+"&storeId="+constants.ajaxParams.storeId+"&productId="+vtoFramesJSON[upc].catentryId+"&fromPage=ProductDetails&type=item");$("#productsToCompare").eq(index).find(".full-details").attr("href","/"+vtoLocale+"/"+vtoFramesJSON[upc].catentryId)}function setupCompareControls(){$(document).on("click",".top-controls a",function(){var $this=$(this);if($(this).hasClass("active")){return false}if($this.hasClass("single")){isCompare=false;hideShowElements($("#productsToCompare"),$(".wearing"));setTotalViewports(1);$(".single").addClass("active");$(".compare").removeClass("active");for(i=1;i<comparedUPCS.length;i++){$("#carousels").find("#"+comparedUPCS[i]).removeClass("selected")}setSingleProduct(comparedUPCS[0])}else{isCompare=true;hideShowElements($(".wearing"),$("#productsToCompare"));$(".compare").addClass("active");$(".single").removeClass("active");var fromCookie=$("#vtoModal .product").not(".pick").length==1;for(i=0;i<comparedUPCS.length;i++){$("#carousels").find("#"+comparedUPCS[i]).addClass("selected");if(i==0){showFrame(comparedUPCS[i]);setTotalViewports(2)}else{totalViewports=i+1;showFrame(comparedUPCS[i],totalViewports);setTotalViewports(totalViewports)}if(fromCookie&&i!=0){$("#vtoModal .product").removeClass("first");var clonedProduct=$("#productsToCompare .product").eq(0).clone();clonedProduct.insertBefore("#productsToCompare .product.pick");$("#productsToCompare .product.pick:first").remove();setProductInfo(totalViewports-1,comparedUPCS[i]);checkProductCount()}}}createVTOCookie();return false})}function setupProductDelete(){$(document).on("click","#vtoModal .product .delete",function(){var $this=$(this);productLength=$("#vtoModal .product").length-1;if(productLength!=1){comparedUPCS.splice($this.parent().index(),1);$this.parent().remove();totalViewports--;checkProductCount();var clonedProduct=$(".clone").clone();clonedProduct.addClass("product pick last").removeClass("clone").show().insertAfter("#productsToCompare .product.last");$("#productsToCompare .product.last:first").removeClass("last");showWarning(false);resetCompare();$("#carousels").find("#"+$this.parent().attr("id")).removeClass("selected")}doHideDeleteButton();createVTOCookie();return false})}function resetCompare(){$("#vtoModal .product").not(".pick").each(function(i){showFrame($(this).attr("id"),(i+1))});setTotalViewports(totalViewports)}function hideShowElements(closeScreen,openScreen){if(closeScreen!=null){closeScreen.hide()}if(openScreen!=null){openScreen.show().removeClass("hide")}}function openTab(tab){showHideCompare();switch(tab){case"webcam":hideShowElements($("#modelScreen, #onModel"),$("#webcamScreen, #vtoBottom, #vtoRightBar, #onYou, #calibrationControls"));$("#webcamFlashContainer").removeClass("move");if(viewerInitialized){SetLiveMode();console.log("setting live mode")}$(".wearing h2").html("You're <br/> Wearing");break;case"model":hideShowElements($("#webcamScreen, #onYou"),$("#modelScreen, #onModel"));if(mode=="photo_male"){$(".wearing h2").html("He's <br/> Wearing");$(".model-link.female").show();$(".model-link.male").hide()}else{if(mode=="photo_female"){$(".wearing h2").html("She's <br/> Wearing");$(".model-link.female").hide();$(".model-link.male").show()}else{$("#vtoLeftBar").hide();$("#vtoMain").removeClass("active")}}if($("#modelSelector").is(":visible")){hideShowElements($("#vtoBottom, #vtoRightBar, .wearing, #productsToCompare, #calibrationControls"),null);$("#webcamFlashContainer").addClass("move")}else{loadVideoMode(modelURL);hideShowElements(null,$(".changeModel, #calibrationControls"))}break;default:break}setTotalViewports(totalViewports)}function showHideCompare(){if(isCompare){hideShowElements($(".wearing"),$("#productsToCompare"));$(".top-controls a.compare").addClass("active");$(".top-controls a.single").removeClass("active");doHideDeleteButton()}else{hideShowElements($("#productsToCompare"),$(".wearing"));$(".top-controls a.single").addClass("active");$(".top-controls a.compare").removeClass("active")}}function checkProductCount(){var $products=$("#productsToCompare .product").not(".pick"),theLength=$products.length;$products.find(".productInfo div:first").removeClass();$products.each(function(i){$(this).find(".productInfo div:first").addClass("p"+(i+1))});if(theLength>=4){$products.find(".productInfo div:first").removeClass("side").removeClass("threeSide").addClass("first grid");$("#productsToCompare .product.pick").hide();$products.eq(theLength-1).addClass("last")}else{if(theLength==3){$products.find(".productInfo div:first").removeClass("side").removeClass("grid").addClass("first threeSide");$("#productsToCompare .product.pick").show()}else{$products.find(".productInfo div:first").removeClass("grid").removeClass("threeSide").addClass("first side");$("#productsToCompare .product.pick").show();$products.removeClass("last");$products.eq(theLength).addClass("last")}}}function showWarning(show){if(show){hideShowElements(null,$("#compareWarning"))}else{hideShowElements($("#compareWarning"),null)}}function setupValidation(){$("#emailForm form").validate({onfocusout:false,onkeyup:false,onclick:false,errorClass:"required",errorElement:"span",rules:{fromName:{required:true,specialCharacters:true},senderEmail:{required:true,email:true,specialCharacters:true,validEmail:true},recipientEmail:{required:true,email:true,specialCharacters:true,validEmail:true},messageBody:{required:true}},messages:{fromName:MessageHelper.messages.ERROR_YourNameEmpty,senderEmail:MessageHelper.messages.ERROR_EmailEnter,recipientEmail:MessageHelper.messages.ERROR_EmailProvide,messageBody:MessageHelper.messages.ERROR_MessageEmpty},highlight:function(element,errorClass){$(element).addClass("required")},unhighlight:function(element,errorClass){$(element).removeClass("required")},submitHandler:function(form){var $form=$(form);var imgURL=$form.find('input[name="imageURL"]').val($("#vtoUploadImage").attr("src"));$("input[name=receiveEmails]").val($("input[name=receiveEmails]:checked").length>0);var catentryIds=[];for(var i=0;i<4;i++){var upc=null;var catentryId="";if(i<comparedUPCS.length){upc=comparedUPCS[i];if(upc!=null&&vtoFramesJSON[upc]!=null){catentryId=vtoFramesJSON[upc].catentryId}}catentryIds.push(catentryId)}var data=$form.serialize();for(var i=0;i<catentryIds.length;i++){data+="&catentryId"+(i+1)+"="+catentryIds[i]}$.ajax({url:getAbsoluteURL()+"SendEmailCmd",data:data,dataType:"html",type:"post",complete:function(response){$form.hide();$("#vtoShareEmailConfirmation").show();var responseData=$.parseJSON(response.responseText);if(responseData.success=="true"){var info=responseData.info.split("-")[1];if(info=="true"){utagLinkSafe({link_name:"emailSubscribe"})}}setTimeout(function(){$("#vtoShareEmailConfirmation").fadeOut();$form.fadeIn();$("#emailForm").find(".cancel").click()},3000)}});return false}});$("#emailForm .submitEmail").click(function(){$("#emailForm form").submit();ShowPhoto();return false})}function facebookLogin(){FB.login(function(response){if(response.authResponse){checkAlbums(albumName)}else{console.log("User cancelled login")}},{scope:"user_photos, publish_stream"})}function checkAlbums(albumName){FB.api("/me/albums",function(response){var exists=false,albumId,dateObject=response.data;for(var i=0;i<response.data.length;i++){if(dateObject[i].name==albumName){exists=true;albumId=dateObject[i].id;break}}createAlbum(exists,albumName,albumId)})}function createAlbum(createAlbum,albumName,albumId){if(!createAlbum){var params={name:albumName};FB.api("/me/albums","post",params,function(response){if(!response||response.error){console.log("Error creating album "+repsonse)}else{console.log("Album creating successfully");postPhoto(response.id)}})}else{postPhoto(albumId)}}function postPhoto(albumId){UploadPhoto();showVTOLoader();checkPhotoUploadStatusInterval=setInterval("checkFacebookPhotoUploadStatus("+albumId+")",100)}function checkFacebookPhotoUploadStatus(albumId){if(photoFileName!=null&&photoFileName!=""){clearInterval(checkPhotoUploadStatusInterval);document.getElementById("vtoUploadImage").src=photoURI+photoFileName;hideVTOLoader();var params={url:photoURI+photoFileName};FB.api("/"+albumId+"/photos","post",params,function(response){if(!response||response.error){console.log("Error posting photo")}else{console.log("Photo posted successfully")}});vtoTrack("VTO email share")}}function vtoTrack(message){if(typeof window.utag!="undefined"){utagLinkSafe({link:message})}}function vtoProductTrack(message,upc){if(typeof window.utag!="undefined"){utagLinkSafe({link:message,product:upc})}}function checkLocale(){switch(constants.ajaxParams.storeId){case"10152":vtoLocale="us";break;case"10154":vtoLocale="ca";break;case"10801":vtoLocale="au";break}}function setGlasses(theUPC,index){index=(index==null||index==undefined)?1:index;vtoInterval=setTimeout(function(){showFrame(theUPC,index);firstView=true},1000)}function setItemFromVTO(theUPC){setSingleProduct(theUPC);setProductInfo(0,theUPC);$("#carousels").find(".selected").removeClass("selected");$("#carousels").find("#"+theUPC).addClass("selected");comparedUPCS[0]=theUPC}function createVTOCookie(){var singleOrCompare=(!isCompare)?"single":"compare",upcs=(comparedUPCS.length>0)?comparedUPCS:comparedUPCS[0];jsonCookie={view:currentScreen,type:singleOrCompare,model:modelURL,upcs:upcs};$.cookie("vtoCookie",JSON.stringify(jsonCookie))}function readVTOCookie(){if($.cookie("vtoCookie")!=null){var jsonCookie=JSON.parse($.cookie("vtoCookie"));isCompare=(jsonCookie.type=="compare")?true:false;hideShowElements($("#setupScreen"),$("#vtoContainerWSidebar"));$("#webcamFlashContainer").removeClass("move");setupCarousels();setupCarouselNavigation();if(jsonCookie.view=="webcam"){$("#vtoLeftBar").show();$("#vtoMain").addClass("active");openTab("webcam");currentScreen="webcam";currentTab=$(".onYou");currentTab.addClass("selected");hideShowElements(null,$("#webcamScreen"));$("#webcamFlashContainer").removeClass("move");vtoTrack("use your webcam");if(vtoUPC!=""){vtoInterval=setTimeout(function(){setGlasses(vtoUPC);firstView=true;setItemFromVTO(vtoUPC)},4000);$("#vtoModal .product").removeClass("first")}else{if(jsonCookie.upcs!=undefined&&!isCompare){$("#vtoModal .product").removeClass("first");setGlasses(jsonCookie.upcs[0]);setItemFromVTO(jsonCookie.upcs[0]);comparedUPCS=jsonCookie.upcs}else{if(jsonCookie.upcs!=undefined&&isCompare){$("#vtoModal .product").removeClass("first");for(i=0;i<jsonCookie.upcs.length;i++){comparedUPCS.push(jsonCookie.upcs[i]);$("#carousels").find("#"+comparedUPCS[i]).addClass("selected");if(i==0){$("#vtoModal .product").removeClass("first");setGlasses(comparedUPCS[i],1);setProductInfo(0,comparedUPCS[i]);setTotalViewports(2)}else{var clonedProduct=$("#productsToCompare .product").eq(0).clone();clonedProduct.insertBefore("#productsToCompare .product.pick");$("#productsToCompare .product.pick:first").remove();setProductInfo(i,comparedUPCS[i]);checkProductCount();totalViewports=i+1;setGlasses(comparedUPCS[i],totalViewports);setTotalViewports(totalViewports)}}}}}}else{if(jsonCookie.model!=undefined){$("#vtoLeftBar").show();$("#vtoMain").addClass("active");if(jsonCookie.model.indexOf("lui")!=-1){mode="photo_male";$(".model-link.female").show();$(".model-link.male").hide()}else{mode="photo_female";$(".model-link.female").hide();$(".model-link.male").show()}modelURL=jsonCookie.model;hideShowElements($("#modelSelector, #chooseModel"),$("#modelScreen ul, #vtoBottom, #vtoRightBar"));showHideCompare();$("#webcamFlashContainer").removeClass("move")}else{hideShowElements($("#vtoBottom, #vtoRightBar"),$("#modelScreen"));$("#webcamFlashContainer").addClass("move")}openTab("model");currentScreen="model";currentTab=$(".onModel");currentTab.addClass("selected");vtoTrack("use model picture");if(vtoUPC!=""){vtoInterval=setTimeout(function(){setGlasses(vtoUPC);firstView=true;setItemFromVTO(vtoUPC)},4000);$("#vtoModal .product").removeClass("first")}else{if(jsonCookie.upcs!=undefined&&!isCompare){$("#vtoModal .product").removeClass("first");setGlasses(jsonCookie.upcs[0]);setItemFromVTO(jsonCookie.upcs[0]);comparedUPCS=jsonCookie.upcs;if(isCompare){setTotalViewports(2);$("#vtoModal .product").removeClass("first")}}else{if(jsonCookie.upcs!=undefined&&isCompare){$("#vtoModal .product").removeClass("first");for(i=0;i<jsonCookie.upcs.length;i++){comparedUPCS.push(jsonCookie.upcs[i]);$("#carousels").find("#"+comparedUPCS[i]).addClass("selected");if(i==0){$("#vtoModal .product").removeClass("first");setGlasses(comparedUPCS[i],1);setProductInfo(0,comparedUPCS[i]);setTotalViewports(2)}else{var clonedProduct=$("#productsToCompare .product").eq(0).clone();clonedProduct.insertBefore("#productsToCompare .product.pick");$("#productsToCompare .product.pick:first").remove();setProductInfo(i,comparedUPCS[i]);checkProductCount();totalViewports=i+1;setGlasses(comparedUPCS[i],totalViewports);setTotalViewports(totalViewports)}}}}}}}}function doHideDeleteButton(){var $length=$("#vtoModal .product").not(".pick").length;console.log($length);if($length==1){$(".product","#productsToCompare").eq(0).addClass("hideDelete")}else{$(".product","#productsToCompare").removeClass("hideDelete")}}$("a.vto").click(function(){$(".do-close","#main-navigation-container").click();if($("#main-navigation-container").hasClass("active")){menuOpen=true;$("#main-navigation-container").removeClass("active")}$("#vtoModal").show();showVTOLoader();$(document).scrollTop(0);if(!viewerInitialized||!googleChromeFirstLoad){googleChromeFirstLoad=true;showVTOLoader();$.getJSON(strCatalogueUrl,function(json){jsonKey=[];$.each(json,function(key,val){jsonKey.push(key.toString())});jsonObj=json});$.getJSON(vtoFramesUrl,function(json){vtoFramesJSONKey=[];$.each(json,function(key,val){vtoFramesJSONKey.push(key.toString())});vtoFramesJSON=json})}if($.cookie("vtoCookie")!=null){$("#setupScreen").remove()}vtoUPC=$(this).attr("rel");if(viewerInitialized){comparedUPCS=[];isCompare=false;totalViewports=1;showFrame(vtoUPC);setItemFromVTO(vtoUPC);setTotalViewports(totalViewports);showHideCompare();$("#productsToCompare .product").not(".pick, :first").remove();$("#productsToCompare .product.pick").show()}comparedUPCS[0]=vtoUPC;firstSelection=true;$("#vtoModal .product").removeClass("first").attr("id",vtoUPC);return false});$("a.vtoAddItemToList").click(function(){var returnURL=document.location.href;$.cookie("vtoReferrer",returnURL,{path:"/"});return true});