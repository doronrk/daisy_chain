var xhr,xhrComplete,request;
jQuery(function(a){a(".add-new-address").click(function(){a("#newaddress").modal();editAddressId=".add-new-address";return!1});a("#create-account-link").click(function(){a("#create-account").show();a("#create-account-button").hide()});a(".gift-checkbox").bind("propertychange change",function(c){("change"==c.type||"propertychange"==c.type&&"checked"==window.event.propertyName)&&toggleGiftMessage(a(this).attr("rel"),a(this).attr("checked"))});a('input[name^="giftwrap_"]').bind("propertychange change",function(){var c=
a(this).attr("id").split("_")[1],b=a(this).attr("checked");"checked"==b||!0==b?a('input[name="giftwraptype_'+c+'"]:radio').each(function(){a(this)[0].disabled=!1;a(this).removeAttr("disabled")}):a('input[name="giftwraptype_'+c+'"]:radio').each(function(){a(this)[0].disabled="disabled"});submitOrderItemUpdateOnGifting()});a('input[name^="giftwraptype_').bind("propertychange change",function(){submitOrderItemUpdateOnGifting()});a('textarea[name^="field2_"]').blur(function(){"dirty"==a(this).attr("dirty")&&
(submitOrderItemUpdateOnGifting(),a(this).removeAttr("dirty"))});a('textarea[name^="field2_"]').keydown(function(){a(this).attr("dirty","dirty")});a("#promoCode").change(function(){a(this).attr("value",a(this).attr("value").toLowerCase())});a("#promoCode").keypress(function(c){13==c.which&&a("#promoCode").trigger("change")});a("form#PromotionCodeForm").submit(function(c){c.preventDefault();a("#cart-area").block();null==request&&(request=a.ajax({url:a("form#PromotionCodeForm").attr("action"),dataType:"json",
data:a("form#PromotionCodeForm").serialize(),type:"POST",success:function(b){"false"===b.success?document.getElementById("promotionBlankError").innerHTML='<font color="red">'+b.errorMessage+"</font><br><br>":refreshPricingAfterOrderCalculation(!0,!0);a("#cart-area").unblock();request=null},error:function(){a("#cart-area").unblock();request=null}}));c.preventDefault()});a('input[name="email1"]').live("keyup",function(){a(this).val(a(this).val().toLowerCase())})});var canSee="block";
function toggleGiftMessage(a,c){c?($("#giftrow_"+a+"").parent().addClass("open"),$("#giftrow_"+a+"").slideDown(),$("#giftrow_"+a+"_2").css("display","block"),$("#giftrow_"+a+"_3").css("display","block")):($("#giftrow_"+a+"").slideUp("normal",function(){$(this).parent().removeClass("open")}),$("#giftrow_"+a+"_2").css("display","none"),$("#giftrow_"+a+"_3").css("display","none"),$("#giftwrap_"+a).attr("checked",!1),$('input[name="giftwraptype_'+a+'"]').attr("disabled",!0),$("textarea#gm_msg_"+a+"").val(""));
submitOrderItemUpdateOnGifting()}
function submitOnOrderItems(a,c,b,e){xhrComplete=!1;xhr=a.ajaxSubmit({dataType:"json",accepts:"*/json;charset=UTF-8",beforeSubmit:function(){c&&(document.getElementById("promotionBlankError").innerHTML="");b&&$("#cart-area").block()},success:function(a){"false"===a.success?(c?document.getElementById("promotionBlankError").innerHTML='<font color="red">'+a.errorMessage+"</font><br><br>":$("div.error-msg").text(a.errorMessage).show(),console&&console.warn&&console.warn(a)):refreshPricingAfterOrderCalculation(c,
e);b&&$("#cart-area").unblock();xhrComplete=!0}})}function appendOutOfInventoryMessage(a){var c=$("td.outofinventory-item");void 0!=c&&0<c.length&&appendInfoMessageTo(c,a)}function appendInfoMessageTo(a,c){a.each(function(){$('<div class="clear">&nbsp;</div>').appendTo($(this));var a=$('<div class="info-message" />');a.text(c);a.appendTo($(this))})}function submitPromoCode(){submitOnOrderItems($("form#PromotionCodeForm"),!0,!0,!1)}
function submitPromoCodeMini(){submitOnOrderItems($("form#PromotionCodeForm"),!0,!1,!0)}function swapOrderItemUpdateForAjax(){formSelector=$('form[name="ShopCartForm"]');var a=formSelector.children('input[name="URL"]'),c=a.val(),b=formSelector.children('input[name="ajaxURL"]');a.val(b.val());b.val(c);a=formSelector.children('input[name="errorViewName"]');c=a.val();b=formSelector.children('input[name="ajaxErrorViewName"]');a.val(b.val());b.val(c)}
function submitOrderItemUpdateOnGifting(){$("#ShopCartForm input[name=type]").val("jsonp");submitOnOrderItems($('form[name="ShopCartForm"]'),!1,!1);$("#ShopCartForm input[name=type]").val("")}function isPromoCodeBlank(a){return""==a?(document.getElementById("promotionBlankError").innerHTML='<font color="red">'+shopcartPromoCodeErrorMessage+"</font><br><br>",!0):!1}
function orderItemDeleteIfPriceError(){var a=$("td.delete-item");if(void 0!=a&&0<a.length){$("div#bad-items-hidden:hidden").show();appendInfoMessageTo(a,checkoutCartItemToBeRemoved);var c=standardWcsQueryParams+"&URL=SuccessView&errorTaskName=FailureView",a=$.map(a,function(a){return $(a).attr("id").split("-")[1]}),c=c+"&orderItemId="+a.join("&orderItemId=");$("td#total-total").text("Recalculating...");$("td#total-subtotal").text("Recalculating...");$("td#giftcard-subtotal").text("Recalculating...");
$("td#total-discount").text("Recalculating...");$("td#total-shipping").text("Recalculating...");$("td#total-adjustment-oversized-fee").text("Recalculating...");$("td#total-adjustment-gift-wrap").text("Recalculating...");executeOrderItemDeleteOnBadItems(c);$("td.delete-item > a").attr("href","javascript:void(0);")}}
function prepareOrderForSubmit(a){$.ajax({url:"/webapp/wcs/stores/servlet/OrderPrepare",dataType:"json",data:standardWcsQueryParams+"&URL=SuccessView&errorTaskName=FailureView&orderId="+a,type:"POST",success:function(){}})}
function refreshPricingAfterOrderCalculation(a,c){$.ajax({url:"/webapp/wcs/stores/servlet/OrderCalculate",dataType:"json",data:standardWcsQueryParams+"&URL=OrderTotalsJSONView&errorTaskName=OrderTotalsJSONView&orderId="+orderBeanOrderId+"&updatePrices=1&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-3&calculationUsageId=-4&calculationUsageId=-5&calculationUsageId=-6&calculationUsageId=-7",success:function(b){$("td#total-total").text(b.total);$("td#total-subtotal").text(b.subtotal);
$("td#giftcard-subtotal").text(b.giftcardsubtotal);$("td#product-balance").text(b.producttotal);$("td#total-tax").text(b.tax);"$0.00"==b.shipping?$("td#total-shipping").text(checkoutMinicartFree):$("td#total-shipping").text(b.shipping);$("td#total-adjustment-oversized-fee").text(b.oversizedfee);$("td#total-adjustment-gift-wrap").text(b.giftwrapfee);"$0.00"!=b.oversizedfee?$("td#total-adjustment-oversized-fee").parent().show():$("td#total-adjustment-oversized-fee").parent().hide();"$0.00"!=b.giftwrapfee?
($("tr#total-adjustment-gift-wrap-spacer").show(),$("td#total-adjustment-gift-wrap").parent().show()):($("tr#total-adjustment-gift-wrap-spacer").hide(),$("td#total-adjustment-gift-wrap").parent().hide());if(0<b.orderPromoDescArr.length){var e="";$.each(b.orderPromoDescArr,function(a,b){void 0!=b&&(e=e+b)});$("#promo-discount").show();$("#promo-discount-message").html(e);$("#promo-discount-amount").html(b.discount)}else $("#promo-discount").hide(),$("#promo-discount-message").html(""),$("#promo-discount-amount").html("");
var d=$("td.shipping-discount");if(0<b.shippingPromoDescArr.length){var f="";$.each(b.shippingPromoDescArr,function(a,b){void 0!=b&&(f=f+b)});d.html(f);d.show()}else d.hide(),d.html("");$(".promo-msg").hide();0<b.itemLevelPromoDescArr.length&&$.each(b.itemLevelPromoDescArr,function(a,b){if(void 0!=b){var c=b.split("#");if(c.length>0){if(elementPresent(document.getElementById("promo-msg-"+c[0]))){document.getElementById("promo-msg-"+c[0]).innerHTML=c[1];$("#promo-msg-"+c[0]).show()}if(elementPresent(document.getElementById("big-price-"+
c[0])))document.getElementById("big-price-"+c[0]).innerHTML=c[2];if(elementPresent(document.getElementById("msrp-price-"+c[0])))document.getElementById("msrp-price-"+c[0]).innerHTML=c[3];if(elementPresent(document.getElementById("save-price-"+c[0])))document.getElementById("save-price-"+c[0]).innerHTML=c[4];if(elementPresent(document.getElementById("subttl-"+c[0])))document.getElementById("subttl-"+c[0]).innerHTML=c[5];if(elementPresent(document.getElementById("pmt-price-"+c[0])))document.getElementById("pmt-price-"+
c[0]).innerHTML=c[5]}}});a&&"true"==b.promotionCodeAppliedButNotQualified&&(document.getElementById("promotionBlankError").innerHTML='<font color="red">'+checkoutCartPromotionAppliedButNotQualified+"</font><br><br>");$('input[name="orderId"][value="."]').each(function(a,c){$(c).attr("value",b.orderId)});c||(d=$('input[name^="orderItemId_"]').not(":disabled"),void 0!=d&&0==d.length&&$("a.checkout-button").attr("href","/webapp/wcs/stores/servlet/OrderItemDisplayView?"+standardWcsQueryParams+"&orderId=."));
c&&prepareOrderForSubmit(b.orderId);jQueryDisplayIntegerValue("10151_CVMINICART","items","#shoppingcart-display-count");jQueryDisplayIntegerValue("10151_CVMINICART","amount","#shoppingcart-display-total")},type:"POST",accepts:"*/json;charset=UTF-8"})}function elementPresent(a){return"undefined"!=typeof a&&null!=a?!0:!1}
function executeOrderItemDeleteOnBadItems(a){$.ajax({url:"/webapp/wcs/stores/servlet/OrderItemDelete",dataType:"json",data:a,success:function(){refreshPricingAfterOrderCalculation(!1,!1)},type:"POST",accepts:"*/json;charset=UTF-8"})}
function setupLabel(){$(".label_check input").length&&($(".label_check").each(function(){$(this).removeClass("c_on")}),$(".label_check input:checked").each(function(){$(this).parent("label").addClass("c_on")}));$(".label_radio input").length&&($(".label_radio").each(function(){$(this).removeClass("r_on")}),$(".label_radio input:checked").each(function(){$(this).parent("label").addClass("r_on")}))}
function cloneNewGenericAddressAttachTo(a,c,b){var e=$("#addAddressForm_TODO").clone();e.children('input[name="addressType"]').val(b);e.children('input[name="addressId"]').attr("disabled",!0);e.submit(function(a){a.preventDefault()});e.attr("id",a);e.children("dl.form").children("dd.actions").children("button").click(function(a){a.preventDefault()});"S"==b&&(a=e.children("dl.form"),a.children(".phone1").remove(),a.children(".phone2").remove(),a.children(".email1").remove(),a.children(".send-me-email").remove());
e.children('input[name="selfAddress"]').attr("disabled",!0);e.appendTo(c);"S"==b&&$('input[name="shipSameBill"]').change()}function switchFormElementDisabled(a,c,b){var e=document.getElementById(a);if(void 0!=e){var a=e.elements,d=0;"G"==b&&c?$(e).hide():"G"==b&&!c&&$(e).show();for(d=0;d<a.length;d++)b=a[d],"hidden"!=b.type&&(c?($(b).attr("disabled","disabled"),$(b).css("background-color","#DED4C9")):($(b).removeAttr("disabled"),$(b).css("background-color","")))}}
function adjustTabIndexOnForm(a,c){var b=document.getElementById(a);if(void 0!=b)for(var b=b.elements,e=0,e=0;e<b.length;e++){var d=b[e];if("hidden"!=d.type){var d=$(d),f=parseInt(d.attr("tabindex"));d.attr("tabindex",f+c)}}}
function cloneExistingAddressIntoFormForEdit(a,c,b,e){var d=$("#addAddressForm_TODO").clone();d.children('input[name="addressType"]').val(a.addressType);"B"==a.addressType||"S"==a.addressType&&a.addressId!=jsBillingAddressId?(d.children('input[name="addressId"]').attr("disabled",!1).val(a.addressId),d.children('input[name="editAddressId"]').attr("disabled",!1).val(a.addressId),d.children('input[name="nickName"]').attr("disabled",!0)):(d.children('input[name="addressId"]').attr("disabled",!0),d.children('input[name="editAddressId"]').attr("disabled",
!0),d.children('input[name="nickName"]').attr("disabled",!1));d.attr("id",b);b=d.children("dl.form").children("dd");b.children('input[name="firstName"]').val(a.firstName);b.children('input[name="lastName"]').val(a.lastName);b.children('input[name="address1"]').val(a.address1);b.children('input[name="address2"]').val(a.address2);b.children('input[name="city"]').val(a.city);b.children('input[name="country"]').val(a.country);var f=b.children("select");f.children("option:selected").removeAttr("selected");
f.children('option[value="'+a.state+'"]').attr("selected",!0);b.children('input[name="zipCode"]').val(a.zipCode);if("B"==a.addressType){b.children('input[name="email1"]').val(a.email1);var g=a.phone1,f=g.substring(0,3),h=g.substring(3,6),g=g.substring(6,10);b.children('input[name="phone1Part1"]').val(f);b.children('input[name="phone1Part2"]').val(h);b.children('input[name="phone1Part3"]').val(g);g=a.phone2;f=g.substring(0,3);h=g.substring(3,6);g=g.substring(6,10);b.children('input[name="phone2Part1"]').val(f);
b.children('input[name="phone2Part2"]').val(h);b.children('input[name="phone2Part3"]').val(g);"true"===a.selfAddress?d.children('input[name="selfAddress"]').removeAttr("disabled"):d.children('input[name="selfAddress"]').attr("disabled",!0)}else a=d.children("dl.form"),a.children(".phone1").remove(),a.children(".phone2").remove(),a.children(".email1").remove(),a.children(".send-me-email").remove(),d.children('input[name="selfAddress"]').attr("disabled",!0);e.hide();d.submit(function(a){a.preventDefault()});
d.appendTo(c)}
function updateShippingAddressId(a){for(var c=1;null!=document.getElementById("isPickupItem_"+c);c++)"false"==document.getElementById("isPickupItem_"+c).value&&(document.getElementById("addressId_"+c).value=a);document.PickupOrderItemUpdate.URL.value="SuccessView";document.PickupOrderItemUpdate.errorViewName.value="FailureView";$("#PickupOrderItemUpdate").ajaxSubmit({success:function(a){if("false"==a.success){var c=$("#addrErrors");c.html(a.errorMessage);c.show();$.unblockUI()}else window.location=$(".continue-checkout-button-next").attr("href")},
dataType:"json"})}function changeShippingAddress(a){window.currentAddressContainer=window["addressBookAddress_"+a];void 0!=window.currentAddressContainer&&(window.currentAddressContainer.addressType="S",jsShippingAddressId=currentAddressContainer.addressId,a=$("#edit_shipping"),void 0!=a&&0<a.length?a.click():editShippingAddressEvent(void 0),jsShippingAddressId!=jsBillingAddressId&&$('input[name="shipSameBill"]').attr("checked",!1).change())}
function addNewAddressEvent(){var a=$('input[name="shipSameBill"]');a[0].checked=!1;a.change();$("form#addAddressForm_Shipping").remove();a=$("#cart-left > .checkout-content");a.children(".address-group").hide();cloneNewGenericAddressAttachTo("addAddressForm_Shipping",a,"S");adjustTabIndexOnForm("addAddressForm_Shipping",30)}
function editShippingAddressEvent(){var a=void 0;void 0!=window.currentAddressContainer?(a=window.currentAddressContainer,$("form#addAddressForm_Shipping").remove()):(window.currentAddressContainer=void 0,a=void 0!=window["addressBookAddress_"+jsShippingAddressId]?window["addressBookAddress_"+jsShippingAddressId]:window["addressBookAddress_"+jsBillingAddressId]);a.addressType="S";a.selfAddress=void 0;cloneExistingAddressIntoFormForEdit(a,$("#cart-left > .checkout-content"),"addAddressForm_Shipping",
$("#cart-left > .checkout-content > .address-group"));$('input[name="shipSameBill"]')[0].checked=!1;$('input[name="shipSameBill"]').removeAttr("checked");adjustTabIndexOnForm("addAddressForm_Shipping",30)}function ContinueButtonLinking(a,c,b){this.requestHeaderReferer=a;this.backToHomePageRelative=c;this.continueButtonElement=b}
ContinueButtonLinking.prototype={setContinueButtonAsHistoryBack:function(){this.continueButtonElement.attr("href","#");this.continueButtonElement.removeAttr("onclick");this.continueButtonElement.unbind("click");this.continueButtonElement.click(function(){history.go(-1);return!1})},setContinueButtonAsHome:function(){this.continueButtonElement.attr("href",this.backToHomePageRelative);this.continueButtonElement.removeAttr("onclick")},checkRefererForIgnores:function(){var a=!1,c=this.requestHeaderReferer;
$.each(["/webapp/wcs/stores/servlet/OrderItemDisplay"],function(b,e){if(-1!=c.indexOf(e))return a=!0,!1});return a},setButtonLinking:function(){-1!=this.requestHeaderReferer.indexOf(window.location.host)?this.checkRefererForIgnores()?this.setContinueButtonAsHome():this.setContinueButtonAsHistoryBack():this.setContinueButtonAsHome()}};function getSubStringValue(a,c){return a.length>c?a.substring(0,c):a};
