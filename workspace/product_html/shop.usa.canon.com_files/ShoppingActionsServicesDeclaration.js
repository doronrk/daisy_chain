dojo.require("wc.service.common");dojo.require("dijit.registry");shoppingActionsServicesDeclarationJS={langId:"-1",storeId:"",catalogId:"",setCommonParameters:function(langId,storeId,catalogId){this.langId=langId;this.storeId=storeId;this.catalogId=catalogId;}};wc.service.declare({id:"AddOrderItem",actionId:"AddOrderItem",url:getAbsoluteURL()+"AjaxOrderChangeServiceItemAdd",formId:"",successHandler:function(serviceResponse){dojo.require("dijit.registry");MessageHelper.hideAndClearMessage();cursor_clear();if(shoppingActionsJS){var attributes_container=dojo.query('div[id^="attrValue_"]');if((dojo.query(".definingAttributes")[0])!=null){var attributes_container=dojo.query(".definingAttributes");}else{if((dojo.query(".product_sizes")[0])!=null){var attributes_container=dojo.query(".product_sizes");}else{if((dojo.query(".product_info")[0])!=null){var attributes_container=dojo.query(".product_info");}}}var attributes=new Array();for(var i=0;i<attributes_container.length;i++){var attribute_selectors=attributes_container[i].querySelectorAll(".dijitSelect");for(var j=0;j<attribute_selectors.length;j++){attributes=attributes.concat(attribute_selectors[j]);}}var dijitSelect=new Array();for(var i=0;i<attributes.length;i++){dijitSelect[i]=dijit.registry.byNode(attributes[i]);}var singleSKU=true;for(var i=0;i<dijitSelect.length;i++){if(dijitSelect[i].options.length>2){singleSKU=false;}}if(!singleSKU){shoppingActionsJS.selectedAttributes=new Object();dojo.topic.publish("DefiningAttributes_Resolved_"+shoppingActionsJS.baseCatalogEntryId,shoppingActionsJS.baseCatalogEntryId,-1);for(var i=0;i<dijitSelect.length;i++){if(dijitSelect[i]!=null){dijitSelect[i].value="";}}}}if(typeof(ShipmodeSelectionExtJS)!=null&&typeof(ShipmodeSelectionExtJS)!="undefined"){ShipmodeSelectionExtJS.setOrderItemId(serviceResponse.orderItemId[0]);}var latestProductInfo=shoppingActionsJS.productAddedList[shoppingActionsJS.baseCatalogEntryId];shoppingActionsJS.CMshopTageGenerate(shoppingActionsJS.baseCatalogEntryId.value,document.title.split("|",1),"",shoppingActionsJS.storeId,latestProductInfo);try{shoppingActionsJS.widgets.CusaProductAccessoriesDialogWidget.show();}catch(e){console.debug(e);}},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){if(serviceResponse.errorMessageKey=="_ERR_NO_ELIGIBLE_TRADING"){MessageHelper.displayErrorMessage(storeNLS["ERROR_CONTRACT_EXPIRED_GOTO_ORDER"]);}else{if(serviceResponse.errorMessageKey=="_ERR_RETRIEVE_PRICE"){var tempString=storeNLS["GENERICERR_MAINTEXT"];tempString=dojo.string.substitute(tempString,{0:storeNLS["GENERICERR_CONTACT_US"]});MessageHelper.displayErrorMessage(tempString);}else{MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}}}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}}),wc.service.declare({id:"AddOrderItemCarepak",actionId:"AddOrderItemCarepak",url:getAbsoluteURL()+"AjaxOrderChangeServiceItemAdd",formId:"",successHandler:function(serviceResponse){dojo.require("dijit.registry");MessageHelper.hideAndClearMessage();cursor_clear();if(shoppingActionsJS){if(shoppingActionsJS.getNoOfCarepakGroups()<=1){shoppingActionsJS.getCatentryForCarepakPlus();var carepakArr=new Array();var carepakId=document.getElementsByName("servicePak_option");for(var i=0;i<carepakId.length;i++){if(carepakId[i].checked==true){var selectedServicePak=carepakId[i].id;carepakArr=selectedServicePak.split("_");}}carepakId=carepakArr[2];var carepakSelected="servicePak_option_"+carepakId;var carepakTnCSelected="servicePak_terms_"+carepakId;shoppingActionsJS.AddItem2ShopCartCarePakPlusAjax(carepakId,shoppingActionsJS.getCatentryForCarepakPlus(),serviceResponse.orderId,serviceResponse.orderItemId);}else{var modelID=shoppingActionsJS.getCatentryForCarepakPlus();var carepakIDsArr=new Array();var count=0;var noOFCarePakgroups=shoppingActionsJS.getNoOfCarepakGroups();for(i=1;i<=noOFCarePakgroups;i++){var carepakNames=document.getElementsByName("servicePak_option_"+i);for(var j=0;j<carepakNames.length;j++){if(carepakNames[j].checked==true){var selectedServicePak=carepakNames[j].id.split("_")[2];if(!isNaN(selectedServicePak)){carepakIDsArr[count]=selectedServicePak;count++;}}}}shoppingActionsJS.AddMultiCarepakItems2ShopCartAjax(carepakIDsArr,modelID,serviceResponse.orderId,serviceResponse.orderItemId);}}if(typeof(ShipmodeSelectionExtJS)!=null&&typeof(ShipmodeSelectionExtJS)!="undefined"){ShipmodeSelectionExtJS.setOrderItemId(serviceResponse.orderItemId[0]);}shoppingActionsJS.CMshopTageGenerate(shoppingActionsJS.baseCatalogEntryId.value,"ESP","ESP",shoppingActionsJS.storeId,shoppingActionsJS.productAddedList[shoppingActionsJS.baseCatalogEntryId]);},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){if(serviceResponse.errorMessageKey=="_ERR_NO_ELIGIBLE_TRADING"){MessageHelper.displayErrorMessage(storeNLS["ERROR_CONTRACT_EXPIRED_GOTO_ORDER"]);}else{if(serviceResponse.errorMessageKey=="_ERR_RETRIEVE_PRICE"){var tempString=storeNLS["GENERICERR_MAINTEXT"];tempString=dojo.string.substitute(tempString,{0:storeNLS["GENERICERR_CONTACT_US"]});MessageHelper.displayErrorMessage(tempString);}else{MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}}}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}}),wc.service.declare({id:"AddOrderItemAccessoryLayer",actionId:"AddOrderItemAccessoryLayer",url:getAbsoluteURL()+"AjaxOrderChangeServiceItemAdd",formId:"",successHandler:function(serviceResponse){dojo.require("dijit.registry");MessageHelper.hideAndClearMessage();cursor_clear();shoppingActionsJS.CMshopTageGenerate(shoppingActionsJS.baseCatalogEntryId.value,"Accessories","Accessory Layer",shoppingActionsJS.storeId,shoppingActionsJS.productAddedList[shoppingActionsJS.baseCatalogEntryId]);console.debug("new method for acc layer");if(shoppingActionsJS){location.href=getAbsoluteURL()+"OrderItemDisplay?&calculationUsageId=-1&calculationUsageId=-2&calculationUsageId=-3&calculationUsageId=-4&calculationUsageId=-7&updatePrices=1&catalogId="+WCParamJS.catalogId+"&errorViewName=AjaxOrderItemDisplayView&orderId="+serviceResponse.orderId+"&langId="+WCParamJS.langId+"&storeId="+WCParamJS.storeId+"&URL=AjaxOrderItemDisplayView";}},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){if(serviceResponse.errorMessageKey=="_ERR_NO_ELIGIBLE_TRADING"){MessageHelper.displayErrorMessage(storeNLS["ERROR_CONTRACT_EXPIRED_GOTO_ORDER"]);}else{if(serviceResponse.errorMessageKey=="_ERR_RETRIEVE_PRICE"){var tempString=storeNLS["GENERICERR_MAINTEXT"];tempString=dojo.string.substitute(tempString,{0:storeNLS["GENERICERR_CONTACT_US"]});MessageHelper.displayErrorMessage(tempString);}else{MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}}}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}}),wc.service.declare({id:"AddPreConfigurationToCart",actionId:"AddOrderItem",url:getAbsoluteURL()+"AjaxOrderChangeServiceAddPreConfigurationToCart",formId:"",successHandler:function(serviceResponse){MessageHelper.hideAndClearMessage();cursor_clear();if(shoppingActionsJS){var attributes=document.getElementsByName("attrValue");var singleSKU=true;for(var i=0;i<attributes.length;i++){if(attributes[i].options.length>1){singleSKU=false;}}if(!singleSKU){shoppingActionsJS.selectedAttributes=new Object();for(var i=0;i<attributes.length;i++){if(attributes[i]!=null){attributes[i].value="";attributes[i].onchange();}}}}if(typeof(ShipmodeSelectionExtJS)!=null&&typeof(ShipmodeSelectionExtJS)!="undefined"){ShipmodeSelectionExtJS.setOrderItemId(serviceResponse.orderItemId[0]);}},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){if(serviceResponse.errorMessageKey=="_ERR_NO_ELIGIBLE_TRADING"){MessageHelper.displayErrorMessage(storeNLS["ERROR_CONTRACT_EXPIRED_GOTO_ORDER"]);}else{if(serviceResponse.errorMessageKey=="_ERR_RETRIEVE_PRICE"){var tempString=storeNLS["GENERICERR_MAINTEXT"];tempString=dojo.string.substitute(tempString,{0:storeNLS["GENERICERR_CONTACT_US"]});MessageHelper.displayErrorMessage(tempString);}else{MessageHelper.displayErrorMessage(serviceResponse.errorMessage);}}}else{if(serviceResponse.errorMessageKey){MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);}}cursor_clear();}}),wc.service.declare({id:"NotifySubmit",actionId:"NotifySubmit",url:getAbsoluteURL()+"CusaNotify",formId:"",successHandler:function(serviceResponse){dojo.require("dijit.registry");MessageHelper.hideAndClearMessage();cursor_clear();document.getElementById("NotifyMeSuccess").innerHTML="Thank you. Your email has been submitted. We will send you an email notification when this product is available.";document.getElementById("NotifyMeSuccess").style.display="block";document.getElementById("NotifyMeFailure").style.display="none";document.getElementById("NotifyMeContent").style.display="none";document.getElementById("NotifyMeEspot").style.display="none";document.getElementById("NotifyMeEspotConf").style.display="block";},failureHandler:function(serviceResponse){if(serviceResponse.errorMessage){document.getElementById("NotifyMeFailure").innerHTML=MessageHelper.displayErrorMessage(serviceResponse.errorMessage);document.getElementById("NotifyMeFailure").style.display="block";document.getElementById("NotifyMeSuccess").style.display="none";document.getElementById("NotifyMeContent").style.display="none";}else{if(serviceResponse.errorMessageKey){document.getElementById("NotifyMeFailure").innerHTML=MessageHelper.displayErrorMessage(serviceResponse.errorMessageKey);document.getElementById("NotifyMeFailure").style.display="block";document.getElementById("NotifyMeSuccess").style.display="none";document.getElementById("NotifyMeContent").style.display="none";}}cursor_clear();}});