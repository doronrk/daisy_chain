(function () { 'use strict';
Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;for(c=0,d=this.length;d>c;++c)c in this&&a.call(b,this[c],c,this)}),document.getElementsByClassName||(document.getElementsByClassName=function(a){for(var b=[],c=this.getElementsByTagName("*"),d=new RegExp("(^|\\s)"+a+"(\\s|$)"),e=c.length,f=0;e>f;f++)d.test(c[f].className)&&b.push(c[f]);return b}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(void 0===this||null===this)throw new TypeError('"this" is null or not defined');var c=this.length>>>0;for(b=+b||0,1/0===Math.abs(b)&&(b=0),0>b&&(b+=c,0>b&&(b=0));c>b;b++)if(this[b]===a)return b;return-1}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f,g,h=[];for(f in e)a.call(e,f)&&h.push(f);if(b)for(g=0;d>g;g++)a.call(e,c[g])&&h.push(c[g]);return h}}()),EB.utils=function(a,b){{var c=(b.settings,Object.prototype),d=Array.prototype;Function.prototype}return{isNull:function(a){return null==a},isUndefined:function(a){return"[object Undefined]"==c.toString.call(a)},isEmpty:function(a){if(null==a)return!0;if(this.isArray(a)||this.isString(a))return 0===a.length;for(var b in a)if(this.has(a,b))return!1;return!0},isBoolean:function(a){return a===!0||a===!1||"[object Boolean]"==c.toString.call(a)},isObject:function(a){return a===Object(a)},isString:function(a){return"[object String]"==c.toString.call(a)},isNumber:function(a){return"[object Number]"==c.toString.call(a)},isFunction:function(a){return"[object Function]"==c.toString.call(a)},isDate:function(a){return"[object Date]"==c.toString.call(a)},isElement:function(a){return!(!a||1!==a.nodeType)},has:function(a,b){return c.hasOwnProperty.call(a,b)},extend:function(a){return this.toArray(arguments,1).forEach(function(b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}),a},toArray:function(a,b){var c=null;b=b||0;try{c=d.slice.call(a,b)}catch(e){c=new Array;for(var f=0,g=a.length;g>f;f++)b>f||c.push(a[f])}return c},toObject:function(a){for(var b,c=a.split("&"),d={},e=0,f=c.length;f>e;e++)b=c[e].split("="),d[b[0]]=b[1];return d},load:function(a,b){this.isArray(a);var c=document.getElementsByTagName("script")[0],d=document.createElement("script");return b=this.isFunction(b)?b:function(){},d.onreadystatechange=function(){("loaded"===d.readyState||"complete"===d.readyState)&&(d.onreadystatechange=null,setTimeout(function(){b()},1))},d.onload=function(){setTimeout(function(){b()},1)},d.src=a,c.parentNode.insertBefore(d,c),this},getParameterByName:function(b,c){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var d=new RegExp("[\\?&]"+b+"=([^&#]*)"),e=d.exec(a.location.search);return null==e?"undefined"!=typeof c?c:e:decodeURIComponent(e[1].replace(/\+/g," "))},param:function(a){var b,c=[];for(b in a)"undefined"!=typeof a[b]&&""!==a[b]&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")},makeUrl:function(a,b){return a+(a.indexOf("?")>-1?"&":"?")+this.param(b)},docCookies:{getItem:function(a){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0}}}}(window,EB);var APIMediator=function(){function a(a,b,c,d,e,f){function g(a){if(!a.method||!a.url||!a.callback)return void f.error("Malformed API request:",a);if(a.custom_response_headers&&!(a.custom_response_headers instanceof Array))return void f.error("POST custom_response_headers should be an ARRAY");if(-1==a.url.indexOf(d.API_URL)&&(a.url=i+a.url),a.url+=-1==a.url.indexOf("?")?"?":"&",a.url+="EBUID="+d.EBUID+"&EBSID="+d.EBSID,"POST"==a.method&&-1!=a.url.indexOf("/users/")){var b=a.callback;a.callback=function(a){b(a),a.results&&a.results.id&&localStorage.setItem("EBUID",a.results.id)}}c(a)}function h(a){var b=d.API_URL+"/v1/l/"+d.FAID;a.obfuid=d.EBUID,c({url:b+"?"+e.param(a),method:"GET",callback:function(a){f.info("tracking response "+a)}})}var i=d.API_URL+"/org/"+d.ORG_ID;return{request:g,track:h}}var b;return{getInstance:function(c,d,e,f,g,h,i){return b||(b=a(c,d,e,f,g,h,i)),b}}}(),AdvancedLogger=function(){function a(a,b,c){function d(a){var b=c.toArray(a),d=(new Date).getTime(),f=((d-e)/1e3).toFixed(3);return b.unshift("[ EB_DEBUG "+f+" ]"),b.join(" ")}var e=(new Date).getTime(),f=function(c){return function(){b.DEBUG&&a.console&&a.console[c](d(arguments))}},g=f("error"),h=f("info"),i=f("warn");return{error:g,info:h,warn:i}}var b;return{getInstance:function(c,d,e){return b||(b=a(c,d,e)),b}}}(),DocumentObjectModelManipulator=function(){return{clone:function(a,b){var c=document.getElementById(a).cloneNode(!0);return c.id="",b&&function d(a){var c,e=a.childNodes,f=e.length,g=0;for(a.getAttribute&&(c=a.getAttribute("data-id")),c&&(b[c]=a);f>g;++g)d(e[g])}(c),c},classify:function(a,b,c){var d,e=(a.className||"").split(" "),f=(b||"").split(" "),g=f.length,h=0;if(c||void 0===c)for(;g>h;++h)d=e.indexOf(f[h]),0>d&&e.push(f[h]);else for(;g>h;++h)d=e.indexOf(f[h]),d>=0&&e.splice(d,1);a.className=e.join(" ")},fill:function(a){for(var b,c=1;a.hasChildNodes();)a.removeChild(a.firstChild);for(;c<arguments.length;++c)arguments[c]&&(b=typeof arguments[c],a.appendChild("string"===b||"number"===b?document.createTextNode(arguments[c]):arguments[c]))},remove:function(a){a.parentNode&&a.parentNode.removeChild(a)}}}(),EventMediator=function(){function a(a,b,c,d){for(var e,f,g,h=0,i=a.length-1;i>=0;i--)e=a[i],2==e.length&&(f=e[0],g=e[1],b.isString(f)&&b.isFunction(g)&&(d.on(f,g),h++,a.splice(i,1)));h&&c.info("Added "+h+" queued event listener"+(h>1?"s":""))}function b(a,b,d){var e={};return{INIT:"init",READY:"ready",ABOUT:"about",BROADCAST:"broadcast",PLUGIN_INIT:"plugin:init",PLUGIN_RESIZE:"plugin:resize",API_REQUEST:"api:request",API_RESPONSE:"api:response",DOM_APPEND:"dom:append",DOM_UPDATE:"dom:update",DOM_REMOVE:"dom:remove",TRACK_CLICK:"eb:track:click",HOST_INFO:"host:info",toPlugin:function(a,c){a.contentWindow.postMessage(b.stringify(c),"*")},toPlugins:function(a,b){var d,e;for(d=0;d<a.length;d++)e=a[d],e.iframe&&c.toPlugin(e.iframe,b)},on:function(a,b,c){var d=e[a]||(e[a]=[]);return d.push({callback:b,context:c}),this},off:function(a,b,c){b||c||delete e[a];for(var d=e[a]||[],f=0;f<d.length;f++)b&&d[f].callback!==b||c&&d[f].context!==c||d.splice(f,1);return this},trigger:function(a){for(var b=d.toArray(arguments,1),c=e[a]||[],f=0,g=c.length;g>f;f++)c[f].callback.apply(c[f].context||this,b);return this}}}var c;return{getInstance:function(d,e,f,g,h){return c||(c=b(d,e,g,h),a(f,g,h,c)),c}}}(),PluginCollection=function(){function a(a,b,d,e,f,g,h){function i(){return k++}function j(a){if(!(this instanceof j))throw new TypeError("Plugin constructor cannot be called as a function.");this.name=a.name,this.url=a.url,this.WUID=i(),this.build=a.build,this.width=a.width,this.height=a.height,this.state=a.state,this.data={}}var k=8;j.prototype.embed=function(c,g){var h=a.document.createElement("iframe"),i=e.extend({WUID:this.WUID,PLUGIN:g,HOST:{url:b}},d);return delete i.request,delete i.status,delete i.PLUGINS,h.width="100%",h.height="100%",h.scrolling="no",h.frameBorder="0",h.allowTransparency=!0,h.id="p-"+this.name+this.WUID,h.name=h.id,h.src=e.makeUrl(g.url+"#/",{settings:JSON.stringify(i)}),this.iframe=h,f.classify(c,"eb-inited"),f.fill(c,h),EB.about.plugins[this.name]={settings:i},h},j.prototype.send=function(a){h.toPlugin(this.iframe,a)},j.prototype.on=function(a,b){h.on(a,b,this)};var l=a.document.getElementById("fb-root");e.isNull(l)&&(l=a.document.createElement("div"),l.id="fb-root",a.document.body.insertBefore(l,a.document.body.firstChild));var m,n,o,p,q,r={};for(o=a.document.getElementsByClassName("eb-plugin"),m=0,n=d.PLUGINS.length;n>m;m++)p=d.PLUGINS[m],r[p.name]=p;for(m=0,q=o.length;q>m;m++){var s=o[m],t={},u=e.toArray(s.attributes);s.className.indexOf("eb-inited")>-1||(u.forEach(function(a){"data-"==a.name.substring(0,5)&&(t[a.name.substring("data-".length)]=a.value)}),t.name&&(e.extend(t,r[t.name]),t.url&&(p=new j(t),s.style.position="relative",p.div=s,p.build=t.build||p.build,p.embed(s,t),c[p.WUID]=p,g.info("Embedded plugin: "+p.name))))}return c}var b,c=[];return{getInstance:function(c,d,e,f,g,h,i,j){return b||(b=a(c,d,e,f,g,h,i,j)),b}}}(),EventListeners=function(){function a(a,b,c,d,e,f,g,h,i){function j(a){if(-1!=a.origin.indexOf("strcst.net")&&-1==a.data.indexOf("_SGC_")){var c=b.parse(a.data);f.info("Received a "+c.type+" message from iframe"),g.trigger(c.type,c)}}function k(a,b){var c=b.WUID;if(b.data.styleElement){var d=document.createElement("style"),e=document.getElementsByTagName("head")[0];d.setAttribute("type","text/css"),e.appendChild(d),d.styleSheet?d.styleSheet.cssText=b.data.styleElement:d.appendChild(document.createTextNode(b.data.styleElement))}if(b.data.scriptElement){var f=document.createElement("script");f.type="text/javascript";var g="(function($ParentPlugin){",h="}(EB.plugins["+c+"]));";f.text=g+b.data.scriptElement+h,a.appendChild(f)}}return a.addEventListener?a.addEventListener("message",j,!1):a.attachEvent("onmessage",j),g.on(g.ABOUT,function(a){EB.about=d.extend({},EB.about,a.data)}),g.on(g.BROADCAST,function(a){var b=i.filter(function(b){return b.WUID!==a.WUID});g.toPlugins(b,a.data)}),g.on(g.PLUGIN_INIT,function(a){a.settings=c,g.toPlugin(i[a.WUID].iframe,a),i[a.WUID].state="initialized"}),g.on(g.PLUGIN_RESIZE,function(a){try{i[a.WUID].iframe.width=a.data.width,i[a.WUID].iframe.height=a.data.height}catch(b){f.info("Failed to resize: "+a)}}),g.on(g.API_REQUEST,function(a){function b(b){a.type=g.API_RESPONSE,a.response=b,g.toPlugin(i[a.WUID].iframe,a)}var c=a.data;c.callback=b,h.request(c)}),g.on(g.DOM_APPEND,function(b){var c=i[b.WUID].div;if(b.data.hasOwnProperty("markup")){var d=a.document.createElement("div");b.data.hasOwnProperty("className")&&(d.className=b.data.className),d.innerHTML=b.data.markup,c.appendChild(d)}k(c,b)}),g.on(g.DOM_UPDATE,function(b){if(b.data&&b.data.element_class){var c=i[b.WUID],d=a.document.getElementById(b.data.element_class);if(!d)return void EB.logger.error("Can't find DOM Element to UPDATE",b.data.element_class);b.data.markup&&(d.innerHTML=b.data.markup),k(c.div,b)}}),g.on(g.DOM_REMOVE,function(b){if(b.data&&b.data.element_class)for(var c=a.document.getElementsByClassName(b.data.element_class),d=0,e=c.length;e>d;d++)c[d].parentNode&&c[d].parentNode.removeChild(c[d])}),g.on(g.TRACK_CLICK,function(a){a.data&&h.track(a.data)}),null}var b;return{getInstance:function(c,d,e,f,g,h,i,j,k){return b||(b=a(c,d,e,f,g,h,i,j,k)),b}}}();!function(){function a(){var a=localStorage.getItem("EBUID");a?EB.settings.EBUID=a:localStorage.setItem("EBUID",EB.settings.EBUID);var b=EB.utils.docCookies.getItem("EBSID");b?EB.settings.EBSID=b:EB.utils.docCookies.setItem("EBSID",EB.settings.EBSID,0,"/")}function b(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return console&&console.log&&console.warn("Fluid EB: This browser does not support local storage."),!1}}EB.init=function(){if(EB.settings&&EB.utils&&b()){a(),EB.logger=AdvancedLogger.getInstance(window,EB.settings,EB.utils),EB.events=EventMediator.getInstance(window,JSON,EB,EB.utils,EB.logger),EB.events.trigger(EB.events.INIT),EB.api=APIMediator.getInstance(window,JSON,EB.xhr,EB.settings,EB.utils,EB.logger,EB.events),EB.plugins=PluginCollection.getInstance(window,EB.page_url,EB.settings,EB.utils,DocumentObjectModelManipulator,EB.logger,EB.events,EB.api);{EventListeners.getInstance(window,JSON,EB.settings,EB.utils,DocumentObjectModelManipulator,EB.logger,EB.events,EB.api,EB.plugins)}}}}();
}());