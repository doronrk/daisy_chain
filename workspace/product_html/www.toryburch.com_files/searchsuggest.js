/*
 * All java script logic for the search suggestions.
 *
 * The code relies on the jQuery JS library to
 * be also loaded.
 *
 * The logic extends the JS namespace app.*
 */(function(e){e?e.searchsuggest={acListTotal:0,acListCurrent:-1,acDelay:300,acURL:null,acFormId:null,acSearchId:null,acResultsId:null,acSearchField:null,acResultsDiv:null,fieldDefault:null,suggestionsJson:null,init:function(t,n,r,i,s){e.searchsuggest.acFormId="#"+t,e.searchsuggest.acSearchId="#"+n,e.searchsuggest.acResultsId="#"+i,e.searchsuggest.acURL=s,e.searchsuggest.fieldDefault=r,e.util.disableAutoComplete(n),jQuery("body").append('<div id="'+i+'"></div>'),e.searchsuggest.acSearchField=jQuery(e.searchsuggest.acSearchId),e.searchsuggest.acResultsDiv=jQuery(e.searchsuggest.acResultsId),e.searchsuggest.repositionResultsDiv(),e.searchsuggest.acSearchField.blur(function(){setTimeout("app.searchsuggest.clear()",200)}),e.searchsuggest.acSearchField.keyup(function(t){var n=t.keyCode||window.event.keyCode,r=e.searchsuggest.acSearchField.val();if(e.searchsuggest.updownArrow(n))return;if(n==13||n==27){e.searchsuggest.clear();return}setTimeout(function(){e.searchsuggest.suggest(r)},e.searchsuggest.acDelay)}),e.searchsuggest.acSearchField.focus(function(){var t=e.searchsuggest.acSearchField.val();t==e.searchsuggest.fieldDefault&&e.searchsuggest.acSearchField.val("")}),jQuery(e.searchsuggest.acFormId).submit(function(){var t=jQuery(e.searchsuggest.acFormId).attr("action"),n=e.searchsuggest.acSearchField.val();if(n!=e.searchsuggest.fieldDefault&&n!=""){var t=e.util.appendParamToURL(t,"q",n);window.location=e.util.appendParamToURL(t,"fromsearch",!0)}return!1}),jQuery(window).unbind("resize",e.searchsuggest.doResize).bind("resize",e.searchsuggest.doResize)},suggest:function(t){var n=e.searchsuggest.acSearchField.val();if(n==""){e.searchsuggest.clear();return}if(t!=n)return;var r=e.util.appendParamToURL(e.searchsuggest.acURL,"q",n);jQuery.getJSON(r,function(t){var n=e.searchsuggest.acListTotal=t.suggestions.length;if(n>0){var r="";for(i=0;i<n;i++)r+='<div class="unselected"><div class="suggestionterm">'+t.suggestions[i].suggestion+"</div>",r+="</div>";e.searchsuggest.suggestionsJson=t.suggestions,e.searchsuggest.acResultsDiv.html('<p id="searchsuggesttop">&nbsp;</p><div	 id="searchsuggestmid"><p class="searchsuggesth"><i>suggested</i> SEARCHES</p>'+r+"</div>"+'<p id="searchsuggestbot">&nbsp;</p>'),e.searchsuggest.acResultsDiv.css("display","block"),e.searchsuggest.repositionResultsDiv();var s=jQuery(e.searchsuggest.acResultsId+" #searchsuggestmid > div");s.mouseover(function(){s.each(function(){this.className="unselected"}),this.className="selected"}),s.each(function(t){jQuery(this).click(function(){e.searchsuggest.acSearchField.val(e.searchsuggest.suggestionsJson[t].suggestion),e.searchsuggest.clear(),jQuery(e.searchsuggest.acFormId).submit()})})}else e.searchsuggest.clear()})},clear:function(){e.searchsuggest.acResultsDiv.html(""),e.searchsuggest.acResultsDiv.css("display","none")},repositionResultsDiv:function(){var t=e.searchsuggest.acSearchField.parents("div:first");if(t.length>0){var n=t.offset();if(n){var r=n.top,i=n.left,s=t.height(),o=t.width(),u=243;e.searchsuggest.acResultsDiv.addClass("suggestions"),e.searchsuggest.acResultsDiv.css("position","absolute"),e.searchsuggest.acResultsDiv.css("left",i+o-u),e.searchsuggest.acResultsDiv.css("top",r+s-1),e.searchsuggest.acResultsDiv.css("width",u),e.searchsuggest.acResultsDiv.css("z-index","7777")}}},doResize:function(){e.searchsuggest.repositionResultsDiv()},updownArrow:function(t){return t==40||t==38?(t==38?e.searchsuggest.acListCurrent==0||e.searchsuggest.acListCurrent==-1?e.searchsuggest.acListCurrent=e.searchsuggest.acListTotal-1:e.searchsuggest.acListCurrent--:e.searchsuggest.acListCurrent==e.searchsuggest.acListTotal-1?e.searchsuggest.acListCurrent=0:e.searchsuggest.acListCurrent++,jQuery(e.searchsuggest.acResultsId+" #searchsuggestmid > div").each(function(t){t==e.searchsuggest.acListCurrent?(e.searchsuggest.acSearchField.val(e.searchsuggest.suggestionsJson[t].suggestion),this.className="selected"):this.className="unselected"}),!0):(e.searchsuggest.acListCurrent=-1,!1)}}:alert("app namespace is not loaded yet!")})(app);