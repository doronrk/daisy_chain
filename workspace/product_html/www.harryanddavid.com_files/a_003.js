mmcore.SetCookie('mmid','-169285|AwAAAArZNp8eTQsAAA==',365,1);mmcore.SetCookie('pd','2113621453|BAAAAAoBQtk2nx5NC5eM9+0BAIN1EarU3NFIAA4AAABeNm2p1NzRSAAAAAD/////AP//////////AAZEaXJlY3QBTQsBAAAAAAABAQABAADNIgAAugUAAP////8CAAMCAAAAIiPOL00LAP////8BTQtNC///AQAAAAAAAAHHCAAA/wwAAAACAgAAABP2Va5NCwD/////C00LTQv//wEAAAAAAAAAAAFbdzidCgAMO6Kx3QICAAAC/m3P4AICAAAC7oDZtgICAAACx15hFAICAAACtZu31wICAAAC0zZ9IQICAAACSXh1iwICAAACs//t2QICAAADDwNTywICAAADJuKFCwICAAADdPp7cgICAAADwWb14wICAAADAAFF',365);mmcore.SetCookie('srv','nycvwcgus08',365);(function(){if(typeof(mmcore.GenInfo)!='object')mmcore.GenInfo={};if(typeof mmcore.recommendations=='undefined')mmcore.recommendations={};
if(typeof mmcore.recommendationErrors=='undefined')mmcore.recommendationErrors={};
mmcore.recommendations['json_BoughtThis']=unescape('[{id:%2750%27, name:%27Signature Holiday Tower of Treats&#174; Gift%27, price:29' + 
 '.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2Fis%2Fimage%2FHarr' + 
 'yandDavid%2FChannelAdvisorPreset%2F1530_50-signature-holiday-tower-of-tr' + 
 'eats-gift.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%2Fgift' + 
 '-baskets-tower-boxes%2Fseasonal-gift-towers%2F50%27, attr1:%27Gift Baske' + 
 'ts & Towers%27, recmethod:2, countinstock:1},{id:%2755%27, name:%27Merry' + 
 ' Mix-Up&#174; Gift Box%27, price:24.95, imageurl:%27http:%2F%2Fimages.ha' + 
 'rryanddavid.com%2Fis%2Fimage%2FHarryandDavid%2FChannelAdvisorPreset%2F15' + 
 '30_55-merry-mix-up-gift-box.jpg%27, pageurl:%27http:%2F%2Fwww.harryandda' + 
 'vid.com%2Fh%2Fgift-baskets-tower-boxes%2Fall-occasion-gift-boxes%2F55%27' + 
 ', attr1:%27Gift Baskets & Towers%27, recmethod:2, countinstock:1},{id:%2' + 
 '72%27, name:%27Two Boxes of The Favorite&#174; Royal Riviera&#174; Pears' + 
 '%27, price:49.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2Fis%2' + 
 'Fimage%2FHarryandDavid%2FChannelAdvisorPreset%2F1530_2-two-boxes-of-the-' + 
 'favorite-royal-riviera-pears.jpg%27, pageurl:%27http:%2F%2Fwww.harryandd' + 
 'avid.com%2Fh%2Ffruit-gift%2Fpears%2F2%27, attr1:%27Pears, Fruit & Clubs%' + 
 '27, recmethod:2, countinstock:1},{id:%2724917%27, name:%27David%5C%27s H' + 
 'oliday Gift Tower%27, price:39.95, imageurl:%27http:%2F%2Fimages.harryan' + 
 'ddavid.com%2Fis%2Fimage%2FHarryandDavid%2FChannelAdvisorPreset%2F1530_24' + 
 '917-davids-holiday-gift-tower.jpg%27, pageurl:%27http:%2F%2Fwww.harryand' + 
 'david.com%2Fh%2Fgift-baskets-tower-boxes%2Fseasonal-gift-towers%2F24917%' + 
 '27, attr1:%27Gift Baskets & Towers%27, recmethod:2, countinstock:1},{id:' + 
 '%274571%27, name:%27Harry%5C%27s Gift Box%27, price:39.95, imageurl:%27h' + 
 'ttp:%2F%2Fimages.harryanddavid.com%2Fis%2Fimage%2FHarryandDavid%2FChanne' + 
 'lAdvisorPreset%2F1530_4571-harrys-gift-box.jpg%27, pageurl:%27http:%2F%2' + 
 'Fwww.harryanddavid.com%2Fh%2Fgift-baskets-tower-boxes%2Fall-occasion-gif' + 
 't-boxes%2F4571%27, attr1:%27Gift Baskets & Towers%27, recmethod:2, count' + 
 'instock:1},{id:%273%27, name:%27Family Affair Royal Riviera&#174; Pears%' + 
 '27, price:36.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2Fis%2F' + 
 'image%2FHarryandDavid%2FChannelAdvisorPreset%2F1530_3-family-affair-roya' + 
 'l-riviera-pears.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%' + 
 '2Ffruit-gift%2Fpears%2F3%27, attr1:%27Pears, Fruit & Clubs%27, recmethod' + 
 ':2, countinstock:1},{id:%2729181%27, name:%27Cushman%5C%27s&#174; HoneyB' + 
 'ells%27, price:19.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2F' + 
 'is%2Fimage%2FHarryandDavid%2FChannelAdvisorPreset%2FFOMC_23672-cushmans-' + 
 'honeybells.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%2Ffru' + 
 'it-gift%2Fhoneybell-oranges%2F29181%27, attr1:%27Pears, Fruit & Clubs%27' + 
 ', recmethod:2, countinstock:0},{id:%275000%27, name:%27Favorites Gift Ba' + 
 'sket%27, price:54.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2F' + 
 'is%2Fimage%2FHarryandDavid%2FChannelAdvisorPreset%2F1530_5000-favorites-' + 
 'gift-basket.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%2Fgi' + 
 'ft-baskets-tower-boxes%2Fall-occasion-gift-baskets%2F5000%27, attr1:%27G' + 
 'ift Baskets & Towers%27, recmethod:3, countinstock:1},{id:%274179%27, na' + 
 'me:%27Bear Creek&#174; Gift Box%27, price:59.95, imageurl:%27http:%2F%2F' + 
 'images.harryanddavid.com%2Fis%2Fimage%2FHarryandDavid%2FChannelAdvisorPr' + 
 'eset%2F1530_4179-bear-creek-gift-box.jpg%27, pageurl:%27http:%2F%2Fwww.h' + 
 'arryanddavid.com%2Fh%2Fgift-baskets-tower-boxes%2Fall-occasion-gift-boxe' + 
 's%2F4179%27, attr1:%27Gift Baskets & Towers%27, recmethod:3, countinstoc' + 
 'k:1},{id:%2724600%27, name:%27Founders%5C%27 Favorites Gift Box%27, pric' + 
 'e:69.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2Fis%2Fimage%2F' + 
 'HarryandDavid%2FChannelAdvisorPreset%2F1530_24600-founders-favorites-gif' + 
 't-box.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%2Fgift-bas' + 
 'kets-tower-boxes%2Fall-occasion-gift-boxes%2F24600%27, attr1:%27Gift Bas' + 
 'kets & Towers%27, recmethod:3, countinstock:1},{id:%274205%27, name:%27D' + 
 'eluxe Signature Gift Basket%27, price:49.95, imageurl:%27http:%2F%2Fimag' + 
 'es.harryanddavid.com%2Fis%2Fimage%2FHarryandDavid%2FChannelAdvisorPreset' + 
 '%2F1530_4205-deluxe-signature-gift-basket.jpg%27, pageurl:%27http:%2F%2F' + 
 'www.harryanddavid.com%2Fh%2Fgift-baskets-tower-boxes%2Fall-occasion-gift' + 
 '-baskets%2F4205?ref=evite&cm_mmc=Shopping_Feeds-_-secondfield-_-thirdfie' + 
 'ld-_-fourthfield%27, attr1:%27Gift Baskets & Towers%27, recmethod:3, cou' + 
 'ntinstock:1},{id:%2712404%27, name:%27Deluxe Favorites Gift Basket%27, p' + 
 'rice:79.95, imageurl:%27http:%2F%2Fimages.harryanddavid.com%2Fis%2Fimage' + 
 '%2FHarryandDavid%2FChannelAdvisorPreset%2F1530_12404-deluxe-favorites-gi' + 
 'ft-basket.jpg%27, pageurl:%27http:%2F%2Fwww.harryanddavid.com%2Fh%2Fgift' + 
 '-baskets-tower-boxes%2Fall-occasion-gift-baskets%2F12404%27, attr1:%27Gi' + 
 'ft Baskets & Towers%27, recmethod:3, countinstock:1}]');
mmcore.recommendations['BoughtThis']=eval(mmcore.recommendations['json_BoughtThis']);
mmcore.recommendationErrors['json_InvalidFilters']='[]';
mmcore.recommendationErrors['InvalidFilters']=eval(mmcore.recommendationErrors['json_InvalidFilters']);
mmcore.EH=function(e){var s=e.message+'\r\n';if(!window.mm_error)window.mm_error=s;else window.mm_error+=s;};
mmcore.GenInfo['ProdPageRecs2']={'element1':'boughtthis'};
mmcore.GenInfo['BoughtThis']={};
try{
/* Written by Kutischev */
mmcore.AttachStyle('\
	.mm-view { overflow: hidden; } \
	.mm-view a { \
		display: block; \
		width: 64px; \
		height: 25px; \
		float: right; \
		color: #fff; \
		text-align: center; \
		font: bold 11px/25px Verdana, Arial, sans-serif; \
		background: url("//service.maxymiser.net/cdn/harryanddavid/maxrec/button25.png"); \
		text-decoration: none; \
		text-transform: uppercase; \
	} \
	.mm-view a:hover { background-position: 0 -25px; } \
');

// Add Array.indexOf support to IE
if(!Array.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0);i<this.length;i++){if(this[i]==obj){return i}}return-1}}

// Anonymous function
(function(){

	var $ = jQuery,
		recCont = $('.up_sale .title:contains("May We Also Suggest")').parent(),
		goDeluxBlock = $('.up_sale .title:contains("Go Deluxe")').parent(),
		resultingHTML = '<div class="title">May We Also Suggest</div> <div class="product-display clearfix">',
		currViewingProdID = document.getElementById('itemNumber').innerHTML.match(/\d+/)[0],	// Currently displaying poduct's ID
		goDeluxIDs = [],
		prodArr = [],	// IDs of products that appended to resulting string
		categories = [
			'Chocolates & Sweets',
			'Chocolate & Sweets',
			'Flowers & Plants',
			'Fruit of the Month Clubs',
			'Gift Baskets & Towers',
			'Gourmet Foods',
			'Pears & Fresh Fruit'
        ];


	// Check for "May We Also Suggest" block existance
	if (!recCont.length) {
		$('#productImage').parent().next().append('<div id="mmRec" class="up_sale clearfix"></div>');
		recCont = $('#mmRec');
	}

	
	// Function sets position of "View" button
	function setHeight(){
		var heights = [],
			els,
			max;
		els = $('.name', recCont);
		els.each(function(){
			heights.push($(this).height());
		});
		max = Math.max.apply(Math, heights);
		els.height(max);

	}

	// Function computates resultingHTML string
	function appendRec(recsObj, recMethod){
		//Up oleg ch 09.10.14
		recsObj = (function(rec){
			var recOut = [];
			for (var i = 0; i < rec.length; i++) {
				if(rec[i].countinstock == 1){
					recOut.push(rec[i]);
				}
			}
			return recOut;
		}(recsObj));

		if(!recsObj) return;
		for (var i = 0; i < recsObj.length; i++) {

			
			//exclude product #50537 (ticket US_TS-1166)
			if(recsObj[i].id == 50537)
				continue;

			
			// exit loop if 3 products added
			if (prodArr.length == 3) {
				resultingHTML += '</div>'; break;
			}
			// don't recommend currently displaying product
			if (currViewingProdID == recsObj[i].id) continue;
			// don't recommend products from "Go Delux" block
			if (goDeluxIDs.indexOf(recsObj[i].id) != -1) continue;
			// don't recommend products from already added products
			if (prodArr.indexOf(recsObj[i].id) != -1) continue;
			// Don't show any methods except "recMethod"
			if (recsObj[i].recmethod !== recMethod) continue;
			// Don't show products which names are starts with "Sympathy"
			if (recsObj[i].name.indexOf('Sympathy') == 0) {
				var currProdName = $.trim($('.product_title h2').text());
				if (currProdName.indexOf('Sympathy') != 0) continue;
			}

			if (prodArr.length != 0) resultingHTML += prodsSep;	// Add separator
			
			// Add zero to prices if needed
			if (recsObj[i].price.toString().replace(/\d+\./, '').length == 1) { 
				recsObj[i].price += '0';
			}

			resultingHTML += recTemplate.replace(/\{[^\}]*\}/g, function(key){
				switch (key) {
					case '{pageurl}' : return recsObj[i].pageurl + (recsObj[i].pageurl.match(/\?/) ? '&' : '?') + 'specialCode=XS&urlVirtualCat=Cross-Sell'; break;
					case '{imageurl}' : return recsObj[i].imageurl.replace(/\$category220\$/, '$thumbnail_cross_sale2010$').replace(/\$ChannelAdvisorPreset\$/, '$thumbnail_cross_sale2010$'); break;
					case '{name}' : return recsObj[i].name; break;
					case '{price}' : return recsObj[i].price; break;
				}
			});

			prodArr.push(recsObj[i].id);
		}
	}


	var recTemplate = '\
		<div class="group"> \
			<div class="image"> \
				<a href="{pageurl}"> \
					<img src="{imageurl}" border="0" width="130" height="130" alt="{name}" /> \
				</a> \
			</div> \
			<div class="details"> \
				<div class="name"> \
					<a href="{pageurl}">{name}</a> \
				</div> \
				<div class="product-display"> \
					<div id="productPrice" class="price"> \
						${price} \
					</div> \
				</div> \
				<div>\
    <a href="{pageurl}" class="button CTA-secondary">View</a> \
</div> \
			</div> \
		</div> \
	';

	var prodsSep = '<div class="spacer background-dot-vertical"></div>';

	// Anumerate Go Delux product's IDs
	if (goDeluxBlock.length > 0) {
		goDeluxBlock.find('.name a').each(function(){
			//var id = $(this).attr('href').match(/item______(\d+)/)[1];
			var id = $(this).attr('href').replace(/\D/g,'');
			goDeluxIDs.push(id);
		});
	}


	// Creating of resulting html-code
	appendRec(mmcore.recommendations['BoughtThis'], 2);

	// If there is less then 3 items recommended
	if (prodArr.length < 3) {
		var currentCategory = 0,
			crumb = $('#breadcrumb .crumb').eq(1).text();
		
		function check(str){
			for (var i = 0; i < categories.length; i++) {
				if (str.indexOf(categories[i]) > -1) {
					currentCategory = categories[i].replace(/®/g, '');
				}
			}
		}
		check(document.title);
		currentCategory ? null : check(crumb);
		mmcore.SetPageID('Most Rated');
		mmcore.SetProductFilter(1, currViewingProdID, 1);
		mmcore._async = true;

		mmcore.CGRequest(function(){
			appendRec(mmcore.recommendations['Most Rated'], 3);
			if (prodArr.length == 0) {
				recCont.remove();
				mmcore.AttachStyle(' #productMediaAndUpSells .up_sale { visibility: visible; } ');
				return;
			}
			recCont.html(resultingHTML);	// Append generated content
			setHeight();
			mmcore.addRecsClickAction();
			mmcore.AttachStyle(' #productMediaAndUpSells .up_sale { visibility: visible; } ');	// Show maxyboxes
		});
	} else {
		recCont.html(resultingHTML);	// Append generated content
		setHeight();
		mmcore.AttachStyle(' #productMediaAndUpSells .up_sale { visibility: visible; } ');	// Show maxyboxes
	}

})();
}catch(err){mmcore.EH(err);}
try{
// Written by Kutischev

// Add Array.indexOf support to IE
if(!Array.indexOf){Array.prototype.indexOf=function(obj,start){for(var i=(start||0);i<this.length;i++){if(this[i]==obj){return i}}return-1}}

mmcore.addRecsClickAction = function(){
	$('.up_sale .title:contains("May We Also Suggest")').parent().find('a').unbind('click').click(function(){
		//var id = this.href.match(/item______(\d+)/)[1],
		var id = this.href.replace(/\D/g,''),
			idsStr = mmcore.GetCookie('lastClickedRecs'),
			idsArray = [],
			indexOfID = idsArray.indexOf(id);
			
		if (idsStr.length > 0) {
			idsArray = idsStr.split(',')
		}

		// If current product's id already exists in cookie than we add it to the end of stack
		if (idsArray.indexOf(id) != -1) {
			idsArray.splice(idsArray.indexOf(id), 1);
		}
		idsArray.push(id);
		
		// Remove first ID when they amount becames larger then 30
		if (idsArray.length > 30) {
			idsArray.shift();
		}

		mmcore.SetCookie('lastClickedRecs', idsArray.join(','), 365);

		mmcore.$Action('Recs_Click', 1)
	});
}

mmcore.addRecsClickAction();

// AddToCartMR action
$('#submitButtons a:not(.dijitButtonDisabled)').live('click', function(){
	mmcore.SetAction('AddToCartMR', 1);
	mmcore.SetPageID('~~~');
	mmcore._async = true;
	mmcore.CGRequest();
});

/* Time to Purchase Action Start Time*/
(function(){
	var timer = mmcore.GetCookie("TimeToPurch");
	if(!timer){
		var tmv = parseInt((new Date().getTime()/1000));
		mmcore.SetCookie("TimeToPurch", tmv, 365);
	}
})();
}catch(err){mmcore.EH(err);}
if(typeof mmcore._callback=='object'&&typeof mmcore._callback[4]=='function'){try{mmcore._callback[4]();}catch(err){mmcore.EH(err);}
finally{mmcore._callback[4]=null;}}
})();