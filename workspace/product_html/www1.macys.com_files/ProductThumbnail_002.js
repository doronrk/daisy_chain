define(["underscore","jquery","backbone","globals","registryUtil"],function(t,e,r,i,a){"use strict";var s=16,o=16,n=64;return r.Model.extend({thumbnailDomain:"",defaults:{loaded:false},url:function(){return"/shop/catalog/product/newthumbnail/json?productId="+this.id+"&source=118"+(a.isRegistry()?"&registry=true":"")},isValid:function(){if(this.attributes.errorMessage){return false}if(!this.attributes.productThumbnail){return false}if(!this.attributes.priceInfo){return false}return true},initialize:function(e){var r=this;if(e){var i,a;i=t.map(e.swatchColorList,function(t,i,a){return r.buildColorSwatchData(t,e,i,a)});a={small:r.generateColorSwatchesPixie(i),jumbo:r.generateColorSwatchesPixie(i,n)};t.each(i,function(t,i){return r.generateColorSwatchUrls(t,e,i,a)});this.set("swatchColorList",i)}},width:function(){return 164},getAlternateImagePath:function(t){return""},buildColorSwatchData:function(e,r,i,a){var l,u,h,c,f,m,p,b;l={};u=a.length;h=parseInt(u/s,10);c=u%s;f=parseInt(i/s,10);m=i%s;b=t.keys(e);l.title=b[0];if(r.colorFamily&&r.colorFamily.hasOwnProperty(l.title)){l.family=r.colorFamily[l.title]}l.path=e[l.title];l.altPath=this.getAlternateImagePath(l.title);if(f<h){l.offset=s*o-m*s}else{l.offset=o*c-m*s}l.jumboOffset=parseInt(l.offset*n/o,10);return l},generateColorSwatchesPixie:function(t,e){var r=0,i,a,n=0,l,u=0,h=t.length,c="",f=[];if(!e){e=o}l=parseInt(h/s,10);for(;n<h;n++){a=t[n];if(r<l){i=s}else{i=h%s}if(u===0){c+="&layer=0&size="+parseInt(i*e,10)+","+e+"&src=is{$b$"+a.path+"}&cropN=0,0,"+i+",1&anchor=0,0";u+=1}else if(u<i){c+="&layer="+u+"&size="+e+","+e+"&src=is{$b$"+a.path+"}&anchor=0,0&posN="+(1/i*u).toFixed(3)+",0";u+=1}if(u===i){u=0;r+=1;c+="&layer="+i+"&op_sharpen=1&fmt=jpeg&qlt=90,0&hei="+e;f.push(c);c=""}}return f},generateColorSwatchUrls:function(t,e,r,a){var o=parseInt(r/s,10),n=i.getValue("props.imageHost");t.thumb=n+"/?&$b="+this.thumbnailDomain+"/swatches/"+a.small[o];t.jumbo=n+"/?&$b="+this.thumbnailDomain+"/swatches/"+a.jumbo[o];if(t.altPath){t.preview=n+"/products/"+t.altPath+"?"+e.mediumFilter+"&wid="+this.width()}}})});