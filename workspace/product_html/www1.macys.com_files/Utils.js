define(function(){var e={defaultScope:{}};function r(e,r){var t=Handlebars.helpers[e];if(!t){throw"Helper '"+e+"' not found."}return t.apply(this,r)}function t(e,r){if(!e||e.indexOf(".")!==-1){throw"Invalid key "+e}if(!r){return undefined}var t=/([^\[]*)\[([^\]]*)\s*\]/,n=t.exec(e),u,a;if(n){e=n[1];u=n[2].trim()}a=r[e];if(a&&u!==undefined){a=a[u]}return a}function n(e,r){if(!e||!r){return undefined}var n=e.split("."),u,a=0,i=n.length,f=r;for(;a<i;a++){u=n[a];f=t(u,f)}return f}function u(r,t,n){var u,a,i,f;if(n&&typeof n==="string"){i=n;a={}}else{n=n||{};u=n.hash||{};a=n.data||{};i=u.scope}if(!i){if(a.templateScope){f=a.templateScope}else{i="defaultScope"}}if(!f){f=e[i]||(e[i]={})}f[r]=t}function a(r,t){if(!r){return undefined}t=t||{};var n=t.data||{},u,a;if(r.indexOf(".")!==-1){u=r.split(".");a=e[u[0]];return a?a[u[1]]:undefined}return n.templateScope?n.templateScope[r]:e.defaultScope[r]}function i(e){return e.replace(/\[\s*|\s*\]/g,"")}function f(e){var r;if(isNaN(Number(e))){r=/^(['"]).*\1$/.test(e)}else{r=true}return r}function s(e){if(/^(['"]).*\1$/.test(e)){e=e.replace(/^(['"])(.*)\1$/,"$2")}else{e=Number(e)}return e}function l(e,r,t){r=r||{};t=t||{};if(e.indexOf(".")===-1){if(e.indexOf("@")===0){return t.data?t.data[e.substr(1)]:undefined}else if(e==="this"){return r}else{e=e.replace(/^\[(.+)\]$/,"$1").trim();return r[e]}}else{var n=e.split("."),u=0,a=n.length,i=r;for(;u<a;u++){i=l(n[u],i);if(!i){break}}return i}}function c(e){var r=/(?:'(?:[^'\\]|\\\')*')|(?:"(?:[^"\\]|\\\")*")/,t=[],n=/\([^\)\(]*\)/,u=[],a,i,f={},s=function(e){e=e.replace(/---(\d+)---/,function(e,r){return u[r]}).replace(/%%%(\d+)%%%/g,function(e,r){return t[r]});return e};e=e.trim();if(e.match(/^\([^)(]+\)$/)){e=e.replace(/^\((.*)\)$/,"$1").trim()}while((a=r.exec(e))!==null){e=e.replace(r,"%%%"+t.length+"%%%");t.push(a[0])}while((a=n.exec(e))!==null){e=e.replace(n,"---"+u.length+"---");u.push(a[0])}i=e.split(/\s+/);if(i.length!==1&&i.length!==3){throw"invalid number of arguments "+i}f.arg1=s(i[0]);if(i.length>1){f.arg1=c(f.arg1);f.operator=i[1];f.arg2=c(s(i[2]))}return f}function o(e,r,t){switch(r){case"||":return e||t;case"&&":return e&&t;case"==":return e==t;case"===":return e===t;case"!=":return e!=t;case"!==":return e!==t;case"<":return e<t;case"<=":return e<=t;case">":return e>t;case">=":return e>=t;case"%":return e%t;case"+":return e+t;case"-":return e-t;case"/":return e/t;case"*":return e*t;default:throw"Operator '"+r+"' is not implemented."}}function d(e,r,t){var n,u,i=e.operator,c;if(!i){c=e.arg1;switch(c){case"true":case true:return true;case"false":case false:return false;case"undefined":case undefined:return undefined;case"null":case null:return null;default:if(f(c)){return s(c)}else if(typeof c==="string"&&c.indexOf("$")===0){return a(c.substr(1),t)}else{return l(c,r,t)}}}n=d(e.arg1,r,t);u=d(e.arg2,r,t);return o(n,i,u)}return{evaluate:function(e,r,t){return d(c(e),r,t)},get:a,set:u,getValueFromJSON:n,callOtherHelper:r,getIdFromPath:i}});