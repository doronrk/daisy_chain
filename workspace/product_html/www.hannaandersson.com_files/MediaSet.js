/*!************************************************************************
*
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2011 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by trade secret or copyright law.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
s7sdk.pkg("s7sdk.set");s7sdk.Util.require("s7sdk.common.Geometry");s7sdk.Util.require("s7sdk.common.IS");s7sdk.Util.require("s7sdk.common.ItemDesc");s7sdk.Util.require("s7sdk.utils.SwatchesParser");if(!s7sdk.set.MediaSetControl){s7sdk.set.MediaSetControl=function(a){arguments.callee.superclass.apply(this,[null,null,null,null,null]);this.component=a;this.compId=this.component.getId();this.parentId=this.component.pid;s7sdk.Util.borrowMethods(this.component,this,s7sdk.set.MediaSetControl.NS);a.settings.registerComponent(this)};s7sdk.set.MediaSetControl.NS="s7sdk.set.MediaSetControl";s7sdk.set.MediaSetControl.prototype.setModifier=function(a){var d="";var n=this.component.getModifiers();var p=this.component.settings;var m=false;var o={};for(var j in a){var q=j.toLowerCase();o[q]=a[j]}var e=o.asset;var g=(e?e:this.component.asset);var h=false;for(var f in n){var c=f.toLowerCase();var l;if(o[c]){if(c=="serverurl"){s7sdk.Logger.log(s7sdk.Logger.INFO,"s7sdk.set.MediaSet setModifier - unsupported modifier: %0",f);continue}l=o[c];if(c=="enableorientation"&&this.component.jsonSet){var b=l.toString();if(b=="1"||b=="true"||b=="false"||b=="0"){this.component.enableOrientation=b=="1"||b=="true";this.component.requestComplete({set:this.component.jsonSet},this.component)}else{continue}}else{if(c=="asset"&&l&&l!=""){d=this.component.asset;m=true;h=true}else{if(c=="labelkey"&&l){d=this.component.labelKey;this.component.labelKey=l;m=true}}}this.dispatchEvent(new s7sdk.event.ControlComponentEvent(s7sdk.event.ControlComponentEvent.NOTF_CONTROLCOMPONENT_MODIFIERUPDATED,{id:this.component.getId(),oldvalue:d,newvalue:l,property:c},false))}}if(m){this.component.setAssetInternal(g,h)}};s7sdk.set.MediaSetControl.prototype.unload=function(){}}s7sdk.Class.inherits(s7sdk.set.MediaSetControl.NS,"s7sdk.UIComponent");if(!s7sdk.set.MediaSet){s7sdk.set.MediaSet=function MediaSet(a,c,b){var d=!!arguments[3];s7sdk.Logger.log(s7sdk.Logger.CONFIG,"s7sdk.set.MediaSet constructor - containerId: %0, settings: %1 , compId: %2",a,c,b);arguments.callee.superclass.apply(this,[b,a,"div","s7mediaset",c,!d]);this.createElement();this.container=s7sdk.Util.byId(a);this.mediaSetDesc=null;this.globalISModifier=null;this.locale=this.getParam("locale","");if(this.serverUrl.lastIndexOf("/")!=(this.serverUrl.length-1)){this.serverUrl+="/"}if(typeof(this.asset)=="string"&&this.asset.length>0){this.requestMediaSet()}if(!d){return new s7sdk.set.MediaSetControl(this)}else{return this}};s7sdk.Class.inherits("s7sdk.set.MediaSet","s7sdk.UIComponent");s7sdk.set.MediaSet.prototype.symbols={};s7sdk.set.MediaSet.prototype.modifiers={asset:{params:["asset"],defaults:[""],parseParams:false},serverUrl:{params:["isRootPath"],defaults:["/is/image/"]},enableOrientation:{params:["value"],defaults:[false],ranges:[[true,false]]},labelKey:{params:["key"],defaults:["label"]}};s7sdk.set.MediaSet.prototype.setAsset=function(a){this.setAssetInternal(a,true)};s7sdk.set.MediaSet.prototype.setAssetInternal=function(a,b){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.MediaSet.setAsset - asset: %0",a);this.blockLabels=b;a=a.toString();if(a==""||a==null){return}if(a!=null&&this.asset!=null&&this.asset!=""){var c=decodeURIComponent(a).split("/",2);var d=(c.length==2)?c[1]:c[0];this.dispatchEvent(new s7sdk.event.UserEvent(s7sdk.event.UserEvent.SWAP,[0,d]))}this.asset=a;this.requestMediaSet()};s7sdk.set.MediaSet.prototype.addEventListener=function(c,b,a){s7sdk.Logger.log(s7sdk.Logger.FINE,"s7sdk.set.MediaSet.addEventListener - type: %0, handler: %1, useCapture: %2",c,b.toString().substring(0,b.toString().indexOf("(")),a);this.superproto.addEventListener.apply(this,[c,b,a])};s7sdk.set.MediaSet.prototype.requestMediaSet=function(){s7sdk.Logger.log(s7sdk.Logger.INFO,"MediaSet.requestMediaSet");this.mediaSet_=this.asset;var b=this.serverUrl;if(b.lastIndexOf("/")<(b.length-1)){b+="/"}var a=s7sdk.MediaSetParser.parseAssetForSetReq(this.asset);this.globalISModifier=a.mod;b+=a.req;if(s7sdk.Util.isNonEmptyString(this.labelKey)){b+="&labelkey="+this.labelKey}if(s7sdk.Util.isNonEmptyString(this.locale)){b+="&locale="+this.locale}this.isReq_=new s7sdk.IS(this.serverUrl,this.mediaSet_);this.isReq_.getHttpReq(b,this.requestComplete,this.requestError,this)};s7sdk.set.MediaSet.prototype.requestComplete=function(b,d){var a=b.set;if(a==null){return}d.jsonSet=b.set;var e=s7sdk.MediaSetParser.parse(a,d.globalISModifier);d.mediaSetDesc_=d.enableOrientation?s7sdk.set.MediaSet.prototype.createSplitFramesMediaSet(e,true):e;if(d.updateLandscapeLabels){d.updateLabels()}var c=new s7sdk.event.AssetEvent(s7sdk.event.AssetEvent.NOTF_SET_PARSED,d.mediaSetDesc_,0,true);d.dispatchEvent(c)};s7sdk.set.MediaSet.prototype.updateLabels=function(){this.updateLandscapeLabels();this.updatePortraitLabels()};s7sdk.set.MediaSet.prototype.updateLandscapeLabels=function(){var h=this.mediaSetDesc_.landscape?this.mediaSetDesc_.landscape.items:this.mediaSetDesc_.items;var a=this.getLocalizedText("LABEL_DELIM");a=a&&!this.blockLabels?a:" - ";for(var f=0;f<h.length;f++){var l=h[f];var j=f.toString();var d=l.label;var g=undefined;var e=undefined;if(l.images){d=undefined;if(l.images[0].label){g=l.images[0].label}if(l.images[1]&&l.images[1].label){e=l.images[1].label}}var m=this.blockLabels?null:this.getLocalizedText("LABEL_"+j);var c=this.blockLabels?null:this.getLocalizedText("LABEL_"+j+"_0");var b=this.blockLabels?null:this.getLocalizedText("LABEL_"+j+"_1");var k="";if(!l.np){if(m){k=m}else{if(c){k=c;if(b){k+=a+b}}else{if(d){k=d}else{if(g){k=g;if(e){k+=a+e}}else{if(e){k=e}}}}}}else{if(m){k=m}else{if(c){k=c}else{if(d){k=d}}}}l.label=k}};s7sdk.set.MediaSet.prototype.updatePortraitLabels=function(){if(!this.mediaSetDesc_.portrait){return}var f=this.mediaSetDesc_.portrait.items;var a=null;var b=false;var d=0;var h="";for(var e=0;e<f.length;e++){var j=f[e];if(e==0&&j.halfFrame){b=true}a=((b?e:e-1)&1)==0?"_0":"_1";var c=null;var g=d.toString();var k=this.getLocalizedText("LABEL_"+g);if(a=="_0"){c=this.getLocalizedText("LABEL_"+g+"_0")}else{c=this.getLocalizedText("LABEL_"+g+"_1");d++}if(c){j.label=c}else{if(k){j.label=k}}if(!j.label){j.label=""}}};s7sdk.set.MediaSet.prototype.requestError=function(a,b){s7sdk.Logger.log(s7sdk.Logger.WARNING,"s7sdk.set.MediaSet.requestError - response: %0",a)};s7sdk.set.MediaSet.prototype.setModifier=function(a){throw new Error("Trying to use setModifier on the Core class (MediaSet) is unsupported! Please refer to SDK documentation on using setModifier.")};s7sdk.set.MediaSet.prototype.cloneImageDesc=function(a,c){var b=new s7sdk.ImageDesc(a,c.type,c.name,c.swatch);b.isDefault=c.isDefault;b.mod=c.mod;b.pmod=c.pmod;b.label=c.label;b.width=c.width;b.height=c.height;b.version=c.version;b.maps=c.maps;b.targets=c.targets;b.userData=c.userData;b.mapsuppressed=c.mapsuppressed;b.userdatasuppressed=c.userdatasuppressed;b.np=c.np;b.images=c.images;return b};s7sdk.set.MediaSet.prototype.createSplitFramesMediaSet=function(m,b){var l=new s7sdk.MediaSetDesc(m.parent,m.level,m.type,m.name,m.swatch);this.maps=m.maps;this.targets=m.targets;this.userdata=m.userdata;var k=new s7sdk.OrientationSetDesc(m,l);k.portraitTolandscapeHash=new Object();k.landscapeToportraitHash=new Object();if(!b||!(m.type===s7sdk.ItemDescType.ECAT_SET)){for(var g=0;g<m.items.length;g++){var o=m.items[g];l.items.push(o);k.portraitTolandscapeHash[g]=k.landscapeToportraitHash[g]=g}k.splitted=false;return k}var a=0;for(var g=0;g<m.items.length;g++){var o=m.items[g];if(!o.np){if(o.images&&o.images.length==2){var f=Math.round(o.width/2);var c=this.cloneImageDesc(l,o.images[0]);c.np=true;c.width=f;c.mapsuppressed=(o.mapsuppressed||(o.maps&&o.maps.length))?true:false;l.items.push(c);l.items[l.items.length-1].halfFrame=true;k.portraitTolandscapeHash[a]=g;k.landscapeToportraitHash[g]=a;a++;c=this.cloneImageDesc(l,o.images[1]);c.np=true;c.width=f;c.mapsuppressed=(o.mapsuppressed||(o.maps&&o.maps.length))?true:false;l.items.push(c);l.items[l.items.length-1].halfFrame=true}else{var n=o.name.split("?")[0].split("/")[0];var f=Math.round(o.width/2);var j=n+"?src=is("+o.name+(o.name.indexOf("?")==-1?"?":"&")+"rgn=0,0,"+f+","+o.height+")";var h=n+"?src=is("+o.name+(o.name.indexOf("?")==-1?"?":"&")+"rgn="+f+",0,"+f+","+o.height+")";var e,d;d=e=o.label;if(o.images){d=undefined;if(o.images[0].label){e=o.images[0].label}if(o.images[1]&&o.images[1].label){d=o.images[1].label}}l.items.push(new s7sdk.ImageDesc(l,o.type,j,null,f,o.height,o.version,o.isDefault,o.mod,o.pmod,e,null,null,null,(o.mapsuppressed||(o.maps&&o.maps.length))?true:false,false,true));l.items[l.items.length-1].halfFrame=true;k.portraitTolandscapeHash[a]=g;k.landscapeToportraitHash[g]=a;a++;l.items.push(new s7sdk.ImageDesc(l,o.type,h,null,f,o.height,o.version,o.isDefault,o.mod,o.pmod,d,null,null,null,(o.mapsuppressed||(o.maps&&o.maps.length))?true:false,false,true));l.items[l.items.length-1].halfFrame=true}k.portraitTolandscapeHash[a]=g;a++}else{l.items.push(this.cloneImageDesc(l,o));k.landscapeToportraitHash[g]=a;k.portraitTolandscapeHash[a]=g;a++}}k.splitted=true;return k};s7sdk.MediaSet=s7sdk.set.MediaSet};