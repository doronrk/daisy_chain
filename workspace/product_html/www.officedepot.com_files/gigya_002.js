var globalGigyaEventObj;var gigyaPrompt=false;$(document).on("click","#gigyaDisabledLink",function(a){a.preventDefault();$("div#gigyaDisabledMessage").show()});function buttonClicked(a){if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA","1","ACCOUNT")}}function showGigyaShippingErrorMessage(a){displayCommonErrorMessage([a],"#shippingGigyaErrors");$(".loadingMoreResults").remove()}function enforceNumeric(a){$(document).on("keyup",a,function(b){$(b.target).val($(b.target).val().replace(/[^0-9]+/g,""))})}function showRetrieveLostPasswordModal(){if(!$("#modalRetrieveLostPassword").length){$("#header").append('<div id="modalRetrieveLostPassword"></div>');$("#modalRetrieveLostPassword").hide();$("#modalRetrieveLostPassword").load(common_utils.appendSessionId("/ajaxhtml/gigyaRetrieveLostPasswordDisplayAjax.do"),function(b,a,c){if(a=="success"){modalRetrieveLostPassword("#gigyaLostPasswordDialog")}})}else{modalRetrieveLostPassword("#gigyaLostPasswordDialog")}}function showRetrieveLostPasswordSuccessModal(){if(!$("#modalRetrieveLostPasswordSuccess").length){$("#header").append('<div id="modalRetrieveLostPasswordSuccess"></div>');$("#modalRetrieveLostPasswordSuccess").hide();$("#modalRetrieveLostPasswordSuccess").load(common_utils.appendSessionId("/ajaxhtml/gigyaRetrieveLostPasswordDisplayAjax.do?cmd=sendSuccess"),function(b,a,c){if(a=="success"){modalRetrieveLostPasswordSuccess("#gigyaLostPasswordSuccessDialog")}})}else{modalRetrieveLostPasswordSuccess("#gigyaLostPasswordSuccessDialog")}}function modalRetrieveLostPasswordSuccess(b){var c=$(b+"Title").html();var a="<div id='retrieveLostPasswordSuccess'><div id='retrieveLostPasswordSuccessBody'>"+$(b+"Body").html()+"</div></div>";$(a).dialog({bgiframe:true,title:c,modal:true,resizable:false,draggable:false,position:"center",width:590,overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){},close:function(){$("#retrieveLostPasswordSuccess").remove()}});$(document).on("click","#sendPasswordSuccessLogin",function(d){d.preventDefault();$(".ui-dialog").remove();showLoginDialog()})}function modalRetrieveLostPassword(b){var c=$(b+"Title").html();var a="<div id='retrieveLostPassword'><div id='retrieveLostPasswordErrorMsgDiv'></div><div id='retrieveLostPasswordBody'>"+$(b+"Body").html()+"</div></div>";$(a).dialog({bgiframe:true,title:c,modal:true,resizable:false,draggable:false,position:"center",width:590,overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){$("#passwordReminderEmail").focus();enforceNumeric("#passwordReminderPhone0");enforceNumeric("#passwordReminderPhone1");enforceNumeric("#passwordReminderPhone2");$("#passwordReminderPhone0,#passwordReminderPhone1,#passwordReminderPhone2").keyup(function(d){nextInputFocus(this,d)})},close:function(){$("#retrieveLostPassword").remove()}});$(document).on("click","#sendPasswordSubmit",function(h){h.preventDefault();var g=$('input[name="passwordReminderEmail"]:visible').val();var f=$('input[name="addrsForm[0].phoneNumber1"]:visible').val();var d=$('input[name="addrsForm[0].phoneNumber2"]:visible').val();var i=$('input[name="addrsForm[0].phoneNumber3"]:visible').val();$.ajax({type:"POST",url:common_utils.appendSessionId("/mobile/gigya/retrieveLostPassword.do"),data:{email:g,phoneNumber:f+d+i},async:false,cache:false,dataType:"JSON",success:function(e){if(e.success){removeCommonErrorMessage("retrieveLostPasswordErrorMsgDiv");$(".ui-dialog").remove();showRetrieveLostPasswordSuccessModal()}else{if(e.errorMsg.length>0){displayCommonErrorMessage(e.errorMsg,"#retrieveLostPasswordErrorMsgDiv")}}}})})}function showLoginDialog(){common_uielements.showModalLoginDialog("a.accountLogin","body","#accountLoginDialog",true)}function oldModalShippingInfo(){if(!$("#modalShipping").length){$("#header").append('<div id="modalShipping"></div>');$("#modalShipping").load(common_utils.appendSessionId("/ajaxhtml/oldGigyaRegistrationDisplayAjax.do"),function(b,a,c){if(a=="success"){oldModalShipping("#gigyaShippingDialog",true)}})}}function modalShippingInfo(){if(!$("#modalShipping").length){$("#header").append('<div id="modalShipping"></div>');var a="/ajaxhtml/gigyaRegistrationDisplayAjax.do";if(window.location.href.indexOf("/cart/checkout.do")!=-1){a+="?checkout=true"}$("#modalShipping").load(common_utils.appendSessionId(a),function(c,b,d){if(b=="success"){modalShipping("#gigyaShippingDialog",true,c)}else{if(window.location.href.indexOf("/cart/checkout.do")!=-1){window.location.reload(true)}else{window.location="/home.do"}}})}}function oldModalShipping(b,c){var a=$(b+"Title").html();var e="<div id='shippingContent'><div id='shippingContentBody'>"+$(b+"Body").html()+"</div></div>";if(c==true){removeGigyaShippingErrorMessage();var d=$(e).dialog({bgiframe:true,title:a,modal:true,resizable:false,draggable:false,position:"center",width:590,height:"auto",overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){$("#modalShipping").remove();$("#shippingContent input[name=shipToEmail]").focus();enforceNumeric("#shipToZip");enforceNumeric("#shipToPhone1");enforceNumeric("#shipToPhone2");enforceNumeric("#shipToPhone3");enforceNumeric("#shipToPhone4");populateGigyaFields()},close:function(){$("#modalShipping").remove()}})}}function modalShipping(e,f,b){var a=$(e+"Title");var d=a.length?a.html():"";var c=$(e+"Body");var h="<div id='shippingContent'><div id='shippingContentBody'>"+(c.length?c.html():b)+"</div></div>";if(f==true){removeGigyaShippingErrorMessage();var g=$(h).dialog({bgiframe:true,title:d,modal:true,resizable:false,draggable:false,position:"center",width:625,height:"auto",overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){$("#modalShipping").remove();$("#shippingContent input[name=shipToEmail]").focus();enforceNumeric("#shipToZip");populateGigyaFields()},close:function(){$("#modalShipping").remove()}})}}function displayCommonErrorMessage(c,d){var b='<ol><div class="moduleStruct errorStyle" id="error"><div class="moduleStructContent"><h3 class="errorHeader">Attention:</h3><ul class="errorList">';for(var a=0;a<c.length;++a){b+=("<li>"+c[a]+"</li>")}b+="</ul></div></div>";$(""+d).html(b)}function removeCommonErrorMessage(a){$("#"+a).html("")}function removeGigyaShippingErrorMessage(){$("#shippingGigyaErrors").html("")}function validateXpressRegForm(){var a=new RegExp("^\\(?(\\d{3})\\)?[-| ]?(\\d{3})[-| ]?(\\d{4})$");var f=new RegExp("^[_a-zA-Z0-9-']+(\\.[_a-zA-Z0-9-']+)*@{1}[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+$");var h=/^\d{5}([\-]\d{4})?$/;var n=new RegExp("\\w+");var k=$("#firstName").val();var l=$("#lastName").val();var i=$("#shipToEmail").val();var b=$("#shipToZip").val();var g=false;if(!n.test(i)){var d=$("#shipToEmailError").val();g=true;$("#shipToEmail_error_msg").html(d).parents("li").addClass("gigya_error")}else{if(!f.test(i)){var j=$("#invalidShipToEmailError").val();g=true;$("#shipToEmail_error_msg").html(j).parents("li").addClass("gigya_error")}else{$("#shipToEmail_error_msg").html("").parents("li").removeClass("gigya_error")}}if(!n.test(k)){var e=$("#firstNameError").val();g=true;$("#firstName_error_msg").html(e).parents("li").addClass("gigya_error")}else{$("#firstName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!n.test(l)){var c=$("#lastNameError").val();g=true;$("#lastName_error_msg").html(c).parents("li").addClass("gigya_error")}else{$("#lastName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!h.test(b)){var m=$("#invalidShipToZipError").val();g=true;$("#shipToZip_error_msg").html(m).parents("li").addClass("gigya_error")}else{$("#shipToZip_error_msg").html("").parents("li").removeClass("gigya_error")}return !g}function validateShippingForm(){var f=new RegExp("^\\(?(\\d{3})\\)?[-| ]?(\\d{3})[-| ]?(\\d{4})$");var l=new RegExp("^[_a-zA-Z0-9-']+(\\.[_a-zA-Z0-9-']+)*@{1}[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+$");var x=/^\d{5}([\-]\d{4})?$/;var j=new RegExp("\\w+");var a=$("#firstName").val();var p=$("#lastName").val();var t=$("#shipToEmail").val();var s=$("#shipToPhone1").val();var r=$("#shipToPhone2").val();var q=$("#shipToPhone3").val();var o=$("#shipToPhone4").val();var k=$("#shipToZip").val();var w=$("#shipToLine1").val();var v=$("#shipToCity").val();var e=$("#shipToState").val();var i=false;if(!j.test(t)){var u=$("#shipToEmailError").val();i=true;$("#shipToEmail_error_msg").html(u).parents("li").addClass("gigya_error")}else{if(!l.test(t)){var c=$("#invalidShipToEmailError").val();i=true;$("#shipToEmail_error_msg").html(c).parents("li").addClass("gigya_error")}else{$("#shipToEmail_error_msg").html("").parents("li").removeClass("gigya_error")}}if(!j.test(a)){var n=$("#firstNameError").val();i=true;$("#firstName_error_msg").html(n).parents("li").addClass("gigya_error")}else{$("#firstName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(p)){var d=$("#lastNameError").val();i=true;$("#lastName_error_msg").html(d).parents("li").addClass("gigya_error")}else{$("#lastName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(w)){var y=$("#shipToLine1Error").val();i=true;$("#shipToLine1_error_msg").html(y).parents("li").addClass("gigya_error")}else{$("#shipToLine1_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(v)){var b=$("#shipToCityError").val();i=true;$("#shipToCity_error_msg").html(b).parents("li").addClass("gigya_error")}else{$("#shipToCity_error_msg").html("").parents("li").removeClass("gigya_error")}if(e==""){var h=$("#shipToStateError").val();i=true;$("#shipToState_error_msg").html(h).parents("li").addClass("gigya_error")}else{$("#shipToState_error_msg").html("").parents("li").removeClass("gigya_error")}if(!x.test(k)){var g=$("#invalidShipToZipError").val();i=true;$("#shipToZip_error_msg").html(g).parents("li").addClass("gigya_error")}else{$("#shipToZip_error_msg").html("").parents("li").removeClass("gigya_error")}if(!f.test(s+r+q)){var m=$("#invalidShipToPhoneError").val();i=true;$("#shipToPhone_error_msg").html(m).parents("li").addClass("gigya_error")}else{$("#shipToPhone_error_msg").html("").parents("li").removeClass("gigya_error")}if(i){displayCommonErrorMessage([$("#shippingErrorMessage").val()],"#shippingGigyaErrors")}return !i}function numeric(a){a.value=a.value.replace(/[^0-9]+/g,"")}function displayGigyaLoginSuccessMessage(c,d){var b='<div class="section"><h3>Congratulations:</h3><p class="login_success">';for(var a=0;a<c.length;++a){b+=(c[a]+"<br />")}b+="</p></div>";$(""+d).html(b)}function redirectToHomePage(a){return function(){var b=a.loginLocation;if(b.length>0){window.location=window.location.protocol+"//"+window.location.host+b}else{location.reload(true)}}}function refreshCountDown(a,b){return function(){if(b>=0){$("#"+a).html(b--)}}}function onLoginHandler(d){var b;globalGigyaEventObj=d;if(d.user.isSiteUID){if($("#loginContent").is(":visible")){common_uielements.showAjaxLoadingInsideElement($("#loginContent"))}b=verifyTheSignature(d.UID,d.timestamp,d.signature,d.user.email,d.user.loginProvider,true,d.user.firstName,d.user.lastName);common_uielements.hideAjaxLoading();var e=redirectToHomePage(b);if(b.loginError){$("#modalLogin").remove();displayCommonErrorMessage([b.message],"div[id=loginGigyaErrors]:visible")}else{if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA:"+d.user.loginProvider,"2","ACCOUNT")}if($("#loginContent").is(":visible")){var c=3;displayGigyaLoginSuccessMessage([b.message],"div[id=loginGigyaErrors]:visible");setTimeout(e,3000);var a=refreshCountDown("countDown",c);setInterval(a,1000)}else{e()}}}else{if($("#loginContent").is(":hidden")||!$("#loginContent").length){gigyaPrompt=true;showLoginDialog()}else{modalLinkAccount()}}}function modalLinkAccount(){if(!$("#modalLink").length){$("#header").append('<div id="modalLink"></div>');$("#modalLink").load(common_utils.appendSessionId("/ajaxhtml/gigyaLinkAccountDisplayAjax.do"),function(b,a,c){if(a=="success"){populateLinkAccountForm("#gigyaLinkAccountModal")}})}}function populateLinkAccountForm(c){var b=verifyTheSignature(globalGigyaEventObj.UID,globalGigyaEventObj.timestamp,globalGigyaEventObj.signature,globalGigyaEventObj.user.email,globalGigyaEventObj.user.loginProvider,false,globalGigyaEventObj.user.firstName,globalGigyaEventObj.user.lastName);var d=$(c).html();$("div[id=loginContentBody]:visible").html(d);$modalLinkAcctMsg=$("div[id=loginContentBody]:visible").find("p#gigyaLinkAcctMsg");$modalExistingAcctMsg=$("div[id=loginContentBody]:visible").find("p#gigyaExistingAcctMsg");$modalLinkAcctMsg.after('<p id="gigyaLinkAcctMsg2" style="display:none;"></p>');$("div[id=loginContentBody]:visible").find("#gigyaLinkAcctMsg2").html($modalLinkAcctMsg.html());$modalLinkAcctMsg.remove();$modalExistingAcctMsg.after('<p id="gigyaExistingAcctMsg2" style="display:none;"></p>');$("div[id=loginContentBody]:visible").find("#gigyaExistingAcctMsg2").html($modalExistingAcctMsg.html());$modalExistingAcctMsg.remove();$("#modalLink").remove();populateGigyaFields();if(b.loginFlag&&b.userID){var e=$("p#gigyaExistingAcctMsg2").html();if(globalGigyaEventObj.user.firstName){e=e.replace("Welcome!","Welcome "+globalGigyaEventObj.user.firstName+"!")}$("p#gigyaExistingAcctMsg2").html(e);$("#ui-dialog-title-loginContent").html($("#gigyaExistingAcctTitle").html());$("p#gigyaExistingAcctMsg2").show();$('input[name="loginName"]').val(b.userID)}else{var e=$("p#gigyaLinkAcctMsg2").html();if(globalGigyaEventObj.user.firstName){e=e.replace("Welcome!","Welcome "+globalGigyaEventObj.user.firstName+"!")}var a=globalGigyaEventObj.provider;if(a.length>1){a=a.charAt(0).toUpperCase()+a.slice(1)}e=e.replace("Facebook",a);$("p#gigyaLinkAcctMsg2").html(e);$("p#gigyaLinkAcctMsg2").show();$("#ui-dialog-title-loginContent").html($("#gigyaExistingAcctTitle").html())}}function populateGigyaFields(){if(!globalGigyaEventObj){return}$('input[name="gigyaUID"]').val(globalGigyaEventObj.UID);$('input[name="gigyaTimestamp"]').val(globalGigyaEventObj.timestamp);$('input[name="gigyaSignature"]').val(globalGigyaEventObj.signature);$('input[name="gigyaLoginProvider"]').val(globalGigyaEventObj.user.loginProvider)}function verifyTheSignature(a,e,b,f,d,g,h,i){encodedUID=encodeURIComponent(a);var c;$.ajax({type:"POST",url:common_utils.appendSessionId("/ajaxhtml/account/gigyaLoginAjax.do"),data:{UID:encodedUID,timestamp:e,signature:b,email:f,loginProvider:d,login:g,firstName:h,lastName:i},dataType:"json",async:false,cache:false,success:function(j){c=j}});return c}function gigyaRegisterCallback(a){var b=$.parseJSON(a);$(".loadingMoreResults").remove();if(b.success){if(b.errorMessages&&b.errorMessages.length>0){showGigyaShippingErrorMessage(b.errorMessages[0])}else{location.reload(true)}}else{showGigyaShippingErrorMessage(b.errorMessages[0])}}function onGigyaServiceReady(b){console.log("onGigyaServiceReady");$("#gigyaLoginDivHeader").show();$(document).on("click","#gigyaLoginDiv",function(g){if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA","1","ACCOUNT")}});$(document).on("click","#createAccount",function(g){g.preventDefault();$(".ui-dialog").remove();modalShippingInfo()});$(document).on("click","#createAccountOld",function(g){g.preventDefault();$(".ui-dialog").remove();oldModalShippingInfo()});$(document).on("click","#retrieveLostPasswordLink",function(g){g.preventDefault();$(".ui-dialog").remove();showRetrieveLostPasswordModal()});$(document).on("click","#createNewAccountOld",function(g){g.preventDefault();common_uielements.showAjaxLoadingInsideElement("div#shippingContentBody");removeGigyaShippingErrorMessage();if(!validateShippingForm()){$(".loadingMoreResults").remove();return}$.ajax({url:"https://"+location.host+"/mobile/register.do",type:"post",crossDomain:true,dataType:"jsonp",data:$("#jqGigyaRegForm").serialize()})});$(document).on("click","#createNewAccount",function(h){h.preventDefault();common_uielements.showAjaxLoadingInsideElement("div#shippingContentBody");removeGigyaShippingErrorMessage();if(!validateXpressRegForm()){$(".loadingMoreResults").remove();return}var g="https://"+location.host+"/mobile/register.do";if(window.location.href.indexOf("/cart/checkout.do")!=-1){g+="?checkout=true"}$.ajax({url:g,type:"post",crossDomain:true,dataType:"jsonp",data:$("#jqGigyaRegForm").serialize()})});$(document).on("modalLoaded",function(j,g,h){$("*[id="+h+"]").show();var i={showTermsLink:"false",height:36,width:150,containerID:g,autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false};gigya.socialize.showLoginUI(i)});$(document).on("expRegModalLoaded",function(i,g){if($("#"+g).length){var h={showTermsLink:"false",height:30,width:100,containerID:g,UIConfig:'<config><body><controls><snbuttons buttonsize="30" /></controls></body></config>',autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(h)}});if($("#gigyaLoginDiv2").length){var a={showTermsLink:"false",height:44,width:148,containerID:"gigyaLoginDiv2",autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(a)}if($("#gigyaLoginDiv3").length){var f={showTermsLink:"false",height:44,width:244,containerID:"gigyaLoginDiv3",autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,buttonsStyle:"fullLogo",onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(f)}if($("#gigyaWelcomeLogin").length){var e={showTermsLink:"false",height:20,width:70,containerID:"gigyaWelcomeLogin",UIConfig:'<config><body><controls><snbuttons buttonsize="20" /></controls></body></config>',autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(e)}if($("#gigyaHeaderLogin").length){var d={showTermsLink:"false",height:30,width:100,containerID:"gigyaHeaderLogin",UIConfig:'<config><body><controls><snbuttons buttonsize="30" /></controls></body></config>',autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(d)}if($("#gigyaModalExpressRegister").length){var c={showTermsLink:"false",height:30,width:100,containerID:"gigyaModalExpressRegister",UIConfig:'<config><body><controls><snbuttons buttonsize="30" /></controls></body></config>',autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(c)}if($("#gigyapreload").length){var c={showTermsLink:"false",height:30,width:100,containerID:"gigyapreload",UIConfig:'<config><body><controls><snbuttons buttonsize="30" /></controls></body></config>',autoDetectUserProviders:"",facepilePosition:"none",hideGigyaLink:true,forceAuthentication:false,onButtonClicked:buttonClicked};gigya.socialize.showLoginUI(c)}gigya.socialize.addEventHandlers({context:{str:"congrats on your"},onLogin:onLoginHandler})}$(function gigya_ready(){console.log("Ready called in gigya.js");var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src=gigyaUrl;a.text='{enabledProviders: "facebook,google,linkedin"}';document.getElementsByTagName("head")[0].appendChild(a)});