var origins=origins||{};origins.customMenu=function(m){if(!Object.isElement(m.selectNode)){return null}var e=m.selectNode;var g=[];var f=function(p){var q=new Element("LI");var o=new Element("A",{"class":"value_"+p.value});o.update(p.label);q.update(o);o.observe("click",function(s){a(s.target)});return q};var a=function(o){var p=o.className.match(/value_(\S+)/);if(Object.isArray(p)&&p.length>1){valueToSelect=p[1]}b(valueToSelect)};var b=function(p){generic.forms.select.setValue({menuNode:e,value:p,fireEvent:true});var o=g.find(function(s){return s.optionValue==p});var q=o.optionLabel;l.update(q)};var n=null;var d=new Element("UL",{"class":"spp-shader-list"});$A(e.options).each(function(o,q){g[q]={};g[q].optionLabel=o.firstChild.nodeValue;g[q].optionValue=o.value;var p=f({value:o.value,label:o.firstChild.nodeValue});d.insert(p);if(q==e.selectedIndex){n=o.value}});var c=new Element("UL",{id:"shaderlist"});var i=new Element("LI",{"class":"spp-shader01"});var k=new Element("DIV",{"class":"spp-shader-wrap"});var j=new Element("DIV",{"class":"spp-shader-menu"});var h=new Element("DIV",{"class":"spp-shader-sub"});var l=new Element("SPAN",{"class":"shader-label"});e.insert({before:c});h.insert(d);j.insert(h);k.insert(j);i.insert(l);i.insert(k);c.insert(i);e.setStyle({position:"absolute",left:"-9999px"});brx.initHover("shaderlist");if(n){b(n)}return{selectOption:function(o){b(o)}}};var brx=brx||{};brx.productView=brx.productView||{};brx.productView.addButton=function(g){var i=g.progressNode;var c=g.addButtonNode;var e=null;if(g.tosButtonNode){e=g.tosButtonNode}var j=g.errorNode;var k=g.skuData;var a;if(g.skuData&&g.skuData.SKU_BASE_ID){a=g.skuData.SKU_BASE_ID}else{if(g.skuBaseId){a=g.skuBaseId}else{return null}}var f=g.itemType||"cart";var h="";var d;if(!d&&g.productCategoryId){var b=g.productCategoryId.match("CAT[0-9]+");if(b){d=b[0];d=d.match("[0-9]+")[0]}}if(Object.isElement(e)){e.observe("click",function(m){generic.overlay.launch2({includeBackground:true});var l="/templates/popups/waitlist.tmpl?SKU_BASE_ID="+k.SKU_BASE_ID;generic.templatefactory.get({path:l,forceReload:true}).evaluateCallback({callback:function(n){var o=new Element("div",{"class":"csbis-wrapper popup"});$(document.body).insert(o);o.insert(n);generic.overlay.update({content:o});generic.overlay.showContainer();$$("#out-of-stock")[0].observe("submit",function(p){p.preventDefault();var u=p.element();value=u.EMAIL_ADDRESS.value;r=/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/.test(value);if(r){$$(".csbis-wrapper .add-button")[0].addClassName("hidden");$$(".csbis-wrapper .add-progress")[0].style.display="inline";var q=u.serialize(true);var t=function(v){var w=$$(".csbis-wrapper")[0];w.update(v);generic.overlay.update({content:w});generic.overlay.showContainer()};var s=generic.jsonrpc.fetch({method:"generic",params:[q],onSuccess:function(v){generic.templatefactory.get({path:u.action,forceReload:true}).evaluateCallback({callback:function(w){t(w)}})},onFailure:function(v){generic.templatefactory.get({path:"/templates/popups/notification_error.tmpl",forceReload:true}).evaluateCallback({callback:function(w){t(w)}})}})}else{generic.showErrors([{text:brx.rb.email_format}],$$(".csbis-wrapper ul.error_messages")[0]);$("bis_request_error").show()}})}})})}c.observe("click",function(m){m.preventDefault();var l={};if(i){i.style.display="block";c.style.display="none"}var n=function(){if(i){i.style.display="none";c.style.display="block"}};if(f=="favorites"){l={skus:[a],itemType:"favorites",action:"add",CAT_BASE_ID:d}}else{if(f=="kit"){l={skuID:[a]}}else{if(f=="replenishment"){l={skus:[a],action:"add",add_to_cart:1,itemType:"replenishment",INCREMENT:1}}else{l={skus:[a],itemType:"cart",INCREMENT:1,CAT_BASE_ID:d}}}}var o=l;if(h){o=Object.extend(h,o)}if(f=="kit"){document.fire("kit:addSku",o)}else{generic.checkout.cart.updateCart({params:o,onSuccess:function(q){var p=q.getData();n();c.fire("cartButton:success",p)},onFailure:function(q){n();var s=q.getMessages();if(o.skus.length&&o.skus[0]==48081){var p=generic.rb("error_messages");s[0].text=p.get("cart.qty_limit.sample_pack")}if(s[0].text.indexOf("The product quantity for an item")==0){if(o.skus.length&&(o.skus[0]==55309)){s[0].text="This item is limited to one per person. Only one Everyday Essentials will remain in your cart."}if(o.skus.length&&(o.skus[0]==55308)){s[0].text="This item is limited to one per person. Only one Best Anti-Agers will remain in your cart."}}generic.showErrors(s,j,j)}})}});return{getItemType:function(){return f},setSkuBaseId:function(l){a=l},setItemType:function(l){if(!l.itemType){return null}f=l.itemType;h=l.altParams},setSkuData:function(l){k=l;this.setSkuBaseId(l.SKU_BASE_ID)},setShoppable:function(){if(!k){return null}if(brx.productData.isSoldOut(k)){if(brx.productData.isBasicReorder(k)){c.addClassName("hidden");e.removeClassName("hidden")}else{c.addClassName("hidden");e.addClassName("hidden")}}else{c.removeClassName("hidden");e.addClassName("hidden")}}}};brx.productData={isShoppable:function(a){return a.INVENTORY_STATUS&&a.INVENTORY_STATUS==1},isTempOutOfStock:function(a){return a.INVENTORY_STATUS&&a.INVENTORY_STATUS==2},isComingSoon:function(a){return a.INVENTORY_STATUS&&a.INVENTORY_STATUS==3},isInactive:function(a){return a.INVENTORY_STATUS&&a.INVENTORY_STATUS==5},isSoldOut:function(a){return a.INVENTORY_STATUS&&a.INVENTORY_STATUS==7},isBasicReorder:function(a){return a.LIFE_OF_PRODUCT&&a.LIFE_OF_PRODUCT==2}};brx.productView.cartOverlay={getMessage:function(c){if(!c){return null}var b=generic.rb("language");var a={add:b.get("the_following_added_to_cart_txt")};if(a[c]){return a[c]}else{return null}},launch:function(b){if(typeof b.getItem!=="function"){return}var a=b.getItem();a.totalCartItems=generic.checkout.cart.getTotalShoppedItems();var e=b.getMethod();a.cartMessage=this.getMessage(e);var c=$$("div.utility-nav a#viewcart")[0];var d=-(320-c.getWidth());generic.templatefactory.get({path:"/templates/cart-overlay.tmpl"}).evaluateCallback({object:a,callback:function(f){generic.overlay.launch({content:f,includeBackground:false,lockPosition:false,cssStyle:{width:"320px"},center:false,lockToDomNode:c,offsetLeft:d})}})}};document.observe("cart:updated",function(a){var b=a.memo});brx.productView.favoritesMessageDisplay={getMessage:function(g){if(!g){return null}var b={};var f=generic.rb("language");var c=g.getCartResults();var a=c.getItem();var d={name:a.product.PROD_RGN_NAME+" ",text:f.get("success.add_sku.collection")};var e=a.product.sku.SHADENAME;if(e){d.name+=e+" "}b.text=d.name+" "+d.text;return b},launch:function(b){var a=this.getMessage(b);generic.templatefactory.get({path:"/templates/favorites-results.tmpl"}).evaluateCallback({object:a,callback:function(c){generic.overlay.launch({content:c,includeBackground:false,lockPosition:true,cssStyle:{width:"340px"}});var d=$("favorites-message").select("a.close-btn");d[0].observe("click",function(f){f.preventDefault();generic.overlay.hide()})}})}};document.observe("favorites:updated",function(a){brx.productView.favoritesMessageDisplay.launch(a.memo)});brx.productView.filterTable=function(a){var f=function(h){var g=this;h.observe("change",function(i){c.filter(i.target)})};var b=new Hash();var e=null;var d;var c={};c.createMenus=function(m){var o=this;var p=Object.extend({filterMenuContainerNode:null,tableData:null,menuMetaData:null,menuWidth:130},m||{});for(var j in p){if(p[j]===null){return null}}d=p.tableData;var l=function(){var i=[];p.menuMetaData.filters.each(function(s){var q=h({field:s.field,label:s.label});if(q){i.push({label:""+s.label+brx.rb.language.filterBy+":",node:q})}});return i};var h=function(q){var i=q.field.split("::");var s=g(i);if(s){return k({menuOptions:s,fieldName:q.field,menuLabel:q.label})}else{return null}};var k=function(s){var q=new Element("select",{"class":"width_"+p.menuWidth,id:s.fieldName,name:s.fieldName});var i=new Element("option",{value:""});i.insert(brx.rb.language.all);q.insert(i);s.menuOptions.each(function(t){i=new Element("option",{value:t});i.insert(t);q.insert(i)});return q};var g=function(s){var u=[];for(var t=0,q=s.length;t<q;t++){var v=s[t];p.tableData.each(function(i){var w=i[v];if(w){u.push(w)}});u=$A(u).uniq();if(u.length<2){return null}return u}};var n=l();if(n.length>0){n.each(function(i){var q=new Element("label",{"class":"filterby"});q.insert(i.label);p.filterMenuContainerNode.insert(q);var s=i.node;p.filterMenuContainerNode.insert(s);o.addFilterNode(s,s.name)})}};c.addFilterNode=function(g,h){b.set(h,g);f(g)};c.addSortNode=function(g,h){e=g;f(g)};c.buildSortMenu=function(g){if(!g.containerNode){return}options=Object.extend({menuWidth:100,selectNodeID:"sort-menu"},g||{});var h=new Element("select",{"class":"width_"+options.menuWidth,id:options.selectNodeID,name:options.selectNodeID});options.sortMenuArray.each(function(i){h.insert(new Element("option",{value:i.field,selected:"selected"}).insert(i.label))});options.containerNode.insert(h);return h};c.filter=function(){var g=this;var h=function(j){return function(l,k){return k===l}};d.each(function(j){j.display=false;b.keys().each(function(m){var l=m.split("::");var p=$F(b.get(m));for(var n=0,k=l.length;n<k;n++){var o=l[n];if(p.length<1||h(o)(p,j[o])){j.display=true;break}else{j.display=false}}if(!j.display){throw $break}})});if(e){var i=$F(e);if(d[0].hasOwnProperty(i)){d=d.sortBy(function(j){return j[i]})}}this.build(d)};return c};jQuery(document).ready(function(){if(jQuery(".franchise-header").length!=0){franchiseScrollMouseDown=function(){if(!j.is(":animated")){h=true;q=g-j.offset().left;mouseStart=g}};franchiseScrollMouseUp=function(){h=false;var w=parseInt(j.css("left"));var x=Math.floor(w/k);var i=x+1;var y=w%k;var z=v;if(y<=(k/2)){j.animate({left:"-="+y},s);v=x+1}else{j.animate({left:"+="+(k-y)},s);v=i+1}if(z!=v){jumpToStep(v)}};franchiseScrollMouseMove=function(){if(h==true){var i=g-q-l.offset().left;var w=(e-1)*(k);if(i<=w&&i>=0){j.css("left",i)}}};jumpToStep=function(i){b.hide();jQuery(b[i-1]).fadeIn(1000)};var s=500;var v=1;var e;var c=jQuery(".franchise-header-loading");var f=jQuery(".franchise-header-content");var u=jQuery(".franchise-header-scroll-region");var k;var j;var l;var d="/products/mpp/franchise_headers/"+CATEGORY_ID+".tmpl";var b;b=jQuery(".franchise-header-content-section");var n=jQuery(".franchise-header .scroll");if(n.length!=0){jQuery(".franchise-header .scroll").jScrollPane()}b.hide();jQuery(b[0]).show();e=b.length;k=parseInt(u.css("width"))/e;for(var p=0;p<e;p++){var o=jQuery("<div>");var t=jQuery(jQuery(".franchise-header-content-section")[p]).attr("sectionTitle");o.attr("class","franchise-header-scroll-stop");o.attr("stopNumber",p+1);o.text(t);o.css("width",k+"px");o.css("left",(p*k)+"px");o.appendTo(u)}u.append("<div class='franchise-header-scroll-highlight' style='width: "+k+"px;'>&nbsp;</div>");j=jQuery(".franchise-header-scroll-highlight");l=jQuery(".franchise-header-scroll-stop");l.mousedown(franchiseScrollMouseDown);l.mouseup(function(){h=false;var i=jQuery(this).attr("stopNumber");if(i!=v){var w=parseInt(jQuery(this).css("left"))-parseInt(j.css("left"));j.animate({left:"+="+w},s);v=i;jumpToStep(v)}else{franchiseScrollMouseUp()}});l.mousemove(franchiseScrollMouseMove);var a=jQuery(".franchise-header-scroll-left");var m=jQuery(".franchise-header-scroll-right");a.click(function(){if(v>1&&!j.is(":animated")){v--;j.animate({left:"-="+k},s);jumpToStep(v)}});m.click(function(){if(v<e&&!j.is(":animated")){v++;j.animate({left:"+="+k},s);jumpToStep(v)}});var g;var q;var h=false;jQuery(document).mousemove(function(i){g=i.pageX;if(h==true){franchiseScrollMouseMove()}});jQuery(document).mouseup(function(){if(h==true&&!j.is(":animated")){franchiseScrollMouseUp()}})}});var generic=generic||{};generic.env=generic.env||{};var brx=brx||{};brx.productView=brx.productView||{};brx.productView.EDD=brx.productView.EDD||{};brx.rb=brx.rb||{};brx.rb.getRBKeys=function(){brx.rb.language=generic.rb("language");brx.rb.tempOutOfStock=brx.rb.language.get("temp_out_of_stock");brx.rb.soldOut=brx.rb.language.get("sold_out");brx.rb.soldOutBasicReorder=brx.rb.language.get("sold_out_basic_reorder");brx.rb.comingSoon=brx.rb.language.get("coming_soon");brx.rb.inactive=brx.rb.language.get("inactive");brx.rb.concern=brx.rb.language.get("concern");brx.rb.shade=brx.rb.language.get("shade");brx.rb.size=brx.rb.language.get("size");brx.rb.finish=brx.rb.language.get("finish");brx.rb.colourGroup=brx.rb.language.get("colour_group");brx.rb.more=brx.rb.language.get("more");brx.rb.email_format="Please enter your email address in the box below.";brx.rb.edd_hour_unit=brx.rb.language.get("edd_hour_unit");brx.rb.edd_minutes_unit=brx.rb.language.get("edd_minutes_unit");brx.rb.edd_days_unit=brx.rb.language.get("edd_days_unit");brx.rb.edd_tomorrow_unit=brx.rb.language.get("edd_tomorrow_unit")};brx.rb.getRBKeys();brx.productView.isDramming=false;brx.productView.single=function(c){var e=c.productData;var b;var d=[{label:brx.rb.concern,field:"STRENGTH"},{label:brx.rb.shade,field:"SHADENAME"},{label:brx.rb.size,field:"PRODUCT_SIZE"}];brx.productView.isDramming=c.productData.isDramming;var a=brx.productView.isDramming;return{getDescriptionContainerNode:function(){return this.descriptionContainerNode},render:function(g){e.urlDomain=generic.env.domain;e.desc=e.DESCRIPTION;eval1=e.PROD_RGN_NAME.split(" ");e1len=eval1.length-1;eval2=eval1[e1len].split("&");eval3=eval2[0].charAt(eval2[0].length-1);regexSearchOne=e.PROD_RGN_NAME.search(/&#174;|&reg;/);regexSearchTwo=eval3.search(/l|d|b|t|f/);if(regexSearchOne==-1){if(regexSearchTwo==-1){e.title=e.PROD_RGN_NAME.replace(/(&#8482;|&#153;|&trade;)/,"<sup class='spp-header-tm-lower'>$1</sup>")}else{e.title=e.PROD_RGN_NAME.replace(/(&#8482;|&#153;|&trade;)/,"<sup class='spp-header-tm-higher'>$1</sup>")}}else{if(regexSearchTwo==-1){e.title=e.PROD_RGN_NAME.replace(/(&#174;|&reg;)/,"<sup class='spp-header-reg-lower'>$1</sup>")}else{e.title=e.PROD_RGN_NAME.replace(/(&#174;|&reg;)/,"<sup class='spp-header-reg-higher'>$1</sup>")}}var f=this;if(Object.isElement(g.imageContainerNode)){generic.templatefactory.get({path:"/templates/products/single-view-image.tmpl"}).evaluateCallback({object:e,callback:function(h){g.imageContainerNode.update(h)}})}if(Object.isElement(g.descriptionContainerNode)){this.descriptionContainerNode=g.descriptionContainerNode;generic.templatefactory.get({path:"/templates/products/single-view-description.tmpl"}).evaluateCallback({object:e,callback:function(p){g.descriptionContainerNode.update(p);var i=g.descriptionContainerNode.select("div.price_display_container")[0];var s=g.descriptionContainerNode.select("div.sku_menu_container")[0];if(Object.isElement(s)&&generic.productData.validateSkusArray(e.skus)&&e.skus.length>1){f.renderSkuMenu({productData:e,priceContainerNode:s})}if(Object.isElement(i)){f.renderPrice({skuData:e.skus[0],priceContainerNode:i})}g.descriptionContainerNode.select("a.spp_email").each(function(z){z.observe("click",function(C){var B=s.select("select")[0];if(!B){selectID=0}else{selectID=B.selectedIndex}var A="/templates/email_a_friend.tmpl?";A+="CATEGORY_ID="+window.CATEGORY_ID;A+="&PRODUCT_ID="+e.PRODUCT_ID;A+="&SOURCE=product";A+="&SELECT="+selectID;window.open(A,"","width=375,height=400,toolbar=0");C.preventDefault()})});g.descriptionContainerNode.select("a.spp_print").each(function(z){z.observe("click",function(D){var C=s.select("select")[0];var B="";if(!C){B=0}else{B=C.selectedIndex}var A="/products/spp/index_print.tmpl?";A+="CATEGORY_ID="+window.CATEGORY_ID;A+="&PRODUCT_ID="+e.PRODUCT_ID;A+="&SELECT="+B;window.open(A,"","width=630,height=500,toolbar=1");D.preventDefault()})});var h=g.descriptionContainerNode.select("p.spp-description")[0];if(h){if(a){generic.templatefactory.get({path:"/dramming/templates/dramming-markup.tmpl"}).evaluateCallback({callback:function(z){h.insert(z);if(g.isQuickshop){}}})}else{f.renderDescription({isQuickshop:g.isQuickshop,productData:e,descriptionNode:h})}}var n=g.descriptionContainerNode.select("p.spp-attributes")[0];if(n){brx.productView.displayAttributes({containerNode:n,productData:e})}var v=g.descriptionContainerNode.select("p.spp-how")[0];if(v&&e.PRODUCT_USAGE&&!g.isQuickshop){f.initHowBtn({productData:e,howNode:v})}if(e.PROD_BASE_ID==29163){var w=g.descriptionContainerNode;w.select("a.favorites-add-link")[0].addClassName("hidden");w.select("div.add-to-gift")[0].addClassName("hidden");w.select("div.shades-container")[0].addClassName("hidden")}var m=$(g.descriptionContainerNode).select("a.description-add-link")[0];var y=$(g.descriptionContainerNode).select("a.favorites-add-link")[0];var q=$(g.descriptionContainerNode).select("a.kit-add-link")[0];var u=$(g.descriptionContainerNode).select("span.add-progress")[0];var x=$(g.descriptionContainerNode).select("ul.error_messages")[0];var j=$(g.descriptionContainerNode).select("div#replenishment-container")[0];var o=$(g.descriptionContainerNode).select("a.description-tos")[0];if(g.type=="kit"){if(m){m.addClassName("hidden")}if(y){y.addClassName("hidden")}if(q){q.removeClassName("hidden")}if(q){f.initAddButton({productData:e,addButtonNode:q,tosButtonNode:o,progressNode:u,itemType:"kit"})}}else{if(q){q.addClassName("hidden")}if(m){f.initAddButton({productData:e,addButtonNode:m,tosButtonNode:o,progressNode:u,replenishContainer:j,errorNode:x,itemType:"cart"});f.initGiftButton({isQuickshop:g.isQuickshop,productData:e,containerNode:g.descriptionContainerNode})}var l=g.descriptionContainerNode.select("span.favorites-progress")[0];if(y){f.initAddButton({productData:e,addButtonNode:y,tosButtonNode:o,progressNode:l,errorNode:x,itemType:"favorites"})}}var k=g.descriptionContainerNode.select("div.inventory_status")[0];brx.productView.displayInventoryStatus({skuData:e.skus[0],node:k});var t=g.descriptionContainerNode.select("div.shades-container")[0];if(Object.isElement(t)&&e.shaded){f.initShadePicker({productData:e,shadesContainerNode:t})}document.observe("select:sku",function(z){if(z.memo.PRODUCT_ID==e.PRODUCT_ID){brx.productView.displayInventoryStatus({skuData:z.memo,node:k});f.renderPrice({skuData:z.memo,priceContainerNode:i});var A=new Object;A.skus=new Array;A.skus[0]=z.memo;A.allowedInGiftSets=true;if(brx.productData.isSoldOut(A.skus[0])){if(brx.productData.isBasicReorder(A.skus[0])){g.descriptionContainerNode.select(".description-add-link")[0].addClassName("hidden");g.descriptionContainerNode.select(".description-tos")[0].removeClassName("hidden")}else{g.descriptionContainerNode.select(".description-add-link")[0].addClassName("hidden");g.descriptionContainerNode.select(".description-tos")[0].addClassName("hidden")}}else{g.descriptionContainerNode.select(".description-add-link")[0].removeClassName("hidden");g.descriptionContainerNode.select(".description-tos")[0].addClassName("hidden")}f.initGiftButton({isQuickshop:g.isQuickshop,productData:A,containerNode:g.descriptionContainerNode})}});if(Object.isFunction(g.postRenderCallback)){g.postRenderCallback()}generic.overlay.initLinks()}})}},renderDescription:function(i){if(!i.productData||!i.descriptionNode){return null}var h=i.productData.DESCRIPTION;if(!h){return null}var f=h.indexOf(" ",165);if(f>-1&&i.isQuickshop&&i.productData.PROD_BASE_ID!=29163){h=h.substring(0,f);h+="...";if(i.productData.url&&i.productData.url.length>0){var g=new Element("a",{href:i.productData.url});var j=new Element("em");j.update(brx.rb.more);g.update(j);i.descriptionNode.insert(g)}}if(!i.isQuickShop&&page_data&&page_data.description_extras){h+="<br/>"+page_data.description_extras}if(!a){i.descriptionNode.insert({top:h})}},renderPrice:function(f){if(f.skuData.limitedSupply==1){f.skuData.limitedSupplyFormatted="Only a few left!"}generic.templatefactory.get({path:"/templates/products/single-view-price.tmpl"}).evaluateCallback({object:f.skuData,callback:function(g){f.priceContainerNode.update(g)}})},renderSkuMenu:function(i){var h=this;var j=function(n){var l=d||[];var o=function(q){return n.pluck(q).uniq().length};var p=[];for(var m=0,k=l.length;m<k;m++){if(o(l[m].field)>1){p.push(l[m])}}return p};var f=function(m){var l=this;var k=$A(b.options);var n=k.detect(function(p,o){if(p.value==m.SKU_BASE_ID){return p}});b.selectedIndex=k.indexOf(n)};var g=function(k){var o=(a)?"select.sku-menu-qs-extended":"select.sku-menu";b=k.priceContainerNode.select(o)[0];if(!b){return}var p=k.skuData;var l=j(p);if(Object.isArray(l)&&l.length>0){var s=false;if(p.pluck("PRICE").uniq().length>1){s=true}var m=[];for(var n=0;n<l.length;n++){m.push(l[n].field)}var t="Select a "+l[0].label;var q=k.priceContainerNode.select("#shadelbl")[0];if(q){q.update(t)}}p.each(function(A,w){var x=[];var z=m[0];var y;y=A[z];x.push(y);var u=x.join(" - ");if(s){u+=" "+generic.productData.getPriceDisplay(A," ")}var v=new Element("option",{value:A.SKU_BASE_ID}).update(u);b.insert(v)});b.observe("change",function(u){var v=$F(u.target);if(v&&v.length>0){var w=p.detect(function(x){return x.SKU_BASE_ID==v})}u.target.fire("select:sku",w);if(a){changeThreePartSmoosh(w)}});document.observe("select:sku",function(u){if(u.target!==b){f(u.memo)}})};generic.templatefactory.get({path:"/templates/products/single-view-price-menu.tmpl"}).evaluateCallback({object:i.productData,callback:function(k){i.priceContainerNode.update(k);g({skuData:i.productData.skus,priceContainerNode:i.priceContainerNode})}})},initHowBtn:function(f){if(!f.productData||!f.howNode){return null}f.howNode.removeClassName("hidden");f.howNode.observe("click",function(g){var h=$$("span.spp-how-info-container")[0];if(h){generic.templatefactory.get({path:"/templates/products/how-to-use.tmpl"}).evaluateCallback({object:f.productData,callback:function(j){if(h){h.update(j);var l=h.select(".spp-how-info")[0];var i=l.getHeight()+12;l.setStyle({top:-0.5*i+"px"});var k=h.select(".close-link")[0];k.observe("click",function(m){m.preventDefault();h.update()})}}})}})},renderReplenishMenu:function(h){var g=this;var f=h.skuInfo.REFILLABLE;if(f){generic.templatefactory.get({path:"/templates/products/replenish_menu.tmpl"}).evaluateCallback({callback:function(i){h.replenishContainer.update(i);generic.overlay_cus.initLinks();g.initReplenishMenu({addBtn:h.addBtn,skuInfo:h.skuInfo,replenishContainer:h.replenishContainer})}})}else{h.replenishContainer.update("");generic.overlay_cus.initLinks()}},initAddButton:function(h){if(!h.addButtonNode||!h.productData||!h.productData.skus){return null}var g=Object.extend({itemType:h.itemType||"cart"},h);var k=g.productData.skus;if(generic.productData.validateSkusArray(k)){var f=this;var i=brx.productView.addButton({addButtonNode:g.addButtonNode,tosButtonNode:g.tosButtonNode,progressNode:g.progressNode,errorNode:g.errorNode,skuData:k[0],itemType:g.itemType,productCategoryId:g.productData.PARENT_CAT_ID});if(i.getItemType()==="cart"){i.setShoppable()}else{if(i.getItemType()==="kit"){i.setItemType({itemType:"kit",altParams:g.productData});i.setShoppable()}}document.observe("select:sku",function(l){var m=l.memo;if(m.PRODUCT_ID==g.productData.PRODUCT_ID){i.setSkuData(m);if(i.getItemType()==="cart"||i.getItemType()==="kit"){i.setShoppable()}}});if(h.replenishContainer){var j=f.renderReplenishMenu({addBtn:i,skuInfo:k[0],replenishContainer:h.replenishContainer})}}},initKitButton:function(h){if(!h.addKitNode||!h.productData||!h.productData.skus){return null}var g=Object.extend({itemType:"cart"},h);var j=g.productData;var i=j.skus;if(generic.productData.validateSkusArray(i)){var f=this;g.addKitNode.observe("click",function(k){k.preventDefault();g.progressNode.style.display="block";g.addKitNode.style.display="none";document.fire("kit:addSku",j)})}},initReplenishMenu:function(h){if(!h.replenishContainer||!h.skuInfo||!h.addBtn){return null}var j=h.replenishContainer.select("#replenish_select")[0];var g=h.skuInfo.SKU_BASE_ID;var i=h.addBtn;if(j){var k="0";var f=function(l){if(!l){return}i.setItemType({itemType:"replenishment",altParams:{REPLENISHMENT_FREQ:l}})};j.observe("change",function(m){m.preventDefault();k=m.target.value;f(k);var l=(h.isQuickshop)?$$("#temp_qs_container")[0]:$$("body")[0];var n=l.select(".add-to-gift")[0];if(k>0&&n){n.hide()}else{n.show()}});f(k)}},initShadePicker:function(g){var f=brx.productView.shadePicker({productData:g.productData,shadesContainerNode:g.shadesContainerNode,singleProductView:this,isDramming:a})},initGiftButton:function(f){if(!$$(".add-to-gift").length){return}if(!f.productData.allowedInGiftSets){f.containerNode.select(".add-to-gift")[0].hide();return}if(brx.productData.isTempOutOfStock(f.productData.skus[0])||brx.productData.isComingSoon(f.productData.skus[0])||brx.productData.isSoldOut(f.productData.skus[0])||brx.productData.isInactive(f.productData.skus[0])){f.containerNode.select(".add-to-gift")[0].hide();return}else{f.containerNode.select(".add-to-gift")[0].show()}document.observe("giftsets:loaded",function(g){f.giftsets=g.memo;brx.productView.giftButton(f)});generic.jsonrpc.fetch({method:"user.giftSets",params:[],onSuccess:function(h){var g=h.getValue();document.fire("giftsets:loaded",g)},onFailure:function(g){console.log("failed to get gift sets")}})}}};brx.productView.giftButton=function(b){var e=b.multiAdd;if((!b.productData||!b.productData.skus)&&!e){return null}var y=b.productData?b.productData.skus:[];if(!generic.productData.validateSkusArray(y)&&!e){return}var A=!e?y[0].SKU_BASE_ID:undefined;var p=e?b.skus:undefined;var n;if(b.containerNode){n=b.containerNode}else{n=(b.isQuickshop)?$$("#temp_qs_container")[0]:$$("body")[0]}var h;if(e){h=".add-all-to-gift"}else{h=".add-to-gift"}var z=n.select(h)[0];var d=z.select(".choose-gift-set")[0];var C=z.select(".choose-gift-set-dropdown")[0];var u=b.isQuickshop?"QV":"SPP";var m=function(E){C.innerHTML="";if(typeof(E.each)!="undefined"){E.each(function(F){C.insert(new Element("li",{"class":"option gift",id:F.COLLECTION_ID}).update(F.COLLECTION_NAME))})}C.insert(new Element("li",{"class":"option create-new new",id:"new"}).update("Create a New Gift"))};var B=b.giftsets||[];m(B);var t=z.select(".add-btn")[0];var s=z.select(".add-new-item")[0];var w=z.select(".add-new-item")[0].select(".btn")[0];var x=z.select(".add-new-item-text")[0];var q=d.select(".btn")[0];var k=d.select(".progress")[0];var c=d.select(".gift-set-selection-id");var l=d.select(".gift-set-selection-name");var a=z.select(".gift-close-link")[0];var g=d.select(".gift-close-link")[0];var f=function(){var E=C.select(".option");E.each(function(F){F.observe("click",function(H){c.value=this.id;l.value=this.innerHTML;if(this.hasClassName("create-new")){var G=d.select(".btn")[0];x.clear();G.click()}else{E.each(function(I){I.removeClassName("active")});this.addClassName("active")}})})};f();var D=document.getElementById("add-new-item-text");D.onkeydown=function(G){var E=G?G:event;var F=E.keyCode;if(F==13){if(s.hasClassName("hidden")){return}else{z.focus();w.simulate("click")}Event.stop(E)}};a.stopObserving("click");a.observe("click",function(){if(C.childElements().length>1&&s.hasClassName("hidden")){toggleVisible(d)}else{toggleVisible(s)}toggleArrow(t)});g.stopObserving("click");g.observe("click",function(){if(C.childElements().length>1&&s.hasClassName("hidden")){toggleVisible(d)}else{toggleVisible(s)}toggleArrow(t)});t.stopObserving("click");t.observe("click",function(){if(C.childElements().length>1&&s.hasClassName("hidden")){toggleVisible(d)}else{toggleVisible(s)}toggleArrow(t)});w.stopObserving("click");w.observe("click",function(){var E=x.value;if(/^\s*$/.test(E)||E=="Enter a name for your gift"){x.addClassName("error");generic.showErrors([{text:"Please name your gift."}])}else{x.removeClassName("error");generic.showErrors([{text:""}]);c.value="";l.value=E;toggleVisible(s);toggleVisible(d);q.simulate("click")}});if(!e){document.observe("select:sku",function(E){A=E.memo.SKU_BASE_ID})}var v=function(){k.show();w.hide()};var j=function(){k.hide();w.show()};var o=function(){toggleVisible(d);toggleArrow(t)};var i=function(){v();if(c.value=="new"){toggleVisible(d);toggleVisible(s);x.focus();t.focus();j();return}var F=c.value;var E=l.value;if(!F&&!E){generic.showErrors([{text:"Please select a gift."}]);j();return}else{generic.showErrors([{text:""}])}var G;if(e){G=[{_SUBMIT:"alter_collection",action:"add,save",COLLECTION_TYPE:"UKIT",COLLECTION_ID:F,COLLECTION_NAME:E||"",COLLECTION_SUBTYPE:"SITEWIDE_GIFT",SKU_BASE_ID:p,INCREMENT:1}]}else{G=[{_SUBMIT:"alter_collection",action:"add,save",COLLECTION_TYPE:"UKIT",COLLECTION_ID:F,COLLECTION_NAME:E||"",COLLECTION_SUBTYPE:"SITEWIDE_GIFT",SKU_BASE_ID:[A],INCREMENT:1,QTY:"1"}]}generic.jsonrpc.fetch({method:"rpc.form",params:G,onSuccess:function(K){j();o();var H=K.getCartResults();document.fire("cart:updated",H);if(!e){var I=H.getItem();var J=I.product.PROD_RGN_NAME;document.fire("kit:success",{collection_name:E,product_name:J.replace(/&.{0,}?;/,""),giftLocation:u})}document.fire("giftset:added");m(H.getAllItems());f()},onFailure:function(H){j();o();var L=H.getMessages();var K=generic.rb("error_messages");var J=K.get("under.min_skus.collection");var I=L[0].text;if(I.match("UKIT:SITEWIDE_GIFT:")){L[0].text=J}generic.showErrors(L)}})};q.stopObserving("click");q.observe("click",i)};var isVisible=function(a){return(a.getStyle("display")!="none")};var ensureHidden=function(a){a.addClassName("hidden")};var toggleVisible=function(a){if(a.hasClassName("hidden")){a.removeClassName("hidden")}else{a.addClassName("hidden")}};var toggleArrow=function(a){if(a.hasClassName("arrow-down")){a.removeClassName("arrow-down")}else{a.addClassName("arrow-down")}};var changeThreePartSmoosh=function(a){var b=a.HEX_VALUE_STRING.split(",");var c=a.SHADE_LABEL.split(",");$$(".three-part-smoosh .smoosh_panel").each(function(e,d){e.select("img")[0].setStyle({backgroundColor:b[d]})});$$(".three-part-smoosh .smoosh_label").each(function(e,d){e.update(c[d])})};brx.productView.shadePicker=function(c){var m=c.swatchWidth||22;var s=c.swatchHeight||22;var y;var x;var q;var k=null;var u;var v=c.shadesContainerNode;var j,l,p,h;var a=brx.productView.isDramming;var f=c.productData.skus[0];var z=a?6:8;var o=function(B,J){var K=this;if(!J.HEX_VALUE_STRING||J.HEX_VALUE_STRING.length<1){return}B.skuBaseId=J.SKU_BASE_ID;var E=B.select("div.swatch-container")[0];var F=B.select("a")[0];var A=J.HEX_VALUE_STRING.split(",");var H=Math.ceil(m/A.length);var I=t(B,J,A);if(a){H=m}E.setStyle({width:m+"px",height:s+"px"});for(var D=0;D<A.length;D++){if(a&&D>0){break}var G=new Element("div",{});G.setStyle(Object.extend(I,{left:(H*D)+"px",width:H+"px",height:s+"px",zIndex:10,backgroundColor:A[D]}));E.insert(G)}var C=new Element("div",{"class":"onstate"});C.setStyle({width:m-6+"px",height:s-6+"px",display:"none"});E.insert(C);B.observe("mouseover",function(M,L){F.fire("swatch:mouseover",M);x=M.SKU_BASE_ID;B.addClassName("over")}.curry(J));B.observe("mouseout",function(M,L){F.fire("swatch:mouseout",M);x="";var N=function(){if(x!=M.SKU_BASE_ID){B.removeClassName("over")}};setTimeout(N,250)}.curry(J));F.observe("click",function(M,L){L.preventDefault();if(y){y.fire("select:sku",M);if(a){changeThreePartSmoosh(M)}}n(M)}.curry(J));document.observe("select:sku",function(L){})};var t=function(A,B,C){var D={position:"absolute",top:"0px",backgroundImage:"none"};return D};var b=function(B){var F=B.tableContainerNode;var H=B.cellsPerRow;if(!F){return null}y=new Element("table",{"class":"table-swatches"});var E=new Element("tbody",{"class":"tbody-swatches"});F.update(y);y.insert(E);var A;var D=B.productData.skus;var G=D;for(var C=0;C<G.length;C++){if(C%H===0){A=new Element("tr");E.insert(A)}generic.templatefactory.get({path:"/templates/products/shade-table-cell.tmpl"}).evaluateCallback({object:G[C],callback:function(I,K,J){I.insert(J);o(I.select("td")[K%H],G[K]);if(K+1===G.length){n(G[0])}}.curry(A,C)})}};var n=function(B){var A=y.select("td");A.each(function(C){C.removeClassName("active");if(C.skuBaseId==B.SKU_BASE_ID){C.addClassName("active")}})};var w=function(D){var A=D.shadeDetailContainerNode;var C=D.productData.skus[0];var B="/templates/products/shade-thumb.tmpl";if(a){B="/dramming/"+B}generic.templatefactory.get({path:B}).evaluateCallback({object:C,callback:function(F,E){A.update(E);if(!a){k=A.select(".smoosh_panel")[0]}j=A.select(".shade-details")[0];l=A.select(".smoosh-btn-tos")[0];p=A.select("h3.shade-name")[0];h=A.select(".limited")[0];d(C);if(F.skus.length>1){A.setStyle({marginTop:"-60px"})}}.curry(D.productData)})};var d=function(A){q=A;e(A)};var e=function(C){var B=this;var A="";if(C.SHADE_DESCRIPTION!==null&&typeof(C.SHADE_DESCRIPTION)!="undefined"){A+="<p>"+C.SHADE_DESCRIPTION+"</p>\n"}if(C.FINISH!==null&&typeof(C.FINISH)!="undefined"){A+="<strong>"+brx.rb.finish+": </strong>"+C.FINISH+"<br />\n"}if(C.ATTRIBUTE_COLOR_FAMILY!==null&&typeof(C.ATTRIBUTE_COLOR_FAMILY)!="undefined"){A+="<strong>"+brx.rb.colourGroup+": </strong>"+C.ATTRIBUTE_COLOR_FAMILY+"<br />\n"}p.update(C.SHADENAME);i(C)};var i=function(A){if(!A.HEX_VALUE_STRING||!A.SMOOSH_PATH_STRING){return}var C=A.HEX_VALUE_STRING;var D=A.SMOOSH_PATH_STRING;if(a){changeThreePartSmoosh(A)}var E={backgroundImage:D,backgroundColor:C,top:"0px",left:"0px"};if(/MSIE (\d+\.\d+)/.test(navigator.userAgent)&&parseFloat(RegExp.$1)<7){E.filter="progid:dximagetransform.Microsoft.AlphaImageLoader(src='"+E.backgroundImage+"', sizingMethod='image')";E.backgroundImage="none"}else{E.backgroundImage="url('"+E.backgroundImage+"')"}var B=new Element("div",{"class":"smoosh_panel_inner",id:"smoosh_panel_inner"});B.setStyle(E);var F=new Element("img",{src:"/images/global/transparent.gif",width:"125",height:"116"});B.update(F);if(!a){k.update(B)}};var g=function(){var A=this;A.mouseOverState=false;v.observe("swatch:mouseover",function(D){A.mouseOverState=true;if(A.mouseoutTimeout){clearTimeout(A.mouseoutTimeout)}e(D.memo)});var C=function(){if(!A.mouseOverState){e(q)}};v.observe("swatch:mouseout",function(D){A.mouseOverState=false;A.mouseoutTimeout=setTimeout(C,250)});v.observe("select:sku",function(D){d(D.memo);var E=y;if(E!==D.target){n(D.memo)}});var B=u.getDescriptionContainerNode();if(Object.isElement(B)){B.observe("select:sku",function(D){d(D.memo);n(D.memo)})}};generic.templatefactory.get({path:"/templates/products/shade-picker.tmpl"}).evaluateCallback({object:c.productData,callback:function(A){c.shadesContainerNode.update(A);var D=c.shadesContainerNode.select("div.swatch-table-container")[0];var B=c.shadesContainerNode.select("div.smoosh-container")[0];u=c.singleProductView;b({cellsPerRow:z,tableContainerNode:D,productData:c.productData,isDramming:c.isDramming});var C={shadeDetailContainerNode:B,productData:c.productData};w(C);g()}})};brx.productView.quickshop=function(b){var a=brx.productView.single({productData:b.productData});document.fire("MPP:productQV",{prodId:b.productData.PRODUCT_ID,catId:b.productData.PARENT_CAT_ID});generic.templatefactory.get({path:"/templates/products/quickshop.tmpl"}).evaluateCallback({callback:function(g){var f={};var i={id:"temp_qs_container"};var c=$$(".overlay-container")[0];if(b.productData.isDramming){i={"class":"dramming"}}var e=new Element("div",i);$(document.body).insert(e);e.insert(g);var h=e.select("div.spp-product-left")[0];if(h){f.imageContainerNode=h}var d=e.select("div.description-container")[0];if(d){f.isQuickshop=1;f.addHeaderLink=1;f.type=b.type;f.descriptionContainerNode=d}generic.overlay.launch({content:e,cssClass:"quick-popup",includeBackground:true});a.render(f)}})};brx.productView.initQuickshopLink=function(a){var c=a.hasClassName("qsl-set");if(c==false){var b=a.readAttribute("class").match(/PROD\w*\d*/)[0];a.addClassName("qsl-set")}};brx.productView.initQuickshopLinks=function(){$$("a.quickshoplink").each(function(a){brx.productView.initQuickshopLink(a)})};document.observe("cart:updated",function(a){generic.overlay.hide()});document.observe("kit:updated",function(a){generic.overlay.hide()});brx.productView.quickshopById=function(c,e,d){var a,b;if(rb.page_data_configuration&&rb.page_data_configuration["catalog.spp.productFields"]){a=rb.page_data_configuration["catalog.spp.productFields"]}else{a=["ATTRIBUTE_COVERAGE","DEFAULT_CAT_ID","DESCRIPTION","LARGE_IMAGE","PARENT_CAT_ID","PRODUCT_ID","PRODUCT_USAGE","PROD_CAT_DISPLAY_ORDER","PROD_CAT_IMAGE_NAME","PROD_RGN_NAME","PROD_RGN_SUBHEADING","SHORT_DESC","SKIN_CONCERN_1","SKIN_CONCERN_2","SMALL_IMAGE","SUB_LINE","THUMBNAIL_IMAGE","ABOUT_INGREDIENT","shaded","sized","skus","worksWith","AVERAGE_RATING","TOTAL_REVIEW_COUNT","RATING_IMAGE","RATING_RANGE","url"]}if(rb.page_data_configuration&&rb.page_data_configuration["catalog.spp.skuFields"]){b=rb.page_data_configuration["catalog.spp.skuFields"]}else{b=["ATTRIBUTE_COLOR_FAMILY","DISPLAY_ORDER","FINISH","HEX_VALUE","HEX_VALUE_STRING","INVENTORY_STATUS","PRICE","PRODUCT_ID","PRODUCT_SIZE","REFILLABLE","SHADENAME","SHADE_DESCRIPTION","SKIN_TONE","SKIN_TYPE","SKU_BASE_ID","SKU_ID","SMOOSH_DESIGN","SMOOSH_PATH_STRING","STRENGTH","formattedPrice","limitedSupply"]}generic.productData.getProductData({productId:c,categoryId:e,productFields:a,skuFields:b,callback:function(f){console.log("getProductData callback");console.log(f);brx.productView.quickshop({type:d,productData:f})}})};brx.productView.displayAttributes=function(d){if(!d.containerNode){return}var g=d.productData;var c=[{label:brx.rb.language.formula,field:g.SKIN_CONCERN_1},{label:brx.rb.language.coverage,field:g.SKIN_CONCERN_2}];var f=new Element("ul",{"class":"attributes"});d.containerNode.update(f);for(var e=0,b=c.length;e<b;e++){if(c[e].field&&c[e].field.length>0){var a=new Element("li");a.insert(c[e].field);f.insert(a)}}};brx.productView.displayInventoryStatus=function(a){if(!a.node||!a.skuData){return null}var b="";if(brx.productData.isTempOutOfStock(a.skuData)){b=brx.rb.tempOutOfStock}else{if(brx.productData.isComingSoon(a.skuData)){b=brx.rb.comingSoon}else{if(brx.productData.isSoldOut(a.skuData)){if(brx.productData.isBasicReorder(a.skuData)){b=brx.rb.soldOutBasicReorder}else{b=brx.rb.soldOut}}else{if(brx.productData.isInactive(a.skuData)){b=brx.rb.inactive}}}}a.node.update(b);if(generic.cookie("LOCALE")=="en_US"){brx.productView.showEstimatedDeliveryDate({isShoppable:brx.productData.isShoppable(a.skuData)})}};brx.productView.showEstimatedDeliveryDate=function(a){var b=$$(".edd")[0];b.hide();if(a.isShoppable){b.show();brx.productView.getEstimatedDeliveryDate()}};brx.productView.getEstimatedDeliveryDate=function(){var a=$$(".edd .edd_info")[0];if(!a.hasAttribute("data-ticker-id")){generic.jsonrpc.fetch({method:"address.estimateDeliveryDateSPP",params:[],onSuccess:function(e){var c=e.getValue();var g;var f;brx.productView.EDD.units={hour:brx.rb.edd_hour_unit,minute:brx.rb.edd_minutes_unit,day:brx.rb.edd_days_unit,tomorrow:brx.rb.edd_tomorrow_unit};if(c.tomorrow){g=brx.productView.EDD.units.tomorrow+", "+c.need_on_day_name+", "+c.need_on_month+" "+c.need_on_day}else{g=c.need_on_day_name+", "+c.need_on_month+" "+c.need_on_day}if(c.order_by_days==0){f=c.order_by_hours+brx.productView.EDD.units.hour+" "+c.order_by_mins+brx.productView.EDD.units.minute}else{f=c.order_by_days+brx.productView.EDD.units.day+" "+c.order_by_hours+brx.productView.EDD.units.hour+" "+c.order_by_mins+brx.productView.EDD.units.minute}var b=$$(".edd .edd_info p.copy");b.each(function(h){h.writeAttribute({"data-order-by-days":c.order_by_days,"data-order-by-hours":c.order_by_hours,"data-order-by-mins":c.order_by_mins});h.getElementsByClassName("need_on")[0].update(g);h.getElementsByClassName("order_within")[0].update(f)});var d=setInterval(brx.productView.updateEstimatedDeliveryDate,60000);a.setAttribute("data-ticker-id",d);$$(".edd").each(function(h){h.removeClassName("hide")})},onFailure:function(b){console.log("Failed to get EDD info")}})}};brx.productView.updateEstimatedDeliveryDate=function(){var a=$$(".edd .edd_info p.copy")[0];var f=a.getAttribute("data-order-by-days");var b=a.getAttribute("data-order-by-hours");var c=a.getAttribute("data-order-by-mins");var e=a.getElementsByClassName("order_within")[0];if(c==0&&b==0&&f==0){var d=$$(".edd .edd_info")[0];clearInterval(d.getAttribute("data-ticker-id"));d.removeAttribute("data-ticker-id");brx.productView.getEstimatedDeliveryDate();return}if(c>0){c=c-1}else{if(b>0){b=b-1;c=59}else{if(f>0){f=f-1;b=23;c=59}}}a.writeAttribute({"data-order-by-days":f,"data-order-by-hours":b,"data-order-by-mins":c});if(f==0){e.update(b+brx.productView.EDD.units.hour+" "+c+brx.productView.EDD.units.minute)}else{e.update(f+brx.productView.EDD.units.day+" "+b+brx.productView.EDD.units.hour+" "+c+brx.productView.EDD.units.minute)}};document.observe("dom:loaded",function(a){brx.productView.initQuickshopLinks()});document.observe("dom:loaded",function(b){var a=$("dramming-qs-link");if(a){$("dramming-qs-link").observe("click",function(){brx.productView.quickshopById("PROD23185","CAT9439","")})}});var generic=generic||{};generic.env=generic.env||{};var brx=brx||{};brx.productView=brx.productView||{};brx.rb=brx.rb||{};brx.rb.product=new Hash({Formula:"Formula",Coverage:"Coverage",Benefits:"Benefits",Concern:"Concern",Finish:"Finish",Color_Group:"Color Group",Filter_by:"Filter By",All:"All",Bestseller:"Bestseller",Alphabetically:"Alphabetically"});brx.productView.multiple={smallTable:function(e){var b=e.containerID||"";var a=e.containerNode||$(e.containerID)||null;var g=e.tableData||[];var d=e.maxItems||e.tableData.length;var c=function(h){h=h.sortBy(function(i){return i.DISPLAY_ORDER?i.DISPLAY_ORDER:0});h.each(function(k,j){if(self.maxItems&&j>=self.maxItems){throw $break}var m=(j+1==self.maxItems);f({productData:k,wrapperID:"mini-thumb-wrapper-"+j,paneContainerNode:a,lastPane:m});var i=(j+1<self.maxItems?"hr clear":"clear");var l=new Element("div",{"class":i});a.insert(l)})};var f=function(h){var i=new Element("div",{id:h.wrapperID});h.paneContainerNode.insert(i);brx.productView.multiple.smallThumb({productData:h.productData,addToBagLink:h.addToBagLink,thumbContainerNode:i})};c(g)},smallThumb:function(a){productData=a.productData||{};thumbContainerNode=a.thumbContainerNode||null;addToBagLink=a.addToBagLink||false;productData=Object.extend(productData,{url_domain:generic.env.domain});generic.templatefactory.get({path:"/templates/products/thumb-small.tmpl"}).evaluateCallback({object:productData,callback:function(d){var b=new Element("dl",{"class":"thumb-75x75"});b.insert(d);thumbContainerNode.insert(b);var g=thumbContainerNode.select("dd.add a")[0];if(g){var e=productData.skus;if(generic.productData.validateSkusArray(e)){var c=brx.productView.addButton({skuData:e[0],addButtonNode:g,productCategoryId:productData.PARENT_CAT_ID})}}var f=thumbContainerNode.select("dd.quickshop a")[0];if(f){brx.productView.initQuickshopLink(f)}}})}};var generic=generic||{};var brx=brx||{};brx.rb=brx.rb||{};brx.rb.product=brx.rb.product||new Hash({});brx.spp=function(){var b;var a;return{init:function(d){console.log("*** spp.js: sppData",d);var c=brx.productView.single({productData:d});var g={};var h=$$("div.spp-product-left div.product_image")[0];if(h){g.imageContainerNode=h}var e=$$("div.description-container")[0];if(e){g.descriptionContainerNode=e}c.render(g);if(Object.isArray(d.worksWith)){var f=[d.worksWith[0],d.worksWith[1],d.worksWith[2],d.worksWith[3]];brx.productView.crossSell.init(f)}brx.spp.show_reviews({PROD_BASE_ID:d.PROD_BASE_ID})},initBazaarVoice:function(h){var f=location.host;var c=f.endsWith("esteeonline.com")?"reviews.origins-us.esteeonline.com/bvstaging":"reviews.origins.com";var e=h.productId;var g="http://"+c+"/3814/"+e+"/reviews.htm?format=embedded";var d=new Element("iframe",{id:"BVFrame",name:"BVFrame",src:g});d.setStyle({visibility:"hidden",width:"1px",height:"1px",position:"absolute",left:"-999px",top:"-999px"});$(document.body).insert(d);window.BVisLoaded=true;d.observe("load",function(){if(!window.BVisLoaded){var j=document.getElementById("BVFrame");if(j){var i=f.endsWith("esteeonline.com")?"reviews.origins-us.esteeonline.com/bvstaging":"reviews.origins.com";j.src="http://"+i+"/logging?page="+escape(page)}}})},sppParams:{productFields:{productFields:["PRODUCT_ID","DEFAULT_CAT_ID","PARENT_CAT_ID","PROD_RGN_NAME","PROD_RGN_SUBHEADING","SUB_LINE","DESCRIPTION","SHORT_DESC","PROD_SKIN_TYPE","PROD_SKIN_TYPE_TEXT","PROD_CAT_IMAGE_NAME","PROD_CAT_DISPLAY_ORDER","SMALL_IMAGE","LARGE_IMAGE","THUMBNAIL_IMAGE","PRODUCT_USAGE","FORMULA","ATTRIBUTE_COVERAGE","ATTRIBUTE_BENEFIT","SKIN_CONCERN_LABEL","SKIN_CONCERN_1","SKIN_CONCERN_2","SKIN_CONCERN_3","skus","shaded","sized","worksWith"]},skuFields:{skuFields:["SKU_ID","SKU_BASE_ID","PRODUCT_ID","SHADENAME","SHADE_DESCRIPTION","SKIN_TYPE","SKIN_TYPE_TEXT","PRODUCT_SIZE","DISPLAY_ORDER","STRENGTH","PRICE","limitedSupply","formattedPrice","formattedTaxedPrice","SMOOSH_DESIGN","SMOOSH_PATH_STRING","INVENTORY_STATUS","REFILLABLE","HEX_VALUE","HEX_VALUE_STRING","FINISH","ATTRIBUTE_COLOR_FAMILY","UNDERTONE","SKIN_TONE","SKIN_TONE_TEXT"]}}}}();brx.spp.show_reviews=function(a){var a=a||{};if(typeof $BV!="undefined"){$BV.ui("rr","show_reviews",{productId:a.PROD_BASE_ID,onEvent:function(b){if(b.eventSource=="Display"&&b.eType=="Read"){document.fire("bv:loaded")}}})}};document.observe("dom:loaded",function(){var a={};a.pageDataKey="catalog.spp";a.productId=window.PRODUCT_ID;a.categoryId=window.CATEGORY_ID;a.callback=function(b){if(typeof global_var_drammingProduct!=="undefined"){b.worksWith=null}brx.spp.init(b)};brx.spp.page_data_configuration=generic.rb("page_data_configuration");console.log("*** brx.spp.page_data_configuration ",brx.spp.page_data_configuration);if(brx.spp.page_data_configuration.get("catalog.spp.productFields")!="catalog.spp.productFields"){a.productFields=brx.spp.page_data_configuration.get("catalog.spp.productFields");a.skuFields=brx.spp.page_data_configuration.get("catalog.spp.skuFields")}else{a=Object.extend(a,brx.spp.sppParams.productFields);a=Object.extend(a,brx.spp.sppParams.skuFields)}generic.productData.getProductData(a)});brx.productView=brx.productView||{};brx.productView.crossSell=(function(){var d=null;var l=[];var i=0;var b=0;var f=null;var e=0;var k=0;var a=function(){d=$$("div.cross_sell_container")[0];productContainers=d.select("div.cross_sell_product");l[0]=d.select("div.cross_sell_pane_1")[0];l[1]=d.select("div.cross_sell_pane_2")[0];e=l.length};var j=function(n){if(Object.isArray(n.products)&&n.products.length>0){n.products.each(function(o,p){if(o.skus.length>0){if(brx.productData.isSoldOut(o.skus[0])){return null}generic.templatefactory.get({path:"/templates/products/cross_sell.tmpl"}).evaluateCallback({object:o,callback:function(t){var s=productContainers[p];s.insert(t);var u=s.select("a.quickshop_link")[0];if(Object.isElement(u)){var q=u.select(".quickshop-btn")[0];u.observe("click",function(w){w.preventDefault();var v=brx.productView.quickshop({productData:o})});u.observe("mouseover",function(v){q.addClassName("qs-active")});u.observe("mouseout",function(v){q.removeClassName("qs-active")})}}})}})}else{d.addClassName("hidden")}};var m=function(){var p=d.getDimensions();k=p.width;l.each(function(s,q){s.setStyle({position:"absolute"});s.setStyle({top:"0px",left:q*k+"px"})});var o=d.select("a.scroll_left");o.each(function(q){if(Object.isElement(q)){q.observe("click",function(){c(-1)})}});var n=d.select("a.scroll_right");n.each(function(q){if(Object.isElement(q)){q.observe("click",function(){c(1)})}})};var c=function(n){b=i+n;if(b>e-1){b=0}else{if(b<0){b=e-1}}l[b].setStyle({left:(n*k)+"px"});new Effect.Move(l[i],{x:(-n*k),y:0,mode:"relative"});new Effect.Move(l[b],{x:(-n*k),y:0,mode:"relative"});i=b};var g=function(o){var p={};p.pageDataKey="catalog.spp.recommendedProducts";p.productIds=o;p.callback=function(q){j(q)};var n=generic.rb("page_data_configuration");if(n.get("catalog.mpp.productFields")!="catalog.mpp.productFields"){p.productFields=n.get("catalog.mpp.productFields");p.skuFields=n.get("catalog.mpp.skuFields")}generic.productData.getProductsData(p)};var h={init:function(n){a();g(n);m()}};return h}());pollCounter=0;oldDescriptionHeight=0;function sizeDidYouKnow(){if($$(".spp-product").length){var c=$$(".spp-product")[0];var a=c.getHeight();var b=$$(".cross_sell_container")[0];b.id="cross_sell_container";var d=a-170;if($("crossSell_sell_container")){$("crossSell_sell_container").setStyle({height:d+"px"})}}}function pollDescription(){if($$(".spp-product").length){$$(".spp-product")[0].getHeight();if($$(".spp-product").length){var a=$$(".spp-product")[0];if(a.getHeight()!=oldDescriptionHeight){oldDescriptionHeight=a.getHeight();sizeDidYouKnow()}if(pollCounter++<30){setTimeout("pollDescription()",1000)}}}}$(document).observe("dom:loaded",function(){setTimeout("pollDescription()",1000)});