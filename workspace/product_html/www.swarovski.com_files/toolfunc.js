config=(typeof(config)!=="object")?config={}:config=config;var detectedUA=jQuery(document).browserDetection();var fontfallback=false;if(detectedUA.os=="WindowsXP"&&((detectedUA.browser=="Firefox"&&detectedUA.browserversion==3.6)||detectedUA.browser=="Chrome")){var fontfallback=true;var fontscss=jQuery("#fontscss");var fallback=fontscss.data("fallback");if(fallback){jQuery("head").prepend('<link rel="stylesheet" href="'+fallback+'" type="text/css" media="screen,print" />');}fontscss.remove();}if(detectedUA.os=="WindowsXP"&&((detectedUA.browser=="Firefox"&&detectedUA.browserversion==3.6)||detectedUA.browser=="Explorer"||detectedUA.browser=="Chrome")){jQuery("#stickyfooter").addClass("xp-adjust");}if(detectedUA.os=="Mac"&&(detectedUA.browser=="Firefox")){jQuery("#stickyfooter").addClass("osx-adjust");}if(detectedUA.os=="WindowsXP"&&(detectedUA.browser=="Explorer"&&detectedUA.browserversion==8)){jQuery("#fontscss").attr("media","screen");}var suggest;jQuery.noConflict();(function($){var originalDataFunc=$.fn.data;$.fn.data=function(){var back=originalDataFunc.apply(this,arguments);if(arguments.length==1){var originalValue=back;if((typeof originalValue=="string")&&(originalValue.indexOf("config:")===0)){if(config){var configKey=$.trim(originalValue.substring(("config:").length,originalValue.length));if(typeof config[configKey]!="undefined"){back=config[configKey];}}}}return back;};$.fn.syncHeight=function(){var maxHeight=-1;$(this).each(function(){var $this=$(this);maxHeight=maxHeight>$this.height()?maxHeight:$this.height();});$(this).height(maxHeight+($(this).first().data("sync-offset")?$(this).first().data("sync-offset"):0));};var GetVars=function(){var getCollection={};var getString=document.location.search.substr(1,document.location.search.length);if(getString!=""){var pairs=getString.split("&");for(var i=0;i<pairs.length;++i){var pair=pairs[i].split("=");getCollection[unescape(pair[0])]=(pair.length>1?unescape(pair[1]):true);}}return{getCollection:getCollection,get:function(varname){return this.getCollection[varname];}};}();var touchOS=false;if(!isIE(6)){touchOS=("ontouchstart" in document.documentElement)?true:false;if(touchOS){var libraryName=$("script#mainjs").data("touchsrc");document.write('<script type="text/javascript" src="'+libraryName+'"><\/script>');}}var productVideo=false;$(".prod-altviews li img").each(function(){var attr1=$(this).attr("data-360degreeview");var attr2=$(this).attr("data-videoview");if((attr1!=="undefined"&&attr1!==false)||(attr2!=="undefined"&&attr2!==false)){productVideo=true;}});if($("video").length>0||productVideo||$("#annual").length>0||$("#blackstallion").length>0){var mejsLib=$("script#mainjs").data("mejssrc");document.write('<script type="text/javascript" src="'+mejsLib+'"><\/script>');}var jsPulldowns=[];var bubbles=[];var infobubbles=[];var videos=[];var formularValidation=[];var isTouch;if(typeof(triggerWebtracking)==="undefined"||typeof(triggerWebtracking)!=="function"){triggerWebtracking=function(){return;};}if(typeof(dcsMultiTrack)==="undefined"||typeof(dcsMultiTrack)!=="function"){dcsMultiTrack=function(){return;};}if(typeof(reportSCIC)==="undefined"||typeof(reportSCIC)!=="function"){reportSCIC=function(){return;};}if(typeof(handleSwitchToMobile)==="undefined"||typeof(handleSwitchToMobile)!=="function"){handleSwitchToMobile=function(){return;};}function enhance(context){if(typeof context==="undefined"){context=null;}if(detectedUA.browser.toLowerCase()==="opera"){$("fieldset",context).css("padding-top","0");$("legend",context).css("margin-bottom","15px");}if(isTouch){$('input:text, input[type="password"], textarea',context).each(function(){$(this).focus(function(ev){var isInStickyFooter=$(this).parents("#stickyfooter").size();if(isInStickyFooter==0){$("#stickyfooter").hide();}});$(this).blur(function(ev){$("#stickyfooter").show();});});}$(".btn-process",context).each(function(){if($(this).width()<=85&&!$(this).hasClass("disabled")){$(this).addClass("short");}});$("input[placeholder], textarea[placeholder]",context).placeholder();$('input[type="checkbox"]',context).ezMark();$('input[type="radio"]',context).ezMark();$(".scrollbox .productbox a").each(function(){var $this=$(this);if(!$this.hasClass("bubble-handle")){var $pname=$this.find("strong");if($pname.height()>50){$this.addClass("ttip ttip-perma").attr("title",$pname.text());}}});$(".sb-like.liked",context).each(function(){$(this).attr("title",$(this).data("successtitle"));});initTooltips(context);$(".textarea-row textarea",context).each(function(){new DefaultTextAreaCounter(this);});$(".prevent-dbl-click",context).each(function(){$(this).click(function(event){var clickTarget=event.currentTarget;if($(clickTarget).data("clicked")==true){event.preventDefault();}else{$(clickTarget).data("clicked",true);}});});$(".submit-form-on-change",context).each(function(){$(this).change(function(event){var changedElement=event.currentTarget;var form=$(changedElement).parents("form").first();form.submit();});});$("a.countrychange",context).each(function(){$(this).click(function(event){$("#stickyfooter a.countryflag").mouseenter().click();});});$("a[data-sftrigger]",context).click(function(ev){ev.preventDefault();var rel=$(this).data("sftrigger");$('#stickyfooter a[data-sfname="'+rel+'"]').mouseenter().click();});$("a.formsubmit",context).each(function(){$(this).click(function(event){event.preventDefault();var link=event.currentTarget;var form2submit=$(link).data("form2submit");if(typeof form2submit!="undefined"){if(form2submit.substr(0,1)!="#"){form2submit="#"+form2submit;}if($(form2submit).is("form")){$(form2submit).submit();}}});});$("form[data-elms2disable]",context).each(function(){$(this).submit(function(){var elms2Disable=$(this).data("elms2disable");if(elms2Disable){$(elms2Disable).each(function(i,elm){var $elm=$(elm);if($elm.is("a")){$elm.attr("href","javascript: void(0);");}else{if($elm.is("input")||$elm.is("textarea")||$elm.is("button")){$elm.attr("disabled","disabled");}}});}});});var textScrollBoxes=$(".text-scrollbox",context);if(textScrollBoxes.size()>0){textScrollBoxes.jScrollPane({showArrows:true,verticalDragMinHeight:18});if(isTouch){var fixStupidIpadJSPaneBehaviourOnFirstScroll=function(event){var textScrollBox=event.currentTarget;$(textScrollBox).unbind("scroll",fixStupidIpadJSPaneBehaviourOnFirstScroll);var drag=$(".jspDrag",textScrollBox);var top=$(".jspDragTop",drag);var bottom=$(".jspDragBottom",drag);var h2lined=$("h2.lined",textScrollBox);var h2linedspan=$("span",h2lined);top.css({position:"static"});bottom.css({position:"static",marginTop:drag.height()-top.height()-bottom.height()});h2lined.css({position:"static","margin-top":"18px","line-height":"10px"});h2linedspan.css({position:"static"});};textScrollBoxes.scroll(fixStupidIpadJSPaneBehaviourOnFirstScroll);}}$(".jspulldown",context).each(function(){var elm=$(this);if(elm){var follow=elm.hasClass("followlink")?true:false;jsPulldowns.push(new JSPulldown(elm,{followLink:follow}));}});if(!isIE6OrLess()){$(".selectpd",context).each(function(){var elm=$(this);if(elm&&elm.data("pd")!="true"){jsPulldowns.push(new JSPulldown(elm,{followLink:false,selectPulldown:true}));elm.data("pd","true");}});}$(".modaloverlay",context).each(function(){var $linkObj=$(this);var params=($linkObj.hasClass("modal-inline"))?{type:"internal"}:{};if(typeof $linkObj.data("modaldata")!="undefined"){var data=$linkObj.data("modaldata");if(typeof data=="object"){params.data=data;}}if(typeof $linkObj.data("modalmethod")!="undefined"){params.method=$linkObj.data("modalmethod");}new ModalLinksHandling($linkObj,params);});$(".klickbox",context).each(function(i,elm){var fieldset=$("."+$(this).data("rel"));if(!fieldset.length){return;}var h=0;if(!fieldset.data("height")){fieldset.children(":not(script)").each(function(i,ups){h+=$(ups).outerHeight(true);});(fieldset.hasClass("greetingtext"))&&(h+=20);if(fieldset.parents(".myaccount-content").size()>0){h+=18;}else{h+=parseInt(fieldset.css("padding-top"));}fieldset.data("height",h);}if(!$(elm).is(":checked")){fieldset.css({height:0,opacity:0,position:"relative",display:"none"});fieldset.addClass("invisible");$(formularValidation).each(function(){this.reInit(false);});}else{fieldset.css({opacity:1,display:"block"});}});$(".hint",context).each(function(i,elem){var fieldhint=$(elem).parents(".form-row").find(".fieldhint");if(detectedUA.browser=="Firefox"&&detectedUA.browserversion<=9){return;}if(fieldhint){$(elem).focus(function(){fieldhint.show();});$(elem).blur(function(){fieldhint.hide();});}});$(".klickbox",context).on("click togglefieldset",function(e){var $this=$(this),options,$form=$this.parents("form"),$fieldset=$("."+$this.data("rel")),h=$fieldset.data("height"),display,visible,speed=600,dspeed=300;radio=($form.find('[name="'+$this.attr("name")+'"]').length)?true:false;if($fieldset.parents("#po-content").size()>0&&!$fieldset.data("height-calc")){$fieldset.children().each(function(i,ups){h+=$(ups).outerHeight()+parseInt($(ups).css("margin-bottom")+parseInt($(ups).css("margin-top")));});h+=parseInt($fieldset.css("padding-top"))+10;$fieldset.data("height",h);}if(!$fieldset.length&&!radio){return;}if($this.is(":checked")){options={opacity:1,height:h};$fieldset.removeClass("invisible");display="block";visible=true;var uniquegroup=$this.data("uniquegroup");if(uniquegroup){var selfname=$this.attr("name");$form.find('.klickbox[data-uniquegroup="'+uniquegroup+'"]:checked').not('[name="'+selfname+'"]').prop("checked",false).trigger("togglefieldset").parent().removeClass("ez-checked");}radioBtns=$form.find('[name="'+$this.attr("name")+'"]').filter(function(){return this!==$this[0];});radioBtns.each(function(i,elm){$("."+$(elm).data("rel")).animate({opacity:0,height:0},function(){$(this).css("display","none");});});}else{options={opacity:0,height:0};$fieldset.addClass("invisible");display="none";visible=false;}$fieldset.css("display","block");$fieldset.animate(options,speed,function(){if($fieldset.parents("#po-content").size()>0&&visible==true&&!$fieldset.data("height-calc")){var nh=0,dh=0;$fieldset.children().each(function(i,ups){nh+=$(ups).outerHeight()+parseInt($(ups).css("margin-bottom")+parseInt($(ups).css("margin-top")));});nh+=parseInt($fieldset.css("padding-top"));$fieldset.animate({height:nh},dspeed);$fieldset.data("height",nh);$fieldset.data("height-calc","true");}$fieldset.css("display",display);var form=$this.parent("form");$(formularValidation).each(function(){this.reInit(visible);});});});if(isIE(7)||isIE(8)){$(".klickbox-col",context).each(function(){if($(this).is(":last-child")){$(this).addClass("lastchild");}});}$("input[type=text].select-on-focus",context).focus(function(){this.select();});$("#modal-basketlayer",context).each(function(){new BasketLayer(this);});$("#modal-zipsearch",context).each(function(){new ZipSearch(this);});$("#modal-countryselect",context).each(function(){var container=$(this).parents("#simplemodal-container:first");if(container.data("forcedCountrySelectInit")=="y"){return;}container.data("forcedCountrySelectInit","y");new ForcedCountrySelect(this);});$("#modal-tourlayer",context).each(function(){new VirtualTourLayer(this);});$("input[type=radio][data-onchange-url]",context).change(function(event){var form=$(event.currentTarget).parents("form:first");var url=($(this).data("onchange-url")||"");if(url.length>0){if($(form).parents(".layer-newsletter:first").size()>0){form.addClass("layerform");}form.attr("action",url).submit();}});$("#article-overview .crosslinks a",context).each(function(i,elm){var allListItems=$(elm).parents("ul").find("li");var currentListItem=$(elm).parents("li");var imgPlaceHolder=$(elm).parents(".category").find("div.image");var imgSrc=currentListItem.data("imgsrc");if(currentListItem.is(":first-child")){imgPlaceHolder.append('<img src="'+imgSrc+'" />');allListItems.removeClass("active");currentListItem.addClass("active");}var to;$(elm).hover(function(){to=setTimeout(function(){allListItems.removeClass("active");currentListItem.addClass("active");$("img",imgPlaceHolder).attr("class","myoldimg");imgPlaceHolder.append('<img src="'+imgSrc+'" style="position: absolute; top: 0; left: 0; display: none;" id="mytempimg" />');$("#mytempimg",imgPlaceHolder).fadeIn(300,function(){$(this).removeAttr("style").removeAttr("id");$(".myoldimg",imgPlaceHolder).detach();});},200);},function(){clearTimeout(to);});});$("#warenkorb_button",context).click(function(ev){var $butt=$(this);var variant=$("#variationform select option:selected").index();if(variant==0){ev.preventDefault();$("#varianterror").fadeIn(300);$butt.addClass("disabled");}else{$butt.removeClass("disabled");}});$("#variationform",context).each(function(){var $vform=$(this),$variantSelect=$("select",$vform),$variantPulldown=$("ul.flesh a",$vform),$variantSelectVal=parseInt($variantSelect.val());if($variantSelectVal===0){$("#warenkorb_button",context).addClass("disabled");}$variantPulldown.click(function(ev){var value=$(this).data("value");if(value!==0){$("#warenkorb_button",context).removeClass("disabled");}else{$("#warenkorb_button",context).addClass("disabled");}});});$("#prodform",context).submit(function(ev){var $form=$(this),$butt=$("#warenkorb_button",this),ajaxAction=$form.data("ajaxaction");if(ajaxAction){ev.preventDefault();if($butt.attr("data-idle")){$butt.addClass("disabled");return;}$butt.addClass("disabled").attr("data-idle","true");var method=($form.attr("method")||"");var data=$form.serialize();if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}$.ajax(ajaxAction,{type:method,data:data,dataType:"html",success:function(data,textStatus,jqXHR){addToShoppingbag(data,$butt,isTouch);}});}});$(".sub-shoppingbag",context).click(function(ev){var $link=$(this),ajaxAction=$link.data("ajaxaction");if(ajaxAction){ev.preventDefault();if($link.attr("data-idle")){$link.addClass("disabled");return;}$link.addClass("disabled").attr("data-idle","true");var method="get";var data=ajaxAction;$.ajax(ajaxAction,{type:method,dataType:"html",success:function(data,textStatus,jqXHR){addToShoppingbag(data,$link,isTouch);}});}});if(isTouch){$("input[data-inputtype]",context).each(function(){var $this=$(this);var type=$this.data("inputtype");var possTypes=new Array("email","tel");if(possTypes.indexOf(type)!=-1){$this.get(0).type=type;if(!isTouch){var $form=$this.parents("form");$form.attr("novalidate","novalidate");}}});}$("div#comments a.show-form",context).on("click",function(event){event.preventDefault();var $form=$("div#comments form");$(this).fadeOut(400,function(){$form.slideDown(400);if($form.hasClass("validate")){formularValidation.push(new Formularvalidator($form,{}));}scrollToAnchor("#comments",0,false);});});$("#commentform",context).on("submit",function(event){event.preventDefault();var $form=$(event.currentTarget),action=$form.attr("action"),method=($form.attr("method")||""),data=$form.serialize(),formRows,i,type,validation=true;formRows=$form.find(".form-row.required-field");for(i=0;i<formRows.length;i++){if($(formRows[i]).find("input").length>0){if($(formRows[i]).find("input").attr("type")=="text"&&$(formRows[i]).find("input").val()==""){validation=false;}}else{if($(formRows[i]).find("textarea").length>0&&$(formRows[i]).find("textarea").val()==""){validation=false;}}}if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}$.ajax(action,{context:this,type:method,data:data,dataType:"html",success:function(data){var $commentform=$("#comments form"),$commentlisthead=$("#comments #commentlisthead");$commentform.replaceWith(data);enhance($("#comments"));scrollToAnchor("#comments",0,false);if($(data).filter("#commentlisthead").size()>0){$commentlisthead.remove();}}});});$("#beswarovski-signup form",context).on("submit",function(event){event.preventDefault();var $form=$(event.currentTarget),action=$form.attr("action"),method=($form.attr("method")||""),data=$form.serialize();if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}$.ajax(action,{context:this,type:method,data:data,dataType:"html",success:function(data){var $target=$("#beswarovski-signup");$target.html(data);enhance($target);var scrollOffs=$("body").hasClass("v2014")?0:($("#checkout-progress").outerHeight(true)+2)*-1;scrollToAnchor("#beswarovski-signup",scrollOffs,false);}});});$(".product-info",context).find(".addtoshoppingbag").click(function(ev){var $link=$(this),ajaxAction=$link.data("ajaxaction");if(ajaxAction){ev.preventDefault();if($link.attr("data-idle")){$link.addClass("disabled");return;}$link.addClass("disabled").attr("data-idle","true");var method="get";var data=ajaxAction;$.ajax(ajaxAction,{type:method,dataType:"html",success:function(data,textStatus,jqXHR){if(context.attr("id")=="simplemodal-container"){$(context).find(".simplemodal-close").click();}addToShoppingbag(data,$link,isTouch);}});}});if($("#modal-othersites").size()){if(isTouch){$("a[data-toggle]").click(function(event){var link=$(event.currentTarget);var target=$("#infotoggle-"+link.data("toggle"));if((target.size()>0)&&(!$(target).is(":visible"))){$("div:visible",target.parent("div")).hide();target.fadeIn(200);event.preventDefault();}});}else{$("a[data-toggle]").mouseenter(function(event){var link=$(event.currentTarget);var target=$("#infotoggle-"+link.data("toggle"));if(target.size()>0){$("div:visible",target.parent("div")).stop(true,true).hide();target.fadeIn(200);}});}}$("#modal-countryselect #hiddenchangelog").each(function(){if($(this).is("input[type=hidden]")){var form=$(this).parents("form:first");$("input[type=submit]",form).click(function(event){var form=$(event.currentTarget).parents("form:first");var changelogField=$("#hiddenchangelog",form).val("submit");});}});if(isTouch){$("#contentwrap .block .overlay").each(function(i,elm){var link=$(elm).closest("a");link.on("click",function(e){if($(elm).data("prevented")){return;}else{e.preventDefault();var time=setTimeout(function(){$("#header, #contentwrap, #footer").one("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,link)){$(elm).data("prevented",false);}clearTimeout(time);});},10);$(elm).data("prevented",true);}});});}}$(function(){$.enhance=function(c){enhance(c);};if(navigator.cookieEnabled==false){$("#nocookies").addClass("show");}if(touchOS){$("body").addClass("touch").addClass(detectedUA.os);isTouch=detectedUA.os;}if(isTouch){$(".hlspluscontent .video").each(function(){var $this=$(this),that=this,$video=$("video",this);$this.hide();var videoMarkup=$this.html();$this.html('<img src="'+$video.attr("poster")+'" alt="" class="videoonclick" />').show();setTimeout(function(){$this.html(videoMarkup);videos.push(new Videohandling($("video",that)));},3000);});}$("body").addClass("js").removeClass("nojs");$(".v2014 #header a.shoppingbag.async").each(function(){var $sblink=$(this),checkurl=$sblink.data("checkurl");if(checkurl){$.ajax(checkurl,{dataType:"text",success:function(data,textStatus,jqXHR){if(data=="true"){$sblink.text($sblink.data("text-notempty"));}else{$sblink.text($sblink.data("text-empty"));}$sblink.fadeIn(200);},error:function(){$sblink.fadeIn(200);}});}else{$sblink.fadeIn(200);}});$(".v2014 #header a.account.async").each(function(i,elm){var $silink=$(this),checkurl=$silink.data("checkurl");if(checkurl){$.ajax(checkurl,{dataType:"html",success:function(data,textStatus,jqXHR){$silink.html(data);if($(data).hasClass("loggedin")){$silink.addClass("loggedin");new MyAccount(elm);}$silink.fadeIn(200);},error:function(){$silink.fadeIn(200);}});}else{$silink.fadeIn(200);}});if(isIE(7)){$(".scrollbox + h2.lined").each(function(){$(this).css("margin-top","50px");});$(".iconic-products + h2.lined").each(function(){$(this).css("margin-top","53px");});}$("a.print, button.print").on("click",function(ev){ev.preventDefault();printPage();});$("#header .page").append('<span id="print-head" style="display: none;">www.swarovski.com</span>');$(".v2014 #header").append('<span id="print-head" style="display: none;">www.swarovski.com</span>');$('.coverstory .teaser[data-contenttype="video"]').addClass("video");$("#listpage").each(function(){var mc=$(this).parents(".maincontent");mc.addClass("listpage");if(mc.find(".filtercontainer").length==0){$(".col-main",mc).addClass("centered");}});if(detectedUA.browser=="Chrome"&&(detectedUA.os=="Windows"||detectedUA.os=="WindowsXP")){$("body").addClass("chrome-win");}else{$("body").addClass(detectedUA.browser.toLowerCase());}if(detectedUA.browser=="Firefox"&&detectedUA.browserversion<=9){$(".secodehint").each(function(){$(this).parent().css("display","block");});}$(".options-box .paging li em").each(function(){$(this).parent().addClass("dots");});$(".giftcenter").each(function(i,elm){$(elm).css("z-index",10-i);});$("video").each(function(i,elem){videos.push(new Videohandling(elem));});$("body.scs .article div.asset .mejs-container, body.magazine .article div.asset .mejs-container").each(function(){var $this=$(this);var w=$this.width();$this.parents("div.asset").width(w);});if($("#giftcategories").length>0){new GiftcategoriesHandler(giftCategories);}$("div[data-provinces]").each(function(){var dataObj=eval($(this).data("provinces"));new ProvinceCityDistrictHandler(dataObj);});initScrollboxes(".scrollbox:visible",isTouch);$(".motionteaser .teaser .content .mainimg").each(function(){var w=0;var cta=$(".button-cta",this);if(cta.length>1){cta.each(function(){var tw=$(this).width();w=tw>w?tw:w;});cta.width(w+1);}});$.initTabBoxes=function(){$(".tab-box").tabs({show:function(event,ui){initScrollboxes("#"+ui.panel.id+" .scrollbox",isTouch);}});};$.initTabBoxes();if(isIE()&&!isIE(10)){$("a.pager.small, a.button-cta").each(function(i,elm){var dir=($(elm).hasClass("prev"))?"left":"right",val=4,obj=($(elm).hasClass("button-cta"))?$(this).find("span"):$(this),bgPos={"background-position-x":$(obj).css("background-position-x")};$(elm).hover(function(){obj.css(bgPos);obj.animate({"background-position-x":((dir=="left")?"-=":"+=")+val},{duration:600,queue:false,easing:"easeOutQuart"});},function(){obj.animate({"background-position-x":((dir=="left")?"+=":"-=")+val},{duration:600,queue:false,easing:"easeOutQuart"},function(){$(obj).css(bgPos);});});});}var initSlideshow=function(context){$(".d-slideshow",context).each(function(){var elm=$(this);var objName=$(this).data("dobj");var obj=eval(objName);new SlideShow(elm,obj,objName);});};initSlideshow();$(".embedded.slideshow").each(function(i,elem,options){new EmbeddedSlideshow(i,this,{isTouch:isTouch});}).hover(function(){if(isIE(6)){return;}var $btns=$("div.pager a",this);$("body").bind("keyup",function(ev){if(ev.keyCode==37){$btns.filter(".prev").click();}else{if(ev.keyCode==39){$btns.filter(".next").click();}}});},function(){if(isIE(6)){return;}$("body").unbind("keyup");});$.initBubbles=function(context,triggerParentLink){if(typeof(context)==="undefined"){context=null;}if(typeof(triggerParentLink)==="undefined"){triggerParentLink=false;}$(".bubble-handle",context).each(function(){var elm=$(this);if(elm){if(elm.find(".bubble").hasClass("bubble-top")||elm.data("top-bubble")){bubbles.push(new Bubble(elm,{positionTop:true,isTouch:isTouch,triggerParentLink:triggerParentLink}));}else{if($(this).parents("#prevsel-products-box").size()){bubbles.push(new Bubble(elm,{offsY:15,isTouch:isTouch,triggerParentLink:triggerParentLink}));}else{if(elm.hasClass("share")){bubbles.push(new Bubble(elm,{offsY:15,isTouch:isTouch,triggerParentLink:triggerParentLink}));}else{bubbles.push(new Bubble(elm,{isTouch:isTouch,triggerParentLink:triggerParentLink}));}}}}});$(".thumbnailbubble",context).each(function(){var elm=$(this);if(elm){elm.append('<div class="bubble thumbnail-bubble"><span class="bubble-arr"></span><div class="bubble-ctn"><img src="'+elm.data("thumbnail")+'" alt="" /></div></div>');bubbles.push(new Bubble(elm,{offsX:30,offsY:15,positionTop:true,isTouch:isTouch,triggerParentLink:triggerParentLink}));}});$(".infobubble-handle",context).each(function(){var elm=$(this);if(elm&&!$("body").hasClass("touch")){infobubbles.push(new Infobubble(elm,{}));}});};$.initBubbles();$("#prod-img #image-area").each(function(i,elem){new DetailProductViewer(elem);});$(".magazine .coverstory").each(function(i,elem){new SmallInlineOverviewDisplay(elem);});$(".pagingteaser").each(function(i,elem){new PagingTeaser(elem);});$(".sidepaging, .hlspluscontent .maxpage").each(function(i,elem){new Pager(elem);});$(".sidepaging a.pager").each(function(){var $this=$(this);if($this.hasClass("prev")&&$this.data("current-page")==1){$this.hide();}if($this.hasClass("next")&&$this.data("page-count")==1){$this.hide();}});$("body.hp").each(function(i,elem){new Pager(elem,{initArrowButtons:"n"});});$.togglePrevselProducts=function(){$("#prevsel-products").click(function(ev){ev.preventDefault();if($("#prevsel-products-box").css("display")!="block"){$("#prevsel-show").hide();$("#prevsel-hide").show();}else{$("#prevsel-show").show();$("#prevsel-hide").hide();}for(var i=0;i<infobubbles.length;i++){if(infobubbles[i].$elem.attr("id")=="prevsel-products"){infobubbles[i].resetContent();}}$("#prevsel-products-box").animate({height:"toggle",opacity:"toggle"},500,"easeOutQuart");if(!isIE()||isIE(9)){$("#prevsel-products-hl").animate({opacity:"toggle"},500);}else{$("#prevsel-products-hl").toggle();}});};$.togglePrevselProducts();$("#contentwrap .myaccount form.std.wishlist #message").each(function(i,elm){if(isIE(9)){$(elm).css("margin-left",0);}});if(detectedUA.browser=="Chrome"||detectedUA.browser=="Safari"){$("#mainnav li.open").each(function(){if($("body").hasClass("hp")){return;}var em=$("em",this).eq(0).outerWidth()+5;var tot=em+3;$("ul li.l1",this).each(function(){tot+=$(this).outerWidth();});$(this).css("width",tot+"px");});}$("#mainnav").each(function(){new Mainnav(this);});$("#mainnav-flat").each(function(){new MainnavFlat(this);});$("body.v2014 nav").each(function(){new Mainnav2014(this);});$("body.v2014 a.shoppingbag").each(function(i,elm){new Shoppingbag(elm);});$("body.v2014 a.account.loggedin").each(function(i,elm){new MyAccount(elm);});$(".styleblog-mainnav>ul>li").each(function(){var $li=$(this),$ul=$li.parent(),liClass=$li.attr("class"),timeIn=400,timeOut=400,toIn,toOut;if(isTouch){$li.on("click",function(ev){if($ul.hasClass("open")&&$ul.hasClass(liClass)){}else{ev.preventDefault();$(".styleblog-mainnav>ul>li").removeClass("hover");$li.addClass("hover");$ul.attr("class","open "+liClass);$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$(".styleblog-mainnav"))){$("#header, #contentwrap, #stickyfooter").unbind("click");$li.removeClass("hover");$ul.removeClass();}});}});}else{$li.on("mouseenter",function(){clearTimeout(toOut);toIn=setTimeout(function(){$li.addClass("hover");$ul.addClass("open");},timeIn);}).on("mouseleave",function(){clearTimeout(toIn);toOut=setTimeout(function(){$li.removeClass("hover");$ul.removeClass("open");},timeOut);});}});$(".sb-post-teaser-slides").each(function(){var $box=$(this),$teaser=$box.find(".sb-post-teaser"),fadetime=600,runtime=($box.data("autorun")?$box.data("autorun"):4000)+fadetime,ix=1;$teaser.first().addClass("active").fadeIn(fadetime);if($teaser.size()>1){$box.addClass("pageable");$box.hover(function(){$box.addClass("hover");},function(){$box.removeClass("hover");});navbullets="";$teaser.each(function(){navbullets+='<a href="#">â€¢</a>';});$box.append('<div class="paging">'+navbullets+"</div>");$box.find(".paging a").on("click",function(ev){ev.preventDefault();var x=$(this).index();$teaser.filter(".active").removeClass("active");$teaser.eq(x).addClass("active").fadeIn(fadetime,function(){$teaser.not(".active").hide();});$box.find(".paging a").removeClass("active").eq(x).addClass("active");ix=x+1;}).removeClass("active").eq($teaser.filter(".active").index()).addClass("active");setInterval(function(){if($box.hasClass("hover")){return;}if(ix<$teaser.size()){$teaser.filter(".active").removeClass("active").next().addClass("active").fadeIn(fadetime,function(){$teaser.not(".active").hide();});ix++;}else{$teaser.filter(".active").removeClass("active");$teaser.first().addClass("active").fadeIn(fadetime,function(){$teaser.not(".active").hide();});ix=1;}$box.find(".paging a").removeClass("active").eq($teaser.filter(".active").index()).addClass("active");},runtime);}});$(".sb-like").click(function(ev){ev.preventDefault();var $link=$(this),ajaxurl=$link.data("ajaxurl");if($link.hasClass("liked")||!ajaxurl){return;}$.ajax(ajaxurl,{dataType:"html",type:"get",success:function(data,textStatus,jqXHR){unTooltip();if(data!=-1){$link.addClass("liked").text(data).attr("title",$link.data("successtitle"));}else{$link.attr("title",$link.data("errortitle"));}initTooltips($link.parent());}});});$(".sb-posts-list").each(function(){var t=0,h=0,$smallteaser=$(this).find(".sb-post-teaser.small");$smallteaser.each(function(){var $teaser=$(this),tHeight=$teaser.height();if(t==3){t=0;h=0;}t++;h=h<tHeight?tHeight:h;$teaser.height(h);});});$("#stickyfooter").each(function(){new FooterNav(this,{isTouch:isTouch});});if(typeof SuggestBox!="undefined"){suggest=new SuggestBox();$("form#headersearch").first().each(function(){$('<div id="suggestoutput"></div>').insertAfter(this);if($(this).data("suggest")){suggest.init($(this).data("suggest"),"headersearch",$("input:text",this).attr("name"),"suggestoutput","suggest");}});}$("form#headersearch").on("submit",function(ev){var termfield=$("input:text",this);if($.trim(termfield.val())==""){var errorbox=$(".errorbox",this);var to;if(!isIE()||isIE(9)){errorbox.fadeIn(200);}else{errorbox.show();}termfield.val("").on("focus",function(){clearTimeout(to);}).on("keyup",function(){if($(this).val()!=""){errorbox.hide();$(this).off("focus keyup");}}).blur(function(){to=setTimeout(function(){errorbox.hide();},100);}).focus();ev.preventDefault();}});$("form.searchform").on("submit",function(ev){var termfield=$("input:text",this);if($.trim(termfield.val())==""){termfield.attr("placeholder",termfield.attr("errortext"));ev.preventDefault();}});suggestCookieDelete=function(){var allCookies=document.cookie.split(";"),i;for(i=0;i<allCookies.length;i++){var cookies=allCookies[i].split("=");cookieKey=$.trim(cookies[0]);cookieVal=$.trim(cookies[1]);if(cookieKey.lastIndexOf("ff_")!==-1){if(cookieKey!="ff_view"){var d=new Date();document.cookie=cookieKey+"="+cookieVal+"; path=/; expires="+d.toGMTString()+";";}}}};$("a.button-cta, a.btn-cta, div.btn-cta").each(function(){var $this=$(this);var color=$this.data("buttoncolor");if(!color){return;}if($("body").is(".v2014")){if($("body").is(".hp")){$button=$this.find("span");}else{$button=$this;}$button.css({"border-color":"#"+color,color:"#"+color}).hover(function(){buttontype=$this.hasClass("white-blue")||$this.hasClass("white")?"white":"blue";$(this).css({color:(buttontype=="white"?"#003063":"#ffffff"),"background-color":"#"+color});},function(){$(this).css({color:"#"+color,"background-color":"transparent"});});return;}var alpha=isIE(7)||isIE(8)?1:0.7;if(typeof color!="undefined"){var rgb=convertHexToRGB(color);if(alpha==1){$this.css("background-color","rgb("+rgb.r+","+rgb.g+","+rgb.b+")");}$this.css("background-color","rgba("+rgb.r+","+rgb.g+","+rgb.b+","+alpha+")").hover(function(){$(this).css("background-color","rgba("+rgb.r+","+rgb.g+","+rgb.b+",1)");},function(){$(this).css("background-color","rgba("+rgb.r+","+rgb.g+","+rgb.b+","+alpha+")");});}});function alignHlsTeaser($o,visible,width){$o.each(function(ix){$(this).css("left",ix*width+"px");if(ix>(visible-1)){$(this).hide();}else{$(this).show();}});}$(".hlsteaser").each(function(){var root=this;var $wrap=$(".teaserwrap",this);var $tsr=$(".teaser",this);var $btns=$(".pager",this);var width=$tsr.first().width()+30;var visibleProducts=$wrap.data("visible")||4;var elms2move=$wrap.data("elms2move")||1;if(elms2move!=1){if($tsr.length<elms2move+visibleProducts){elms2move=1;}}for(var i=0;i<visibleProducts;i++){var prodimg=$tsr.eq(i).find("a img");if(prodimg.attr("src")!=prodimg.data("src")){prodimg.attr("src",prodimg.data("src"));}}alignHlsTeaser($tsr,visibleProducts,width);if($tsr.size()<(visibleProducts+1)){$btns.hide();return;}var clicked=false;$btns.click(function(ev){if(clicked){return;}clicked=true;ev.preventDefault();var dir=$(this).hasClass("prev")?"prev":"next",elms,previmg,nextimg;if(dir=="prev"){elms=$tsr.filter(":gt("+($tsr.length-(elms2move+1))+")");elms.each(function(i,elm){$(elm).prependTo($wrap).css({left:((i+1)*width*-1)+"px",position:"relative"}).css({position:"absolute"});previmg=$(elm).find("a img");if(previmg.attr("src")!=previmg.data("src")){previmg.attr("src",previmg.data("src"));}});}else{elms=$tsr.filter(":lt("+(visibleProducts+elms2move)+")");elms.each(function(i,elm){nextimg=$(elm).find("a img");if(nextimg.attr("src")!=nextimg.data("src")){nextimg.attr("src",nextimg.data("src"));}});}if(!isIE()||isIE(9)){elms.fadeIn(800);elms2fadeout=$tsr.filter(":lt("+visibleProducts+")");if(visibleProducts!=elms2move){if(dir=="prev"){elms2fadeout=elms2fadeout.last();}else{elms2fadeout=elms2fadeout.first();}}elms2fadeout.fadeOut(400);}else{elms.show();$tsr.filter(":lt("+visibleProducts+")").hide();}$wrap.animate({left:(dir=="next"?"-":"+")+"="+(elms2move*width+"px")},(800),"easeOutQuart",function(){if(dir=="next"){$wrap.append($tsr.filter(":lt("+elms2move+")"));}$tsr=$(".teaser",root);alignHlsTeaser($tsr,visibleProducts,width);$wrap.css("left","0px");clicked=false;});});if($("body").hasClass("touch")){$(this).swipe({swipeLeft:function(ev,dir){$btns.filter(".next").click();},swipeRight:function(ev,dir){$btns.filter(".prev").click();}});}}).hover(function(){if(isIE(6)){return;}var $btns=$(".pager",this);$("body").bind("keyup",function(ev){if(ev.keyCode==37){$btns.filter(".prev").click();}else{if(ev.keyCode==39){$btns.filter(".next").click();}}});},function(){if(isIE(6)){return;}$("body").unbind("keyup");});$.initMoretextHandling=function(){$(".moretext").each(function(){var that=this;$("p.more",that).animate({height:"hide",opacity:"hide"},100);$("a.more",this).click(function(ev){ev.preventDefault();$(that).animate({"max-height":"3000px"},800,"easeInQuart",function(){$("a.more",that).hide();});});});$(".moredetails").each(function(){var that=this;var introLength=400;var moreText=$(that).data("moretext");var text=$.trim($(that).html());if(text.length<=introLength){return;}if(moreText.length){var tmpText=text.substring(0,(introLength-moreText.length-2));}var split=tmpText.lastIndexOf(" ");if(split!=-1&&moreText.length){var intro=text.substring(0,split);var full=text.substring(split,text.length);$(that).html(intro+'<span class="ellipsis">&hellip;</span> <a class="more" href="#more" style="">'+moreText+'</a><span class="more-text">'+full+"</span>");$(that).find(".more-text").css("display","none");var moreLink=$(that).find(".more");var moreContent=$(that).find(".more-text");var ellipsis=$(that).find(".ellipsis");moreLink.click(function(ev){ev.preventDefault();moreLink.hide();ellipsis.hide();moreContent.animate({opacity:"show"},800,"easeInQuart");});}});};$.initMoretextHandling();$(".iconic-products").each(function(){markLastItemInRow(this);});$.arrangeParagraphs=function(){this.$elm=$("#listpage");var self=this;this.perRow=(this.$elm.hasClass("medium"))?3:2;this.objects=this.$elm.find(".listproduct p");var elms=new Array();this.objects.each(function(i,elm){elms.push(elm);if((i+1)%self.perRow==0){var low=i+1-self.perRow,high=i,vals=new Array(),nElms=new Array();for(var i=low;i<=high;i++){vals.push($(elms[i]).height());nElms.push(elms[i]);}var max=Math.max.apply(Math,vals);$(nElms).css("height",max);}});if(this.$elm.hasClass("medium")){var processHeightAdjust=function(){$("div.labels.bottom").each(function(i,elm){var h=$(elm).height(),fh=$(elm).find("img.flag").outerHeight(true);if(h>fh){$(this).css("top","-="+(h-fh));}});};$(window).on("lp-m-labels-loaded",processHeightAdjust);var imageCount,imagesLoaded=0,imgs=$("div.labels.bottom img.flag"),imageCount=imgs.length;imgs.each(function(i,img){$(img).load(function(){(++imagesLoaded==imageCount)&&($(window).trigger("lp-m-labels-loaded"));});});if(isIE()){processHeightAdjust();}}};if($("#listpage > .listproduct").length>1){$.arrangeParagraphs();}if($(".smallteaser-holder > .smallteaser").length>1){setTimeout($.proxy(function(){this.$elm=$(".smallteaser-holder");var self=this;this.perRow=2;this.objects=this.$elm.find(".smallteaser");var elms=new Array();this.objects.each(function(i,elm){elms.push(elm);if((i+1)%self.perRow==0){var low=i+1-self.perRow,high=i,vals=new Array(),nElms=new Array();for(var i=low;i<=high;i++){vals.push($(elms[i]).height());nElms.push(elms[i]);}var max=Math.max.apply(Math,vals);$(nElms).css("height",max);}});},document),100);}enhance();$("form.validate").each(function(){var elm=$(this);if(elm){formularValidation.push(new Formularvalidator(this,{}));}});$("form.std-2014.validate").each(function(){var elm=$(this);if(elm){formularValidation.push(new $.CheckoutFormValidator(this,{}));}});$(".datepicker").each(function(){var elm=$(this);if(elm){var params=elm.data("maxdate")?{maxDate:elm.data("maxdate")}:{};new $.AdvancedDatePicker(this,params);}});$(".sync-height").syncHeight();if($("body").hasClass("v2014")){if($("#giftcardtext .message-ctn")&&$("#edit-giftcardtext")){var giftcardtext=$.trim($("#giftcardtext .message-ctn").text());if(giftcardtext){$("#giftcardtext").show();$("#edit-giftcardtext").hide();}else{$("#giftcardtext").hide();$("#edit-giftcardtext").show();}$("#giftcardtext a").click(function(e){e.preventDefault();$("#giftcardtext").hide();$("#edit-giftcardtext textarea").text(giftcardtext);$("#edit-giftcardtext").show();});$("#edit-giftcardtext textarea").blur(function(e){$("#edit-giftcardtext").hide();$("#giftcardtext .message-ctn").text($("#edit-giftcardtext textarea").val());$("#giftcardtext").show();giftcardtext=$.trim($("#edit-giftcardtext textarea").val());});}}if(!isTouch){$(".sticky").each(function(i,elm){$(this).data("pos-y",$(this).offset().top-parseInt($(this).css("margin-top")));if($(this).siblings(".placeholder").length==0){$(this).after('<div class="placeholder" />');}});var footerSpace=($("body").hasClass("v2014")?$("#footer").height()+17+150:90);$(window).scroll(function(e){var scrollTop=$(window).scrollTop();var space=(isIE(7))?"padding-top":"margin-top";$(".sticky").each(function(i,elm){var h=$(this).outerHeight()+parseInt($(this).css("margin-top"))+parseInt($(this).css("margin-bottom"));this.$placeholder=$(this).siblings(".placeholder");if(scrollTop>$(this).data("pos-y")){$(this).css("top",0);if(isIE(7)&&$(this).prev().length!=0){$(this).prev().hide();h+=$(this).prev().height();}$(this).addClass("fixed");this.$placeholder.css(space,h);var diff=($(document).height()-$(window).scrollTop())-(h+footerSpace);(diff<0)&&($(this).css("top",diff));}else{$(this).removeClass("fixed");if(isIE(7)&&$(this).prev().length!=0){$(this).prev().show();}$(this).css("top","");this.$placeholder.css(space,"");}});});}$('input[type="radio"].klickbox, input[type="checkbox"].klickbox').on("change",function(){if($(this).data("toggleid")===undefined){return;}var i,field,fieldIds=$(this).data("toggleid").split(",");var fieldsCount=fieldIds.length;for(i=0;i<fieldsCount;i++){field=$.trim(fieldIds[i]);if($(this).data("toggleid")!==undefined&&$(this).data("togglecheck")!==false&&$(this).is(":checked")){$("#"+field+"-mirror").find("a.handle").removeClass("disabled");if($("#"+field).attr("type")=="text"){$("#"+field).removeClass("disabled").removeAttr("disabled");}if($("#"+field).hasClass("hasDatepicker")){$("#"+field).removeClass("hide").find("input[type=hidden]").removeClass("disabled").removeAttr("disabled");}}else{$("#"+field+"-mirror").find("a.handle").addClass("disabled");if($("#"+field).attr("type")=="text"){$("#"+field).addClass("disabled").attr("disabled","disabled").val("");}if($("#"+field).hasClass("hasDatepicker")){$("#"+field).addClass("hide").find("input[type=hidden]").addClass("disabled").attr("disabled","disabled").val("");$("#"+field).find(".ui-datepicker td").removeClass("ui-datepicker-current-day");}}}});$('input[type="radio"].klickbox, input[type="checkbox"].klickbox').each(function(){if($(this).data("toggleid")!==undefined&&$(this).data("togglecheck")!==false&&$(this).is(":checked")){var i,field,fieldIds=$(this).data("toggleid").split(",");var fieldsCount=fieldIds.length;for(i=0;i<fieldsCount;i++){field=$.trim(fieldIds[i]);$("#"+field+"-mirror").find("a.handle").removeClass("disabled");$("#"+field).removeClass("disabled");if($("#"+field).attr("type")=="text"){$("#"+field).removeClass("disabled").removeAttr("disabled");}if($("#"+field).hasClass("hasDatepicker")){$("#"+field).removeClass("hide").find("input[type=hidden]").removeClass("disabled").removeAttr("disabled");}}}});$("#email").change(function(e){$("#account-email").val(($(this).val()));});(function(){var snavHandler=$("#snav-handler:first");if(snavHandler.size()>0){var snavPd=$("#snav-pd:first");if(snavPd.size()>0){new Snav(snavHandler,snavPd,{isTouch:isTouch});}}})();$("input[type=checkbox][data-displaytoggle],input[type=radio][data-displaytoggle]").each(function(){var element=this;if($(element).is("[type=radio]")){var myName=$(element).attr("name");var brotherRadios=$(element).parents("form").find(":radio[name="+myName+"]").filter(function(i,elm){return(elm!=element);});brotherRadios.change(function(event){toggleFlyout(element);});}if($(element).is(":checked")){toggleFlyout(element);}});$("input[type=checkbox][data-displaytoggle],input[type=radio][data-displaytoggle]").change(function(event){var element=event.currentTarget;toggleFlyout(element);});$("input[type=checkbox][data-emptyfieldscontainer],input[type=radio][data-emptyfieldscontainer]").each(function(){var element=this;if($(element).is("[type=radio]")){var myName=$(element).attr("name");var brotherRadios=$(element).parents("form").find(":radio[name="+myName+"]").filter(function(i,elm){return(elm!=element);});brotherRadios.change(function(event){toggleEmptyFields(element);});}if($(element).is(":checked")){toggleEmptyFields(element);}});$("input[type=checkbox][data-emptyfieldscontainer],input[type=radio][data-emptyfieldscontainer]").change(function(event){var element=event.currentTarget;toggleEmptyFields(element);});$(".v2014 input.btn-process").each(function(i,elm){$(elm).click(function(e){if($(this).data("formid")){e.preventDefault();$("#"+$(this).data("formid")).submit();}});});$(".btn-quantity.plus, .btn-quantity.minus").each(function(i,elm){$(elm).click(function(e){e.preventDefault();var form=$(elm).siblings().filter("form");input=form.find("input:first");val=input.val();val=($(elm).is(".minus"))?--val:++val;if(val<0){val=0;}input.val(val);input.trigger("change");});});$('.v2014 form[data-presubmit="true"]').each(function(i,elm){var form=this;$("input, textarea",form).change(presendForm);function presendForm(){var f=$(form);var ajaxUrl=f.attr("action");var errorText=f.data("errortext")||"Connection error. Please try again later.";var formTimeout=f.data("timeout")||"5000";var formParams=f.serialize()+"&presubmit=true";var result=$.ajax({type:"POST",timeout:formTimeout,data:formParams,url:ajaxUrl,dataType:"text"});}});$(".block.giftcard-voucher form#voucherform").each(function(i,elm){$(elm).find('input[type="submit"]').click(function(e){e.preventDefault();handleVoucherForm(elm,$(elm).data("ajaxurl"));});});$(".block.giftcard-voucher #egcarea .remove").click(function(e){$("#egcarea").hide();$("#submitcode").show();$("#vouchercode").val("");$("#voucher_form_error strong").text("");$("#voucher_form_error").hide();});$("#vouchercode, #pincode").keyup(function(event){var value=$(this).val();if(value==""&&event.which!=13){$("#voucher_form_error").hide().children().text("");if($("#egcarea:visible").length>0){$("#egcarea").hide();$("#submitcode").show();}}});function handleVoucherForm(form,ajaxUrl){var f=$(form);var errorText=f.data("errortext")||"Connection error. Please try again later.";var formTimeout=f.data("timeout")||"5000";var formParams=f.serialize();var cover=$("<div />").addClass("cover").appendTo(f.closest(".giftcard-voucher"));var result=$.ajax({type:"POST",timeout:formTimeout,data:formParams,url:ajaxUrl,success:function(result){var response=$.trim(result)||errortext;if(response=="ok"){form.submit();$("#voucher_form_error strong").text("");$("#voucher_form_error").hide();$("#loadingicondiv").hide();}else{if(response=="ShowPinCode"){$("#voucher_form_error strong").text("");$("#voucher_form_error").hide();var vouchercode=$("#vouchercode").val();$("#submitcode").hide();$("#egcarea").show();cover.hide();}else{if($("#egcarea:visible").length>0){$("#voucher_form_error").show();}else{}$("#voucher_form_error strong").text(response);$("#voucher_form_error").show();cover.hide();}}},error:function(result){cover.hide();},dataType:"text"});}openAutoModal=function(url,closeText,data,method,type){closeText=closeText===undefined||closeText==""?closeText="Close":closeText=closeText;if(typeof data!="object"){data={};}if(typeof method=="string"){method=method.toLowerCase();}else{method="";}if((method!="get")&&(method!="post")){method="post";}if(typeof type=="string"){type=type.toLowerCase();}else{type="url";}var autoModal=new ModalLinksHandling("",{modalURL:url,closeText:closeText,autoOpen:true,data:data,method:method,type:type});};if(typeof(config)!=="undefined"&&typeof(config["modal.autoopen"])==="object"){var url=(config&&config["modal.autoopen"].url)?config["modal.autoopen"].url:"";var closeText=(config&&config["modal.autoopen"].closeText)?config["modal.autoopen"].closeText:(config&&config["modal.closetext"])?config["modal.closetext"]:"";var data=(config&&config["modal.autoopen"].data)?config["modal.autoopen"].data:"";if(url.length>0){openAutoModal(url,closeText,data);}}var openModalClass=$(".modal-autoopen","body");var openModalClassCount=openModalClass.length;if(openModalClassCount>0){var ajaxURL=openModalClass.data("ajaxurl");var content,type;if(typeof(ajaxURL)=="string"&&ajaxURL.length>0){content=ajaxURL;type="external";}else{content=openModalClass.html();type="internal";}var closeText=openModalClass.data("txt-closemodal");var data={};var method="post";openAutoModal(content,closeText,data,method,type);}openForcedCountrySelect=function(){var url=(config&&config["forcedcountryselect.url"])?config["forcedcountryselect.url"]:"";var closeText=(config&&config["modal.closetext"])?config["modal.closetext"]:"";var data=(config&&config["forcedcountryselect.ajaxparams"])?config["forcedcountryselect.ajaxparams"]:{};if(url.length>0){openAutoModal(url,closeText,data);}};if(config&&config["forcedcountryselect.init"]){openForcedCountrySelect();}doSetCookie=function(){var pagename,cookieKey="ff_pagename";var cookieVal=getCookieValue(cookieKey);document.cookie="ff_lastpage="+cookieVal+"; path=/";if($("#productdetailpage").length>0){pagename="productdetailpage";}else{if($("#listpage").length>0){pagename="listpage";}else{pagename="none";}}document.cookie=cookieKey+"="+pagename+"; path=/";};doSetCookie();if($(".maincontent.boutique_finder").size()>0){new Boutiquefinderform();}if($("#select_payment").length>0){var paymentDetails=$(".payment-details");paymentDetails.hide();$("#select_payment input").on("change",function(){var id=$(this).attr("id");paymentDetails.hide();$("#"+id+"_details").show();}).each(function(){if($(this).prop("checked")){var id=$(this).attr("id");$("#"+id+"_details").show();}});}$("a.mobileswitch").click(function(){handleSwitchToMobile(this.href);return false;});$(".hp .teaser a").each(function(){var concat=(String($(this).attr("href")).match(/\?/))?"&":"?";var href=$(this).attr("href").split("#");var anchor=href[1]?"#"+href[1]:"";$(this).attr("href",href[0]+concat+"WT.ac="+encodeURIComponent($(this).parents(".teaser").data("teasername"))+anchor);});$(".hp #footer a").each(function(){var concat=(String($(this).attr("href")).match(/\?/))?"&":"?";$(this).attr("href",$(this).attr("href")+concat+"WT.ac="+encodeURIComponent("Landing / Nav / Footer"));});$.lp_tracking={};$.lp_tracking.teaser=new Array();$.lp_tracking.registerTeaser=function(tsr){if(typeof(tsr)==="undefined"){return;}if($.isArray(tsr)){$.merge(this.teaser,tsr);}else{this.teaser.push(tsr);}};$.lp_tracking.cleanTeaser=function(){this.teaser=null;this.teaser=new Array();};$.lp_tracking.commit=function(){if(!this.teaser||this.teaser==""){this.cleanTeaser();return;}if(!window.triggerWebtracking){return;}triggerWebtracking("WT.ad="+encodeURIComponent(this.teaser.join(";")).replace(/%3B/g,";"));this.cleanTeaser();};$(".hp .teaser").each(function(i,elm){$.lp_tracking.registerTeaser($(elm).data("teasername"));});$.lp_tracking.commit();});var scrollToAnchor=function(target,offs,focus){$target=$(target).filter(":visible");$target=$target.length&&$target||$(target+"-mirror");$target=$target.length&&$target||$("[name="+target.slice(1)+"]");if($target.length){var targetOffset=$target.offset().top+offs;$("html,body").animate({scrollTop:targetOffset},800,"easeInOutQuart",function(){if(focus){$target.focus();}});return false;}};var addToShoppingbag=function(data,refelm,isTouch){if($("body").hasClass("v2014")){addToShoppingbag2014(data,refelm,isTouch);return;}var $popover=$("#mainnav-popover"),$mainnav=$("#header #mainnav-flat, #header #mainnav"),$sblink=$("#header #shoppingbag"),$sbsub=$(".mn-sub",$sblink),showTime=config["add2shoppingbag.showtime"]||3000;if($sbsub.length==0){$sbsub=$('<div class="mn-sub"></div>').appendTo($sblink);}$sbsub.html(data);var hasError=$(".shoppingbag-content",$sbsub).data("addtoshoppingbagerror");var productCount=$(".shoppingbag-content #newbagcount",$sbsub).text();if(productCount){$("#bagcount",$sblink).text(productCount);}$sblink.attr("data-noload","true").trigger("mouseenter");if(isTouch){$sblink.trigger("click");}$mainnav.attr("data-idle","true");$mainnav.after('<div id="tempidle" style="position: absolute;top:0;left:0;right:0;bottom:0;background:transparent"></div>');$popover.addClass("addedtoshoppingbag");var scrollMark=77;var scrollTop=$(window).scrollTop();var defaultPos=$popover.css("position");var defaultTop=$popover.css("top");if(scrollTop>scrollMark){if(isTouch){$popover.css({position:"absolute",top:$(window).scrollTop()-23+5+"px"});}else{$popover.css({position:"fixed",top:"5px"});}}if(isTouch){$("body").append('<div id="tmpscrollfixme" style="height: 1px;"></div>');setTimeout(function(){$("#tmpscrollfixme").remove();},100);}$(window).on("scroll",function(){if(!$popover.hasClass("addedtoshoppingbag")){return;}var $this=$(this);if($this.scrollTop()>scrollMark){if(isTouch){$popover.css({position:"absolute",top:$(window).scrollTop()-23+5+"px"});}else{$popover.css({position:"fixed",top:"5px"});}}else{$popover.css({position:defaultPos,top:defaultTop});}});var cleanup=function(){$sblink.removeAttr("data-noload").attr("data-reload","true");$mainnav.removeAttr("data-idle");$sblink.trigger("mouseleave");if(isTouch){$popover.trigger("leave");}if(!isIE()||isIE(9)){$popover.fadeOut(200);}else{$popover.hide();}$("#tempidle").remove();refelm.removeClass("disabled").removeAttr("data-idle");if(defaultPos&&defaultTop){$popover.css({position:defaultPos,top:defaultTop});}var loadingHl=$sblink.data("loading-hl")||"";if(loadingHl.length>0){loadingHl=$("<div />").html(loadingHl).text();var loader='<div class="shoppingbag-content"><h2 class="lined"><span class="icon"></span><span>'+loadingHl+'</span></h2><div class="preload"></div></div>';$sbsub.html(loader);}$popover.off("mouseleave");$popover.removeClass("addedtoshoppingbag");$(document).off("cleanupminisb");};if(hasError){$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("#mainnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #stickyfooter").unbind("click");setTimeout(cleanup,10);}});$(document).on("cleanupminisb",function(){to=setTimeout(cleanup,1);});}else{var to=setTimeout(cleanup,showTime);$popover.on("mouseover",function(){clearTimeout(to);}).on("mouseleave",function(){to=setTimeout(cleanup,300);});}};var addToShoppingbag2014=function(data,refelm,isTouch){var $popover=$("#mnav-shoppingbag"),$mainnav=$("#header #nav"),$sblink=$("#header a.shoppingbag"),$sbsub=$("#po-shoppingbag"),showTime=config["add2shoppingbag.showtime"]||3000;$sblink.siblings(".mn-sub").html("");$sbsub.html(data);var hasError=$(".shoppingbag-content",$sbsub).data("addtoshoppingbagerror");var productCount=$(".shoppingbag-content #newbagcount",$sbsub).text();if(productCount&&productCount>0){$sblink.text($sblink.data("text-notempty"));}else{$sblink.text($sblink.data("text-empty"));}$sblink.attr("data-noload","true").trigger("mouseenter");if(isTouch){$sblink.trigger("click");}$mainnav.attr("data-idle","true");$mainnav.after('<div id="tempidle" style="position: absolute;top:0;left:0;right:0;bottom:0;background:transparent"></div>');$popover.addClass("addedtoshoppingbag");if(!$popover.attr("data-defaultPos")){$popover.attr("data-defaultPos",$popover.css("position"));}if(!$popover.attr("data-defaultTop")){$popover.attr("data-defaultTop",$popover.css("top"));}var scrollMark=49;var scrollTop=$(window).scrollTop();var defaultPos=$popover.attr("data-defaultPos");var defaultTop=$popover.attr("data-defaultTop");var offsMainnavR=($(window).width()-960)/2;if(scrollTop>scrollMark){if(isTouch){$popover.css({position:"absolute",right:"0",top:$(window).scrollTop()-23+5+"px"});}else{$popover.css({position:"fixed",right:offsMainnavR+"px",top:"5px"});}}if(isTouch){$("body").append('<div id="tmpscrollfixme" style="height: 1px;"></div>');setTimeout(function(){$("#tmpscrollfixme").remove();},100);}$(window).on("scroll",function(){if(!$popover.hasClass("addedtoshoppingbag")){return;}var $this=$(this);if($this.scrollTop()>scrollMark){if(isTouch){$popover.css({position:"absolute",right:"0",top:$(window).scrollTop()-23+5+"px"});}else{$popover.css({position:"fixed",right:offsMainnavR+"px",top:"5px"});}}else{$popover.css({position:defaultPos,right:"0",top:defaultTop});}});var cleanup=function(){$sblink.removeAttr("data-noload").attr("data-reload","true");$mainnav.removeAttr("data-idle");$sblink.trigger("mouseleave");if(isTouch){$popover.trigger("leave");}if(!isIE()||isIE(9)){$popover.fadeOut(200);}else{$popover.hide();}$("#tempidle").remove();refelm.removeClass("disabled").removeAttr("data-idle");if(defaultPos&&defaultTop){$popover.css({position:defaultPos,right:"0",top:defaultTop});}$popover.off("mouseleave");$popover.removeClass("addedtoshoppingbag");$(document).off("cleanupminisb");};if(hasError){$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("#mnav-shoppingbag"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #stickyfooter").unbind("click");setTimeout(cleanup,10);}});$(document).on("cleanupminisb",function(){to=setTimeout(cleanup,1);});}else{var to=setTimeout(cleanup,showTime);$popover.on("mouseover",function(){clearTimeout(to);}).on("mouseleave",function(){to=setTimeout(cleanup,300);});}};function getCookieValue(cookieKey){var allCookies=document.cookie.split(";");var cookieVal="";for(var i=0;i<allCookies.length;i++){var cookies=allCookies[i].split("=");if($.trim(cookies[0])==cookieKey){cookieVal=cookies[1];}}return cookieVal;}function markLastItemInRow(o){var n=$(o).data("itemsinrow");n=n?n:($(o).hasClass("full")?7:(parseInt($(o).width())==960?7:5));$(o).addClass("itemsinrow-"+parseInt($(o).width())+"-"+n);$(".iconic-product:nth-child("+n+"n+"+n+"), .iconic-product:last-child",o).addClass("last-in-row");}function changeSelectOption(elm,iframeTarget){var go=$(elm).val(),overlayId="overlay_gc",$overlay=$("#"+overlayId),$iframeTargetElement=$("#"+iframeTarget),selectId=elm.attr("id")+"-mirror",$selectElement=$("#"+selectId+" a");$iframeTargetElement.empty();if($("#cardholder_wrapper")){$("#cardholder_wrapper").css("display","none");}$selectElement.addClass("disabled");if($overlay.length>0){$overlay.css("display","block");}else{$iframeTargetElement.parent().css("position","relative").append('<div id="'+overlayId+'" style="width: 100% !important;"><span></span></div>');}if(go&&go!=0){$.get(go,function(data){$iframeTargetElement.prepend(data);$selectElement.removeClass("disabled");});}}function convertHexToRGB(hex){hex+="";try{hex=normalizeHexColor(hex);}catch(err){throw err;}return{r:parseInt(hex.slice(1,3),16),g:parseInt(hex.slice(3,5),16),b:parseInt(hex.slice(5,7),16)};}function convertRGBToHex(color){try{color=normalizeRgbaColor(color);}catch(err){throw err;}var r,g,b,a;r=color.r.toString(16);r=(r.length<2?"0":"")+r;g=color.g.toString(16);g=(g.length<2?"0":"")+g;b=color.b.toString(16);b=(b.length<2?"0":"")+b;if(typeof color.a!="undefined"){a=Math.round(color.a*255).toString(16);a=(a.length<1?"0":"")+a;}else{a="";}return a+r+g+b;}function rgbColorString(color){try{color=normalizeRgbaColor(color);}catch(err){throw err;}var back=(color.a==1)?"rgb(":"rgba(";back+=parseInt(color.r)+", "+parseInt(color.g)+", "+parseInt(color.b);back+=(color.a==1)?")":(", "+color.a+")");return back;}$.fn.setTransparentBGColor=function(elm,color){setTransparentBackgroundColor(elm,color);};function setTransparentBackgroundColor(elm,color){var success=false;if(!isIE6OrLess()){if(isIE(7)||isIE(8)){var hex=convertRGBToHex(color);$(elm).css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr=#"+hex+",endColorstr=#"+hex+")");}else{$(elm).css("backgroundColor",rgbColorString(color));}}}function normalizeRgbaColor(color){if(!color.a){color.a=1;}if((typeof color.r=="undefined")||(color.r<0)||(color.r>255)||(typeof color.g=="undefined")||(color.g<0)||(color.g>255)||(typeof color.b=="undefined")||(color.b<0)||(color.b>255)||(color.a<0)||(color.a>1)){throw"Invalid RGB(a)-Color";}return color;}function normalizeHexColor(hex){hex=hex.toLowerCase();var regex=/^#?([0-9a-f]*)$/i;var result=hex.match(regex);if(!result){throw"Invalid Hex Color Value";}else{if((result[1].length!=3)&&(result[1].length!=6)){while(result[1].length<6){result[1]="0"+result[1];}}}var fullColor=result[1];if(fullColor.length==3){fullColor="".concat(fullColor[0]).concat(fullColor[0]).concat(fullColor[1]).concat(fullColor[1]).concat(fullColor[2]).concat(fullColor[2]);}return("#"+fullColor);}function toggleFlyout(element){var flyout=$("#"+$(element).data("displaytoggle"));if(flyout.size()>0){var checked=$(element).is(":checked");var duration=(!isIE()||isIE(9))?400:null;if($("body").is(".v2014")){var form=flyout.closest("form"),topVal=parseInt(form.css("top")),animateTop=topVal>0;animateTop&&form.data("top",topVal);}if(checked){if(!isIE(8)){$(flyout).slideDown(duration);}else{$(flyout).show();}if(animateTop){form.animate({top:0},duration);}if($("#giftcardtext .message-ctn")&&$("#edit-giftcardtext")){var giftcardtext=$.trim($("#giftcardtext .message-ctn").text());if(giftcardtext){$("#giftcardtext").show();$("#edit-giftcardtext").hide();}else{$("#giftcardtext").hide();$("#edit-giftcardtext").show();}$("#giftcardtext a").click(function(e){e.preventDefault();$("#giftcardtext").hide();$("#edit-giftcardtext textarea").text(giftcardtext);$("#edit-giftcardtext").show();});$("#edit-giftcardtext textarea").blur(function(e){$("#edit-giftcardtext").hide();$("#giftcardtext .message-ctn").text($("#edit-giftcardtext textarea").val());$("#giftcardtext").show();giftcardtext=$.trim($("#edit-giftcardtext textarea").val());});$("#edit-giftcardtext input[type=submit]").click(function(e){e.preventDefault();$("#edit-giftcardtext").hide();$("#giftcardtext .message-ctn").text($("#edit-giftcardtext textarea").val());$("#giftcardtext").show();giftcardtext=$.trim($("#edit-giftcardtext textarea").val());});}}else{if(!isIE(8)){$(flyout).slideUp(duration);}else{$(flyout).hide();}if(form&&form.data("top")){form.animate({top:form.data("top")},duration);}}}}function toggleEmptyFields(element){var containerSelector="#"+$(element).data("emptyfieldscontainer");try{var fields=$(containerSelector+" input[type=text],"+containerSelector+" textarea").filter(":not(:disabled)");}catch(e){return;}if(fields.size()>0){var checked=$(element).is(":checked");$(fields).each(function(i,field){if(checked){$(field).data("__savedPreviousData",$(field).val());$(field).val("");}else{var prevData=$(field).data("__savedPreviousData")||"";$(field).val(prevData);}});}}var BasketLayer=function(layer){this.init(layer);};BasketLayer.prototype={init:function(layer){this.$layer=$(layer);this.checkboxes=$("input[type=checkbox]",this.$layer);this.submitButton=$("button",this.$layer);if((this.checkboxes.size()==0)||(this.submitButton.size()==0)){return;}$("#giftcard-tile input[type=submit].modaloverlay").each(function(){$(this).removeClass("modal-active");});this.bindElements();this.updateButtonState();},bindElements:function(){var boundFunc=$.proxy(this.checkboxValueChanged,this);this.checkboxes.change(boundFunc);if(isIE(7)||isIE(8)){var boundFunc=$.proxy(this.clickedCheckboxIE7,this);$("label",this.$layer).each(function(){$(this).click(boundFunc);});}},clickedCheckboxIE7:function(event){if(event.target.tagName.toLowerCase()=="input"){return;}event.preventDefault();var $checkbox=$("input[type=checkbox]",event.currentTarget);if($checkbox.is(":checked")){$checkbox.prop("checked",false);$checkbox.parent().removeClass("ez-checked");}else{$checkbox.prop("checked",true);$checkbox.parent().addClass("ez-checked");}this.updateButtonState();this.highlightLabel($checkbox);},checkboxValueChanged:function(ev){this.updateButtonState();this.highlightLabel($(ev.currentTarget));},updateButtonState:function(){if(this.anyCheckboxChecked()){$(this.submitButton).removeAttr("disabled").removeClass("disabled");}else{$(this.submitButton).attr("disabled","disabled").addClass("disabled");}},anyCheckboxChecked:function(){var anyChecked=false;for(var i=0,count=this.checkboxes.length;i<count;i++){anyChecked=(anyChecked||$(this.checkboxes[i]).is(":checked"));if(anyChecked){break;}}return anyChecked;},highlightLabel:function(target){if(target.is(":checked")){target.parents("label").addClass("active");}else{target.parents("label").removeClass("active");}}};var ZipSearch=function(layer){this.init(layer);};ZipSearch.prototype={init:function(layer){this.$layer=$(layer);this.$form=$("form",this.$layer);this.$scrollboxLinks=$(".text-scrollbox a",this.$layer);this.zipid=$("input[name=zipid]:first",this.$form).val();this.cityid=$("input[name=cityid]:first",this.$form).val();this.prefectureid=$("input[name=prefectureid]:first",this.$form).val();this.bindElements();},bindElements:function(){var clickProxyFunc=$.proxy(this.clickedLink,this);this.$scrollboxLinks.attr("href","javascript:void(0);").click(clickProxyFunc);},clickedLink:function(event){$link=$(event.currentTarget);this.setValue(this.zipid,$link.data("zip"));this.setValue(this.cityid,$link.data("city"));this.setValue(this.prefectureid,$link.data("prefecture"));$.modal.close();},setValue:function(fieldId,value){var $field=$("#"+fieldId);if($field.is("select")){var jsPDObj=$field.data("myJSPulldownObject");if(typeof jsPDObj=="object"){jsPDObj.setToValue(value);}}else{$field.val(value);}}};var VirtualTourLayer=function(layer){this.init(layer);};VirtualTourLayer.prototype={init:function(layer){this.$layer=$(layer);this.flashReplacementID="flash-tour";var flashReplacement=$("#"+this.flashReplacementID);if(flashReplacement.size()==0){return;}this.mainswf=flashReplacement.data("mainswf");if((typeof this.mainswf!="string")||(this.mainswf.length==0)){return;}this.views=flashReplacement.data("views");if((!$.isArray(this.views))||(this.views.length==0)){return;}this.$links=$(".sub-positioner a");this.bindElements();this.showView(0);},bindElements:function(){this.$links.click($.proxy(this.clickViewLink,this));},clickViewLink:function(event){event.preventDefault();var link=event.currentTarget;var activeLinkIndex=this.$links.index($("a.active:first",this.$layer));var linkIndex=this.$links.index(link);if(activeLinkIndex==linkIndex){return;}this.showView(linkIndex);},showView:function(index){if((index<0)||(index>this.views.length-1)){return;}$("a.active:first",this.$layer).removeClass("active");$(this.$links[index]).addClass("active");swfobject.embedSWF(this.mainswf,this.flashReplacementID,"380","280","8.0.0",false,{path:this.views[index]},{wmode:"transparent"},{});}};var BasicFieldContentCounter=function(watchedElm,outputElm,classUpdateElm,options){this.init(watchedElm,outputElm,classUpdateElm,options);};BasicFieldContentCounter.prototype={init:function(watchedElm,outputElm,classUpdateElm,options){this.$watchedElm=$(watchedElm);this.$outputElm=$(outputElm);this.$classUpdateElm=$(classUpdateElm);this.options=$.extend({maxLength:350,errorClassName:"error",stopOnExceed:true},options);this.allowedToTypeBuffer=null;this.bindElements();this.updateOutput();},bindElements:function(){var proxyFunc=$.proxy(this.contentChanged,this);this.$watchedElm.change(proxyFunc);this.$watchedElm.keyup(proxyFunc);},contentChanged:function(event){this.updateOutput();},updateOutput:function(){var textLength=this.$watchedElm.val().length;if(this.options.stopOnExceed){if(textLength>this.options.maxLength){this.$watchedElm.val(this.$watchedElm.val().substr(0,this.options.maxLength));textLength=this.options.maxLength;}}var difference=this.options.maxLength-textLength;var allowedToType=(difference>0);this.$outputElm.html(difference);if(allowedToType!==this.allowedToTypeBuffer){this.allowedToTypeBuffer=allowedToType;if(!allowedToType){this.$classUpdateElm.addClass(this.options.errorClassName);}else{this.$classUpdateElm.removeClass(this.options.errorClassName);}}}};var DefaultTextAreaCounter=function(watchedElm){this.init(watchedElm);};DefaultTextAreaCounter.prototype=$.extend({},BasicFieldContentCounter.prototype,{parent:BasicFieldContentCounter.prototype,init:function(watchedElm,outputElm,classUpdateElm){var outputElm=$(".remainingchars",$(watchedElm).parents(".textarea-row").first()).first();if(outputElm.size()==0){return;}var classUpdateElm=outputElm;var options={};var maxLength=parseInt($(watchedElm).data("maxlength"));if(maxLength>0){options.maxLength=maxLength;}this.parent.init(watchedElm,outputElm,classUpdateElm,options);}});function initScrollboxes(obj,isTouch){var scrollboxSettings={showArrows:true,hideFocus:true};$(obj).each(function(){var $boxes=$(".productlist > div",this);var anz=$boxes.size();var bWidth=$boxes.outerWidth(true);$boxes.parent().width(anz*bWidth+(isIE(6)?40:0));}).scroll(function(){for(var i=0;i<bubbles.length;i++){bubbles[i].mouseout();}}).bind("touchstart",function(ev){$(".jspHorizontalBar",this).addClass("nopacity");for(var i=0;i<bubbles.length;i++){bubbles[i].mouseout();}}).bind("touchend",function(ev){$(".jspHorizontalBar",this).removeClass("nopacity");}).jScrollPane(scrollboxSettings).find(".jspHorizontalBar").each(function(){if(isTouch){$(this).append('<div style="width: 100%;height: 100%;position: absolute;"></div>');}});}function initTooltips(context){if(isTouch){return;}$('.ttip[title!=""], .ttip-inline, img.ttip[data-ttipsrc]',context).each(function(){new ToolTip($(this));});}function unTooltip(){$("body").unbind("mousemove");$("#ttlayer").hide().html("");}var ttdom=false;var ToolTip=function(elem,params){this.init(elem,params);};ToolTip.prototype={timeoutLeave:null,timeoutEnter:null,timeoutShow:null,init:function(elem,params){this.$elem=$(elem);this.params=params||{};this.delayShow=this.params.delayShow?this.params.delayShow:300;this.delayHide=this.params.delayHide?this.params.delayHide:0;this.showTime=this.params.showTime?this.params.showTime:2000;this.offsX=this.params.offsX?this.params.offsX:15;this.offsY=this.params.offsY?this.params.offsY:15;this.ttlayerID=this.params.ttlayerID?this.params.ttlayerID:"ttlayer";this.content=$(elem).hasClass("ttip-inline")?$(elem).text():($(elem).attr("placeholder")?$(elem).attr("placeholder"):$(elem).attr("title"));if(!this.content&&$(elem).data("ttipsrc")){this.content='<img src="'+$(elem).data("ttipsrc")+'" width="180" height="180" alt="" />';this.contentIsImg=true;}if(!this.content){return;}this.innerImgAlt=$("img",elem).attr("alt");if(!ttdom){$("body").append('<div id="'+this.ttlayerID+'"></div>');ttdom=true;}this.$ttlayer=$("#"+this.ttlayerID);this.$elem.mouseover($.proxy(this,"mouseover"));this.$elem.mouseout($.proxy(this,"mouseout"));},setpos:function(ev){var widthTooltip=this.$ttlayer.outerWidth();var heightTooltip=this.$ttlayer.outerHeight();var maxRight=$("body").innerWidth()-30;var maxBottom=$("body").innerHeight()-30;var layerOffsX=widthTooltip+ev.pageX+this.offsX>maxRight?ev.pageX-this.offsX+7-widthTooltip:ev.pageX+this.offsX;var layerOffsY=heightTooltip+ev.pageY+this.offsY>maxBottom?ev.pageY-this.offsY+10-heightTooltip:ev.pageY+this.offsY;this.$ttlayer.css({left:layerOffsX,top:layerOffsY});},mouseover:function(ev){window.clearTimeout(ToolTip.timeoutLeave);ToolTip.timeoutLeave=null;this.$elem.attr("title","");$("img",this.$elem).attr("alt","");this.$ttlayer.html(this.content);$("body").bind("mousemove",$.proxy(this,"setpos"));if(!ToolTip.timeoutEnter){ToolTip.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}if(!ToolTip.timeoutShow&&!(this.$elem.hasClass("ttip-perma"))){ToolTip.timeoutShow=window.setTimeout($.proxy(this,"hide2"),this.showTime);}},mouseout:function(){$("body").unbind("mousemove",$.proxy(this,"setpos"));window.clearTimeout(ToolTip.timeoutEnter);ToolTip.timeoutEnter=null;window.clearTimeout(ToolTip.timeoutShow);ToolTip.timeoutShow=null;if(!ToolTip.timeoutLeave){ToolTip.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},hide:function(){this.$ttlayer.hide().html("");this.$elem.attr("title",this.content);$("img",this.$elem).attr("alt",this.innerImgAlt);},hide2:function(){this.$ttlayer.hide().html("");},show:function(){if(!isIE()||isIE(9)){this.$ttlayer.fadeIn(100);}else{this.$ttlayer.show();}}};var MyAccount=function(elm){this.init(elm);};MyAccount.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elm){this.delayShow=400;this.delayHide=400;this.$elem=$(elm);this.buildPopover();this.$layer=$("#mnav-myaccount");this.ajaxURL="";this.ajaxCallFired=false;this.initialEmptyDropdownSrc=false;this.shouldLoad=false;this.$dropdownSrc={};this.prepare();if(this.initialEmptyDropdownSrc&&!this.shouldLoad){return;}this.$layerContent=this.$layer.find("#po-myaccount");this.$layer.mouseover($.proxy(function(){window.clearTimeout(MyAccount.timeoutLeave);MyAccount.timeoutLeave=null;},this));if(typeof isTouch!=="undefined"){this.$elem.click($.proxy(this,"mouseenter"));this.$layer.on("leave",$.proxy(this,"mouseleave"));}else{this.$elem.mouseenter($.proxy(this,"mouseenter"));this.$elem.mouseout($.proxy(this,"mouseleave"));this.$layer.mouseout($.proxy(this,"mouseleave"));}},buildPopover:function(){this.$popover=$('<div id="mnav-myaccount"></div>').insertAfter(this.$elem);this.$popover.append('<span class="sub-arr"></span><div id="po-myaccount" class="clearfix"></div>');this.$popoverContent=this.$popover.find("#po-myaccount");},prepare:function(){var outerElm=this.$elem;this.ajaxURL=this.$elem.data("ajaxurl-popover")||"";if(!$("div.mn-sub",outerElm).size()){$('<div class="mn-sub"></div>').appendTo(outerElm);}this.$dropdownSrc=$("div.mn-sub",outerElm);this.initialEmptyDropdownSrc=($.trim(this.$dropdownSrc.html()).length==0);if((this.ajaxURL.length>0)&&(this.initialEmptyDropdownSrc)){this.shouldLoad=true;}this.loadingHl=this.$elem.data("loading-hl")||"";if((this.loadingHl.length>0)&&(this.shouldLoad)){this.loadingHl=$("<div />").html(this.loadingHl).text();var loader='<div class="shoppingbag-content"><h2 class="lined"><span class="icon"></span><span>'+this.loadingHl+'</span></h2><div class="preload"></div></div>';this.$dropdownSrc.html(loader);}},mouseenter:function(ev){var suppressContentSwitchAnimation=false;if(this.$elem.attr("data-reload")){this.shouldLoad=true;this.$elem.removeAttr("data-reload");}if(this.shouldLoad&&!this.$elem.attr("data-noload")){this.loadContent();suppressContentSwitchAnimation=true;}var that=this;if(typeof isTouch!=="undefined"&&ev.type=="click"){ev.preventDefault();$("#header, #contentwrap, #footer").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("nav"))&&!isInElement(ev.pageX,ev.pageY,$("#mnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #footer").unbind("click");that.mouseleave();}});}this.switchContent(suppressContentSwitchAnimation);this.$layer.css("visibility","visible");this.$layer.stop(true,true);window.clearTimeout(MyAccount.timeoutLeave);MyAccount.timeoutLeave=null;var fail=true;if(!MyAccount.timeoutEnter){MyAccount.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},switchContent:function(suppressAnimation){var that=this;var duration=0;if((suppressAnimation!=true)&&(!isIE()||isIE(9))){duration=200;}if(this.$dropdownSrc.children().size()){this.$popoverContent.empty().hide();this.$dropdownSrc.children().appendTo(this.$popoverContent);}this.$layerContent.animate({opacity:"hide"},duration,function(){$(this).animate({opacity:"show"},duration,function(){that.enhance();if(isIE()&&!isIE(9)){setTimeout(function(){that.enhance();},100);}});});},mouseleave:function(){window.clearTimeout(MyAccount.timeoutEnter);MyAccount.timeoutEnter=null;if(!MyAccount.timeoutLeave){MyAccount.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},loadContent:function(){if(!this.shouldLoad){return;}this.shouldLoad=false;if(this.loadingHl.length>0){this.switchContent(true);}this.$dropdownSrc.load(this.ajaxURL,{},$.proxy(this.mnavAjaxLoaded,this));},mnavAjaxLoaded:function(responseText,textStatus,XMLHttpRequest){enhance(this.$dropdownSrc);this.switchContent(false);},hide:function(){if(!isIE()||isIE(9)){this.$layer.fadeOut(200).removeClass();}else{this.$layer.hide().removeClass();}$(document).trigger("cleanupminisb");},show:function(){var that=this;if(!isIE()||isIE(9)){this.$layer.fadeIn(200,function(){that.enhance();});}else{this.enhance();this.$layer.show();}},enhance:function(){}};var Shoppingbag=function(elm){this.init(elm);};Shoppingbag.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elm){this.delayShow=400;this.delayHide=400;this.$elem=$(elm);this.buildPopover();this.$layer=$("#mnav-shoppingbag");this.ajaxURL="";this.ajaxCallFired=false;this.initialEmptyDropdownSrc=false;this.shouldLoad=false;this.$dropdownSrc={};this.prepare();if(this.initialEmptyDropdownSrc&&!this.shouldLoad){return;}this.$layerContent=this.$layer.find("#po-shoppingbag");this.$layer.mouseover($.proxy(function(){window.clearTimeout(Shoppingbag.timeoutLeave);Shoppingbag.timeoutLeave=null;},this));if(typeof isTouch!=="undefined"){this.$elem.click($.proxy(this,"mouseenter"));this.$layer.on("leave",$.proxy(this,"mouseleave"));}else{this.$elem.mouseenter($.proxy(this,"mouseenter"));this.$elem.mouseout($.proxy(this,"mouseleave"));this.$layer.mouseout($.proxy(this,"mouseleave"));}},buildPopover:function(){this.$popover=$('<div id="mnav-shoppingbag"></div>').insertAfter(this.$elem);this.$popover.append('<span class="sub-arr"></span><div id="po-shoppingbag" class="clearfix"></div>');this.$popoverContent=this.$popover.find("#po-shoppingbag");},prepare:function(){var outerElm=this.$elem.parent(".wrap");this.ajaxURL=this.$elem.data("ajaxurl-popover")||"";if(!$("div.mn-sub",outerElm).size()){$('<div class="mn-sub"></div>').appendTo(outerElm);}this.$dropdownSrc=$("div.mn-sub",outerElm);this.initialEmptyDropdownSrc=($.trim(this.$dropdownSrc.html()).length==0);if((this.ajaxURL.length>0)&&(this.initialEmptyDropdownSrc)){this.shouldLoad=true;}this.loadingHl=this.$elem.data("loading-hl")||"";if((this.loadingHl.length>0)&&(this.shouldLoad)){this.loadingHl=$("<div />").html(this.loadingHl).text();var loader='<div class="shoppingbag-content"><h2 class="lined"><span class="icon"></span><span>'+this.loadingHl+'</span></h2><div class="preload"></div></div>';this.$dropdownSrc.html(loader);}},mouseenter:function(ev){var suppressContentSwitchAnimation=false;if(this.$elem.attr("data-reload")){this.shouldLoad=true;this.$elem.removeAttr("data-reload");}if(this.shouldLoad&&!this.$elem.attr("data-noload")){this.loadContent();suppressContentSwitchAnimation=true;}var that=this;if(typeof isTouch!=="undefined"&&ev.type=="click"){ev.preventDefault();$("#header, #contentwrap, #footer").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("nav"))&&!isInElement(ev.pageX,ev.pageY,$("#mnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #footer").unbind("click");that.mouseleave();}});}this.switchContent(suppressContentSwitchAnimation);this.$layer.css("visibility","visible");this.$layer.stop(true,true);window.clearTimeout(Shoppingbag.timeoutLeave);Shoppingbag.timeoutLeave=null;var fail=true;if(!Shoppingbag.timeoutEnter){Shoppingbag.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},switchContent:function(suppressAnimation){var that=this;var duration=0;if((suppressAnimation!=true)&&(!isIE()||isIE(9))){duration=200;}if(this.$dropdownSrc.children().size()){this.$popoverContent.empty().hide();this.$dropdownSrc.children().appendTo(this.$popoverContent);}this.$layerContent.animate({opacity:"hide"},duration,function(){$(this).animate({opacity:"show"},duration,function(){that.enhance();if(isIE()&&!isIE(9)){setTimeout(function(){that.enhance();},100);}});});},mouseleave:function(){window.clearTimeout(Shoppingbag.timeoutEnter);Shoppingbag.timeoutEnter=null;if(!Shoppingbag.timeoutLeave){Shoppingbag.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},loadContent:function(){if(!this.shouldLoad){return;}this.shouldLoad=false;if(this.loadingHl.length>0){this.switchContent(true);}this.$dropdownSrc.load(this.ajaxURL,{},$.proxy(this.mnavAjaxLoaded,this));},mnavAjaxLoaded:function(responseText,textStatus,XMLHttpRequest){enhance(this.$dropdownSrc);this.switchContent(false);},hide:function(){if(!isIE()||isIE(9)){this.$layer.fadeOut(200).removeClass();}else{this.$layer.hide().removeClass();}$(document).trigger("cleanupminisb");},show:function(){var that=this;if(!isIE()||isIE(9)){this.$layer.fadeIn(200,function(){that.enhance();});}else{this.enhance();this.$layer.show();}},enhance:function(){$(".bubble").fadeOut(400,function(){$(this).trigger("mouseleave");});var $scrollbox=this.$layer.find(".scrollbox-vertical");if($scrollbox.size()>0){var rows=$scrollbox.find("tr").size();if(rows>3){$scrollbox.addClass("scrollable").jScrollPane({showArrows:true,verticalDragMinHeight:18});if(isTouch){var fixStupidIpadJSPaneBehaviourOnFirstScrollPO=function(event){var scrollBox=event.currentTarget;$(scrollBox).unbind("scroll",fixStupidIpadJSPaneBehaviourOnFirstScrollPO);var drag=$(".jspDrag",scrollBox);var top=$(".jspDragTop",drag);var bottom=$(".jspDragBottom",drag);top.css({position:"static"});bottom.css({position:"static",marginTop:drag.height()-top.height()-bottom.height()});};$scrollbox.scroll(fixStupidIpadJSPaneBehaviourOnFirstScrollPO);}var jspapi=$scrollbox.data("jsp");jspapi.scrollToY(20000);}}}};var Mainnav2014=function(elm){this.init(elm);};Mainnav2014.prototype={timeout:null,init:function(elm){this.$mainnav=$(elm);this.activeDropdown=null;this.buildPopover();if(!isTouch){this.buildCover();}this.initDropdowns();},buildPopover:function(){this.$popover=$('<div id="mnav-popover"></div>').appendTo("nav");this.$popover.append('<div id="po-content" class="clearfix"></div>');this.$popoverContent=this.$popover.find("#po-content");},buildCover:function(){this.$cover=$('<div class="cover" />').insertBefore(this.$popover);},initDropdowns:function(){this.dropdowns=new Array();$("li[data-ajaxurl-popover]",this.$mainnav).each($.proxy(function(i,elm){this.dropdowns.push(new MainnavDropdown2014($(elm),this,{isTouch:isTouch}));},this));this.$mainnav.find("li").css("z-index",998);},activatePopover:function(dropdown){this.deactivatePopover();this.$popoverContent.append(dropdown.getPopoverContent());this.activeDropdown=dropdown;dropdown.$elem.find("a").addClass("pop");this.$popoverContent.data("uniqueKey",dropdown.uniqueKey);},deactivatePopover:function(){if(this.activeDropdown!=null){this.activeDropdown.setPopoverContent(this.$popoverContent.children());}this.$popoverContent.children().remove();this.activeDropdown=null;this.$mainnav.find("a").removeClass("pop");this.$popoverContent.data("uniqueKey",false);},activateCover:function(dropdown){dropdown.$elem.css("z-index",1000);this.$cover.show();},deactivateCover:function(){this.$mainnav.find("li").css("z-index",998);var self=this;if(!Mainnav2014.timeout&&this.$cover.is(":visible")){Mainnav2014.timeout=setTimeout(function(){self.$cover.hide();clearTimeout(Mainnav2014.timeout);Mainnav2014.timeout=null;},250);}}};var MainnavDropdown2014=function(elem,ref2MainnavObj,params){this.init(elem,ref2MainnavObj,params);};MainnavDropdown2014.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elem,ref2MainnavObj,params){this.delayShow=200;this.delayHide=400;this.$elem=$(elem);this.ref2MainnavObj=ref2MainnavObj;this.uniqueKey="pd"+(getUniqueId()+1);this.params=params||{};this.$mainnav=$("nav");this.$mnlayer=$("#mnav-popover");this.ajaxURL="";this.ajaxCallFired=false;this.initialEmptyDropdownSrc=false;this.shouldLoad=false;this.$dropdownSrc={};this.prepare();if(this.initialEmptyDropdownSrc&&!this.shouldLoad){return;}this.$mnlayerContent=this.$mnlayer.find("#po-content");this.$mnlayer.mouseover($.proxy(function(){window.clearTimeout(MainnavDropdown2014.timeoutLeave);MainnavDropdown2014.timeoutLeave=null;},this));if(this.params.isTouch){this.$elem.click($.proxy(this,"mouseenter"));this.$mnlayer.on("leave",$.proxy(this,"mouseleave"));}else{this.$elem.mouseenter($.proxy(this,"mouseenter"));this.$elem.mouseout($.proxy(this,"mouseleave"));this.$mnlayer.mouseout($.proxy(this,"mouseleave"));}if(this.params.followLink==false){this.$elem.click(function(ev){ev.preventDefault();});}},prepare:function(){var outerElm=this.$elem;this.ajaxURL=$(outerElm).data("ajaxurl-popover")||"";if(!$("div.mn-sub",outerElm).size()){$('<div class="mn-sub"></div>').appendTo(outerElm);}this.$dropdownSrc=$("div.mn-sub",outerElm);this.initialEmptyDropdownSrc=($.trim(this.$dropdownSrc.html()).length==0);if((this.ajaxURL.length>0)&&(this.initialEmptyDropdownSrc)){this.shouldLoad=true;}this.loadingHl=$(outerElm).data("loading-hl")||"";if((this.loadingHl.length>0)&&(this.shouldLoad)){this.loadingHl=$("<div />").html(this.loadingHl).text();var loader='<div class="'+this.id+'-content"><h2 class="lined"><span class="icon"></span><span>'+this.loadingHl+'</span></h2><div class="preload"></div></div>';this.$dropdownSrc.html(loader);}},mouseenter:function(ev){var suppressContentSwitchAnimation=false;if(this.$elem.attr("data-reload")){this.shouldLoad=true;this.$elem.removeAttr("data-reload");}if(this.shouldLoad&&!this.$elem.attr("data-noload")){this.loadContent();suppressContentSwitchAnimation=true;}var that=this;if(this.params.isTouch&&ev.type=="click"){if(this.$mnlayerContent.data("uniqueKey")==this.uniqueKey){return;}else{ev.preventDefault();$("#header, #contentwrap, #footer").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("nav"))&&!isInElement(ev.pageX,ev.pageY,$("#mnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #footer").unbind("click");that.mouseleave();}});}}if(this.$mnlayerContent.data("uniqueKey")!=this.uniqueKey){that.ref2MainnavObj.deactivatePopover();that.switchContent(suppressContentSwitchAnimation);}that.$mnlayer.css("visibility","visible");that.$mnlayer.stop(true,true);window.clearTimeout(MainnavDropdown2014.timeoutLeave);MainnavDropdown2014.timeoutLeave=null;var fail=true;if(!MainnavDropdown2014.timeoutEnter){MainnavDropdown2014.timeoutEnter=window.setTimeout($.proxy(that,"show"),that.delayShow);}if(!isTouch){this.ref2MainnavObj.activateCover(this);}},switchContent:function(suppressAnimation){var that=this;var duration=0;if((suppressAnimation!=true)&&(!isIE()||isIE(9))){duration=0;}this.$mnlayerContent.animate({opacity:"hide"},duration,function(){that.ref2MainnavObj.activatePopover(that);$(this).animate({opacity:"show"},duration,function(){that.enhance();if(isIE()&&!isIE(9)){setTimeout(function(){that.enhance();},100);}});});},mouseleave:function(){window.clearTimeout(MainnavDropdown2014.timeoutEnter);MainnavDropdown2014.timeoutEnter=null;if(!MainnavDropdown2014.timeoutLeave){MainnavDropdown2014.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}if(!isTouch){this.ref2MainnavObj.deactivateCover();}},loadContent:function(){if(!this.shouldLoad){return;}this.shouldLoad=false;if(this.loadingHl.length>0){this.switchContent(true);}this.$dropdownSrc.load(this.ajaxURL,{},$.proxy(this.mnavAjaxLoaded,this));},mnavAjaxLoaded:function(responseText,textStatus,XMLHttpRequest){enhance(this.$dropdownSrc);this.switchContent(false);},hide:function(){this.$mnlayer.hide().removeClass();this.ref2MainnavObj.deactivatePopover();$(document).trigger("cleanupminisb");},show:function(){var that=this;this.$mnlayer.show();that.enhance();},getPopoverContent:function(){return $(this.$dropdownSrc.children());},setPopoverContent:function(content){if(this.$dropdownSrc.children().size()==0){this.$dropdownSrc.append(content);}},enhance:function(){}};var MainnavFlat=function(elm){this.init(elm);};MainnavFlat.prototype={init:function(elm){this.$mainnav=$(elm);this.activeDropdown=null;this.buildPopover();this.initDropdowns();this.setActiveNurple();},buildPopover:function(){this.$popover=$('<div id="mainnav-popover"></div>').appendTo("#header");this.$popover.append('<div class="nurple"></div><div class="concealer"></div><div id="po-content" class="clearfix"></div>');this.$popoverContent=this.$popover.find("#po-content");},initDropdowns:function(){this.dropdowns=new Array();$("li.mn>a, li.mn>em, #shopmeta>a",this.$mainnav).each($.proxy(function(i,elm){this.dropdowns.push(new MainnavDropdownFlat($(elm),this,{isTouch:isTouch}));},this));},activatePopover:function(dropdown){this.deactivatePopover();this.$popoverContent.append(dropdown.getPopoverContent());this.activeDropdown=dropdown;},deactivatePopover:function(){if(this.activeDropdown!=null){this.activeDropdown.setPopoverContent(this.$popoverContent.children());}this.$popoverContent.children().remove();this.activeDropdown=null;},setActiveNurple:function(){$("li.l0.act, #shopmeta a.act",this.$mainnav).each(function(){var width=$(this).outerWidth();var offsLeft=width/2-2;$(this).append('<div class="mn-actnurple" style="left: '+offsLeft+'px;"></div>');});}};var MainnavDropdownFlat=function(elem,ref2MainnavObj,params){this.init(elem,ref2MainnavObj,params);};MainnavDropdownFlat.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elem,ref2MainnavObj,params){this.delayShow=400;this.delayHide=400;this.$elem=$(elem);this.ref2MainnavObj=ref2MainnavObj;this.isMetaNav=this.$elem.parent().is("div");if(this.isMetaNav){this.id=this.$elem.attr("id");}else{this.id=this.$elem.parent("li.l0").first().attr("id").substring(3);}this.params=params||{};this.$mainnav=$("#mainnav-flat");this.$shopmeta=$("#mn-shopmeta");this.$mnlayer=$("#mainnav-popover");this.$nurple=this.$mnlayer.find(".nurple");this.ajaxURL="";this.ajaxCallFired=false;this.initialEmptyDropdownSrc=false;this.shouldLoad=false;this.$dropdownSrc={};this.prepare();if(this.initialEmptyDropdownSrc&&!this.shouldLoad){return;}this.$mnlayerContent=this.$mnlayer.find("#po-content");this.$mnlayer.mouseover($.proxy(function(){window.clearTimeout(MainnavDropdown.timeoutLeave);MainnavDropdown.timeoutLeave=null;},this));if(this.params.isTouch){this.$elem.click($.proxy(this,"mouseenter"));this.$mnlayer.on("leave",$.proxy(this,"mouseleave"));}else{this.$elem.mouseenter($.proxy(this,"mouseenter"));this.$elem.mouseout($.proxy(this,"mouseleave"));this.$mnlayer.mouseout($.proxy(this,"mouseleave"));}if(this.params.followLink==false){this.$elem.click(function(ev){ev.preventDefault();});}},prepare:function(){var outerElm=(this.isMetaNav)?this.$elem:this.$elem.parent("li");this.ajaxURL=$(outerElm).data("ajaxurl-popover")||"";if($("div.mn-sub",outerElm).size()==0){$('<div class="mn-sub"></div>').appendTo(outerElm);}this.$dropdownSrc=$("div.mn-sub",outerElm);this.initialEmptyDropdownSrc=($.trim(this.$dropdownSrc.html()).length==0);if((this.ajaxURL.length>0)&&(this.initialEmptyDropdownSrc)){this.shouldLoad=true;}this.loadingHl=$(outerElm).data("loading-hl")||"";if((this.loadingHl.length>0)&&(this.shouldLoad)){this.loadingHl=$("<div />").html(this.loadingHl).text();var loader='<div class="'+this.id+'-content"><h2 class="lined"><span class="icon"></span><span>'+this.loadingHl+'</span></h2><div class="preload"></div></div>';this.$dropdownSrc.html(loader);}},mouseenter:function(ev){var suppressContentSwitchAnimation=false;if(this.$elem.attr("data-reload")){this.shouldLoad=true;this.$elem.removeAttr("data-reload");}if(this.shouldLoad&&!this.$elem.attr("data-noload")){this.loadContent();suppressContentSwitchAnimation=true;}var that=this;if(this.params.isTouch&&ev.type=="click"){if(this.$mnlayer.hasClass(this.id)){return;}else{ev.preventDefault();$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("#mainnav-flat"))&&!isInElement(ev.pageX,ev.pageY,$("#mainnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #stickyfooter").unbind("click");that.mouseleave();}});}}if(!this.$mnlayer.hasClass(this.id)){this.ref2MainnavObj.deactivatePopover();this.switchContent(suppressContentSwitchAnimation);}this.$mnlayer.css("visibility","visible");this.$mnlayer.removeClass().addClass(this.id);this.$mnlayer.stop();var width=this.$elem.width();if(this.isMetaNav){var offs=this.$elem.position().left;var offsMainnavR=($(window).width()-960)/2;var bagOffs=this.$elem.attr("id")=="shoppingbag"?12:0;var pos=this.$shopmeta.width()-(width+this.$nurple.width())/2-offs-2-bagOffs;this.$mnlayer.css({left:"auto",right:offsMainnavR,opacity:1});this.$nurple.stop().css({left:"auto"}).animate({right:pos},200,"easeOutQuart");}else{var offs=this.$elem.offset().left-100;var pad=parseInt(this.$elem.css("padding-left"));var corr=0;var rpos=offs+this.$mnlayer.outerWidth();var corrOffs=$(window).width()-rpos-10;if(corrOffs<0){corr=corrOffs;}if(!isIE()||isIE(9)){this.$mnlayer.animate({right:"auto",left:offs+corr},100,"easeOutQuart",function(){$(this).css("opacity",1);});}else{this.$mnlayer.css({right:"auto",left:offs+corr});}this.$nurple.stop().css({right:"auto"}).animate({left:(50-corr+width/2)},200,"easeOutQuart");}window.clearTimeout(MainnavDropdown.timeoutLeave);MainnavDropdown.timeoutLeave=null;var fail=true;if(!MainnavDropdown.timeoutEnter){MainnavDropdown.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},switchContent:function(suppressAnimation){var that=this;var duration=0;if((suppressAnimation!=true)&&(!isIE()||isIE(9))){duration=200;}this.$mnlayerContent.animate({opacity:"hide"},duration,function(){that.ref2MainnavObj.activatePopover(that);$(this).animate({opacity:"show"},duration,function(){that.enhance();if(isIE()&&!isIE(9)){setTimeout(function(){that.enhance();},100);}});});},mouseleave:function(){window.clearTimeout(MainnavDropdown.timeoutEnter);MainnavDropdown.timeoutEnter=null;if(!MainnavDropdown.timeoutLeave){MainnavDropdown.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},loadContent:function(){if(!this.shouldLoad){return;}this.shouldLoad=false;if(this.loadingHl.length>0){this.switchContent(true);}this.$dropdownSrc.load(this.ajaxURL,{},$.proxy(this.mnavAjaxLoaded,this));},mnavAjaxLoaded:function(responseText,textStatus,XMLHttpRequest){enhance(this.$dropdownSrc);if(this.$mnlayer.hasClass(this.id)){this.switchContent(false);}},hide:function(){if(!isIE()||isIE(9)){this.$mnlayer.fadeOut(200).removeClass();$(".mn-actnurple",this.$mainnav).fadeIn(200);}else{this.$mnlayer.hide().removeClass();$(".mn-actnurple",this.$mainnav).show();}this.ref2MainnavObj.deactivatePopover();$(document).trigger("cleanupminisb");},show:function(){var that=this;$(".iconic-products",this.$mnlayer).each(function(){markLastItemInRow(this);});$("a.pocat-hover",this.$mnlayer).on({mouseenter:function(){var cat=$(this).data("cat");$('a.pocat-hover[data-cat="'+cat+'"]',this.$mnlayer).addClass("hover");},mouseleave:function(){var cat=$(this).data("cat");$('a.pocat-hover[data-cat="'+cat+'"]',this.$mnlayer).removeClass("hover");}});if(!isIE()||isIE(9)){this.$mnlayer.fadeIn(200,function(){that.enhance();});$(".mn-actnurple",this.$mainnav).fadeOut(200);}else{this.$mnlayer.show();that.enhance();$(".mn-actnurple",this.$mainnav).hide();}},getPopoverContent:function(){return $(this.$dropdownSrc.children());},setPopoverContent:function(content){if(this.$dropdownSrc.children().size()==0){this.$dropdownSrc.append(content);}},enhance:function(){$(".bubble").fadeOut(400,function(){$(this).trigger("mouseleave");});var $scrollbox=this.$mnlayer.find(".scrollbox-vertical");if($scrollbox.size()>0){var rows=$scrollbox.find("tr").size();if(rows>3){$scrollbox.addClass("scrollable").jScrollPane({showArrows:true,verticalDragMinHeight:18});if(isTouch){var fixStupidIpadJSPaneBehaviourOnFirstScrollPO=function(event){var scrollBox=event.currentTarget;$(scrollBox).unbind("scroll",fixStupidIpadJSPaneBehaviourOnFirstScrollPO);var drag=$(".jspDrag",scrollBox);var top=$(".jspDragTop",drag);var bottom=$(".jspDragBottom",drag);top.css({position:"static"});bottom.css({position:"static",marginTop:drag.height()-top.height()-bottom.height()});};$scrollbox.scroll(fixStupidIpadJSPaneBehaviourOnFirstScrollPO);}var jspapi=$scrollbox.data("jsp");jspapi.scrollToY(20000);}}}};var Mainnav=function(elm){this.init(elm);};Mainnav.prototype={init:function(elm){this.$mainnav=$(elm);this.activeDropdown=null;this.buildPopover();this.initDropdowns();this.setActiveNurple();this.initAccordion();},buildPopover:function(){this.$popover=$('<div id="mainnav-popover"></div>').appendTo("#header");this.$popover.append('<div class="nurple"></div><div class="concealer"></div><div id="po-content" class="clearfix"></div>');this.$popoverContent=this.$popover.find("#po-content");},initDropdowns:function(){this.dropdowns=new Array();$("li>ul>li>a, li>ul>li>em, #shopmeta>a",this.$mainnav).each($.proxy(function(i,elm){this.dropdowns.push(new MainnavDropdown($(elm),this,{isTouch:isTouch}));},this));},activatePopover:function(dropdown){this.deactivatePopover();this.$popoverContent.append(dropdown.getPopoverContent());this.activeDropdown=dropdown;},deactivatePopover:function(){if(this.activeDropdown!=null){this.activeDropdown.setPopoverContent(this.$popoverContent.children());}this.$popoverContent.children().remove();this.activeDropdown=null;},setActiveNurple:function(){$("li.l1.act, #shopmeta a.act",this.$mainnav).each(function(){var width=$(this).width();var offsLeft=width/2-2;if(!$(this).is("a")){var pos=$(this).position();offsLeft+=pos.left;}$(this).append('<div class="mn-actnurple" style="left: '+offsLeft+'px;"></div>');});},initAccordion:function(){var root=this;this.$mainnav.children("li").children("em").click(function(){var that=this;if($(this).parent().hasClass("open")){var jump=$(this).data("href");if(jump){self.location.href=jump;}return;}$("#mainnav > li.open").css("width","auto");$("#mainnav > li.open > ul").animate({width:"1px",opacity:"hide"},400,"easeOutQuart",function(){if(isTouch){root.$popover.css("visibility","hidden");}$(this).css("width","auto").parent().removeClass("open");$(that).parent().find("> ul").animate({width:"show",opacity:"show"},200,function(){$(that).parent().addClass("open");var jump=$(that).data("href");if(jump){self.location.href=jump;}});});});}};var MainnavDropdown=function(elem,ref2MainnavObj,params){this.init(elem,ref2MainnavObj,params);};MainnavDropdown.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elem,ref2MainnavObj,params){this.delayShow=400;this.delayHide=400;this.$elem=$(elem);this.ref2MainnavObj=ref2MainnavObj;this.isMetaNav=this.$elem.parent().is("div");if(this.isMetaNav){this.id=this.$elem.attr("id");}else{this.id=this.$elem.parent("li.l1").first().attr("id").substring(3);}this.params=params||{};this.$mainnav=$("#mainnav");this.$shopmeta=$("#mn-shopmeta");this.$mnlayer=$("#mainnav-popover");this.$nurple=this.$mnlayer.find(".nurple");this.ajaxURL="";this.ajaxCallFired=false;this.initialEmptyDropdownSrc=false;this.shouldLoad=false;this.$dropdownSrc={};this.prepare();if(this.initialEmptyDropdownSrc&&!this.shouldLoad){return;}this.$mnlayerContent=this.$mnlayer.find("#po-content");this.$mnlayer.mouseover($.proxy(function(){window.clearTimeout(MainnavDropdown.timeoutLeave);MainnavDropdown.timeoutLeave=null;},this));if(this.params.isTouch){this.$elem.click($.proxy(this,"mouseenter"));}else{this.$elem.mouseenter($.proxy(this,"mouseenter"));this.$elem.mouseout($.proxy(this,"mouseleave"));this.$mnlayer.mouseout($.proxy(this,"mouseleave"));}if(this.params.followLink==false){this.$elem.click(function(ev){ev.preventDefault();});}},prepare:function(){var outerElm=(this.isMetaNav)?this.$elem:this.$elem.parent("li");this.ajaxURL=$(outerElm).data("ajaxurl-popover")||"";if($("div.mn-sub",outerElm).size()==0){$('<div class="mn-sub"></div>').appendTo(outerElm);}this.$dropdownSrc=$("div.mn-sub",outerElm);this.initialEmptyDropdownSrc=($.trim(this.$dropdownSrc.html()).length==0);if((this.ajaxURL.length>0)&&(this.initialEmptyDropdownSrc)){this.shouldLoad=true;}this.loadingHl=$(outerElm).data("loading-hl")||"";if((this.loadingHl.length>0)&&(this.shouldLoad)){this.loadingHl=$("<div />").html(this.loadingHl).text();var loader='<div class="'+this.id+'-content"><h2 class="lined"><span class="icon"></span><span>'+this.loadingHl+'</span></h2><div class="preload"></div></div>';this.$dropdownSrc.html(loader);}},mouseenter:function(ev){var suppressContentSwitchAnimation=false;if(this.$elem.attr("data-reload")){this.shouldLoad=true;this.$elem.removeAttr("data-reload");}if(this.shouldLoad&&!this.$elem.attr("data-noload")){this.loadContent();suppressContentSwitchAnimation=true;}var that=this;if(this.params.isTouch&&ev.type=="click"){if(this.$mnlayer.hasClass(this.id)){return;}else{ev.preventDefault();$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){if(!isInElement(ev.pageX,ev.pageY,$("#mainnav"))&&!isInElement(ev.pageX,ev.pageY,$("#mainnav-popover"))&&ev.target.nodeName!="LABEL"&&ev.target.nodeName!="INPUT"){$("#header, #contentwrap, #stickyfooter").unbind("click");that.mouseleave();}});}}if(!this.$mnlayer.hasClass(this.id)){this.ref2MainnavObj.deactivatePopover();this.switchContent(suppressContentSwitchAnimation);}var offsMainnav=this.$mainnav.offset();var offs=this.$elem.position().left;var width=this.$elem.width();var openNav=this.$mainnav.find(".l0.open");if(openNav.length>0){var openHack=openNav.position().left;}if(this.$elem.hasClass("po-rightXXX")){var offsMainnavR=($(window).width()-960)/2+this.$shopmeta.width()-1;this.$mnlayer.css({left:"auto",right:offsMainnavR});this.$nurple.css({left:"auto"}).animate({right:(offs+width/2-50)},200,"easeOutQuart");}else{if(this.isMetaNav){var offsMainnavR=($(window).width()-960)/2;var bagOffs=this.$elem.attr("id")=="shoppingbag"?16:0;var pos=this.$shopmeta.width()-(width+this.$nurple.width())/2-offs-2-bagOffs;this.$mnlayer.css({left:"auto",right:offsMainnavR});this.$nurple.css({left:"auto"}).animate({right:pos},200,"easeOutQuart");}else{var offsMainnavL=offsMainnav.left;var that=this;this.$mnlayer.css({right:"auto",left:offsMainnavL});this.$nurple.css({right:"auto"}).animate({left:(openHack+offs+width/2-57)},200,"easeOutQuart",function(){var rpos=offsMainnavL+that.$mnlayer.outerWidth();var corrOffs=$(window).width()-rpos-10;if(corrOffs<0){that.$mnlayer.css("left","+="+corrOffs);that.$nurple.css("left","-="+corrOffs);}});}}this.$mnlayer.css("visibility","visible");this.$mnlayer.removeClass().addClass(this.id);window.clearTimeout(MainnavDropdown.timeoutLeave);MainnavDropdown.timeoutLeave=null;var fail=true;if(!MainnavDropdown.timeoutEnter){MainnavDropdown.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},switchContent:function(suppressAnimation){var that=this;var duration=0;if((suppressAnimation!=true)&&(!isIE()||isIE(9))){duration=200;}this.$mnlayerContent.animate({opacity:"hide"},duration,function(){that.ref2MainnavObj.activatePopover(that);$(this).animate({opacity:"show"},duration,function(){that.enhance();if(isIE()&&!isIE(9)){setTimeout(function(){that.enhance();},100);}});});},mouseleave:function(){window.clearTimeout(MainnavDropdown.timeoutEnter);MainnavDropdown.timeoutEnter=null;if(!MainnavDropdown.timeoutLeave){MainnavDropdown.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},loadContent:function(){if(!this.shouldLoad){return;}this.shouldLoad=false;if(this.loadingHl.length>0){this.switchContent(true);}this.$dropdownSrc.load(this.ajaxURL,{},$.proxy(this.mnavAjaxLoaded,this));},mnavAjaxLoaded:function(responseText,textStatus,XMLHttpRequest){enhance(this.$dropdownSrc);if(this.$mnlayer.hasClass(this.id)){this.switchContent(false);}},hide:function(){if(!isIE()||isIE(9)){this.$mnlayer.fadeOut(200).removeClass();$(".mn-actnurple",this.$mainnav).fadeIn(200);}else{this.$mnlayer.hide().removeClass();$(".mn-actnurple",this.$mainnav).show();}this.ref2MainnavObj.deactivatePopover();},show:function(){var that=this;$(".iconic-products",this.$mnlayer).each(function(){markLastItemInRow(this);});$("a.pocat-hover",this.$mnlayer).on({mouseenter:function(){var cat=$(this).data("cat");$('a.pocat-hover[data-cat="'+cat+'"]',this.$mnlayer).addClass("hover");},mouseleave:function(){var cat=$(this).data("cat");$('a.pocat-hover[data-cat="'+cat+'"]',this.$mnlayer).removeClass("hover");}});if(!isIE()||isIE(9)){this.$mnlayer.fadeIn(200);$(".mn-actnurple",this.$mainnav).fadeOut(200,function(){that.enhance();});}else{this.$mnlayer.show();that.enhance();$(".mn-actnurple",this.$mainnav).hide();}},getPopoverContent:function(){return $(this.$dropdownSrc.children());},setPopoverContent:function(content){if(this.$dropdownSrc.children().size()==0){this.$dropdownSrc.append(content);}},enhance:function(){var $scrollbox=this.$mnlayer.find(".scrollbox-vertical");if($scrollbox.size()>0){var rows=$scrollbox.find("tr").size();if(rows>3){$scrollbox.addClass("scrollable").jScrollPane({showArrows:true,verticalDragMinHeight:18});}}}};var FooterNav=function(stickyfooter,options){this.init(stickyfooter,options);};FooterNav.prototype={init:function(stickyfooter,options){this.$stickyfooter=$(stickyfooter);this.$layerLinks=$("a[data-ajaxurl]",this.$stickyfooter);this.options=jQuery.extend({isTouch:false},(options||{}));this.delayShow=300;this.delayHide=800;this.slideDurationPerPx=1600/1000;this.timerShow=null;this.timerHide=null;this.blockAnimation=false;this.layerContents=new Array();this.enhanced=new Array();this.shown=-1;this.want2Show=-1;if(this.$layerLinks.size()==0){return;}this.defaultNurpleIndex=this.$layerLinks.index($(".content a.active:first",this.$stickyfooter));this.buildMarkup();this.initEvents();if(this.defaultNurpleIndex!=-1){setTimeout($.proxy(function(){this.showNurple(this.defaultNurpleIndex,100);$(window).resize($.proxy(this.rePositionDefaultNurple,this));},this),200);}if((typeof GetVars!="undefined")&&(GetVars.get("debug"))){if(typeof GetVars.get("footernav")!="undefined"){var debbugedIndex=parseInt(GetVars.get("footernav"));if(this.$layerLinks[debbugedIndex]){$(this.$layerLinks[debbugedIndex]).mouseenter();}}}},buildMarkup:function(){this.$nurple=$('<div class="actnurple"></div>').prependTo($(".maxpage.content",this.$stickyfooter)).hide();this.$layerContainer=$('<div class="maxpage clearfix"></div>').prependTo(this.$stickyfooter).hide();},initEvents:function(){if(this.options.isTouch){this.$layerLinks.click($.proxy(this.touchClickLink,this));}else{this.$layerLinks.mouseenter($.proxy(this.mouseenterLink,this));this.$layerLinks.mouseleave($.proxy(this.mouseleave,this));this.$layerContainer.mouseenter($.proxy(this.mouseenterContainer,this));this.$layerContainer.mouseleave($.proxy(this.mouseleave,this));}$("#stickyfooter").on("submit",".sub-layer form.layerform",{},$.proxy(this.submitInlineForm,this));this.$layerLinks.removeAttr("href").css("cursor","pointer");},getSlideDuration:function(height){return Math.abs(Math.round(height*this.slideDurationPerPx));},submitInlineForm:function(event){this.blockAnimation=true;event.preventDefault();var form=$(event.currentTarget);var action=form.attr("action");var method=(form.attr("method")||"");var data=form.serialize();if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}$.ajax(action,{context:this,type:method,data:data,dataType:"html",success:this.inlineFormSubmitSuccess});},inlineFormSubmitSuccess:function(data,textStatus,jqXHR){this.$layerContainer.empty().append(data);this.enhance();this.adjustLayerHeight();this.blockAnimation=false;var that=this;if(isIE(8)){setTimeout(function(){that.$layerContainer.trigger("mouseenter");},400);}},enhance:function(){enhance(this.$layerContainer);var that=this;$(".modaloverlay",this.$layerContainer).each(function(){new ModalLinksHandling(this,{});$(this).click(function(event){that.want2Show=-1;that.hideLayer();});});$(".sub-close",this.$layerContainer).click($.proxy(this.hideLayer,this));$("h2.lined, legend",this.$layerContainer).each(function(i,elm){var width=$(elm).width()-$("span:not(.icon)",elm).outerWidth();var line=$('<span class="sub-line"></span>').appendTo(elm).css("width",width+"px");});var layerContent=$(".sub-layer",this.$layerContainer);if($(layerContent).is(".layer-boutiquefinder")){$("form",layerContent).submit($.proxy(this.submitBoutiqueFinder,this));this.enhanceBFPulldowns();}if($(layerContent).is(".layer-otherswarovskisites")){if(this.options.isTouch){$("a[data-toggle]").click(function(event){var link=$(event.currentTarget);var target=$("#infotoggle-"+link.data("toggle"));if((target.size()>0)&&(!$(target).is(":visible"))){$("div:visible",target.parent("div")).hide();target.fadeIn(200);event.preventDefault();}});}else{$("a[data-toggle]").mouseenter(function(event){var link=$(event.currentTarget);var target=$("#infotoggle-"+link.data("toggle"));if(target.size()>0){$("div:visible",target.parent("div")).stop(true,true).hide();target.fadeIn(200);}});}}if($(layerContent).is(".layer-countryselect")){var form=$("#hiddenchangelog",layerContent).parents("form:first");if(form.size()==0){form=$("form:first",layerContent);}var ajaxURL=(form.data("ajaxurl")||"");if(ajaxURL.length>0){$(form).attr("action",ajaxURL);}$("input[type=submit]",layerContent).click(function(event){event.preventDefault();var form=$(event.currentTarget).parents("form:first");$("#hiddenchangelog",form).val("submit");form.submit();});}},enhanceBFPulldowns:function(){var proxyFunc=$.proxy(this.changeBoutiqueFinder,this);$("select:not(:last)",this.$layerContainer).each(function(i,elm){$(elm).data("originalValue",$(elm).val());$("#"+$(elm).attr("id")+"-mirror li a",this.$layerContainer).bind("jspulldownchanged",proxyFunc);});},touchClickLink:function(event){var index=$.inArray(event.currentTarget,this.$layerLinks);if(this.isModalVisible()){$.modal.close();}if(this.shown==index){this.want2Show=-1;this.hideLayer();}else{this.preloadIfNeeded(index);this.want2Show=index;this.showLayer();$("#header, #contentwrap").click($.proxy(this.touchClickOutside,this));}},touchClickOutside:function(event){if((!isInElement(event.pageX,event.pageY,this.$layerContainer))&&(!isInElement(event.pageX,event.pageY,this.$stickyfooter))){event.preventDefault();$("#header, #contentwrap").unbind("click");if(this.shown>-1){this.want2Show=-1;this.hideLayer();}}},mouseenterLink:function(event){var index=$.inArray(event.currentTarget,this.$layerLinks);if((index!=-1)&&(!this.isModalVisible())){if(this.timerHide!=null){clearTimeout(this.timerHide);}this.preloadIfNeeded(index);if(this.shown==-1){this.timerShow=setTimeout($.proxy(this.timeoutShow,{_this:this,index:index}),this.delayShow);}else{this.want2Show=index;if(this.isLoaded(index)&&this.$layerContainer.is(":animated")){this.blockAnimation=false;this.$layerContainer.stop();}this.showLayer();}}},isModalVisible:function(){return($("#simplemodal-overlay:visible").size()>0);},mouseenterContainer:function(){if(this.timerHide!=null){clearTimeout(this.timerHide);}},mouseleave:function(event){var index=$.inArray(event.currentTarget,this.$layerLinks);if(this.timerShow!=null){clearTimeout(this.timerShow);}this.timerHide=setTimeout($.proxy(this.timeoutHide,this),this.delayHide);if(index==this.want2Show){this.want2Show=-1;}},preloadIfNeeded:function(index){if(!this.isLoaded(index)){var ajaxURL=$(this.$layerLinks[index]).data("ajaxurl")||"";if(ajaxURL.length>0){var data=$(this.$layerLinks[index]).data("ajaxparams")||{};$.ajax(ajaxURL,{context:{_this:this,index:index},dataType:"html",data:data,type:"post",success:this.ajaxLoaded});}}},isLoaded:function(index){return(typeof this.layerContents[index]!="undefined");},ajaxLoaded:function(data,textStatus,jqXHR){var _this=this._this;var index=this.index;try{_this.layerContents[index]=$(data);_this.showLayer(index);}catch(e){}},emptyLayer:function(){if(this.shown!=-1){var deleteCache=($(".sub-layer",this.$layerContainer).data("resetcacheafterclosing")=="y");if(deleteCache){this.layerContents[this.shown]=undefined;$(".sub-layer",this.$layerContainer).remove();this.enhanced[this.shown]=false;}else{this.layerContents[this.shown]=$(".sub-layer",this.$layerContainer).detach();}}this.shown=-1;},fillLayer:function(index){if(index!=this.shown){this.emptyLayer();this.$layerContainer.append(this.layerContents[index]);}if(!this.enhanced[index]){var isVisible=this.$layerContainer.is(":visible");if(!isVisible){this.$layerContainer.show();}this.enhance();if(!isVisible){this.$layerContainer.hide();}this.enhanced[index]=true;}this.shown=index;},timeoutShow:function(){var _this=this._this;var index=this.index;_this.want2Show=index;_this.showLayer();},timeoutHide:function(){this.hideLayer();},showLayer:function(){if((!this.blockAnimation)&&(this.want2Show!=-1)&&(this.isLoaded(this.want2Show))){this.blockAnimation=true;if(this.shown!=-1){this.fillLayer(this.want2Show);this.adjustLayerHeight(true);return;}this.$layerContainer.css("height","auto");this.fillLayer(this.want2Show);var height=this.$layerContainer.height();var duration=this.getSlideDuration(height);this.$layerContainer.show().css("height",0);this.showNurple(this.want2Show,duration);this.$layerContainer.animate({height:height},duration,"easeInOutQuart",$.proxy(function(){this.blockAnimation=false;this.$layerContainer.css("overflow","hidden");if(this.shown==this.want2Show){this.want2Show=-1;}this.showLayer();},this));}},hideLayer:function(){if(!this.blockAnimation){this.blockAnimation=true;var height=this.$layerContainer.height();var duration=this.getSlideDuration(height);this.hideNurple(duration);this.$layerContainer.animate({height:0},duration,"easeInOutQuart",$.proxy(function(){this.$layerContainer.css("height","auto").hide();this.emptyLayer();this.blockAnimation=false;this.showLayer();},this));}},adjustLayerHeight:function(moveNurple){var currentHeight=this.$layerContainer.height();this.$layerContainer.css("height","auto");var neededHeight=this.$layerContainer.height();if(currentHeight==neededHeight){this.$layerContainer.css("height",neededHeight+"px");if(moveNurple){this.showNurple(this.want2Show,0);}this.blockAnimation=false;return;}var difference=Math.max(100,Math.min(400,Math.abs(currentHeight-neededHeight)))*2;var duration=this.getSlideDuration(difference);if(moveNurple){this.showNurple(this.want2Show,duration);}this.$layerContainer.css({opacity:0,height:currentHeight+"px"}).animate({opacity:1,height:neededHeight},duration,"easeInOutQuart",$.proxy(function(){this.$layerContainer.css("overflow","hidden");this.blockAnimation=false;this.showLayer();},this));},showNurple:function(index,duration){var link=this.$layerLinks[index];var nurpleWidth=7;var linkLeftOffset=$(link).offset().left;var linkLeftPadding=parseInt($(link).css("paddingLeft"));var linkWidth=$(link).width();var maxPageLeftOffset=$(link).parents(".maxpage").offset().left;if(index==this.$layerLinks.size()-1){linkWidth=$("span",link).first().width();}var leftPos=linkLeftOffset-maxPageLeftOffset+linkLeftPadding+Math.round(linkWidth/2)-Math.ceil(nurpleWidth/2);this.$nurple.css("left",leftPos+"px").fadeIn(duration);},rePositionDefaultNurple:function(){if(this.shown==-1&&this.want2Show==-1){this.showNurple(this.defaultNurpleIndex,0);}},hideNurple:function(duration){if(this.shown!=this.defaultNurpleIndex){this.$nurple.fadeOut(duration,$.proxy(function(){if(this.defaultNurpleIndex!=-1){this.showNurple(this.defaultNurpleIndex,0);}},this));}},changeBoutiqueFinder:function(event){var link=event.currentTarget;var jsPulldownID=$(link).parents("div.jspulldown:first").attr("id");var selectID=jsPulldownID.substring(0,jsPulldownID.length-String("-mirror").length);var select=$("#"+selectID,this.$layerContainer);var selectOriginalValue=select.data("originalValue");var selectCurrentValue=select.val();if(selectOriginalValue!=selectCurrentValue){var form=$(link).parents("form:first");var data=form.serialize();var ajaxURL=form.data("pulldown-url");var method=form.attr("method");if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}if((typeof ajaxURL!="undefined")&&(ajaxURL.length>0)){this.blockAnimation=true;$.ajax(ajaxURL,{context:this,dataType:"html",type:method,data:data,success:this.boutiqueFinderPulldownsLoaded});}}},boutiqueFinderPulldownsLoaded:function(data,textStatus,jqXHR){var replaced=$(data).appendTo($(".sub-pdselection",this.$layerContainer).empty());enhance(replaced);this.enhanceBFPulldowns();$("p.error",this.$layerContainer).hide();this.adjustLayerHeight();this.blockAnimation=false;},submitBoutiqueFinder:function(event){var form=event.currentTarget;var secondSelect=$("select:nth(1)",form);var secondSelectOptionCount=$("option",secondSelect).size();var secondSelectValue=$(secondSelect).val();if((secondSelectOptionCount>1)&&(secondSelectValue.length==0)){$("p.error",form).show();$("label[for="+secondSelect.attr("id")+"]",form).addClass("error");this.adjustLayerHeight();event.preventDefault();}}};var Boutiquefinderform=function(){this.init();};Boutiquefinderform.prototype={init:function(){this.$layerContainer=".maincontent.boutique_finder";this.enhanceBFPulldowns();},enhanceBFPulldowns:function(){var proxyFunc=$.proxy(this.changeBoutiqueFinder,this);$("select:not(:last)",this.$layerContainer).each(function(i,elm){$(elm).data("originalValue",$(elm).val());$("#"+$(elm).attr("id")+"-mirror li a",this.$layerContainer).bind("jspulldownchanged",proxyFunc);});},changeBoutiqueFinder:function(event){var link=event.currentTarget;var jsPulldownID=$(link).parents("div.jspulldown:first").attr("id");var selectID=jsPulldownID.substring(0,jsPulldownID.length-String("-mirror").length);var select=$("#"+selectID,this.$layerContainer);var selectOriginalValue=select.data("originalValue");var selectCurrentValue=select.val();if(selectOriginalValue!=selectCurrentValue){var form=$(link).parents("form:first");var data=form.serialize();var ajaxURL=form.data("pulldown-url");var method=form.attr("method");if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}if((typeof ajaxURL!="undefined")&&(ajaxURL.length>0)){this.blockAnimation=true;$.ajax(ajaxURL,{context:this,dataType:"html",type:method,data:data,success:this.boutiqueFinderPulldownsLoaded});}}},boutiqueFinderPulldownsLoaded:function(data,textStatus,jqXHR){var replaced=$(data).appendTo($(".filtercontainer form",this.$layerContainer).empty());enhance(replaced);this.enhanceBFPulldowns();$("p.error",this.$layerContainer).hide();}};var Snav=function(snavHandler,snavPd,options){this.init(snavHandler,snavPd,options);};Snav.prototype={init:function(snavHandler,snavPd,options){this.$snavHandler=$(snavHandler);this.$snavPd=$(snavPd);var defaults={isTouch:false};this.options=jQuery.extend(defaults,(options||{}));this.toIn=null;this.toOut=null;this.offset=4;this.$snavPd.css({paddingTop:parseInt(this.$snavHandler.parents("h1").height())+this.offset+"px"});this.initEvents();},initEvents:function(){if(this.options.isTouch){this.$snavHandler.click($.proxy(this.touchClickSnavHandler,this));}else{this.$snavHandler.mouseover($.proxy(this.mouseOverSnavHandler,this));this.$snavHandler.hover($.proxy(this.mouseEnterSnavHandler,this),$.proxy(this.mouseLeaveSnavHandler,this));this.$snavPd.hover($.proxy(this.mouseEnterSnavPD,this),$.proxy(this.mouseLeaveSnavPD,this));}},touchClickSnavHandler:function(event){if(this.$snavPd.is(":visible")){this.hidePulldown();this.touchUnbindClickOutside();}else{event.preventDefault();event.stopPropagation();this.showPulldown();this.myTouchCLickOutSide=$.proxy(this.touchClickOutside,this);$("#header, #contentwrap, #stickyfooter").click(this.myTouchCLickOutSide);}},touchClickOutside:function(event){if(this.$snavPd.is(":visible")){if((!isInElement(event.pageX,event.pageY,this.$snavHandler))&&(!isInElement(event.pageX,event.pageY,this.$snavPd))){event.preventDefault();}this.hidePulldown();this.touchUnbindClickOutside();}},touchUnbindClickOutside:function(){if(this.myTouchCLickOutSide){$("#header, #contentwrap, #stickyfooter").unbind("click",this.myTouchCLickOutSide);this.myTouchCLickOutSide=null;}},mouseOverSnavHandler:function(event){event.preventDefault();clearTimeout(this.toOut);if(!this.$snavPd.is(":visible")){clearTimeout(this.toOut);this.toIn=setTimeout($.proxy(this.showPulldown,this),300);}else{clearTimeout(this.toIn);this.$snavHandler.removeClass("active");this.toOut=setTimeout($.proxy(this.hidePulldown,this),300);}},mouseEnterSnavHandler:function(event){if(this.options.isTouch){return;}clearTimeout(this.toOut);},mouseLeaveSnavHandler:function(event){if(this.options.isTouch){return;}this.toOut=setTimeout($.proxy(this.hidePulldown,this),300);},mouseEnterSnavPD:function(event){if(this.options.isTouch){return;}clearTimeout(this.toOut);},mouseLeaveSnavPD:function(event){if(this.options.isTouch){return;}clearTimeout(this.toIn);this.toOut=setTimeout($.proxy(this.hidePulldown,this),300);},showPulldown:function(){this.$snavHandler.addClass("active");if(!isIE()||isIE(9)){this.$snavPd.animate({opacity:"show"},200,"easeOutQuart");}else{this.$snavPd.show();}},hidePulldown:function(){this.$snavHandler.removeClass("active");if(!isIE()||isIE(9)){this.$snavPd.animate({opacity:"hide"},200,"easeOutQuart");}else{this.$snavPd.hide();}}};var ForcedCountrySelect=function(modalContent){this.init(modalContent);};ForcedCountrySelect.prototype={init:function(modalContent){this.$modalContent=$(modalContent).parents("#simplemodal-content:first");$(modalContent);this.$modalContainer=this.$modalContent.parents("#simplemodal-container:first");if((this.$modalContent.size()==0)||(this.$modalContainer.size()==0)){return;}this.$modalContainer.on("submit","form.layerform",{},$.proxy(this.submitInlineForm,this));this.blocked=false;this.enhance();},submitInlineForm:function(event){event.preventDefault();if(this.blocked){return;}var form=$(event.currentTarget);var action=form.attr("action");if(action.length==0){return;}this.blocked=true;var method=(form.attr("method")||"");var data=form.serialize();if($.inArray(method.toLowerCase(),["post","get"])==-1){method="post";}$.ajax(action,{context:this,type:method,data:data,dataType:"html",success:this.inlineFormSubmitSuccess});},inlineFormSubmitSuccess:function(data,textStatus,jqXHR){var that=this;this.$modalContent.fadeOut(function(){that.$modalContent.empty().append(data).fadeIn();enhance(this.$modalContent);that.enhance();that.blocked=false;});},enhance:function(){$("input[type=submit]",this.$modalContent).click(function(event){var form=$(event.currentTarget).parents("form:first");$("#hiddenchangelog",form).val("submit");});$(".sub-close",this.$modalContent).click(function(event){$.modal.close();});}};var JSPulldown=function(elem,params){this.init(elem,params);};$.JSPulldown=JSPulldown;JSPulldown.prototype={init:function(elem,params){this.delayShow=200;this.delayHide=200;this.delayType=1000;this.closeTimer=null;this.$elem=$(elem);this.params=params||{};this.selectPulldown=false;if(this.params.selectPulldown==true){this.selectPulldown=true;}if(this.$elem.is("select")){this.$elem.data("myJSPulldownObject",this);}this.selectedIndex=-1;if(this.selectPulldown){var selectOptions=this.$elem.find("option");var selectedOption=this.$elem.find("option:selected")[0];this.selectedIndex=selectOptions.index(selectedOption);this.createFakePulldown();this.$pulldown=$("#"+this.$elem.attr("id")+"-mirror");}else{this.$pulldown=this.$elem;}this.pulldownParent=this.$pulldown.parent().parent();this.$handle=this.$pulldown.find(".handle");this.$flesh=this.$pulldown.find(".flesh");var handleArrowWidth=this.$handle.find("span").css("margin-right");var newHandleWidth=this.$flesh.width()+parseInt(handleArrowWidth.substring(0,handleArrowWidth.indexOf("px")));if(this.$handle.width()<newHandleWidth){this.$handle.css({width:newHandleWidth+"px"});}else{this.$handle.css({width:(this.$handle.width()+1)+"px"});}this.$handle.mouseover(function(){$(this).addClass("hover");});this.$handle.mouseout(function(){$(this).removeClass("hover");});this.$handle.click($.proxy(this,"mouseclick"));if(this.params.followLink==false){this.$pulldown.click(function(ev){ev.preventDefault();});}var that=this;this.$flesh.find("li a").each(function(){$(this).click($.proxy(that,"itemChanged"));});this.$pulldown.mouseover($.proxy(this,"mouseover"));this.$pulldown.not(".active").find(".flesh").hide();},mouseclick:function(e){e.stopPropagation();e.preventDefault();if(!this.$handle.hasClass("disabled")){if(this.$pulldown.hasClass("active")){this.hide();}else{for(var i=0;i<jsPulldowns.length;i++){jsPulldowns[i].hide(true);}this.show();}}},mouseover:function(){window.clearTimeout(this.closeTimer);this.closeTimer=null;},mouseout:function(){if(!this.closeTimer){this.closeTimer=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},hide:function(hideall){$(document).unbind("keydown",this.eventHandlerKeyDown);this.$flesh.find("li a").removeClass("active");if(this.pulldownParent.hasClass("form-row")){this.pulldownParent.css({zIndex:"auto"});var fieldhint=this.pulldownParent.find(".fieldhint");if(fieldhint){fieldhint.hide();}}this.$pulldown.css({zIndex:"199"});this.$pulldown.removeClass("active");if(!hideall){this.$pulldown.trigger("hidepulldown");}this.$flesh.animate({height:["hide","swing"]},this.delayHide,"linear");},show:function(){this.initKeyWatcher();if(this.$flesh.width()<this.$handle.width()){this.$flesh.css({width:this.$pulldown.outerWidth()+"px"});}if(this.pulldownParent.hasClass("form-row")){this.pulldownParent.css({position:"relative",zIndex:"9999"});var hint=this.pulldownParent.find(".hint");if(hint){var fieldhint=this.pulldownParent.find(".fieldhint");if(fieldhint){fieldhint.show();}}}this.$pulldown.css({zIndex:"9999"});this.$pulldown.addClass("active");this.$flesh.animate({height:["toggle","swing"]},this.delayShow,"linear");var self=this;$("#header, #contentwrap, #stickyfooter").bind("click",function(){$("#header, #contentwrap, #stickyfooter").unbind("click");self.mouseout();});},initKeyWatcher:function(){if(typeof this.eventHandlerKeyDown=="undefined"){this.eventHandlerKeyDown=$.proxy(this.keyDown,this);this.resetTimeout=$.proxy(this.resetSigns,this);}$(document).bind("keydown",this.eventHandlerKeyDown);if(typeof this.entriesList=="undefined"){var entriesList=new Array();this.$flesh.find("li a").each(function(i,link){entriesList.push($(link).html().toLowerCase());});this.entriesList=entriesList;}this.resetSigns();},resetSigns:function(){this.lastHit=-1;this.prefix="";},keyDown:function(event){clearTimeout(this.timer);if(event.keyCode==13){var currentActive=this.$flesh.find("li a.active:first");if(currentActive.size()>0){this.selectItem(currentActive);event.preventDefault();return;}}if(event.keyCode==27){event.preventDefault();event.stopPropagation();this.hide();}if(event.keyCode==38){event.preventDefault();event.stopPropagation();var currentActive=this.$flesh.find("li a.active:first");var prevLink=currentActive.closest("li").prev('li:not([class~="dpn"])').find("a");if(prevLink.size()>0){this.markActive(prevLink);this.resetSigns();return false;}}if(event.keyCode==40){event.preventDefault();event.stopPropagation();var currentActive=this.$flesh.find("li a.active:first");if(currentActive.size()>0){var nextLink=currentActive.closest("li").next('li:not([class~="dpn"])').find("a");}else{var nextLink=this.$flesh.find('li:not([class~="dpn"]) a:first');}if(nextLink.size()>0){this.markActive(nextLink);this.resetSigns();return false;}}var sign=String.fromCharCode(event.keyCode);if(sign.match(/[a-z0-9]/i)){this.prefix+=sign.toLowerCase();this.timer=setTimeout(this.resetTimeout,this.delayType);var count=count=this.entriesList.length;var start=Math.max(Math.min(this.lastHit,count-1),0);for(var i=start;i<count;i++){if(this.entriesList[i].substr(0,this.prefix.length)==this.prefix){this.lastHit=i;var firstHitEntry=this.$flesh.find("li a:eq("+this.lastHit+")");this.markActive(firstHitEntry);break;}}}},markActive:function(link){link=$(link);this.$flesh.find("li a").removeClass("active");link.addClass("active");var ul=link.parents("ul:first");var offset=link.position();ul.scrollTop(offset.top+ul.scrollTop());},createFakePulldown:function(){var selectOptions=this.$elem.find("option");var entryLimit=parseInt(this.$elem.data("entrylimit"));if(entryLimit<3||isNaN(entryLimit)){entryLimit=-1;}var activeText="";if(this.$elem.find("option:selected")[0]){activeText=this.$elem.find("option:selected")[0].innerHTML;}else{activeText=selectOptions[0].innerHTML;}var flesh='<ul id="'+this.$elem.attr("id")+'-mirror-pd" class="flesh limited" style="'+(entryLimit==-1?"display:none;":"display:block; height: 100px;")+'">';selectOptions.each(function(){var optionClass="";if($(this).data("invisible")){optionClass=' class="dpn"';}flesh+="<li"+optionClass+'><a href="javascript:void(0);" '+($(this).data("invisible")?'tabindex="-1" ':"")+'data-value="'+$(this).val()+'">'+$(this).html()+"</a></li>";});flesh+="</ul>";var errorClass="";if(this.$elem.hasClass("error")){errorClass=" error";}var classname="handle";if(this.$elem.hasClass("disabled")){classname=classname+" disabled";}var fake=$('<div class="jspulldown'+errorClass+'" id="'+this.$elem.attr("id")+'-mirror"><a href="javascript:void(0);" class="'+classname+'" title="'+activeText+'"><span>'+activeText+"</span></a>"+flesh+"</div>").insertBefore(this.$elem);if(entryLimit!=-1){var liElements=$("li",fake);var minHeight=50;$(liElements).each(function(i,li){minHeight=Math.min(minHeight,$(li).outerHeight(true));});if(minHeight<10){minHeight=this.$elem.parents(".styleblogcontent").length>0?38:23;}$("#"+this.$elem.attr("id")+"-mirror .flesh").css({overflow:"auto","-webkit-overflow-scrolling":"touch"}).height(entryLimit*minHeight);}this.$elem.hide();},itemChanged:function(ev){var link=ev.currentTarget;this.selectItem(link);},setToValue:function(value){var selector='li a[data-value="'+value.replace(/"/g,'\\"')+'"]:first';var $link=$(selector,this.$flesh);if($link.size()>0){this.selectItem($link);}},selectItem:function(link){link=$(link);var changeItem=false;var links=$($(link).parents("ul").find("li a"));var linkIndex=links.index(link);if(this.selectPulldown){if(this.selectedIndex!=linkIndex){this.selectedIndex=linkIndex;$(this.$elem).find("option")[$(link).parent("li").prevAll().length].selected=true;if(this.$elem.data("changeevent")){changeSelectOption(this.$elem,this.$elem.data("iframe"));}if(this.$elem.hasClass("autosubmit")){this.$elem.parents("form").first().submit();}if(this.$elem.hasClass("wkbtndisable")){$("#warenkorb_button").attr("disabled",true);$("#prodform").removeAttr("action");}link.trigger("jspulldownchanged");changeItem=true;}}else{if(link.html()!=this.$handle.children("span").html()){changeItem=true;}}if(changeItem){this.$handle.children("span").html(link.html());this.$handle.attr("title",link.html());initTooltips($(".jspulldown"));}this.hide();}};var Bubble=function(elem,params){this.init(elem,params);};Bubble.prototype={init:function(elem,params){this.$elem=$(elem);this.params=params||{};this.delayShow=this.params.delayShow?this.params.delayShow:400;this.delayHide=this.params.delayHide?this.params.delayHide:300;this.positionTop=this.params.positionTop?this.params.positionTop:false;this.activation=this.params.activation?this.params.activation:"mouseover";this.offsX=this.params.offsX?this.params.offsX:0;this.offsY=this.$elem.data("offs-y")?parseInt(this.$elem.data("offs-y")):(this.params.offsY?this.params.offsY:0);this.triggerParentLink=this.params.triggerParentLink;this.live=this.$elem.data("dynamicparams")=="y";this.ajaxurl=this.$elem.data("ajaxurl-bubble");this.ajaxparams=(this.$elem.data("ajaxparams-bubble")||{});this.isHls=this.$elem.parents(".hlspluscontent").size()?true:false;this.$bubblelayer=this.$elem.find(".bubble");this.timeoutEnter=null;this.timeoutLeave=null;this.clicked=null;this.debug=this.$elem.data("debug");this.preferredPos=null;this.positionHints=null;var bubblePos=this.$elem.data("bubble-pos");var possiblePos=["top","bottom","left","right"];if(bubblePos&&($.inArray(bubblePos,possiblePos)!=-1)){this.preferredPos=bubblePos;if(this.$elem.data("pos-bubble")){var hints=this.$elem.data("pos-bubble").split(",");if(hints.length==3){this.positionHints=[parseInt(hints[0]),parseInt(hints[1]),parseInt(hints[2])];}}if(!this.positionHints){var handleOffset=this.$elem.offset(),handleWidth=this.$elem.outerWidth(),handleHeight=this.$elem.outerHeight(),$parent=this.getReferenceElement(this.$elem),parentOffset=$parent.offset();if($.inArray(this.preferredPos,["top","bottom"])!=-1){this.positionHints=[handleOffset.top-parentOffset.top,handleOffset.left-parentOffset.left+Math.round(handleWidth/2),handleOffset.top-parentOffset.top+handleHeight];}else{this.positionHints=[handleOffset.left-parentOffset.left,handleOffset.top-parentOffset.top+Math.round(handleHeight/2),handleOffset.left-parentOffset.left+handleWidth];}}}if($("#listpage").hasClass("mouseover")){this.activation="mouseover";}if(this.$elem.data("bubble-activator")){if(this.$elem.data("bubble-activator")=="self"){this.activator=this.$elem;}else{this.activator=$(this.$elem.data("bubble-activator"));}}else{this.activator=this.$elem.find("img");if(this.$elem.prop("tagName").toLowerCase()=="area"||this.$elem.hasClass("share")){this.activator=this.$elem;}}if(this.activation=="mouseover"){this.activator.mouseover($.proxy(this,"mouseover"));}else{if(this.activation=="click"){this.activator.mouseover($.proxy(this,"resetTime"));this.activator.click($.proxy(this,"click"));}else{return false;}}if(this.debug){var t=this;setTimeout(function(){t.activator.mouseover();},200);}else{this.activator.mouseout($.proxy(this,"mouseout"));}},getReferenceElement:function($element){if($element.is("area")){var mapId=$element.parent("map").attr("id");var $reference=$("img[usemap=#"+mapId+"]:first").offsetParent();}else{var $reference=$element.offsetParent();}return $reference;},enoughSpaceToDisplayWithDefinedPositionHints:function(pos){var $parent=this.getReferenceElement(this.$elem),parentOffset=$parent.offset();if($.inArray(pos,["top","bottom"])!=-1){var layerPosY=parseInt(this.positionHints[0]);var layerPosX=parseInt(this.positionHints[1]);var layerPosY2=parseInt(this.positionHints[2]);var box={top:parentOffset.top+layerPosY,left:parentOffset.left+layerPosX,width:0,height:layerPosY2-layerPosY};}else{var layerPosX=parseInt(this.positionHints[0]);var layerPosY=parseInt(this.positionHints[1]);var layerPosX2=parseInt(this.positionHints[2]);var box={top:parentOffset.top+layerPosY,left:parentOffset.left+layerPosX,width:layerPosX2-layerPosX,height:0};}return this.enoughSpaceToDisplayAtPos(pos,box);},enoughSpaceToDisplayAtPos:function(pos,box){var bubbleWidth=this.$bubblelayerClone.outerWidth(),bubbleHeight=this.$bubblelayerClone.outerHeight(),$nurple=this.$bubblelayerClone.find(".bubble-arr");nurpleShortSide=Math.min($nurple.width(),$nurple.height())-5,spaceAround=this.getSpaceAroundBox(box);if(pos=="bottom"){return(spaceAround.bottom>=bubbleHeight+this.offsY+nurpleShortSide+40);}else{if(pos=="top"){return(spaceAround.top>=bubbleHeight+this.offsY+nurpleShortSide);}else{if(pos=="left"){return(spaceAround.left>=bubbleWidth+this.offsX+nurpleShortSide);}else{if(pos=="right"){return(spaceAround.right>=bubbleWidth+this.offsX+nurpleShortSide);}}}}},getSpaceAroundBox:function(box){var scrollTop=$(window).scrollTop(),scrollLeft=$(window).scrollLeft(),windowWidth=$(window).width(),windowHeight=$(window).height();var spaceAround={top:box.top-scrollTop,left:box.left-scrollLeft,bottom:0,right:0};spaceAround.right=windowWidth-box.width-spaceAround.left;spaceAround.bottom=windowHeight-box.height-spaceAround.top;return spaceAround;},showAtPos:function(pos){var $ref=this.getReferenceElement(this.$elem),refOffset=$ref.offset(),$nurple=this.$bubblelayerClone.find(".bubble-arr"),scrollTop=$(window).scrollTop(),bubbleWidth=this.$bubblelayerClone.outerWidth(),bubbleHeight=this.$bubblelayerClone.outerHeight(),nurpleLongSide=Math.max($nurple.width(),$nurple.height()),nurpleShortSide=Math.min($nurple.width(),$nurple.height())-5,minNurpleDist=5,minTop=10;var layerOffsX,layerOffsY;if($.inArray(pos,["top","bottom"])!=-1){var layerPosY=this.positionHints[pos=="top"?0:2];var layerPosX=this.positionHints[1];var minLeft=$(".maincontent").offset().left,maxLeft=minLeft+$(".maincontent").width()-bubbleWidth-this.offsX;layerOffsX=refOffset.left+layerPosX-Math.round(bubbleWidth/5)-this.offsX;layerOffsX=Math.max(minLeft,Math.min(maxLeft,layerOffsX));if(pos=="top"){layerOffsY=refOffset.top-bubbleHeight+layerPosY-nurpleShortSide-this.offsY;this.$bubblelayerClone.addClass("bubble-top");}else{layerOffsY=refOffset.top+layerPosY+nurpleShortSide+this.offsY;this.$bubblelayerClone.removeClass("bubble-top");}var nurpleOffsX=layerPosX+refOffset.left-layerOffsX-Math.round(nurpleLongSide/2);$nurple.css({left:nurpleOffsX});}else{if($.inArray(pos,["left","right"])!=-1){var layerPosX=this.positionHints[pos=="left"?0:2];var layerPosY=this.positionHints[1];layerOffsY=refOffset.top+layerPosY-Math.round(bubbleHeight/2);if(pos=="left"){layerOffsX=refOffset.left-bubbleWidth+layerPosX-nurpleShortSide-this.offsX;this.$bubblelayerClone.addClass("bubble-left").removeClass("bubble-right");}else{layerOffsX=refOffset.left+layerPosX+nurpleShortSide+this.offsX;this.$bubblelayerClone.addClass("bubble-right").removeClass("bubble-left");}var nurpleOffsY=Math.round((bubbleHeight-nurpleLongSide)/2);$nurple.css({top:nurpleOffsY});}}this.$bubblelayerClone.css({left:layerOffsX,top:layerOffsY});},setpos:function(){var nurple=this.$bubblelayerClone.find(".bubble-arr"),width=this.$bubblelayerClone.outerWidth(),height=this.$bubblelayerClone.outerHeight(),elemOffset=this.$elem.offset(),elemHeight=this.$elem.outerHeight(),maxLeft=$(".maincontent").offset().left,maxRight=this.$elem.hasClass("thumbnailbubble")?$("body").width():maxLeft+$(".maincontent").width(),maxBottom=$(window).scrollTop()+$(window).height()-40,minTop=10,isTopBox=false,isLeftBox=false,layerOffsX=0,layerOffsY=0,nurpleOffsX;if(this.isHls&&this.activator.prop("tagName").toLowerCase()=="area"){var layerPos=this.$elem.data("pos-bubble").split(",");if(layerPos.length){var layerPosX=parseInt(layerPos[0]);var layerPosY=parseInt(layerPos[1]);var layerPosXLeft=parseInt(layerPos[2]);elemOffset=this.$elem.parents(".hls-layer").find("img[usemap]").offset();layerOffsY=elemOffset.top+this.offsY+layerPosY;(elemOffset.left+this.offsX+width+layerPosX>maxRight)&&(isLeftBox=true);if(isLeftBox){if(layerPosXLeft){layerPosX=layerPosXLeft;}layerOffsX=elemOffset.left-width-this.offsX+layerPosX-nurple.width();this.$bubblelayerClone.addClass("bubble-left");}else{layerOffsX=elemOffset.left+this.offsX+layerPosX;this.$bubblelayerClone.addClass("bubble-right");}nurple.css({top:((height-nurple.height())/2)});}}else{if(this.preferredPos){var showAs=this.preferredPos;var opposites={top:"bottom",bottom:"top",left:"right",right:"left"};if(!this.enoughSpaceToDisplayWithDefinedPositionHints(this.preferredPos)&&this.enoughSpaceToDisplayWithDefinedPositionHints(opposites[this.preferredPos])){showAs=opposites[this.preferredPos];}var t=this;setTimeout(function(){t.showAtPos(showAs);},100);return;}else{((elemOffset.top+this.offsY+height+elemHeight>maxBottom)||this.positionTop)&&(isTopBox=true);layerOffsY=(isTopBox)?elemOffset.top-height-this.offsY:elemOffset.top+elemHeight+this.offsY;(layerOffsY<minTop)&&(layerOffsY=minTop);layerOffsX=(elemOffset.left+width-this.offsX>maxRight)?maxRight-width:elemOffset.left-this.offsX;nurpleOffsX=((elemOffset.left-layerOffsX)+((this.$elem.width()-nurple.width())/2));if(nurpleOffsX>(width-nurple.width())){nurpleOffsX=width-nurple.width()-5;}isTopBox?this.$bubblelayerClone.addClass("bubble-top"):this.$bubblelayerClone.removeClass("bubble-top");nurple.css({left:nurpleOffsX});}}this.$bubblelayerClone.css({left:layerOffsX,top:layerOffsY});},click:function(e){e.preventDefault();var self=this;if(self.clicked){location.href=this.$elem.attr("href");self.clicked=null;}else{this.mouseover();self.clicked=true;}},mouseover:function(e){if(this.params.isTouch){if(this.$elem.hasClass("thumbnailbubble")){return;}$(".bubble").hide();$("#mainnav-popover").trigger("leave");e.preventDefault();$("#header, #contentwrap, #stickyfooter").bind("click",function(ev){$("#header, #contentwrap, #stickyfooter").unbind("click");self.mouseout();});}var self=this;window.clearTimeout(self.timeoutLeave);self.timeoutLeave=null;var ajaxurl=this.live?this.$elem.data("ajaxurl-bubble"):this.ajaxurl;if(!this.$bubblelayer.size()&&ajaxurl){var that=this;$.ajax({url:ajaxurl,data:this.live?(this.$elem.data("ajaxparams-bubble")||{}):this.ajaxparams,type:"post",async:false,success:function(data){if(data.length){that.$bubblelayer=that.$elem.find(".bubble");if(!that.$bubblelayer.size()){var bubbleHtml='<div class="bubble"><span class="bubble-arr"></span><div class="bubble-ctn">'+data+"</div></div>";if(that.$elem.prop("tagName").toLowerCase()=="area"){that.$bubblelayer=$(bubbleHtml).appendTo(that.$elem.parent().parent());}else{that.$bubblelayer=$(bubbleHtml).appendTo(that.$elem);}}}}});}if(!this.$bubblelayerClone){this.$bubblelayerClone=this.$bubblelayer.clone();this.$bubblelayerClone.appendTo("body");if(!this.debug){this.$bubblelayerClone.mouseenter($.proxy(this,"resetTime"));this.$bubblelayerClone.mouseleave($.proxy(this,"mouseout"));if(this.params.isTouch){this.$bubblelayerClone.find("span.close").click($.proxy(this,"mouseout"));}}}this.setpos();if(this.isHls){var self=this;$(window).bind("scrollatorStart",function(){window.clearTimeout(self.timeoutEnter);self.timeoutEnter=null;$(window).unbind("scrollatorStart");});}if(!self.timeoutEnter){self.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},mouseout:function(){var self=this;window.clearTimeout(self.timeoutEnter);self.timeoutEnter=null;if(!self.timeoutLeave){self.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},hide:function(){var self=this;self.clicked=null;if(this.$bubblelayerClone!=undefined){this.$bubblelayerClone.hide();this.$bubblelayerClone.remove();this.$bubblelayerClone=null;}if(this.live&&this.$bubblelayer!="undefined"){this.$bubblelayer.remove();this.$bubblelayer=this.$elem.find(".bubble");}},resetTime:function(){var self=this;window.clearTimeout(self.timeoutLeave);self.timeoutLeave=null;},show:function(){var that=this;if(!isIE()||isIE(9)){this.$bubblelayerClone.fadeIn(100);}else{this.$bubblelayerClone.show();}this.$bubblelayerClone.find(".modaloverlay").each(function(){new ModalLinksHandling(this,{});});enhance(this.$bubblelayerClone);if(!!this.triggerParentLink){this.$bubblelayerClone.find("a").on("click",function(ev){ev.preventDefault();that.$elem.trigger("click");});}if(this.isHls){var self=this;$(window).bind("scrollatorStart",function(){window.clearTimeout(self.timeoutEnter);self.timeoutEnter=null;if(!self.timeoutLeave){self.timeoutLeave=window.setTimeout($.proxy(self,"hide"),0);}$(window).unbind("scrollatorStart");});}}};var Infobubble=function(elem,params){this.init(elem,params);};Infobubble.prototype={init:function(elem,params){this.$elem=$(elem);this.params=params||{};this.delayShow=this.params.delayShow?this.params.delayShow:400;this.delayHide=this.params.delayHide?this.params.delayHide:300;this.activation=this.params.activation?this.params.activation:"mouseover";this.offsX=this.params.offsX?this.params.offsX:100;this.offsY=this.params.offsY?this.params.offsY:0;this.$bubblelayer=this.$elem.find(".bubble");this.timeoutEnter=null;this.timeoutLeave=null;if(this.activation=="mouseover"){this.$elem.mouseover($.proxy(this,"mouseover"));}else{if(this.activation=="click"){this.$elem.mouseover($.proxy(this,"resetTime"));this.$elem.click($.proxy(this,"click"));}else{return false;}}this.$elem.mouseout($.proxy(this,"mouseout"));},setpos:function(){var nurple=this.$bubblelayerClone.find(".bubble-arr"),width=this.$bubblelayerClone.outerWidth(),height=this.$bubblelayerClone.outerHeight(),elemOffset=this.$elem.offset(),minTop=10,layerOffsX=0,layerOffsY=0,nurpleOffsX;if($(".maincontent").size()){maxLeft=$(".maincontent").offset().left,maxRight=maxLeft+$(".maincontent").width();}else{if($(".shoppingbag").size()){maxLeft=$(".shoppingbag").offset().left,maxRight=maxLeft+$(".shoppingbag").width();}else{maxLeft=$("#contentwrap").offset().left,maxRight=maxLeft+$("#contentwrap").width();}}layerOffsY=elemOffset.top-height-this.offsY-nurple.height();if(layerOffsY<minTop){layerOffsY=minTop;}if(this.$elem.find(".bubble").is(".bubble-bottom")){layerOffsY=elemOffset.top+nurple.height()+this.$elem.height();}layerOffsX=(elemOffset.left+width-this.offsX>maxRight)?maxRight-width:elemOffset.left-this.offsX;nurpleOffsX=(width-nurple.width())/2-4;nurple.css("right",nurpleOffsX);this.$bubblelayerClone.css({left:layerOffsX,top:layerOffsY});},click:function(e){e.preventDefault();this.mouseover();},mouseover:function(){var self=this;window.clearTimeout(self.timeoutLeave);self.timeoutLeave=null;if(!this.$bubblelayerClone){this.$bubblelayerClone=this.$bubblelayer.clone();this.$bubblelayerClone.appendTo("body");this.$bubblelayerClone.mouseenter($.proxy(this,"resetTime"));this.$bubblelayerClone.mouseleave($.proxy(this,"mouseout"));}this.setpos();if(!self.timeoutEnter){self.timeoutEnter=window.setTimeout($.proxy(this,"show"),this.delayShow);}},mouseout:function(){var self=this;window.clearTimeout(self.timeoutEnter);self.timeoutEnter=null;if(!self.timeoutLeave){self.timeoutLeave=window.setTimeout($.proxy(this,"hide"),this.delayHide);}},hide:function(){if(this.$bubblelayerClone!=undefined){this.$bubblelayerClone.hide();this.$bubblelayerClone.remove();this.$bubblelayerClone=null;}},resetTime:function(){var self=this;window.clearTimeout(self.timeoutLeave);self.timeoutLeave=null;},resetContent:function(){if(this.$bubblelayerClone!=undefined){this.$bubblelayerClone.remove();this.$bubblelayerClone=null;this.timeoutEnter=null;this.mouseover();}},show:function(){if(!isIE()||isIE(9)){this.$bubblelayerClone.fadeIn(100);}else{this.$bubblelayerClone.show();}}};var DetailProductViewer=function(elem){this.init(elem);};DetailProductViewer.prototype={init:function(elem){if(typeof Z!="object"){return;}this.$elem=$(elem);this.elemID=this.$elem.attr("id");this.lastActivatedViewSelector=null;this.zoomifyUsed=$("#ViewerDisplay").size()>0;this.$simpleImage=null;this.mejsLoaded=false;this.$productVideo=null;if(typeof Z.detach=="undefined"){Z.detach=function(){$("#buttonContainer").detach().appendTo("#prod-img");if(isTouch){$("#buttonContainer").hide();}$("#buttonContainer").mousemove(function(e){e.preventDefault();});$("#buttonBackground,#panDivider,#buttonPanLeft,#buttonPanUp,#buttonPanRight,#buttonPanDown,#buttonReset").remove();};}this.initDetailViewSelectors();this.showFirstDetailView();},initDetailViewSelectors:function(){$(".prod-altviews a").each($.proxy(function(i,elem){$(elem).click($.proxy(this.activateDetailView,this));},this));},activateDetailView:function(event){event.preventDefault();if(event.currentTarget!=this.lastActivatedViewSelector){this.lastActivatedViewSelector=event.currentTarget;this.showDetailView(event.currentTarget);}},showDetailView:function(targetElement){back=false;$(".prod-altviews li").removeClass("active");$(targetElement).parent().addClass("active");var img=$(targetElement).find("img");if(img){img=$(img[0]);if(img.data("360degreeview")){this.showVideo(img.data("360degreeview"),true);back=true;}else{if(img.data("zoomifyimg")){this.showZoomify(img.data("zoomifyimg"));back=true;}else{if(img.data("simpleimg")){this.showImage(img.data("simpleimg"));back=true;}else{if(img.data("videoview")){this.showVideo(img.data("videoview"),false);back=true;}}}}}return back;},showFirstDetailView:function(){var firstSelector=$(".prod-altviews a:first")[0];this.lastActivatedViewSelector=firstSelector;this.showDetailView(firstSelector);},showZoomify:function(path){this.disablePrevious();$("#ViewerDisplay").css("display","block");$("#buttonContainer").show();$("#zoom-title").show();if(!this.zoomifyUsed){var zoomifyAssets="zSkinPath="+$("#image-area").attr("data-zoomifyPath")+"&zNavigatorVisible=0&zToolbarVisible=1&zLogoVisible=0&zSliderVisible=1&zFullPageVisible=0&zProgressVisible=0&zTooltipsVisible=0&zToolbarPosition=0&zKeys=0";Z.showImage(this.elemID,path,zoomifyAssets);Z.initialize();$("#ViewerDisplay").css("display","block");if(isTouch){$('<div id="touchZoomOffTotal" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; background: rgba(255,255,255,0);"></div>').appendTo("#ViewerDisplay")[0];$("#zoom-title").hide();$("#touchZoomOff").on("click",function(){$this=$(this);$this.hide();$("#touchZoomOn").show();$("#buttonContainer").show();$("#zoom-title").show();});$('<div id="touchZoomOn" style="position: absolute; top: 0; left: 0; z-index: 1000; padding: 10px; background: rgba(255,255,255,0.4); display: none;">'+($("#image-area").attr("data-text-touchdisable")||"Disable Zoom")+"</div>").appendTo("#ViewerDisplay")[0];$("#touchZoomOn").on("click",function(){$this=$(this);$this.hide();$("#touchZoomOff").show();$("#buttonContainer").hide();$("#zoom-title").hide();});}this.zoomifyUsed=true;}else{Z.Viewer.setImagePath(path);if(isTouch){$("#buttonContainer").hide();$("#zoom-title").hide();$("#touchZoomOn").hide();$("#touchZoomOff").show();}}},showVideo:function(objectname,is360Video){this.disablePrevious();var containerWidth=$("#image-area").width();var containerHeight=$("#image-area").height();var object=eval(objectname);this.objectWidth=object.width;this.objectHeight=object.height;this.leftPos=(containerWidth-this.objectWidth)/2;this.topPos=(containerHeight-this.objectHeight)/2;if($("#"+objectname).length>0){this.$productVideo=$("#"+objectname).parents(".mejs-container");this.$productVideo.css({left:this.leftPos+"px",position:"absolute",top:this.topPos+"px"});}else{var i,videoMarkup;if(object.sources.length==1){videoMarkup='<video id="'+objectname+'" src="'+object.sources[0].src+'" type="'+object.sources[0].type+'" width="'+object.width+'" height="'+object.height+'" poster="'+object.poster+'" controls="controls" preload="metadata"></video>';}else{videoMarkup='<video id="'+objectname+'" width="'+object.width+'" height="'+object.height+'" poster="'+object.poster+'" controls="controls" preload="metadata">';for(i=0;i<object.sources.length;i++){videoMarkup+='<source src="'+object.sources[i].src+'" type="'+object.sources[i].type+'" />';}videoMarkup+="</video>";}this.$productVideo=$(videoMarkup).prependTo("#image-area")[0];if(is360Video){this.params={vidFeatures:["playpause","progress"],loop:true,showControls:true};}else{this.params={};}videos.push(new Videohandling($(this.$productVideo),this.params));$("#image-area .mejs-container").first().css({left:this.leftPos+"px",position:"absolute",top:this.topPos+"px"});}},showImage:function(path){this.disablePrevious();this.$simpleImage=$('<img class="simple" src="'+path+'" alt="" />').prependTo("#image-area")[0];},disablePrevious:function(){if(this.$simpleImage){$(this.$simpleImage).detach();}this.$simpleImage=null;if(this.$productVideo){if(mejs.players.length>0){$("#image-area .mejs-container").remove();}}this.$productVideo=null;$("#ViewerDisplay").css("display","none");$("#buttonContainer").hide();$("#zoom-title").hide();}};$.initDetailProductViewer=function(elem){new DetailProductViewer(elem);};var Pager=function(elem,options){this.init(elem,options);};Pager.prototype={init:function(elem,options){this.$elem=$(elem);this.$subscriber=this.$elem.data("eventsubscriber")?$(this.$elem.data("eventsubscriber")):[];if(!isTouch&&this.$elem.hasClass("sidepaging")&&($(window).width()<1060)){$(this.$elem).hide();}options=options||{};options.bindEvents=options.bindEvents||"y";options.initArrowButtons=options.initArrowButtons||"y";this.$btns=options.initArrowButtons=="y"?$(".pager",this.$elem):$({});this.toIn={prev:null,next:null};this.toOut={prev:null,next:null};this.$btnViews=$(".btn-view",this.$elem);this.currentlyHover=null;this.descriptionData=null;this.$description=null;this.enhancePagerMarkup();this.bgColor=this.$elem.data("bgcolor")||"595959";this.setBgColor(this.bgColor,0.3,0.5);if(options.bindEvents==="y"){this.bindEvents();}},enhancePagerMarkup:function(){for(var i=0;i<this.$btns.size();i++){var btn=this.$btns[i];var dir=$(btn).hasClass("prev")?"prev":"next";$('<div class="bg"><div></div></div>').appendTo(btn);var preview=$(".preview",btn);if(preview.size()==0){preview=$('<div class="preview '+dir+'"><div class="wrapper"></div></div>').appendTo(btn);}if(this.descriptionData){preview.width(preview.width()+100);}}for(var i=0;i<this.$btnViews.size();i++){var btn=this.$btnViews[i];$('<div class="bg"><div></div></div>').appendTo(btn);}},setBgColor:function(hex,alphaStd,alphaHover){this.bgColor=convertHexToRGB(hex);this.bgHoverColor=jQuery.extend({},this.bgColor);this.bgColor.a=alphaStd;this.bgHoverColor.a=alphaHover;if(this.$btns&&this.$btns.size()>0){setTransparentBackgroundColor($(".bg",this.$btns),this.bgColor);setTransparentBackgroundColor($(".bg",this.$btnViews),this.bgColor);setTransparentBackgroundColor($(".preview",this.$btns),this.bgColor);}},bindEvents:function(){if($("#prevsel-products-box","body").length<1){this.$btns.click($.proxy(this.clickButton,this));}this.$btns.hover($.proxy(this.hoverInButton,this),$.proxy(this.hoverOutButton,this));this.$btnViews=$(".btn-view",this.$elem);this.$btnViews.hover($.proxy(this.hoverInNonPreviewButton,this),$.proxy(this.hoverOutNonPreviewButton,this));},clickButton:function(event){},hoverInButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);var dir=button.hasClass("prev")?"prev":"next";this.currentlyHover=dir;setTransparentBackgroundColor($(".bg",button),this.bgHoverColor);this.stopHidePreviewTimer(dir);this.startShowPreviewTimer(dir);},hoverOutButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);var dir=button.hasClass("prev")?"prev":"next";this.currentlyHover=null;setTransparentBackgroundColor($(".bg",button),this.bgColor);this.stopShowPreviewTimer(dir);this.startHidePreviewTimer(dir);},hoverInNonPreviewButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);setTransparentBackgroundColor($(".bg",button),this.bgHoverColor);this.stopNonPreviewTimer(button,"hide");this.startNonPreviewTimer(button,"show");},hoverOutNonPreviewButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);setTransparentBackgroundColor($(".bg",button),this.bgColor);this.stopNonPreviewTimer(button,"show");this.startNonPreviewTimer(button,"hide");},stopNonPreviewTimer:function(button,timerType){if((timerType!="hide")&&(timerType!="show")){return;}var timer=$(button).data("timer_"+timerType)||null;clearTimeout(timer);$(button).data("timer_"+timerType,null);},startNonPreviewTimer:function(button,timerType){if((timerType!="hide")&&(timerType!="show")){return;}var toAnimate={width:timerType};if(!isIE6OrLess()&&!isIE(7)&&!isIE(8)){toAnimate.opacity=timerType;}var func;if(timerType=="show"){if(!button.hasClass("previewed")){func=function(){var preview=$(".preview",button);$(button).addClass("previewed");if(isIE(7)){preview.fadeIn(400);}else{preview.animate(toAnimate,400,"easeOutQuart",function(){});}};}}else{if(button.hasClass("previewed")){func=function(){$(button).removeClass("previewed");if(isIE(7)){$(".preview",button).fadeOut(400);}else{$(".preview",button).animate(toAnimate,400,"easeOutQuart",function(){});}};}}if(func){var timer=setTimeout(func,400);$(button).data("timer_"+timerType,timer);}},showPreview:function(dir){if((dir!="next")&&(dir!="prev")){return;}if(!this.previewHasContent(dir)){return;}this.updatePreviewDescription(dir);var toAnimate={width:"show"};if(!isIE6OrLess()&&!isIE(7)&&!isIE(8)){toAnimate.opacity="show";}var button=this.$btns.filter("."+dir);$(button).addClass("previewed");$(".preview",button).animate(toAnimate,400,"easeOutQuart",function(){});},stopShowPreviewTimer:function(dir){if((dir!="next")&&(dir!="prev")){return;}clearTimeout(this.toIn[dir]);this.toIn[dir]=null;},startHidePreviewTimer:function(dir){if((dir!="next")&&(dir!="prev")){return;}this.toOut[dir]=setTimeout($.proxy(function(){this.hidePreview(dir);},this),400);},stopHidePreviewTimer:function(dir){if((dir!="next")&&(dir!="prev")){return;}clearTimeout(this.toOut[dir]);this.toOut[dir]=null;},hidePreview:function(dir){if((dir!="next")&&(dir!="prev")){return;}var button=this.$btns.filter("."+dir);$(button).removeClass("previewed");var toAnimate={width:"hide"};if(!isIE6OrLess()&&!isIE(7)&&!isIE(8)){toAnimate.opacity="hide";}$(".preview",button).animate(toAnimate,400,"easeOutQuart",function(){});},startShowPreviewTimer:function(dir){if((dir!="next")&&(dir!="prev")){return;}this.toIn[dir]=setTimeout($.proxy(function(){this.showPreview(dir);},this),400);},updatePreviewDescription:function(dir){if(((dir!="next")&&(dir!="prev"))||(!this.descriptionData)){return;}$(this.$description).detach();var content=this.getDescriptionContent(dir);this.$description=$("<p><strong>"+this.descriptionData.title+"</strong><br />"+content+"</p>").appendTo($(".preview."+dir+" .wrapper"));},getDescriptionContent:function(dir){return this.descriptionData.content;},getPager:function(dir){if((dir!="next")&&(dir!="prev")){return;}return this.$btns.filter("."+dir);},getCurrentlyHover:function(){return this.currentlyHover;},previewHasContent:function(dir){if((dir!="next")&&(dir!="prev")){return false;}return($(".wrapper",this.$btns.filter("."+dir)).html().length>0);},triggerCustomEvent:function(eventName,eventParams){if(this.$subscriber.length>0){this.$subscriber.trigger(eventName,eventParams);}}};var PagingTeaser=function(elem){this.init(elem);};PagingTeaser.prototype=$.extend({},Pager.prototype,{parent:Pager.prototype,init:function(elem){this.parent.init.call(this,elem,{bindEvents:"n"});if(this.$elem.data("init-on-event")=="y"){this.$elem.one("init",$.proxy(this.initialize,this));}else{this.initialize();}},initialize:function(){this.$wrap=$(".teaserwrap",this.$elem);this.$origTsr=$(".teaser",this.$elem);this.$intronav=null;this.animating=false;this.$origTsr.each(function(i,elm){if(typeof $(elm).data("teaserindex")=="undefined"){$(elm).data("teaserindex",i);}});if(this.$origTsr.size()==1){this.$btns.hide();return;}try{this.setBgColor(this.$elem.data("bgcolor"),0.3,0.5);}catch(err){this.setBgColor("595959",0.3,0.5);}try{this.textShadowColor=normalizeHexColor(this.$elem.data("textshadowcolor"));}catch(err){this.textShadowColor=null;}if(this.$elem.hasClass("motionteaser")){this.buildIntroNav();this.$intronav=$(".intronav",this.$elem);}setTransparentBackgroundColor(this.$intronav,this.bgColor);this.alignPagingTeaser();this.bindEvents();},buildIntroNav:function(){this.$origTsr=$(".teaser",this.$elem);if(this.$origTsr.size()<2){return;}var txtVideo=this.$elem.data("txt-video");var txtHighlights=this.$elem.data("txt-highlights");if(!txtVideo||!txtHighlights){return;}txtVideo=$("<div />").html(txtVideo).text();txtHighlights=$("<div />").html(txtHighlights).text();if(txtVideo.length==0||txtHighlights.length==0){return;}var contentContainer=$(".content",this.$origTsr.first());var introNav=$('<div class="intronav"><a href="javascript:void(0);" class="next">'+txtHighlights+"</a></div>").appendTo(contentContainer);if(this.$origTsr.last().data("contenttype")=="video"){$('<a href="javascript:void(0);" class="prev">'+txtVideo+"</a>").prependTo(introNav);}},bindEvents:function(){this.parent.bindEvents.call(this);if(isTouch){if((this.$elem).hasClass("mainteaser")){$(this.$elem).swipe({swipeLeft:$.proxy(function(){this.$btns.filter(".next").click();},this),swipeRight:$.proxy(function(){this.$btns.filter(".prev").click();},this)});}}if(!isIE(6)){this.eventHandlerKeyUp=$.proxy(function(event){$(".preview",this.$elem).hide();if(event.keyCode==37){this.$btns.filter(".prev").click();}else{if(event.keyCode==39){this.$btns.filter(".next").click();}}},this);this.eventHandlerElementHoverIn=$.proxy(function(event){$("body").bind("keyup",this.eventHandlerKeyUp);},this);this.eventHandlerElementHoverOut=$.proxy(function(event){$("body").unbind("keyup",this.eventHandlerKeyUp);},this);this.$elem.hover(this.eventHandlerElementHoverIn,this.eventHandlerElementHoverOut);}if(this.$intronav&&this.$intronav.size()>0){$("a",this.$intronav).click($.proxy(this.clickButton,this)).hover($.proxy(this.hoverInTextButton,this),$.proxy(this.hoverOutTextButton,this));}this.$elem.bind("moveToPage",$.proxy(this.moveToPage,this));},clickButton:function(event){event.preventDefault();if(this.animating){return;}this.moveTeaser($(event.currentTarget).hasClass("prev")?"prev":"next");},moveToPage:function(event,params){if(this.animating){return;}var pageIndex=params.pageIndex;var pageCount=$(".teaser",this.$elem).size();if(pageIndex<0){throw"pageIndex has to be 0 or higher.";}else{if(pageIndex>=pageCount){throw"pageIndex has to be lower than "+pageCount;}}var currentIndex=this.getTeaser("current").data("teaserindex");if(pageIndex==currentIndex){return;}else{var dir=(pageIndex>currentIndex)?"next":"prev";var steps=Math.abs(pageIndex-currentIndex);this.moveTeaser(dir,steps);}},hoverInTextButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);var dir=button.hasClass("prev")?"prev":"next";if(this.textShadowColor){button.css("text-shadow","1px 1px 1px "+this.textShadowColor);}},hoverOutTextButton:function(event){if(isTouch){return;}var button=$(event.currentTarget);var dir=$(button).hasClass("prev")?"prev":"next";if(this.textShadowColor){button.css("text-shadow","none");}},moveTeaser:function(dir,steps){if((dir!="next")&&(dir!="prev")){return;}if(typeof steps!="number"){steps=1;}var currentTeaserBeforeAnimation=this.getTeaser("current");var currentTeaserAfterAnimation=this.getTeaserByOffset(steps*(dir=="next"?1:-1));this.animating=true;if(dir=="prev"){for(var i=1;i<=steps;i++){this.$wrap.prepend(this.getTeaser("prev").css({left:(-i*100)+"%",position:"relative"}).css({position:"absolute"}));}if(currentTeaserBeforeAnimation.data("contenttype")=="video"){Videohandling.prototype.pauseVideo(currentTeaserBeforeAnimation);}if(currentTeaserAfterAnimation.data("contenttype")=="video"&&(currentTeaserAfterAnimation.data("plugintype")=="flash"||isTouch!="undefined")){Videohandling.prototype.reinitializeVideoElem(currentTeaserAfterAnimation);}}var teaserToShow;if(dir=="prev"){teaserToShow=this.getTeaser("current");}else{teaserToShow=this.getTeaserByOffset(steps);}markActive("",$(".smalloverview",this.$elem),this.$origTsr.index(teaserToShow));this.triggerCustomEvent("startMoveTeaser",{direction:dir,teaserToShow:teaserToShow});this.$wrap.animate({left:(dir=="next"?"-":"+")+"="+(steps*100)+"%"},800,"easeOutQuart",$.proxy(function(){if(dir=="next"){for(var i=1;i<=steps;i++){this.$wrap.append(this.getTeaser("current"));}}if(currentTeaserBeforeAnimation.data("contenttype")=="video"&&currentTeaserBeforeAnimation.data("plugintype")!="flash"&&currentTeaserBeforeAnimation.attr("data-played")=="true"){Videohandling.prototype.pauseVideo(currentTeaserBeforeAnimation);}if(currentTeaserAfterAnimation.data("contenttype")=="video"&&(currentTeaserAfterAnimation.data("plugintype")=="flash"||isTouch!="undefined")){Videohandling.prototype.reinitializeVideoElem(currentTeaserAfterAnimation);}this.alignPagingTeaser();this.$wrap.css("left","0%");this.animating=false;var previewTsr=this.getTeaser(dir);if(this.isPreviewVisible(dir)){if(!this.hasTeaserPreview(previewTsr)){this.hidePreview(dir);return;}}else{if(this.hasTeaserPreview(previewTsr)&&(this.getCurrentlyHover()==dir)){if(this.preparePreview(dir)){this.showPreview(dir);}return;}}$(".preview."+dir+" img",this.$elem).attr("src",previewTsr.data("previewimg"));this.updatePreviewDescription(dir);if(isTouch){$(".teaser:last-child").css("visibility","hidden");window.setTimeout(function(){$(".teaser:last-child").css("visibility","visible");},1);}this.triggerCustomEvent("endMoveTeaser",{direction:dir,teaserToShow:teaserToShow});if($.lp_tracking){$.lp_tracking.registerTeaser(currentTeaserAfterAnimation.data("teasername"));$.lp_tracking.commit();}},this));},showPreview:function(dir){if((dir!="next")&&(dir!="prev")){return;}if(this.preparePreview(dir)){this.parent.showPreview.call(this,dir);}},preparePreview:function(dir){if((dir!="next")&&(dir!="prev")){return false;}var target=this.$btns.filter("."+dir);var previewTsr=this.getTeaser(dir);if(!this.hasTeaserPreview(previewTsr)){return false;}var previewImgSrc=previewTsr.data("previewimg");var preview=$(".wrapper",target);preview.html('<img src="'+previewImgSrc+'" height="98" alt="" />');return true;},alignPagingTeaser:function(){$(".teaser",this.$elem).each(function(i,elem){$(elem).css("left",i*100+"%");});},getDescriptionContent:function(dir){var nr=this.$origTsr.index(this.getTeaser(dir))+1;return this.descriptionData.content.replace(/#ALL/i,this.$origTsr.size()).replace(/#CURRENT/i,nr);},isPreviewVisible:function(dir){if((dir!="next")&&(dir!="prev")){return false;}return this.$btns.filter("."+dir).hasClass("previewed");},getTeaser:function(which){var mapping={current:0,next:1,prev:-1};if(typeof mapping[which]==undefined){return{};}else{return $(".teaser",this.$elem).eq(mapping[which]);}},getTeaserByOffset:function(offset){return $(".teaser",this.$elem).eq(offset);},hasTeaserPreview:function(tsr){tsr=$(tsr);return(tsr.data("previewimg")&&(tsr.data("previewimg").length>0));}});$.videoTracking=new Array();$.videoTrackingRequest=function(key){var trackingSteps=5,trackingStepsFloor=2;if(typeof(config)!=="undefined"&&typeof(config["videotracking.steps"])==="number"&&typeof(config["videotracking.stepsfloor"])==="number"){trackingSteps=config["videotracking.steps"];trackingStepsFloor=config["videotracking.stepsfloor"];}if(key){if($.videoTracking[key]&&$.videoTracking[key].lastTrackTime>0){var vTime=$.videoTracking[key].lastTrackTime;if(trackingSteps>1){var vTimeMod=vTime%trackingSteps;vTime=vTimeMod<=trackingStepsFloor?vTime-vTimeMod:vTime+trackingSteps-vTimeMod;}dcsMultiTrack("DCSext.video_title",$.videoTracking[key].trackTitle,"DCSext.video_time",vTime.toString(),"WT.dl","15");$.videoTracking[key].lastTrackTime=0;$.videoTracking[key].trackTime=0;}}else{for(k=1;k<=$.videoTracking.length;k++){if($.videoTracking[k]&&$.videoTracking[k].lastTrackTime>0){var vTime=$.videoTracking[k].lastTrackTime;if(trackingSteps>1){var vTimeMod=vTime%trackingSteps;vTime=vTimeMod<=trackingStepsFloor?vTime-vTimeMod:vTime+trackingSteps-vTimeMod;}dcsMultiTrack("DCSext.video_title",$.videoTracking[k].trackTitle,"DCSext.video_time",vTime.toString(),"WT.dl","15");$.videoTracking[k].lastTrackTime=0;$.videoTracking[k].trackTime=0;}}}};var Videohandling=function(elem,params){this.init(elem,params);};Videohandling.prototype={init:function(elem,params){var that=this;this.$elem=$(elem);this.params=params?params:{};this.playerVersion=1;if(this.$elem.css("position")=="relative"){if(this.$elem.css("font-family")=="Arial"){this.playerVersion=3;}else{this.playerVersion=2;}}if(this.params.vidFeatures){this.vidFeatures=this.params.vidFeatures;}else{if(this.playerVersion==1){isTouch?this.vidFeatures=["playpause","progress","current","duration","fullscreen"]:this.vidFeatures=["playpause","progress","current","duration","volume","fullscreen"];}else{if(this.playerVersion==2){isTouch?this.vidFeatures=["playpause","progress","duration","current","fullscreen"]:this.vidFeatures=["playpause","progress","duration","current","volume","fullscreen"];}else{isTouch?this.vidFeatures=["playpause","progress","current","duration","fullscreen"]:this.vidFeatures=["playpause","progress","current","duration","volume","fullscreen"];}}}this.mode=(isIE()&&!isIE(10))?"shim":"auto";this.mode=((detectedUA.browser=="Firefox"&&detectedUA.browserversion<=9)||(isIE()&&!isIE(10)))?"shim":"auto";this.pluginFullscreen=(isIE(9)||isIE(8)||isIE(7))?false:true;this.txtMute=this.$elem.attr("data-txt-mute")?this.$elem.attr("data-txt-mute"):"Mute";this.txtPlaypause=this.$elem.attr("data-txt-playpause")?this.$elem.attr("data-txt-playpause"):"Play/Pause";this.txtLoading=this.$elem.attr("data-txt-loading")?this.$elem.attr("data-txt-loading"):"Loading";this.poster=this.$elem.attr("poster")?this.$elem.attr("poster"):"";this.inMotionteaser=(this.$elem.parents(".pagingteaser.motionteaser").length>0||this.$elem.parents(".pagingteaser.coverstory").length>0)?true:false;this.teaserWrap=this.$elem.parents(".teaserwrap");this.allTeaser=this.teaserWrap.find(".teaser");this.teaserCount=this.teaserWrap.find(".teaser").length;this.vidFeatures=this.vidFeatures,this.loop=this.params.loop?this.params.loop:false;this.showControls=this.playerVersion==3?true:(this.params.showControls?this.params.showControls:false);this.vidHeight=this.$elem.attr("height");this.vidWidth=this.$elem.attr("width");this.alpha=this.playerVersion==3?0.001:(this.playerVersion==1?0.3:0.1);this.alphaInitial=this.playerVersion==3?0.5:0.3;this.alphaHover=this.playerVersion==3?0.3:0.5;this.hex="595959";this.colorHandling=this.playerVersion==3?false:true;if(this.inMotionteaser){var bgColorData=this.$elem.parents(".pagingteaser.motionteaser").data("bgcolor");if(typeof bgColorData!="undefined"){this.hex=bgColorData;this.colorHandling=true;}}that.$elem.parent(".video").height(this.vidHeight).width(this.vidWidth);this.trackingtitle=this.$elem.data("trackingtitle");if(this.trackingtitle){this.uniqueKey=getUniqueId()+1;this.$elem.data("uniqueKey",this.uniqueKey);$.videoTracking[this.uniqueKey]={};$.videoTracking[this.uniqueKey].trackTime=0;$.videoTracking[this.uniqueKey].lastTrackTime=0;$.videoTracking[this.uniqueKey].trackStep=1;}this.$elem.mediaelementplayer({alwaysShowControls:this.showControls,flashName:"flashmediaelement.swf",features:this.vidFeatures,mode:this.mode,pauseOtherPlayers:true,poster:this.poster,muteText:this.txtMute,playpauseText:this.txtPlaypause,loop:this.loop,usePluginFullScreen:this.pluginFullscreen,success:$.proxy(that.successHandler,that)});},successHandler:function(mediaElement){if(this.inMotionteaser){$("#"+mediaElement.id).parents(".teaser").attr("data-plugintype",mediaElement.pluginType);$("#"+mediaElement.id).parents(".teaser").attr("data-played","false");}var that=this;this.mediaElement=mediaElement;this.mediaElem=(mediaElement.id)?$("#"+mediaElement.id):$(mediaElement);this.controls=this.mediaElem.parents(".mejs-inner").find(".mejs-controls");this.posterElem=this.mediaElem.parents(".mejs-inner").find(".mejs-poster");this.pagingButtons=this.mediaElem.parents(".pagingteaser").find(".pager");this.mediaElem.parents(".mejs-inner").find(".mejs-overlay-loading").html(this.txtLoading);if(this.colorHandling==true){this.controls.addClass("colored");this.setColors();}this.setEventHandlers();},setColors:function(){var that=this;this.bgColor=convertHexToRGB(this.hex);this.bgColor.a=this.alpha;this.bgHoverColor=this.playerVersion==3?convertHexToRGB("ffffff"):jQuery.extend({},this.bgColor);this.bgHoverColor.a=this.alphaHover;this.bgColorTimerail=convertHexToRGB(this.hex);this.bgColorTimerail.a=0.4;this.bgColorLoaded=convertHexToRGB("ffffff");this.bgColorLoaded.a=0.4;var btns=this.controls.find(".mejs-button");this.timerail=this.controls.find(".mejs-time-total");this.timeloaded=this.controls.find(".mejs-time-loaded");this.timedesc=this.controls.find(".mejs-time");if(this.playerVersion==1){setTransparentBackgroundColor(btns,this.bgColor);setTransparentBackgroundColor(this.timerail,this.bgColor);setTransparentBackgroundColor(this.timeloaded,this.bgColor);setTransparentBackgroundColor(this.timedesc,this.bgColor);}else{this.bgColor.a=this.alphaInitial;if(this.playerVersion==3){setTransparentBackgroundColor(this.timerail,this.bgColorTimerail);setTransparentBackgroundColor(this.timeloaded,this.bgColorLoaded);}else{setTransparentBackgroundColor(this.timerail,this.bgColor);setTransparentBackgroundColor(this.timeloaded,((isIE(7)||isIE(8))?this.bgColor:this.bgColorLoaded));}setTransparentBackgroundColor(this.controls,this.bgColor);this.bgColor.a=this.alpha;}btns.each(function(){$(this).hover(function(){setTransparentBackgroundColor($(this),that.bgHoverColor);},function(){if(that.playerVersion==3){$(this).css({"background-color":"transparent",filter:"none"});}else{setTransparentBackgroundColor($(this),that.bgColor);}});$(this).addClass("ttip");});},hoverInTimerail:function(){setTransparentBackgroundColor(this.timerail,this.bgHoverColor);},hoverOutTimerail:function(){setTransparentBackgroundColor(this.timerail,this.bgColor);},videoJumper:function(time,startPlaying){time=time==-1?this.mediaElement.duration-1:time;this.mediaElement.pause();this.mediaElement.setCurrentTime(time);if(startPlaying){this.mediaElement.play();}},setEventHandlers:function(){var that=this,timeChanged=false;if(this.trackingtitle){this.mediaElement.addEventListener("play",function(){$.videoTracking[that.uniqueKey].trackTitle=that.trackingtitle+" - "+Math.floor(that.mediaElement.duration);window.onbeforeunload=function(){$.videoTrackingRequest();};});this.mediaElement.addEventListener("timeupdate",function(){if(that.mediaElement.currentTime>0&&that.mediaElement.currentTime>$.videoTracking[that.uniqueKey].trackTime){$.videoTracking[that.uniqueKey].trackTime=Math.floor(that.mediaElement.currentTime);}if($.videoTracking[that.uniqueKey].trackTime>$.videoTracking[that.uniqueKey].lastTrackTime&&$.videoTracking[that.uniqueKey].trackTime/$.videoTracking[that.uniqueKey].trackStep==Math.floor($.videoTracking[that.uniqueKey].trackTime/$.videoTracking[that.uniqueKey].trackStep)){$.videoTracking[that.uniqueKey].lastTrackTime=$.videoTracking[that.uniqueKey].trackTime;}});}this.mediaElement.addEventListener("timeupdate",function(){if(that.inMotionteaser&&!timeChanged){timeChanged=true;$("#"+that.mediaElement.id).parents(".teaser").attr("data-played","true");}if(isIE()){if((that.mode=="shim"||isIE(10))&&that.mediaElem.parents(".mejs-container").hasClass("mejs-container-fullscreen")){that.fixIEControls(true);}else{that.fixIEControls(false);}}},false);this.mediaElement.addEventListener("ended",function(){if(!that.loop){that.posterElem.show();}},false);$(that.mediaElem.parents(".mejs-container")).hover(function(){if(isIE(6)){return;}$("body").bind("keyup",function(ev){if(ev.keyCode==27){if(isIE()){that.fixIEControls(false);}}});},function(){if(isIE(6)){return;}$("body").unbind("keyup");});$(this.controls).find(".mejs-fullscreen-button button").on("click",function(){if(isIE()){if((that.mode=="shim"||isIE(10))&&that.mediaElem.parents(".mejs-container").hasClass("mejs-container-fullscreen")){that.fixIEControls(false);}else{that.fixIEControls(true);}}});},pauseVideo:function(elem,moreElems){var alreadyPlayed=elem.attr("data-played");this.inMotionteaser=($(elem).parents(".pagingteaser.motionteaser").length>0||$(elem).parents(".pagingteaser.coverstory").length>0)?true:false;if(this.inMotionteaser&&(alreadyPlayed=="false"||!alreadyPlayed)){return;}$(elem).find(".mejs-container").each(function(){var objectId=$(this).attr("id");var posterElem=$("#"+objectId).find(".mejs-poster");for(var i=0;i<mejs.players.length;i++){if(mejs.players[i].id==objectId){mejs.players[i].pause();mejs.players[i].setCurrentTime(0);mejs.players[i].setCurrentRail();mejs.players[i].showControls();posterElem.show();}}});},reinitializeVideoElem:function(elem){var videoCount=$(elem).find("video").length;if((!isTouch&&$(elem).data("plugintype")=="native")||videoCount<1){return;}if(isTouch!="undefined"||(isIE()&&isTouch=="undefined"&&$(elem).data("plugintype")!="native")){$(elem).attr("data-played","false");var videoIdToDelete=$(elem).find(".mejs-container").attr("id"),i;var playerLength=mejs.players.length;for(i=0;i<playerLength;i++){if(mejs.players[i].id==videoIdToDelete){mejs.players.remove(i);}}var actTeaser=$(elem).find(".content .video").length!=0?$(elem).find(".content .video"):$(elem).find(".content");var playerId=$(elem).find("video").attr("id");var attributes=$("#"+playerId).getAttributes();var videoSrc=($("#"+playerId+" source:first").attr("src")!==undefined)?$("#"+playerId+" source:first").attr("src"):$("#"+playerId).attr("src");var videoType=($("#"+playerId+" source:first").attr("type")!==undefined)?$("#"+playerId+" source:first").attr("type"):$("#"+playerId).attr("type");var i=0,attributeNames=[],attributeValues=[];$(actTeaser).empty().append('<video id="'+playerId+'" />');for(key in attributes){if(key!="player"){if(attributes.hasOwnProperty(key)){attributeNames[i]=key;attributeValues[i]=attributes[key];i++;}}}for(i=0;i<attributeNames.length;i++){if(attributeValues[i]!="null"&&attributeValues[i]!=""&&attributeValues[i]!="0"){$("#"+playerId).attr(attributeNames[i],attributeValues[i]);}}$("#"+playerId).attr("src",videoSrc);$("#"+playerId).attr("type",videoType);new Videohandling($("#"+playerId));}},fixIEControls:function(isFullscreen){if(isFullscreen==true){this.mediaElem.parents(".mejs-inner").find(".mejs-layers").append('<div class="mejs-ieclickfix"></div>');$("#contentwrap").css("z-index","1000001");$(".col-marginal").css("visibility","hidden");$("#breadcrumbs").css("visibility","hidden");$("#header").css("visibility","hidden");$("#stickyfooter").css("visibility","hidden");$(".pager.prev").css("visibility","hidden");$(".pager.next").css("visibility","hidden");$("ul.squarenav").css("visibility","hidden");$(".hls-layer","#hlsplus").css("visibility","hidden");$(".hls-layer","#hlsplus").has("div.video").css("visibility","");}else{$(".mejs-ieclickfix").remove();$("#contentwrap").css("z-index","");$(".col-marginal").css("visibility","");$("#breadcrumbs").css("visibility","");$("#header").css("visibility","");$("#stickyfooter").css("visibility","");$(".pager.prev").css("visibility","");$(".pager.next").css("visibility","");$("ul.squarenav").css("visibility","");$(".hls-layer","#hlsplus").css("visibility","");$(".hls-layer","#hlsplus").has("div.video").css("z-index","5000").css("display","block");}}};var markActive=function(theone,all,idx){var alllinks=$("a",all);alllinks.each(function(){$(this).removeClass("active");$(".previewbubble, .previewnurple",this).hide();});if(theone!=""){$(theone).addClass("active");}else{if(idx>=0){alllinks.eq(idx).addClass("active");}}};var SmallInlineOverviewDisplay=function(elem){this.init(elem);};SmallInlineOverviewDisplay.prototype={timeoutLeave:null,timeoutEnter:null,init:function(elem){this.$pagingteaser=$(elem);this.$wrap=$(".teaserwrap",this.$pagingteaser);this.$tsr=$(".teaser",this.$pagingteaser);this.$overView=null;this.descriptionData=null;if((this.$wrap.size()==0)||(this.$tsr.size()<2)){return;}this.showOverView();},clickOverViewThumb:function(event){event.preventDefault();var target=event.currentTarget;var currentTeasers=$(".teaser",this.$pagingteaser);var actualTeaser=currentTeasers[0];if($(actualTeaser).data("contenttype")=="video"){Videohandling.prototype.reinitializeVideoElem(actualTeaser);}var teaserSelected=$(target).data("myTeaser");markActive(target,this.$overView);var indexOfSelectedTeaser=currentTeasers.index(teaserSelected);if(indexOfSelectedTeaser>0){for(var i=0;i<indexOfSelectedTeaser;i++){this.$wrap.append(currentTeasers.eq(i));}$(".teaser",this.$pagingteaser).each(function(i,teaser){$(teaser).css("left",i*100+"%");});}},XXmarkActive:function(theone,all){$("a",all).each(function(){$(this).removeClass("active");$(".previewbubble, .previewnurple",this).hide();});$(theone).addClass("active");},showBubble:function(ev){var l=ev.currentTarget;var bubble=$(".previewbubble, .previewnurple",l);if($(window).width()<=1210){bubble.addClass("offsleft");}else{bubble.removeClass("offsleft");}bubble.fadeIn(300);},hideBubble:function(ev){var l=ev.currentTarget;$(".previewbubble, .previewnurple",l).fadeOut(300);},showOverView:function(){if(!this.$overView){this.buildOverView();}this.$overView.show();},buildOverView:function(){this.$overView=$(".smalloverview",this.$pagingteaser).first();if(this.$pagingteaser.attr("data-descContent")){this.descriptionData={content:this.$pagingteaser.attr("data-descContent")};}var that=this;if(this.$overView.size()==0){var struct='<div class="page smalloverview"><ul class="squarenav">';this.$tsr.each(function(i,tsr){var descr=that.descriptionData.content.replace(/#ALL/i,that.$tsr.size()).replace(/#CURRENT/i,i+1);struct+='<li><a href="#a"'+(i==0?' class="active"':"")+">";if($(tsr).data("previewimg")){struct+='<div class="previewbubble">';struct+='<img src="'+$(tsr).data("previewimg")+'" alt="" />';struct+="<p>"+descr+"</p>";struct+="</div>";struct+='<div class="previewnurple"></div>';}struct+="</a></li>";});struct+="</ul></div>";this.$overView=$(struct).appendTo(this.$pagingteaser);$("a",this.$overView).each($.proxy(function(i,link){$(link).data("myTeaser",this.$tsr[i]);$(link).click($.proxy(this.clickOverViewThumb,this)).hover($.proxy(this.showBubble,this),$.proxy(this.hideBubble,this));},this));}}};var OverviewDisplay=function(elem){this.init(elem);};OverviewDisplay.prototype={init:function(elem){this.$pagingteaser=$(elem);this.$btnOverView=$(".btn-overview",this.$pagingteaser).first();this.$btnSingleView=$(".btn-singleview",this.$pagingteaser).first();this.$wrap=$(".teaserwrap",this.$pagingteaser);this.$tsr=$(".teaser",this.$pagingteaser);this.$overView=null;if((this.$btnOverView.size()==0)||(this.$btnSingleView.size()==0)||(this.$wrap.size()==0)||(this.$tsr.size()<2)){return;}$(this.$btnOverView).click($.proxy(this.clickOverView,this));$(this.$btnSingleView).click($.proxy(this.clickSingleview,this));},clickOverView:function(event){this.showOverView();},clickSingleview:function(event){this.hideOverView();},clickOverViewBG:function(event){this.hideOverView();},clickOverViewThumb:function(event){event.preventDefault();var target=event.currentTarget;var currentTeasers=$(".teaser",this.$pagingteaser);var teaserSelected=$(target).data("myTeaser");var indexOfSelectedTeaser=currentTeasers.index(teaserSelected);if(indexOfSelectedTeaser>0){for(var i=0;i<indexOfSelectedTeaser;i++){this.$wrap.append(currentTeasers.eq(i));}$(".teaser",this.$pagingteaser).each(function(i,teaser){$(teaser).css("left",i*100+"%");});}this.hideOverView();},showOverView:function(){this.$btnOverView.trigger("mouseleave");if(!this.$overView){this.buildOverView();}if(!isIE()||isIE(9)){this.$overView.fadeIn(400);this.$btnSingleView.fadeIn(400);this.$btnOverView.fadeOut(400);}else{this.$overView.show();this.$btnSingleView.show();this.$btnOverView.hide(400);}$(".pager",this.$pagingteaser).each(function(index,elm){if(!isIE()||isIE(9)){$(elm).fadeOut(400);}else{$(elm).hide();}});},hideOverView:function(){this.$btnSingleView.trigger("mouseleave");if(!isIE()||isIE(9)){this.$overView.fadeOut(400);this.$btnOverView.fadeIn(400);this.$btnSingleView.fadeOut(400);}else{this.$overView.hide();this.$btnOverView.show();this.$btnSingleView.hide();}$(".pager",this.$pagingteaser).each(function(index,elm){if(!isIE()||isIE(9)){$(elm).fadeIn(400);}else{$(elm).show();}});},buildOverView:function(){this.$overView=$(".overview",this.$pagingteaser).first();if(this.$overView.size()==0){var struct='<div class="overview"><ul>';this.$tsr.each(function(i,tsr){struct+='<li><a href="#">';struct+='<img src="'+$(tsr).data("previewimg")+'" alt="" />';struct+="</a></li>";});this.$overView=$(struct).appendTo(this.$pagingteaser);var liElms=$("li",this.$overView);$("li",this.$overView).each(function(i,elm){if((i+1)%3!=1){$(elm).css("margin-right","0");}if((i+1)%3==0){$(elm).css("float","right");}if(i>5){$(elm).css("margin-bottom","0");}});$(this.$overView).click($.proxy(this.clickOverViewBG,this));$("a",this.$overView).each($.proxy(function(i,link){$(link).data("myTeaser",this.$tsr[i]);$(link).click($.proxy(this.clickOverViewThumb,this));},this));}}};var ModalLinksHandling=function(elem,params){this.init(elem,params);};ModalLinksHandling.prototype={init:function(elem,params){params=params?params:{};this.$elem=$(elem);this.$modalContent=$("#simplemodal-content");if(this.$modalContent.size()==0){this.$modalContent=$('<div id="simplemodal-content" style="display:none;"></div>').appendTo($("body"));}this.modalURL=params.modalURL||this.$elem.data("modalurl")||this.$elem.attr("href");this.closeText=params.closeText||this.$elem.data("txt-closemodal")||"";if(this.closeText.length==0){if(config&&config["modal.closetext"]){this.closeText=config["modal.closetext"];}}this.data=(typeof params.data!="object")?{}:params.data;if(typeof params.method=="string"){this.method=params.method.toLowerCase();}else{this.method="";}if((this.method!="get")&&(this.method!="post")){this.method="post";}if(!(this.modalURL)||this.modalURL.length==0){return;}this.boundClickFunc=$.proxy(function(e){if($(e.currentTarget).hasClass("modal-active")){e.preventDefault();if(params.type=="internal"){var data=$(this.modalURL).html();this.$modalContent.html(data);this.openModal(this.closeText);$.modal.setPosition();}else{$.ajax(this.modalURL,{context:this,type:this.method,data:this.data,dataType:"html",success:function(data,textStatus,jqXHR){this.$modalContent.html(data);this.openModal(this.closeText);$.modal.setPosition();}});}var trackingname=$(e.currentTarget).data("trackingname")||"";if(trackingname){var title=$(e.currentTarget).data("trackingtitle")||$('meta[name="WT.ti"]').attr("content")||$("title").text();var trackingUriText="/"+$(e.currentTarget).data("trackinguri")||"";var pathDCSdcsuri=$('meta[name="DCS.dcsuri"]').attr("content")||"";var pathWTes=$('meta[name="WT.es"]').attr("content")||"";dcsMultiTrack("WT.ti",title,"DCS.dcsuri",pathDCSdcsuri+trackingUriText,"WT.es",pathWTes+trackingUriText,"DCSext.content_cat",trackingname);}}},this);if(params.autoOpen){if(params.type=="internal"){var data=params.modalURL;this.$modalContent.html(data);this.openModal(this.closeText);$.modal.setPosition();}else{var that=this;$.ajax(this.modalURL,{context:this,type:this.method,data:this.data,dataType:"html",success:function(data,textStatus,jqXHR){this.$modalContent.html(data);this.openModal(this.closeText);$.modal.setPosition();}});}}else{this.$elem.addClass("modal-active");this.$elem.click(this.boundClickFunc);}},openModal:function(closeText){var that=this;this.$modalContent.modal({autoResize:true,overlayClose:true,zIndex:1000002,closeHTML:'<a href="#close" class="simplemodal-close ttip" title="'+closeText+'"></a>',opacity:75,fixed:false,persist:false,onOpen:function(dialog){if(that.$elem.data("class")){$("#simplemodal-container").addClass(that.$elem.data("class"));}dialog.overlay.fadeIn(400,function(){dialog.data.show();dialog.container.fadeIn(400,function(){});enhance($("#simplemodal-container"));$("#simplemodal-container a.closemodal").click(function(e){e.preventDefault();$.modal.close();});that.initAdditionalLinks();that.initModalChangeLinks();that.initModalForms();setTimeout(function(){$.modal.setPosition();that.fixPos();},1);$("#simplemodal-container").css("width","auto");$("#simplemodal-container .simplemodal-wrap").css("width","auto");$(window).resize(function(){that.fixPos();});});},onClose:function(dialog){$("#ttlayer").hide();dialog.container.fadeOut(400,function(){dialog.overlay.fadeOut(400,function(){$.modal.close();$("#simplemodal-content").remove();});});}});},fixPos:function(){var tmpOffs=$(".simplemodal-container").offset();if(!tmpOffs){return;}var topPos=tmpOffs.top;$(".simplemodal-container .simplemodal-wrap").css("overflow","hidden");if(topPos<10){$(".simplemodal-container").css("top","10px");}},removeEvent:function(){this.$elem.unbind("click",this.boundClickFunc);},initAdditionalLinks:function(){var that=this;$("#simplemodal-container .modaloverlay").each(function(){that.init($(this),{});});},initModalChangeLinks:function(){var that=this;$(".modalchange").each(function(){$(this).click(function(e){e.preventDefault();var contentURL=$(this).attr("href");$.get(contentURL,function(data){that.$modalContent.html(data);}).success(function(){$.modal.setPosition();});});});},initModalForms:function(){var that=this;$("form.modalform").submit(function(e){var f=$(this);var errorText=f.data("errortext")||"Connection error. Please try again later.";var formAction=f.attr("action");var formParams=new Object();if($(this).attr("id")=="voucherform"){var ajaxUrl=f.data("ajaxurl");that.handleVoucherForm(this,ajaxUrl);return false;}else{e.preventDefault();$(":input",this).each(function(){formParams[this.name]=this.value;});var result=$.ajax({type:"POST",timeout:9000,data:formParams,url:formAction,success:function(result){$("#simplemodal-content").html(result);enhance($("#simplemodal-content"));that.initModalForms();},error:function(){$("#modal_form_error").text(errorText);$("#modal_form_error").show();},dataType:"html"});}});},handleVoucherForm:function(form,ajaxUrl){var f=$(form);var errorText=f.data("errortext")||"Connection error. Please try again later.";var formTimeout=f.data("timeout")||"5000";var formParams=f.serialize();$("#submitpin").addClass("disabled").attr("disabled",true);$("#loadingicondiv").show();var result=$.ajax({type:"POST",timeout:formTimeout,data:formParams,url:ajaxUrl,success:function(result){var response=$.trim(result)||errortext;if(response=="ok"){form.submit();$("form.std.modalform div.form-row").removeClass("error-row");$("#modal_form_error strong").text("");$("#loadingicondiv").hide();}else{if(response=="ShowPinCode"){$("#modal_form_error strong").text("");$("form.std.modalform div.form-row").removeClass("error-row");$("p.code-correct").remove();var vouchercode=$("#vouchercode").val();$("#submitcode").hide();$("#egcarea").show();$("#loadingicondiv").hide();$("#submitpin").removeClass("disabled").attr("disabled",false);}else{if($("#egcarea:visible").length>0){$("form.std.modalform div#egcarea.form-row").addClass("error-row");}else{$("form.std.modalform div.form-row").addClass("error-row");}$("#modal_form_error strong").text(response);$("#modal_form_error").show();$("#loadingicondiv").hide();$("#submitpin").removeClass("disabled").attr("disabled",false);}}},error:function(result){$("form.std.modalform div.form-row").addClass("error-row");$("#modal_form_error strong").text(errorText);$("#modal_form_error").show();$("#submitpin").removeClass("disabled").attr("disabled",false);$("#loadingicondiv").hide();},dataType:"text"});}};var Formularvalidator=function(elem,params){this.init(elem,params);};Formularvalidator.prototype={init:function(elem,params){params=params?params:{};var that=this;this.$elem=$(elem);this.submitButton=this.$elem.find("input[type=submit]");this.formRows=this.$elem.find(".form-row.required-field");this.countRequired=this.$elem.find(".form-row.required-field").length;this.completedFields=[];if(this.countRequired<1||this.countRequired===undefined){return;}this.prepareFields();this.checkSubmitButton();},prepareFields:function(){var that=this;$(this.formRows).each(function(i){var fieldsetInvisible=$(this).parents("fieldset").hasClass("invisible")||$(this).hasClass("invisible");var input=$(this).find("input");var textarea=$(this).find("textarea");var select=$(this).find("select");var countInputs=input.length,countTextareas=textarea.length,countSelects=select.length;if(countInputs>0){if(input.hasClass("disabled-text")){that.completedFields[i]="skip";}else{if(input.is(":visible")&&!fieldsetInvisible){var type=input.attr("type"),j;if(countInputs>1){if(type=="checkbox"||type=="radio"){that.completedFields[i]=false;for(j=0;j<countInputs;j++){if($(input[j]).prop("checked")){that.completedFields[i]=true;break;}}$(input).on("keyup change blur",function(){that.checkRequiredField($(input),i);});}else{if(type=="text"||type=="password"){that.completedFields[i]=false;var tmpBool=true;for(j=0;j<countInputs;j++){if(!$(input[j]).val()||$(input[j]).val()==""){tmpBool=false;}}that.completedFields[i]=tmpBool;$(input).on("keyup change blur",function(){that.checkRequiredField($(input),i);});}}}else{if(type=="checkbox"||type=="radio"){that.completedFields[i]=$(input).prop("checked")?true:false;}else{if(type=="text"||type=="password"){that.completedFields[i]=$(input).val()&&$(input).val()!=""?true:false;}}$(input).on("keyup change blur",function(){that.checkRequiredField($(input),i);});}}else{that.completedFields[i]="skip";}}}else{if(countTextareas>0&&!fieldsetInvisible){if(textarea.is(":visible")){that.completedFields[i]=$(textarea).val()&&$(textarea).val()!=""?true:false;$(textarea).on("keyup change blur",function(){that.checkRequiredField($(textarea),i);});}else{that.completedFields[i]="skip";}}else{if(countSelects>0&&!fieldsetInvisible){that.completedFields[i]=($(select).val()!=""&&$(select).val()!="-"&&$(select).val()!=" ")?true:false;$(select).siblings().find("ul a").on("click",function(){that.checkRequiredField($(this),i);});}else{that.completedFields[i]="skip";}}}});},checkSubmitButton:function(){$(this.submitButton).removeClass("disabled");var that=this;var j,length=that.completedFields.length;for(j=0;j<length;j++){if(!that.completedFields[j]&&that.completedFields[j]!="skip"){$(this.submitButton).addClass("disabled");break;}}},checkRequiredField:function(elem,i){var that=this;var $elem=$(elem);var type=$elem.attr("type");var data=$elem.data("value");$(this.submitButton).removeClass("disabled");if(type=="checkbox"||type=="radio"){that.completedFields[i]=$elem.prop("checked")?true:false;}else{if(type===undefined&&data!=="undefined"){that.completedFields[i]=(data!=""&&data!=" "&&data!="-")?true:false;}else{if($elem.length==1){that.completedFields[i]=$elem.val()&&$elem.val()!=""?true:false;}else{var tmpBool=true;for(j=0;j<$elem.length;j++){if(!$(elem[j]).val()||$(elem[j]).val()==""){tmpBool=false;}}that.completedFields[i]=tmpBool;}}}var j,length=that.completedFields.length;for(j=0;j<length;j++){if(!that.completedFields[j]){$(this.submitButton).addClass("disabled");break;}}},reInit:function(visible){var that=this;var i=0,length=that.completedFields.length;if(visible){for(i=0;i<length;i++){if(that.completedFields[i]=="skip"){that.completedFields[i]=false;}}}else{that.completedFields=[];}that.prepareFields();that.checkSubmitButton();}};var SlideShow=function(elem,params,name){this.init(elem,params,name);};SlideShow.prototype={arrlength:0,id:0,init:function(elem,params,name){var that=this;this.slideshowname=name;this.$elem=$(elem);this.params=params||{};this.ttPlay=this.params.play?this.params.play:"Play";this.ttPause=this.params.pause?this.params.pause:"Pause";this.ttPrev=this.params.previous?this.params.previous:"Previous";this.ttNext=this.params.next?this.params.next:"Next";this.toggle=this.params.toggle?this.params.toggle:"false";this.autoplay=this.params.autoplay?this.params.autoplay:"false";this.delay=this.params.delay?parseInt(this.params.delay):4000;this.blend=this.params.blend?parseInt(this.params.blend):400;this.width=this.params.width?this.params.width:"600";this.height=this.params.height?this.params.height:"379";this.sIndex=-1;this.picRealData=new Array();this.hidden=false;this.textout=false;this.fs_active=false;this.type=this.params.type?this.params.type:"std";this.imgArr=this.params.images;SlideShow.arrlength=this.imgArr.length;for(var i=0;i<this.imgArr.length;i++){this.imgArr[i].loaded=false;}this.$elem.css({width:this.width,height:this.height});this.fs_text=(this.fsbutton=="true")?'<li class="dFullscreen dSlideShow-fr ttip" title="'+this.ttFullscreen+'"></li>':"";this.fsbutton="false";this.fs_text="";this.content='<div class="dSlideShow-wrapper loading">\n							<div class="dSlideShow-pic">\n								<div class="dSlideShow-pic-container"></div>\n							</div>\n							<div class="dSlideShow-slidedown">\n								<div class="dSlideShow-controls"><ul class="dSlideShow-controls-list"><li class="dPlay ttip" title="'+this.ttPlay+'"></li><li class="dPause ttip" title="'+this.ttPause+'"></li><li class="fr ttip dCount"></li><li class="dNext ttip fr" title="'+this.ttNext+'"></li><li class="dPrev ttip fr" title="'+this.ttPrev+'"></li>'+this.fs_text+"</ul></div>\n							</div>\n							</div>";this.$elem.append(this.content);this.$elem.parents().eq(0).append($("<div />").addClass("dSlide-textBox").css("width",this.width));this.$elem.find(".dSlideShow-wrapper").css("width",this.width);this.$elem.find(".dSlideShow-pic").css("height",this.height);if(this.toggle=="true"){this.$elem.find(".dSlideShow-slidedown").addClass("dSlide-b20");this.$elem.find(".dSlideShow-wrapper").addClass("dSlide-mb-20");}if(SlideShow.arrlength<2){this.$elem.find(".dSlideShow-slidedown").hide();}this.bindKeys();this.toggleControls();this.toolTip();this.nextPic();if(this.autoplay!="false"){this.autoPlay("start");that.$elem.find("li.dPlay").css("visibility","hidden");that.$elem.find("li.dPause").css("visibility","visible");}},toggleControls:function(){var that=this;this.$elem.mouseout(function(){if(that.hidden==false&&that.toggle=="true"){that.$elem.find(".dSlideShow-controls").delay(2000).animate({height:"hide",opacity:"hide"},"slow");that.hidden=true;}});this.$elem.find("div.dSlideShow-controls").mouseover(function(){$(this).stop(true,true).css("opacity","1");that.hidden=false;});this.$elem.mouseover(function(){if(that.hidden==true&&that.toggle=="true"){that.$elem.find(".dSlideShow-controls").stop(true,true).animate({height:"show",opacity:"show"},"fast");that.hidden=false;}});},bindKeys:function(){var that=this;this.$elem.find("li.dPlay").click(function(){that.autoPlay("start");$(this).css("visibility","hidden");that.$elem.find("li.dPause").css("visibility","visible");});this.$elem.find("li.dPause").click(function(){that.autoPlay("stop");$(this).css("visibility","hidden");that.$elem.find("li.dPlay").css("visibility","visible");});this.$elem.find("li.dNext").click(function(){that.nextPic();that.$elem.find("li.dPause").click();});this.$elem.find("li.dPrev").click(function(){that.prevPic();that.$elem.find("li.dPause").click();});},autoPlay:function(doit){var that=this;if(doit=="start"){SlideShow.id=setInterval(function(){that.nextPic();},that.delay);}else{clearInterval(SlideShow.id);that.$elem.find("li.dPlay").css("visibility","visible");that.$elem.find("li.dPause").css("visibility","hidden");}},nextPic:function(){var that=this;if(that.sIndex<(SlideShow.arrlength-1)){var lastId=that.sIndex;var nextPic=++that.sIndex;if(!that.imgArr[nextPic].loaded){that.loadPic(nextPic,lastId);that.imgArr[nextPic].loaded=true;}else{that.showPic(nextPic,lastId);}var overNext=parseInt(that.sIndex)+2;if(overNext<=(SlideShow.arrlength-1)&&!that.imgArr[overNext].loaded){var img=new Image();img.src=that.imgArr[overNext].src;}}else{that.sIndex=-1;that.nextPic();}},prevPic:function(){var that=this;if(that.sIndex>0){var lastId=that.sIndex;var prevPic=--that.sIndex;if(!that.imgArr[prevPic].loaded){that.loadPic(that.sIndex,lastId);that.imgArr[prevPic].loaded=true;}else{that.showPic(prevPic,lastId);}}else{that.sIndex=SlideShow.arrlength;that.prevPic();}},showPic:function(showPic,lastId){var that=this;that.$elem.find(".dSlideShow-pic-container img").parent().removeClass("dSlideTop");that.$elem.find(".dSlideShow-pic-container img").parent().removeClass("dSlideLast");var pic=that.$elem.find("#"+that.slideshowname+"pic"+showPic);var last=that.$elem.find("#"+that.slideshowname+"pic"+lastId);last.parent().removeClass("dSlideTop").addClass("dSlideLast");that.$elem.find(".dSlideShow-pic-container div").removeClass("dSlideTopDiv");pic.addClass("dSlideTop").parent().addClass("dSlideTopDiv").css({opacity:"0"});pic.parent().animate({opacity:"1"},that.blend);var textCount=(showPic+1)+" | "+SlideShow.arrlength;that.$elem.find("li.dCount").html(textCount);setContent(that.$elem.find(".dSlide-titleTitle"),that.imgArr[showPic].title.toUpperCase());if(this.type=="products"){var productContent="<p>"+that.imgArr[showPic].description+"</p>";productContent+='<div class="pricebox">';productContent+='<span class="price">'+that.imgArr[showPic].price+"</span>";productContent+='<a href="'+that.imgArr[showPic].linkurl+'" class="buy">'+that.imgArr[showPic].linktext+"</a>";productContent+="</div>";productContent+='<span class="more">'+that.imgArr[showPic].more+"</span>";setContent($(".dSlide-textBox"),productContent);}else{setContent($(".dSlide-textBox"),that.imgArr[showPic].title);}function setContent(what,content){$(what).fadeOut(200,function(){$(what).html(content);});$(what).fadeIn(200);}},loadPic:function(id,lastId){var that=this;var img=new Image();var src=that.imgArr[id].src;var href=that.imgArr[id].href;var hreftarget=that.imgArr[id].hreftarget;$(img).load(function(){var me=document.createElement("div");$(me).addClass("dSlideShowBG z100");$(me).append(this);that.$elem.find(".dSlideShow-pic-container").append(me);var addDimAttr;if(that.fs_active){$(img).addClass("dSlide-img-fs");addDimAttr=(img.height>img.width)?{height:window.innerHeight}:{width:window.innerWidth};}else{var ratio=img.width/img.height,w,h;if(that.width>that.height){w=that.width;h=Math.ceil(w/ratio);if(h>that.height){h=that.height;w=Math.ceil(h*ratio);}}else{h=that.height;w=Math.ceil(h*ratio);if(w>that.width){w=that.width;h=Math.ceil(w/ratio);}}addDimAttr={height:h,width:w};$(img).css("position","absolute");if(w<that.width){var left=Math.ceil((that.width-w)/2);$(img).css("left",left+"px");}else{if(h<that.height){var top=Math.ceil((that.height-h)/2);$(img).css("top",top+"px");}}}$(img).attr(addDimAttr);$(me).css({width:that.width,height:that.height});that.imgArr[id].loaded=true;if(href){$(img).click(function(ev){if(hreftarget){window.open(href,hreftarget);}else{self.location.href=href;}}).css("cursor","pointer");}if((isIE(7)||isIE(8))&&lastId>=0){setTimeout(function(){that.showPic(id,lastId);},10);}else{that.showPic(id,lastId);}}).error(function(){}).attr({src:src,id:that.slideshowname+"pic"+id,"class":"z100 dSlideTop"});},toolTip:function(){var that=this;that.$elem.find(".ttip").each(function(){$(this).append($("<span/>").attr("class","dSlide-ttip").html($(this).attr("title"))).attr("title","");});that.$elem.find("li > span").css("left",function(){var newLeft;var paddingWidth=parseInt($(this).css("padding-left"))+parseInt($(this).css("padding-right"));var thisWidth=$(this).width()+paddingWidth;var leftOffset=$(this).parent().position().left;newLeft=(((thisWidth/2)*-1)+($(this).parent().width()/2));if((leftOffset+newLeft+thisWidth)>that.width){newLeft=(that.width-thisWidth-leftOffset);}else{if((newLeft+leftOffset)<0){newLeft=0;}}return newLeft;});that.$elem.find("li").hover(function(){$(this).find("span").stop(true,true).delay(1000).fadeIn(400);},function(){$(this).find("span").stop(true,true).delay(100).fadeOut(200);});}};var EmbeddedSlideshow=function(i,elem,options){this.init(i,elem,options);};EmbeddedSlideshow.prototype={init:function(i,elem,options){this.$elem=$(elem);this.$pager=this.$elem.find("div.pager");this.$pagerlinks=this.$elem.find("div.pager a");this.$imageContainer=this.$elem.find("div.bigimg");this.$thumbnailContainer=this.$elem.find("div.thumbs");this.$thumbnailListElems=this.$elem.find("div.thumbs li");this.$thumbnailLinks=this.$elem.find("div.thumbs a");this.hasOptionalTexts=(this.$thumbnailListElems.find("span.text").length>0)?true:false;this.isExtendedSlideshow=(this.$elem.hasClass("extended"))?true:false;if(this.hasOptionalTexts==true){this.$textElement=$('<div class="text"></div>').appendTo(this.$imageContainer);}this.animating=false;this.options=jQuery.extend({isTouch:isTouch},(options||{}));if(this.isExtendedSlideshow=true){this.$contentholder=this.$elem.find("div.contentholder");this.$contentholderElems=this.$elem.find("div.contentholder > div");$(this.$contentholderElems[0]).show();}this.fixPositions();this.bindEvents();var t=this,initImg=this.$imageContainer.find("img");if(initImg.length){var iiSrc=initImg.attr("src"),ts=new Date().getTime();initImg.attr("src",iiSrc+(iiSrc.indexOf("?")!=-1?"&":"?")+"load"+ts);}else{initImg=$('<img src="'+this.$thumbnailLinks.filter(".active").attr("href")+'" alt="" class="new" />').prependTo(this.$imageContainer);}initImg.load(function(){t.fixImgPos($(this));$(this).animate({opacity:"1"},800);});},fixPositions:function(){var t=this,newPos,elemWidth,thumbnaillistWidth,margin,extraHeight,$optionalTextElem,optionalText="";if(this.hasOptionalTexts==true){$optionalTextElem=$(this.$thumbnailListElems[0]).find("span.text");if($optionalTextElem.length>0){optionalText=$optionalTextElem.html();this.$textElement.html("<p>"+optionalText+"</p>");}}this.elemHeight=this.$elem.find("div.bigimg").height();extraHeight=this.$elem.find("div.text").outerHeight();this.$imageContainer.css("height",parseInt(this.elemHeight+extraHeight)+"px");this.pagerlinksHeight=this.$pagerlinks.height();newPos=(this.elemHeight/2)-(this.pagerlinksHeight/2);this.$pagerlinks.css({top:newPos+"px",margin:"0"});this.$pager.css("height",this.elemHeight);this.bgColor=convertHexToRGB("595959");this.bgHoverColor=jQuery.extend({},this.bgColor);this.bgColor.a=0.3;this.bgHoverColor.a=0.5;setTransparentBackgroundColor(this.$pagerlinks,this.bgColor);this.$pagerlinks.hover(function(){setTransparentBackgroundColor($(this),t.bgHoverColor);},function(){setTransparentBackgroundColor($(this),t.bgColor);});},bindEvents:function(){var t=this,originalHref,html,direction,$activeListElem,$optionalTextElem,optionalText="";this.$thumbnailLinks.on("click",function(ev){ev.preventDefault();if(t.animating==true){return;}t.animating=true;$(t.$imageContainer.find("span.text")).remove();t.$thumbnailLinks.removeClass("active");$(this).addClass("active");if(t.hasOptionalTexts==true){$optionalTextElem=$(this).parent("li").find("span.text");t.$textElement.empty();if($optionalTextElem.length>0){optionalText=$optionalTextElem.html();t.$textElement.html("<p>"+optionalText+"</p>");}}originalHref=$(this).attr("href");html=$('<img src="'+originalHref+'" alt="" class="new" />').prependTo(t.$imageContainer);if(t.isExtendedSlideshow=true){var activateContentDiv=$(this).parents("li").index();$(t.$contentholderElems).css({display:"none"});$(t.$contentholderElems[activateContentDiv]).css({display:"block",opacity:"0"}).stop().animate({opacity:"1"},800);}t.$fadeinImg=t.$imageContainer.find("img")[0];t.$fadeoutImg=t.$imageContainer.find("img")[1];$(t.$fadeinImg).load(function(){t.fixImgPos($(this));$(t.$fadeinImg).css({opacity:"0"}).stop().animate({opacity:"1"},800);$(t.$fadeoutImg).css({opacity:"1"}).stop().animate({opacity:"0"},800,function(){$(this).remove();t.animating=false;});});});this.$pagerlinks.on("click",function(ev){ev.preventDefault();direction=$(this).attr("class");$activeListElem=t.$thumbnailListElems.find("a.active").parent("li");totalElems=(t.$thumbnailListElems.length-1);switch(direction){case"next":if($activeListElem.next("li").length>0){$activeListElem.next("li").find("a").trigger("click");}else{$(t.$thumbnailListElems[0]).find("a").trigger("click");}break;case"prev":if($activeListElem.prev("li").length>0){$activeListElem.prev("li").find("a").trigger("click");}else{$(t.$thumbnailListElems[totalElems]).find("a").trigger("click");}break;default:break;}});},fixImgPos:function(img){var t=this,imgH=img.height(),imgW=img.width(),contH=t.elemHeight,contW=t.$imageContainer.width(),posLeft=0,posTop=0,imgOptions,contRatio=contW/contH,imgRatio=imgW/imgH;if(contRatio>imgRatio){imgOptions={height:contH,width:"auto"};img.css(imgOptions);posLeft=(contW-img.width())/2;img.css({left:posLeft});}if(contRatio<imgRatio){imgOptions={width:contW,height:"auto"};img.css(imgOptions);posTop=(contH-img.height())/2;img.css({top:posTop});}}};var GiftcategoriesHandler=function(jsonObject){this.init(jsonObject);};GiftcategoriesHandler.prototype={init:function(jsonObject){this.data=jsonObject;this.categories=this.data.categories;this.categoriesCount=this.data.categories.length;this.subcategories={};this.subcategoriesCount=0;this.priceranges=[];this.pricerangesCount=0;this.fillCategories();this.handleCategories();this.handleSubcategories();},fillCategories:function(){var i,categoryName,categoryValue,html,extraAttribute;var $selectField=$("#category");$selectField.empty();for(i=0;i<this.categoriesCount;i++){categoryName=this.categories[i].categoryName;categoryValue=this.categories[i].categoryValue;extraAttribute=(i==0)?extraAttribute=' data-invisible="true"':extraAttribute="";html=$('<option value="'+categoryValue+'" data-index="cat-'+i+'"'+extraAttribute+">"+categoryName+"</option>").appendTo($selectField);}},handleCategories:function(){var that=this,selectedCategoryIndex;$("#category-mirror-pd a").live("click",function(){selectedCategoryIndex=$("#category option:selected").data("index").substr(4);that.subcategories=that.data.categories[selectedCategoryIndex].subcategories;that.priceranges=that.data.categories[selectedCategoryIndex].priceranges;that.pricerangesCount=that.priceranges.length;if(that.subcategories!==undefined){that.subcategoriesCount=that.subcategories.length;that.switchSubcategory();}that.switchPriceranges();});},switchSubcategory:function(){var that=this,i,subcategoryName,subcategoryValue,html;var $selectField=$("#product");var noCategory=$selectField.find("option:first").html();$selectField.empty();$("#product-mirror").remove();html=$('<option value="" data-invisible="true">'+noCategory+"</option>").appendTo($selectField);for(i=0;i<this.subcategoriesCount;i++){subcategoryName=this.subcategories[i].subcatName;subcategoryValue=this.subcategories[i].subcatValue;html=$('<option value="'+subcategoryValue+'" data-index="subcat-'+i+'">'+subcategoryName+"</option>").appendTo($selectField);}this.handleSubcategories();$selectField.removeClass("disabled");jsPulldowns.push(new JSPulldown($selectField,{followLink:false,selectPulldown:true}));},handleSubcategories:function(){var that=this,selectedSubcategoryIndex;$("#product-mirror-pd a").live("click",function(){selectedSubcategoryIndex=$("#product option:selected").data("index").substr(7);that.priceranges=that.subcategories[selectedSubcategoryIndex].priceranges;if(that.priceranges!==undefined){that.pricerangesCount=that.priceranges.length;that.switchPriceranges();}});},switchPriceranges:function(){var that=this,i,pricerange,html="";var $selectField=$("#price");var allPrices=$selectField.find("option:first").html();$selectField.empty();$("#price-mirror").remove();html=$('<option value="" data-invisible="true">'+allPrices+"</option>").appendTo($selectField);for(i=0;i<this.pricerangesCount;i++){pricerange=this.priceranges[i];html=$('<option value="'+pricerange+'" data-index="subcat-'+i+'">'+pricerange+"</option>").appendTo($selectField);}$selectField.removeClass("disabled");jsPulldowns.push(new JSPulldown($selectField,{followLink:false,selectPulldown:true}));}};var ProvinceCityDistrictHandler=function(jsonObject){this.init(jsonObject);};ProvinceCityDistrictHandler.prototype={init:function(jsonObject){this.data=jsonObject;this.fields=this.data.fieldIDs[0];this.provinces=this.data.provinces;this.provincesCount=this.data.provinces.length;this.cities={};this.citiesCount=0;this.districts={};this.districtsCount=0;this.preselected=(typeof(this.data.preselected)!=="undefined"&&this.data.preselected.length>0)?true:false;if(this.preselected==true){this.preselectFields();}else{this.fillProvinces();this.handleProvinces();}},fillProvinces:function(){var i,provinceName,provinceValue,html,extraAttribute;var $selectField=$("#"+this.fields.province);$selectField.empty();for(i=0;i<this.provincesCount;i++){provinceName=this.provinces[i].provinceName;provinceValue=this.provinces[i].provinceValue;extraAttribute=(i==0)?extraAttribute=' data-invisible="true"':extraAttribute="";html=$('<option value="'+provinceValue+'" data-index="prov-'+i+'"'+extraAttribute+">"+provinceName+"</option>").appendTo($selectField);}$(formularValidation).each(function(){this.reInit(true);});},preselectFields:function(){var that=this,province=null,city=null,district=null;province=this.data.preselected[0].province;city=this.data.preselected[0].city;district=this.data.preselected[0].district;var $selectFieldProvince=$("#"+that.fields.province);var $selectFieldCity=$("#"+that.fields.city);var $selectFieldDistrict=$("#"+that.fields.district);var html;for(i=0;i<this.provincesCount;i++){provinceName=this.provinces[i].provinceName;provinceValue=this.provinces[i].provinceValue;extraAttribute=(i==0)?extraAttribute=' data-invisible="true"':extraAttribute="";selectedAttr=(provinceValue==province)?' selected="selected"':"";html=$('<option value="'+provinceValue+'" '+selectedAttr+' data-index="prov-'+i+'"'+extraAttribute+">"+provinceName+"</option>").appendTo($selectFieldProvince);}selectedProvinceIndex=$("#"+that.fields.province+" option:selected").data("index").substr(5);that.cities=that.data.provinces[selectedProvinceIndex].cities;if(that.cities!==undefined){that.citiesCount=that.cities.length;}for(i=0;i<this.citiesCount;i++){cityName=this.cities[i].cityName;cityValue=this.cities[i].cityValue;selectedAttr=(cityValue==city)?' selected="selected"':"";html=$('<option value="'+cityValue+'" '+selectedAttr+' data-index="prov-'+i+'">'+cityName+"</option>").appendTo($selectFieldCity);}$selectFieldCity.removeClass("disabled");selectedCityIndex=$("#"+that.fields.city+" option:selected").data("index").substr(5);that.districts=that.data.provinces[selectedProvinceIndex].cities[selectedCityIndex].districts;if(that.districts!==undefined){that.districtsCount=that.districts.length;}for(i=0;i<this.districtsCount;i++){districtName=this.districts[i].districtName;districtValue=this.districts[i].districtValue;selectedAttr=(districtValue==district)?' selected="selected"':"";html=$('<option value="'+districtValue+'" '+selectedAttr+' data-index="prov-'+i+'">'+districtName+"</option>").appendTo($selectFieldDistrict);}$selectFieldDistrict.removeClass("disabled");this.handleProvinces();this.handleCities();},handleProvinces:function(){var that=this,selectedProvinceIndex;$("#"+that.fields.province+"-mirror-pd a").live("jspulldownchanged",function(){selectedProvinceIndex=$("#"+that.fields.province+" option:selected").data("index").substr(5);that.cities=that.data.provinces[selectedProvinceIndex].cities;if(that.cities!==undefined){that.citiesCount=that.cities.length;that.switchCity();}});},switchCity:function(){var that=this,i,cityName,cityValue,html;var $selectField=$("#"+this.fields.city);var noOption=$selectField.find("option:first").html();$selectField.empty();$("#"+this.fields.city+"-mirror").remove();html=$('<option value="" data-invisible="true">'+noOption+"</option>").appendTo($selectField);for(i=0;i<this.citiesCount;i++){cityName=this.cities[i].cityName;cityValue=this.cities[i].cityValue;html=$('<option value="'+cityValue+'" data-index="city-'+i+'">'+cityName+"</option>").appendTo($selectField);}this.handleCities();$selectField.removeClass("disabled");jsPulldowns.push(new JSPulldown($selectField,{followLink:false,selectPulldown:true}));$(formularValidation).each(function(){this.reInit(true);});var $selectFieldDistrict=$("#"+this.fields.district);noOption=$selectFieldDistrict.find("option:first").html();$selectFieldDistrict.empty();$("#"+this.fields.district+"-mirror").remove();html=$('<option value="" data-invisible="true">'+noOption+"</option>").appendTo($selectFieldDistrict);$selectFieldDistrict.addClass("disabled");jsPulldowns.push(new JSPulldown($selectFieldDistrict,{followLink:false,selectPulldown:true}));},handleCities:function(){var that=this,selectedCityIndex;$("#"+that.fields.city+"-mirror-pd a").live("jspulldownchanged",function(){selectedCityIndex=$("#"+that.fields.city+" option:selected").data("index").substr(5);that.districts=that.cities[selectedCityIndex].districts;if(that.districts!==undefined){that.districtsCount=that.districts.length;that.switchDistricts();}});},switchDistricts:function(){var that=this,i,districtName,districtValue,html;var $selectField=$("#"+this.fields.district);var noOption=$selectField.find("option:first").html();$selectField.empty();$("#"+this.fields.district+"-mirror").remove();html=$('<option value="" data-invisible="true">'+noOption+"</option>").appendTo($selectField);for(i=0;i<this.districtsCount;i++){districtName=this.districts[i].districtName;districtValue=this.districts[i].districtValue;html=$('<option value="'+districtValue+'" data-index="dist-'+i+'">'+districtName+"</option>").appendTo($selectField);}$selectField.removeClass("disabled");jsPulldowns.push(new JSPulldown($selectField,{followLink:false,selectPulldown:true}));$(formularValidation).each(function(){this.reInit(true);});}};})(jQuery);function printPage(){window.print();}function isIE(b){if(navigator.appName=="Microsoft Internet Explorer"){if(!b){return true;}if(b==6&&navigator.appVersion.search(/MSIE 6.0/)!=-1){return true;}if(b==7&&navigator.appVersion.search(/MSIE 7.0/)!=-1){return true;}if(b==8&&navigator.appVersion.search(/MSIE 8.0/)!=-1){return true;}if(b==9&&navigator.appVersion.search(/MSIE 9.0/)!=-1){return true;}if(b==10&&navigator.appVersion.search(/MSIE 10.0/)!=-1){return true;}}else{if(b==11&&navigator.appName=="Netscape"&&navigator.appVersion.search(/rv:11.0/)!=-1){return true;}}return false;}function isIEx64(){if(navigator.appName=="Microsoft Internet Explorer"){if((navigator.appVersion.search(/MSIE 9.0/)!=-1&&navigator.appVersion.search(/WOW64/)!=-1)||(navigator.appVersion.search(/MSIE 9.0/)!=-1&&navigator.appVersion.search(/x64/)!=-1)){return true;}}return false;}function isIE6OrLess(){var d=navigator.userAgent.toLowerCase();var c=parseInt(navigator.appVersion);var a=parseFloat(navigator.appVersion);var b=((d.indexOf("msie")!=-1)&&(d.indexOf("opera")==-1));return(b&&(c==4)&&(d.search(/msie [56]\./)!=-1));}function lg(a){if(true){if(typeof(opera)!="undefined"&&opera!=null){opera.postError(a);return;}else{if(typeof(console)!="undefined"&&console!=null){console.log(a);return;}}}}function isInElement(a,c,b){var a=a;var c=c;var b=b;if((a>b.offset().left+b.width()||a<b.offset().left)||(c>b.offset().top+b.height()||c<b.offset().top)){return false;}else{return true;}}var getUniqueId=(function(){var a=0;return function(){if(arguments[0]==0){a=0;return 1;}else{return a++;}};})();Array.prototype.in_array=function(b){for(var a=0;a<this.length;a++){if(b===this[a]){return true;}}return false;};Array.prototype.remove=function(c,b){var a=this.slice((b||c)+1||this.length);this.length=c<0?this.length+c:c;return this.push.apply(this,a);};getXmlHttpRequest=function(){if(window.XMLHttpRequest&&window.DOMParser&&document.implementation&&document.implementation.createDocument){this.request=new XMLHttpRequest();return this.request;}try{this.request=new ActiveXObject("MSXML2.XmlHttp");return this.request;}catch(a){}try{this.request=new ActiveXObject("Microsoft.XmlHttp");return this.request;}catch(a){}try{this.request=new ActiveXObject("MSXML.XmlHttp");return this.request;}catch(a){}try{this.request=new ActiveXObject("MSXML3.XmlHttp");return this.request;}catch(a){}};function ccTracking(b){var e=b.added["WT.si_x"];var g=b.added["WT.ti"];var d=b.added["DCSext.url_path"];var f=jQuery('meta[name="DCS.dcsuri"]').attr("content")||"";var a=jQuery('meta[name="WT.es"]').attr("content")||"";var c=new Array();if(e!=undefined&&e!=""){c.push("WT.ti",""+g,"DCS.dcsuri",""+f+d,"WT.es",""+a+d,"WT.si_n",b.added["WT.si_n"]);switch(e){case"1":case"2":c.push("WT.si_x",b.added["WT.si_x"]);break;case"3":c.push("WT.si_x",b.added["WT.si_x"]);if(b.added["DCSext.cc_filter"]){c.push("DCSext.cc_filter",b.added["DCSext.cc_filter"]);}if(b.added["DCSext.cc_product_viewed_value"]){c.push("DCSext.cc_product_viewed_cat",b.added["DCSext.cc_product_viewed_cat"],"DCSext.cc_product_viewed_value",b.added["DCSext.cc_product_viewed_value"]);}if(b.added["DCSext.cc_product_chosen_value"]){c.push("DCSext.cc_product_chosen_cat",b.added["DCSext.cc_product_chosen_cat"],"DCSext.cc_product_chosen_value",b.added["DCSext.cc_product_chosen_value"]);}break;case"33":c.push("WT.si_x","3");if(b.added["DCSext.cc_product_viewed_value"]){c.push("DCSext.cc_product_viewed_cat",b.added["DCSext.cc_product_viewed_cat"],"DCSext.cc_product_viewed_value",b.added["DCSext.cc_product_viewed_value"]);}if(b.added["DCSext.cc_details_viewed_value"]){c.push("DCSext.cc_details_viewed_cat",b.added["DCSext.cc_details_viewed_cat"],"DCSext.cc_details_viewed_value",b.added["DCSext.cc_details_viewed_value"]);}if(b.added["DCSext.cc_product_chosen_value"]){c.push("DCSext.cc_product_chosen_cat",b.added["DCSext.cc_product_chosen_cat"],"DCSext.cc_product_chosen_value",b.added["DCSext.cc_product_chosen_value"]);}if(b.added["DCSext.cc_product_added_value"]){c.push("DCSext.cc_product_added_cat",b.added["DCSext.cc_product_added_cat"],"DCSext.cc_product_added_value",b.added["DCSext.cc_product_added_value"]);}break;case"4":c.push("WT.si_x",b.added["WT.si_x"]);if(b.added["DCSext.cc_filter"]){c.push("DCSext.cc_filter",b.added["DCSext.cc_filter"]);}if(b.added["DCSext.cc_product_viewed_value"]){c.push("DCSext.cc_product_viewed_cat",b.added["DCSext.cc_product_viewed_cat"],"DCSext.cc_product_viewed_value",b.added["DCSext.cc_product_viewed_value"]);}if(b.added["DCSext.cc_product_added_value"]){c.push("DCSext.cc_product_added_cat",b.added["DCSext.cc_product_added_cat"],"DCSext.cc_product_added_value",b.added["DCSext.cc_product_added_value"]);}if(b.added["DCSext.cc_product_removed_value"]){c.push("DCSext.cc_product_removed_cat",b.added["DCSext.cc_product_removed_cat"],"DCSext.cc_product_removed_value",b.added["DCSext.cc_product_removed_value"]);}if(b.added["DCSext.cc_product_chosen_value"]){c.push("DCSext.cc_product_chosen_cat",b.added["DCSext.cc_product_chosen_cat"],"DCSext.cc_product_chosen_value",b.added["DCSext.cc_product_chosen_value"]);}break;}dcsMultiTrack.apply(dcsMultiTrack,c);}else{dcsMultiTrack("WT.ti",""+g,"DCS.dcsuri",""+f+d,"WT.es",""+a+d);}}function egcTracking(b){var d=b.added["WT.si_x"];var f=b.added["WT.ti"];var c=b.added["DCSext.url_path"];var e=jQuery('meta[name="DCS.dcsuri"]').attr("content")||"";var a=jQuery('meta[name="WT.es"]').attr("content")||"";if(d!=undefined&&d!=""){switch(d){case"1":case"2":case"5":dcsMultiTrack("WT.ti",""+f,"DCS.dcsuri",""+e+c,"WT.es",""+a+c,"WT.si_n",b.added["WT.si_n"],"WT.si_x",b.added["WT.si_x"]);break;case"3":case"4":dcsMultiTrack("WT.ti",""+f,"DCS.dcsuri",""+e+c,"WT.es",""+a+c,"WT.si_n",b.added["WT.si_n"],"WT.si_x",b.added["WT.si_x"],"DCSext.egc_cat",b.added["DCSext.egc_cat"],"DCSext.egc_value",b.added["DCSext.egc_value"]);break;}}else{dcsMultiTrack("WT.ti",""+f,"DCS.dcsuri",""+e+c,"WT.es",""+a+c);}}(function(a){a.CheckoutFormValidator=function(b,c){this.init(b,c);};a.CheckoutFormValidator.prototype={init:function(c,d){d=d?d:{};var b=this;this.$elem=a(c);this.submitButton=this.$elem.find("[type=submit]");this.formRows=this.$elem.find(".form-row.required-field");this.countRequired=this.$elem.find(".form-row.required-field").length;this.completedFields=[];if(this.countRequired<1||this.countRequired===undefined){return;}this.prepareFields();},prepareFields:function(){var b=this;a(this.formRows).each(function(f){var l=a(this),g=l.parents("fieldset").hasClass("invisible")||a(this).hasClass("invisible"),m=l.find("input"),p=l.find("textarea"),n=l.find("select"),c=m.length,q=p.length,o=n.length;if(c>0){if(m.hasClass("disabled-text")){b.completedFields[f]="skip";}else{if(m.is(":visible")&&!g){var h=m.attr("type"),e;if(c>1){if(h=="checkbox"||h=="radio"){b.completedFields[f]=false;for(e=0;e<c;e++){if(a(m[e]).prop("checked")){b.completedFields[f]=true;break;}}a(m).on("change blur",function(){b.checkRequiredField(a(m),f);});}else{if(h=="text"||h=="password"){b.completedFields[f]=false;var d=true;for(e=0;e<c;e++){if(!a(m[e]).val()||a(m[e]).val()==""){d=false;}}b.completedFields[f]=d;a(m).on("change blur",function(){b.checkRequiredField(a(m),f);});}}}else{if(h=="checkbox"||h=="radio"){b.completedFields[f]=a(m).prop("checked")?true:false;}else{if(h=="text"||h=="password"){b.completedFields[f]=a(m).val()&&a(m).val()!=""?true:false;}}a(m).on("change blur",function(){b.checkRequiredField(a(m),f);});}}else{b.completedFields[f]="skip";}}}else{if(q>0&&!g){if(p.is(":visible")){b.completedFields[f]=a(p).val()&&a(p).val()!=""?true:false;a(p).on("change blur",function(){b.checkRequiredField(a(p),f);});}else{b.completedFields[f]="skip";}}else{if(o>0&&!g){b.completedFields[f]=(a(n).val()!=""&&a(n).val()!="-"&&a(n).val()!=" ")?true:false;a(n).siblings(".jspulldown").on("hidepulldown",function(){b.checkRequiredField(a(n),f,true);}).find(">a.handle").on("blur",function(){setTimeout(function(){b.checkRequiredField(a(n),f,true);},80);});}else{b.completedFields[f]="skip";}}}});},checkSubmitButton:function(){},checkRequiredField:function(e,l,g){var n=this;var d=a(e);var o=d.attr("type");var h=d.data("value");if(g){o="select";h=d.val();}if(o=="checkbox"||o=="radio"){if(d.length==1){n.completedFields[l]=d.prop("checked")?true:false;}else{var f=false;for(j=0;j<d.length;j++){if(a(e[j]).prop("checked")){f=true;break;}}n.completedFields[l]=f;}}else{if(o===undefined&&h!=="undefined"){n.completedFields[l]=(h!=""&&h!=" "&&h!="-")?true:false;}else{if(d.length==1){n.completedFields[l]=d.val()&&d.val()!=""?true:false;}else{var f=true;for(j=0;j<d.length;j++){if(!a(e[j]).val()||a(e[j]).val()==""){f=false;}}n.completedFields[l]=f;}}}var b=d.parents(".form-row"),c=b.children("div").last();if(!this.completedFields[l]){var m=b.data("errortext")||"";if(!b.hasClass("error-row")||c.children("span.error").length==0){var p=a("<span/>").addClass("error");c.append(p.html(m));b.addClass("error-row");}}else{c.children("span.error").remove();b.removeClass("error-row");}},reInit:function(e){var d=this;var b=0,c=d.completedFields.length;if(e){for(b=0;b<c;b++){if(d.completedFields[b]=="skip"){d.completedFields[b]=false;}}}else{d.completedFields=[];}d.prepareFields();}};})(jQuery);(function($){$.AdvancedDatePicker=function(elem,params){this.init(elem,params);};$.AdvancedDatePicker.prototype={init:function(elem,params){params=params||{};this.$elem=$(elem);var dateFormat=this.$elem.data("datepicker-dateformat")||"mm/dd/yy";var dateMax=params.maxDate||"+1M";var enableddays=this.$elem.data("datepicker-enableddays");$.datepicker.regional.custom=eval(this.$elem.data("datepicker-locale")).custom;if(enableddays){var lastDay=enableddays[enableddays.length-1].split("-");dateMax=new Date(lastDay[0],lastDay[1]-1,lastDay[2]);}this.params={dateFormat:dateFormat,numberOfMonths:params.numberOfMonths||1,constrainInput:params.constrainInput||true,minDate:params.minDate||new Date(),maxDate:dateMax,dayNamesMin:params.dayNamesMin||["S","M","T","W","T","F","S"],firstDay:params.firstDay||1,beforeShowDay:this.setUnavailableDates,defaultDate:this.getValue(),onSelect:this.setValue};this.$elem.datepicker(this.params);this.$elem.datepicker("option",$.datepicker.regional.custom);},setUnavailableDates:function(date){var ymd=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();var noWeekend=jQuery.datepicker.noWeekends(date);var enabledDays=$(this).data("datepicker-enableddays")||[];var disabledDays=$(this).data("datepicker-disableddays")||[];var dayCondition=$(this).data("datepicker-enableddays")?($.inArray(ymd,enabledDays)>-1&&noWeekend[0]):($.inArray(ymd,disabledDays)==-1&&noWeekend[0]);if(dayCondition){return[true,""];}else{return[false,""];}},setValue:function(date){$(this).find("input[type=hidden]").val(date);},getValue:function(){return this.$elem.find("input[type=hidden]").val();}};})(jQuery);