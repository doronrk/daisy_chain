$(document).ready(function(){clickStream.bindClientStartTime();clickStream.changeTopNavLink();var c=clickStream.getClickStreamJson();if(!c){return}var d=clickStream.ignoreRequestInBrowsePage(c);if(d){return}clickStream.bindSearchParams(c);clickStream.changeLink();clickStream.sendRequest(c);clickStream.bindClickStreamTagClick()});$(document).ajaxComplete(function(e,g){var h=g.getResponseHeader("ClickStream");var f=$.parseJSON(h);if(!f){return}clickStream.bindPdpParames(f);clickStream.sendRequest(f);clickStream.bindClickStreamTagClick();clickStream.reviseRefTag()});$(document).ajaxStop(function(){clickStream.changeLink()});var clickStream=(function(){var aq={pageType:"page-type",subPageType:"sub-page-type",hitType:"hitType",tabId:"tab-id",siteVariant:"site_variant",customerId:"customer-id",info:"Info",ignoreRequest:"IgnoreRequest",pageTypeIdSource:"page-type-id-source",quidsiRegion:"quidsi-region"};var J=[aq.pageType,aq.subPageType,aq.hitType,aq.tabId,aq.siteVariant,aq.customerId];var S=[aq.quidsiRegion,aq.pageType,aq.subPageType,aq.hitType,aq.tabId,aq.siteVariant,aq.customerId];function af(b){var a=new Object();var d=b.Info.split(",");for(var c=0;c<d.length;c++){var e=d[c].split("=");if(e.length!=2){return}a[e[0]]=e[1]}return a}function M(f,d){if(!f){return}if(!d){d=Z(f)}var a=/^(http:\/\/|https:\/\/)/;var e=f.RequestAPI.replace(a,"");var b=document.location.protocol+"//"+e+"?json="+encodeURIComponent(d)+"&random="+Math.random();var c=new Image();c.src=b}function K(b){if(b&&b.EnableLog){var a=$("<table></table>");for(var c in b){a.append("<tr><td>"+c+"</td><td>"+ao(b[c])+"</td></tr>")}a.append("<br />");$("body",window.top.document).append(a)}}function ao(a){var b=document.createElement("div");(b.textContent!=null)?(b.textContent=a):(b.innerText=a);var c=b.innerHTML;b=null;return c}function Z(a){var d=[];var c=function(e){if(typeof e=="object"&&e!=null){return Z(e)}return/^(string|number)$/.test(typeof e)?'"'+e+'"':e};for(var b in a){if(b=="ClickstreamInfo"&&a[b]!=null){d.push('"'+b+'":'+JSON.stringify(a[b]))}else{d.push('"'+b+'":'+c(a[b]))}}return"{"+d.join(",")+"}"}function aa(b){var a=am();var c=$(a).closest("["+b+"]");return c.attr(b)}function am(){var a=ak();if(!a){return null}a=a.target||a.srcElement;return a}function ak(){if(document.all){return window.event}func=ak.caller;while(func!=null){var a=func.arguments[0];if(a){if((a.constructor==Event||a.constructor==MouseEvent)||(typeof(a)=="object"&&a.preventDefault&&a.stopPropagation)){return a}}func=func.caller}return null}function ah(b,c,a){var d=af(b);d[c]=a;an(b,d)}function R(b,c){var a=af(b);delete a[c];an(b,a)}function U(b,c){var d=af(b);if(c in d){var a=d[c];delete d[c];d[c]=a;an(b,d)}}function an(b,a){var d="";for(var c in a){d+=c+"="+a[c]+","}b.Info=d.substring(0,d.length-1)}function W(a,b){if(b==undefined){b=aa("reftag")}if(b){if(b.indexOf("=")>=0){b=b.substring(b.indexOf("=")+1)}ah(a,"ref-override",b)}}function ag(d,b){var e=new Date().getTime();var a=$("body").data("clientStartTime");var c=10000;d.StartTime=b+e-a;d.EndTime=parseInt(d.StartTime)+c}function ad(b,a){if(a==undefined){a=aa("hitType")}if(a==undefined){a="pageHit"}else{switch(a.toLowerCase()){case"pagehit":a="pageHit";break;case"popup":a="popUp";break;case"pagetouch":a="pageTouch";break;default:break}}ah(b,"hitType",a)}function L(b,c,e){if(c==undefined){c=aa("pageType")}if(e==undefined){e=aa("subPageType")}if(c){ah(b,"page-type",c);if(e==undefined){e=""}var d=af(b);var a=d["sub-page-type"].substring(0,d["sub-page-type"].indexOf("-")+1);ah(b,"sub-page-type",a+e)}}function V(a,b){if(b){ah(a,"page-type-id",b)}}function ae(b,a){if(a){ah(b,"groupingASIN",a)}}function Y(a,b){if(b){ah(a,"ProductGlId",b)}}function ai(a,c){if(c){var d=af(a);var b="event-quidsi-action."+d["page-type-id"];R(a,b);ah(a,"event-quidsi-action."+c,"DISCOVERY")}}function ac(a){ah(a,aq.pageTypeIdSource,"externalAsin")}function ab(a){ah(a,"is-glance-view","Y")}function O(){var a="VISITOR_ID";var b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)"));if(b!=null){return unescape(b[2])}return null}function Q(b){var a=$(b).text()||$("#clickStreamJson").text();if(a){return $.parseJSON(a)}return undefined}function aj(f){var e=Q(f);var c=[];if(e){var d=af(e);for(var a=0;a<J.length;a++){var b=J[a];if(b in d){c.push(b+"="+d[b])}}}if(c.length>0){e[aq.info]=c.join(",")}return e}function X(){var e=Q();var c=[];if(e){var d=af(e);for(var a=0;a<S.length;a++){var b=S[a];if(b in d){c.push(b+"="+d[b])}}}if(c.length>0){e[aq.info]=c.join(",")}return e}function N(a,b){b=b||$("#clickStreamJson").attr("pageTypeShortHand");if(a&&b){a=a.replace("@pageType",b)}return ar(a,"_@pageType")}function ap(b,a){a=a||$("#clickStreamJson").attr("subPageTypeShortHand");if(b&&a){b=b.replace("@subPageType",a)}return ar(b,"_@subPageType")}function al(a,b){if(a&&b){a=a.replace("@position",b)}return ar(a,"_@position")}function ar(b,a){if(b){return b.replace(a,"")}return b}function P(c,a){var b=Q();if(b){b[c]=a;$("#clickStreamJson").text(Z(b))}}function T(d,e){var a=e.split("=");var c=a[0];if(d.indexOf("&"+c+"=")>=0||d.indexOf("?"+c+"=")>=0){var b=new RegExp(c+"=[^&]*");d=d.replace(b,e);return d}d+=(d.indexOf("?")>0?"&":"?")+e;return d}return{sendClientRequest:function(c,b,d,e){var a=aj();if(!a){return}W(a,c);ag(a,parseInt(a.EndTime));ad(a,d);L(a,b,e);a.HTTP_REFERER=document.location.href;clickStream.sendRequest(a)},sendRequest:function(b,a){if(!b||b.IgnoreRequest==true){return}M(b,a);K(b)},getHtmlAttribute:function(a){return aa(a)},getRefByHtmlAttribute:function(){return aa("reftag")},appendRef:function(a,b){b=b||clickStream.getRefByHtmlAttribute();if(a&&b){a=T(a,b)}return a},appendClickStreamInfo:function(a,b,c){if(!a){return a}var d=[];b=b||$("#clickStreamJson").attr("pageType");if(b){d.push("pageType="+b)}c=c||clickStream.getRefByHtmlAttribute();if(c){d.push(c)}if(d.length>0){a+=(a.indexOf("?")>0?"&":"?")+d.join("&")}return a},getClickStreamObj:function(b){b=b||am();var a=new Object();a.pageType=$(b).attr("pageType");a.subPageType=$(b).attr("subPageType");a.reftag=$(b).attr("reftag");a.hitType=$(b).attr("hitType");return a},bindClientStartTime:function(){$("body").data("clientStartTime",new Date().getTime())},bindClickStreamTagClick:function(){$(".clickStreamTag").click(function(){clickStream.sendClientRequest()});$(".clickStreamTag").removeClass("clickStreamTag")},appendClickStreamTag:function(a){$(a).addClass("clickStreamTag")},changeLink:function(){$(".cSChangeLink").each(function(){var c=$(this).closest("[reftag]").attr("reftag");var b=$(this).find("a").attr("href");if(b&&c){var a=b+(b.indexOf("?")!=-1?"&":"?")+c;$(this).find("a").attr("href",a);$(this).removeClass("cSChangeLink")}})},changeTopNavLink:function(){$("#siteNav a").each(function(){var b=$(this).attr("reftag");var a=$(this).attr("href");if(a&&a.toLowerCase().indexOf("javascript")<0&&b){b=N(b,$("#clickStreamJson").attr("pageTypeShortHand")||"gpt");b=ap(b);a=clickStream.appendRef(a,b);$(this).attr("href",a)}})},reviseRefTag:function(a){var b=1;a=a||$(".cSReftag");a.each(function(){var c=$(this).attr("reftag");if(c){if(c.indexOf("@pageType")>0){c=N(c)}if(c.indexOf("@subPageType")>0){c=ap(c)}if(c.indexOf("@position")>0){c=al(c,b++)}$(this).attr("reftag",c)}})},syncVisitorIdSendClickStream:function(){P(aq.ignoreRequest,false);var a=clickStream.getClickStreamJson();if(!a){return}a.Session=O();clickStream.sendRequest(a)},getClickStreamJson:function(a){return Q(a)},sendDiscoveryRequest:function(h,b,e,f,c,a,d){var g=X();if(!g){return}L(g,h,"");V(g,e||b);if(!e){ac(g)}ae(g,f);Y(g,c);W(g,a);ai(g,e||b);ab(g);ag(g,parseInt(g.EndTime));ad(g,d);g.HTTP_REFERER=document.location.href;clickStream.sendRequest(g)},bindEasyReorderClickStream:function(d,c){var a=$(d).attr("subPageTypeShortHand");var b=$(d).attr("reftag");var e=easyReorderClickStream.subPageTypeShortHand;if(b&&e){easyReorderClickStream.reftag=b.replace("@subPageType",e)}easyReorderClickStream.pageTypeId=c||$(d).attr("pageTypeId");easyReorderClickStream.subPageType=$(d).attr("subPageType")||easyReorderClickStream.subPageType;easyReorderClickStream.actionPageType=$(d).attr("actionPageType")||easyReorderClickStream.actionPageType;easyReorderClickStream.subPageTypeShortHand=a||easyReorderClickStream.subPageTypeShortHand},sendEasyReordersClientRequest:function(h,g,e,c,d){var a=aj($("#mlClickStreamJson"));if(!a){return}var f=clickStream.getClickStreamJson();var b=f?f.EndTime:a.EndTime;W(a,h);ag(a,parseInt(b));ad(a,d);L(a,g,e);V(a,c);a.HTTP_REFERER=document.location.href;clickStream.sendRequest(a)},easyReorderClickStreamClear:function(){$("#mlClickStreamJson").remove();if(typeof(easyReorderClickStream)!="undefined"){easyReorderClickStream.subPageType="";easyReorderClickStream.subPageTypeShortHand="";easyReorderClickStream.reftag="";easyReorderClickStream.actionPageType="";easyReorderClickStream.pageTypeId=""}},ignoreRequestInBrowsePage:function(b){if(!b){return false}var d=af(b);var c=d["tab-id"].toLowerCase();if(c!="look"){return false}var e=window.location.pathname.toLowerCase();var a=window.location.hash.toLowerCase();if(e.indexOf("/cat=")>-1||e.indexOf("/subcat=")>-1||e.indexOf("/buy")>-1||e.indexOf("/b/")>-1||e.indexOf("/clothing-clearance")>-1||e.indexOf("/shoes-clearance")>-1||e.indexOf("/shoes-new-arrivals")>-1||e.indexOf("/shoes-best-sellers")>-1||e.indexOf("/shoes-outlet")>-1||e.indexOf("/gift-cards")>-1){if(a&&a!="#fromsearch=y"&&a.indexOf("=")>-1){return true}}return false},bindSearchParams:function(a){if(location.href.toLowerCase().indexOf("s=")>-1||location.href.toLowerCase().indexOf("subcat=")>-1){if(typeof(clickStreamParams)!="undefined"&&clickStreamParams.qid){ah(a,"qid",clickStreamParams.qid);U(a,"alias-or-index");ah(a,"total-found",clickStreamParams.totalFound)}}},bindDiscoveryRequest:function(e,d,f){if(f||!e||!d){return}var g=$(e).attr("asin");var a=$(e).attr("ProductId");var c=$(e).attr("ProductGlId");var b=clickStream.getRefByHtmlAttribute();clickStream.sendDiscoveryRequest("F-PDPSkuSelection",d,g,a,c,b,"pageTouch")},bindDiscoveryRequestForUniversalTemplate:function(e,d,f){if(f||e==null||d==null||d==""){return}var g=e.Asin;var a=e.ProductId;var c=e.ProductGlId;var b=clickStream.getRefByHtmlAttribute();clickStream.sendDiscoveryRequest("F-PDPSkuSelection",d,g,a,c,b,"pageTouch")},bindClickStreamRequestOnSelect:function(a,b){if(a&&b){$(b).on("change",function(){var c=$(this).val();clickStream.sendClientRequest(a[c])})}},bindPdpParames:function(a){var c=location.href.toLowerCase();if(c.indexOf("/p/")>-1&&c.indexOf("qid=")>-1&&c.indexOf("sr=">-1)){var d=getURLParameter("qid");var b=getURLParameter("sr");if(typeof(d)!="undefined"&&typeof(b)!="undefined"){ah(a,"qid",d);ah(a,"sr",b)}}}}}());