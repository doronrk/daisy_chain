var AA=AA||{};AA.namespace("Modules.TypeAhead");AA.Modules.TypeAhead=(function($,AA){"use strict";var defaults={enableCache:false,dataURL:null,renderItem:renderItem,targetElement:null,autoComplete:{minLength:2,delay:400}},autoComplete={},TYPEAHEAD_LOADED="typeAheadLoaded",cache={};function hightlight(keyword,result){var replacement='<span class="aa-search-highlight">'+ keyword+'</span>',search=new RegExp(keyword,"gi");if(result){return result.replace(search,replacement);}}
function dataHandler(request,response){var term=request.term;$.getJSON(defaults.dataURL+'?term='+ request.term,function(data,status,xhr){response(data.searchResults);});}
function dataHandlerCached(request,response){var term=request.term,data;if(term in cache){data=cache[term];response(data.searchResults);return;}
$.getJSON(defaults.dataURL+'?term='+ request.term,function(data,status,xhr){cache[term]=data;response(data.searchResults);});}
function renderItem(ul,item){var displayText=hightlight($(defaults.targetElement).val(),item.value),query=(item.termMatchesProdId==="true")?item.prodId:item.value;return $("<li></li>").data("item.autocomplete",item).append('<a href="\search\?Ntt='+ query+'" >'+ displayText+'</a>').appendTo(ul);}
function init(options){autoComplete=$.extend(defaults.autoComplete,options.autoComplete||{});autoComplete.source=(defaults.enableCache)?dataHandlerCached:dataHandler;$.extend(defaults,options);if($(defaults.targetElement).length){$(defaults.targetElement).autocomplete(autoComplete).data("ui-autocomplete")._renderItem=defaults.renderItem;$.publish(TYPEAHEAD_LOADED);}}
return{init:init,events:{onLoad:TYPEAHEAD_LOADED}};}(jQuery,AA));