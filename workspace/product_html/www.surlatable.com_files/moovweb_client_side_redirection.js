var allowedParams=["affsrcid"];var mobileHostName="m.surlatable.com";var mobileHostNameStage="mstage-seattle-stage2.surlatable.com";var debug=false;var queryString=function(){var query_string={};var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(typeof query_string[pair[0]]==="undefined"){query_string[pair[0].toLowerCase()]=pair[1]}else if(typeof query_string[pair[0]]==="string"){var arr=[query_string[pair[0]],pair[1]];query_string[pair[0].toLowerCase()]=arr}else{query_string[pair[0].toLowerCase()].push(pair[1])}}return query_string}();function preRedirect(topDomain){var url=null;var canonical=null;var links=document.getElementsByTagName("link");for(var i=0;i<links.length;i++){if(links[i].getAttribute("rel")==="canonical"){canonical=links[i].getAttribute("href");break}}if(canonical!=null){url=getURLFromString(canonical);log("canonicalURL",url)}else{url=window.location;log("windowURL",url)}var newLoc="";(url.protocol==null||url.protocol==""||url.protocol==":")?newLoc+="http:":newLoc+=url.protocol;newLoc+="//";newLoc+=topDomain;(url.pathname!=null&&url.pathname.charAt(0)!="/")?newLoc+="/"+url.pathname:newLoc+=url.pathname;newLoc+=url.hash;var qs="";for(i=0;i<allowedParams.length;i++){qs=addURLParameter(qs,allowedParams[i])}return newLoc+qs}(function(){var mobileCookie=readCookie("mw_mobile_site");var regExUA=/ip(hone|od)|android.*(mobile)|blackberry.*applewebkit/i;var regExDomain=/^(www(\d+)?\.)?(.*)$/;var regExCookieDomain=/^(www(\d+)?\.)?(m.*\.)?(.*\.\w{3})$/;var hostname=window.location.hostname;var domain=hostname.match(regExCookieDomain);domain=domain[domain.length-1];function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length)}return null}function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString()}else var expires="";document.cookie=name+"="+value+expires+"; path=/;"+"domain=."+domain}function redirect(version){var loc=window.location;var topDomain;var stage=false;(version==="mobile"&&location.hostname.match(/^seattle-stage2\./)!==null)?stage=true:stage=false;if(stage)mobileHostName=mobileHostNameStage;version==="mobile"?topDomain=(mobileHostName):topDomain=domain;t=topDomain.match(regExDomain);topDomain=t[t.length-1];var newURL=preRedirect(topDomain);version==="mobile"?createCookie("mw_mobile_site",true,10):createCookie("mw_mobile_site",false,10);log("redirectURL",newURL);loc.href=newURL}function onMobile(){var onMobile;(location.hostname.match(/^m\./)||location.hostname.match(/^mstage-seattle-stage2\./))!==null?onMobile=true:onMobile=false;return onMobile}if(mobileCookie!==null){if(mobileCookie==="false"&&onMobile()){redirect("desktop");return}else if(mobileCookie==="true"&&!onMobile()){redirect("mobile");return}}else if(!onMobile()){if(window.navigator){if(navigator.userAgent.match(regExUA)!==null){redirect("mobile")}}}})();function getURLFromString(str){var url=document.createElement('a');url.href=str;return url}function addURLParameter(qs,name){var val=queryString[name];if(val!=null&&val!="undefined"){qs==""?qs+="?":qs+="&";qs+=name+"="+val}return qs}function log(str,val){if(debug==true)alert(str+" : "+val)}
