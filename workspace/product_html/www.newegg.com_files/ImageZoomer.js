NEG.Module("NEG.Widget.ImageZoomer",function(j){var i=j("NEG.ThirdParty.jQuery"),q=j("NEG.Widget.Mask"),o={magnifierDom:"<div>",detailImgProperty:"imgZoomPic",fixPosition:!0,magnifierBackgroundImg:base.baseURL+"NEG/Resource/Widget/ImageZoomer/tile.gif",getRealImgSize:!1,detailWindowStyle:{}},p=function(a,f){var b=i(a.target);f.fixPosition&&"static"==b.css("position")&&b.css("position","relative");var e=new function(){var b,e=NEG.utility.isDefined(a.detailWindow);b=e?{target:a.detailWindow}:{size:a.getDetailSize(),
position:a.getDetailPosition()};var c=NEG.merge(f.detailWindowStyle,{"background-color":"white",opacity:"1",overflow:"hidden","z-index":2E4}),d=q(b,{style:c,hideWhenClick:!1});if(!e)d.on("BEFORE_SHOW",function(){var c=a.getDetailSize(),h=a.getDetailPosition();NEG.utility.isDefined(c.width)&&NEG.utility.isDefined(c.height)&&d.setSize(c);NEG.utility.isDefined(h.top)&&NEG.utility.isDefined(h.left)&&d.setPosition(h)});var h=i("<div style='position: absolute'>");i(d.dom).append(h);this.setImg=function(c){var d=
function(c,a){var d=i("<img>");d.attr("src",c);d.css(a);return d},b=function(c,a){var d;a.children("img").each(function(a,h){var b=i(h);b.attr("src")==c&&(d=b)});return d}(c,h);b||(b=d(c,a.imgSize),h.append(b));h.children("img").hide();b.show()};this.setImgPosition=function(a){h.css({left:a.left,top:a.top})};this.show=function(){d.show();h.show()};this.getSize=function(){return e?d.getSize():a.getDetailSize()};this.hide=function(){h.hide();d.hide()}},g=new function(){var e=null,g=null,c=null,d={width:0,
height:0},e=i(f.magnifierDom);e.css({position:"absolute",cursor:"pointer",background:"url("+f.magnifierBackgroundImg+")"});this.show=function(){c=e.appendTo(b)};this.setSize=function(a){d=a;e.css(a)};this.hide=function(){c&&c.remove()};this.setPosition=function(c){var b=a.target.getBoundingClientRect(),f=Math.min(Math.max(0,c.left-b.left-d.width/2),a.target.clientWidth-d.width),c=Math.min(Math.max(0,c.top-b.top-d.height/2),a.target.clientHeight-d.height);g={left:f,top:c};e.css(g)};this.getCurrentPos=
function(){return g}},k,l,m,n,j=function(){var i=function(c,d,b){c=a.imgSize;return{left:-b.left/d.clientWidth*c.width,top:-b.top/d.clientHeight*c.height}},j=function(){var c=a.imgSize,d=e.getSize(),b=jQuery(this).width(),f=jQuery(this).height(),c=Math.max(c.width/b,c.height/f);return{width:Math.round(Math.min(b,d.width/c)),height:Math.round(Math.min(f,d.height/c))}};l||(l=function(a){e.setImg(jQuery(this).attr(f.detailImgProperty));var b=j.apply(this);g.setSize(b);a={left:a.clientX,top:a.clientY};
g.setPosition(a);b=g.getCurrentPos();e.setImgPosition(i(a,this,b));g.show();e.show()});m||(m=function(a){a={left:a.clientX,top:a.clientY};g.setPosition(a);var b=g.getCurrentPos();e.setImgPosition(i(a,this,b))});n||(n=function(){e.hide();g.hide()});k||(k=function(){b.off("mouseenter",l);b.off("mousemove",m);b.off("mouseleave",n)});k();b.on("mouseenter",l);b.on("mousemove",m);b.on("mouseleave",n)};this.start=function(){j()};this.stop=function(){k&&k()}};return function(a,f){var b;if(a&&f&&f.detailWindow&&
NEG.utility.isDefined(a.length)&&0<a.length)for(b=0;b<a.length;b++)(new p({target:a[b],imgSize:{width:1280,height:960},detailWindow:f.detailWindow[0]},o)).start();else{var e;a:{if(NEG.utility.isDefined(a.target)&&NEG.utility.isDefined(a.imgSize)&&NEG.utility.isType(a.imgSize.width,"Number")&&NEG.utility.isType(a.imgSize.height,"Number")){if(NEG.utility.isDefined(a.detailWindow)){e=!0;break a}if(NEG.utility.isDefined(a.getDetailPosition)&&NEG.utility.isType(a.getDetailPosition,"Function")&&NEG.utility.isDefined(a.getDetailSize)&&
NEG.utility.isType(a.getDetailSize,"Function")){e=a.getDetailPosition();var g=a.getDetailSize();e=NEG.utility.isType(e.top,"Number")&&NEG.utility.isType(e.left,"Number")&&NEG.utility.isType(g.width,"Number")&&NEG.utility.isType(g.height,"Number");break a}}e=!1}e&&!a.target.length&&(f||(f={}),NEG.blend(f,o,{cover:!1,mergePrototype:!1}),b=new p(a,f));return b}}});
