if(typeof BUY=="undefined")BUY={}; (function(){BUY.autocomplete={};BUY.autocomplete.init=function(f){var a=f.qu,h=$(a),l=$('<div class="autocomplete"></div>').insertAfter($("<br />").insertAfter(h)),b=l[0],m=f.queryType,c=-1,g=0,e=a.value,i,j=0,n=false,k=/<(.|\n)+?>/g;a.setAttribute("autocomplete","off");h.blur(function(){n||(j=window.setTimeout(function(){b.style.visibility="hidden"},200))});var p=function(){n=true;window.clearTimeout(j)},q=function(){n=false;window.clearTimeout(j);j=window.setTimeout(function(){b.style.visibility="hidden"}, 200)};l.focus(p).blur(q);$(f).bind("submit",function(){if(b.style.visibility!="hidden"){b.style.visibility="hidden";if(c>-1&&c<b.childNodes.length){var d=b.childNodes[c+1];if(d.className=="activeLink"&&a.value==d.firstChild.innerHTML.replace(k,"")){f.suggest.value="1";if(d.getAttribute("queryType"))m.value=d.getAttribute("queryType");b.style.visibility="hidden"}}}});if(a.offsetWidth!=0)b.style.width=a.offsetWidth+"px";h.keydown(function(d){g=b.childNodes.length;switch(d.keyCode){case 27:b.style.visibility= "hidden";break;case 40:if(b.style.visibility=="hidden")return;if(c<g-2)c++;else c=g-2;if(c>0)b.childNodes[c].className="";b.childNodes[c+1].className="activeLink";a.value=b.childNodes[c+1].firstChild.innerHTML.replace(k,"");if(e)if(a.createTextRange){d=a.createTextRange();d.moveStart("character",e.length);d.moveEnd("character",a.value.length-1);d.select()}else a.setSelectionRange&&a.setSelectionRange(e.length,a.value.length);break;case 38:if(b.style.visibility=="hidden")return;if(c>g+1)c=g+1;if(c< 1){c=-1;a.value=e;b.childNodes[1].className="";return}c--;if(c<g)b.childNodes[c+2].className="";b.childNodes[c+1].className="activeLink";a.value=b.childNodes[c+1].firstChild.innerHTML.replace(k,"");if(e)if(a.createTextRange){d=a.createTextRange();d.moveStart("character",e.length);d.moveEnd("character",a.length-1);d.select()}else a.setSelectionRange&&a.setSelectionRange(e.length,a.value.length);break}});h.keyup(function(d){switch(d.keyCode){case 13:case 16:case 17:case 20:case 37:case 39:case 27:case 40:case 38:break; default:o();break}});h.bind("drop",function(){o()}).bind("paste cut",function(){window.setTimeout(o,1)});var o=function(){if(e!=a.value){e=a.value;if(a.value.length<3){r();b.style.visibility="hidden"}else{c=-1;var d="/SR/autocomplete.aspx?q="+escape(a.value)+"&qt="+m.value;r();i=$.get(d,function(s){if(s){b.innerHTML=s;l.children("a").click(t).focus(p).blur(q);b.style.visibility="visible"}else b.style.visibility="hidden"})}}},r=function(){if(i)switch(i.readyState){case 0:case 4:default:i.abort()}}, t=function(){f.suggest.value="1";if(this.getAttribute("queryType"))m.value=this.getAttribute("queryType");a.value=this.firstChild.innerHTML.replace(k,"");b.style.visibility="hidden";f.submit();return false}}})();