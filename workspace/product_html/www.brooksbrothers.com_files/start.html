<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html webdriver="true" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1252">
        <title></title>
        <script type="text/javascript">
            (function() {
                if (window.top === window.self) {
                    if (document.referrer.length > 0) {
                        window.location.href = document.referrer;
                    }
                    else {
                        window.location.href = "http://" + window.location.hostname;
                    }
                }
            })();
        </script>
        <script type="text/javascript" src="www.brooksbrothers.com_files/jquery-1.js"></script>
        <script type="text/javascript" src="www.brooksbrothers.com_files/jquery.js"></script>
        <script type="text/javascript" src="www.brooksbrothers.com_files/json2.js"></script>
        <script type="text/javascript" src="www.brooksbrothers.com_files/jschannel.js"></script>
        <script type="text/javascript" src="start_data/sha1.js"></script>
        <script type="text/javascript">
            var Util = {
                getLatestRememberedItems : function(items) {
                    var sliceLength = 5;
                    var itemsLength = items.length;
                    var newItems    = [];

                    if (sliceLength > itemsLength) {
                        newItems = items;
                    }
                    else {
                        newItems = items.slice(itemsLength - sliceLength);
                    }

                    return newItems.reverse();
                },

                validateSavedPreferenceItem : function(item) {
                    var isObject  = ((item != null) && (typeof item === "object"));
                    var hasCatId  = (isObject && ("c" in item) && (typeof item.c === "string"));
                    var hasHidden = (isObject && ("h" in item) && (typeof item.h === "string"));
                    var hasFit    = (isObject && ("f" in item) && (typeof item.f === "string"));
                    var hasSize   = (isObject && ("s" in item) && (typeof item.s === "string"));

                    return (hasCatId && hasHidden && hasFit && hasSize);
                },

                getRecentlyViewedProducts : function(items) {
                    var sliceLength = 10;
                    var itemsLength = items.length;

                    if (sliceLength > itemsLength) {
                        return items;
                    }
                    else {
                        return items.slice(itemsLength - sliceLength);
                    }
                }
            };
        </script>
        <script type="text/javascript">
            // Remembered Items
            var chRememberedItems = Channel.build({
                window : window.parent,
                origin : "*",
                scope  : "RememberedItems"
            });

            chRememberedItems.bind("get", function(trans, p) {
                var defaultData = {
                    h : (function() {
                        var hash = CryptoJS.SHA1(JSON.stringify([]));
                        return hash.toString(CryptoJS.enc.Hex);
                    })(),
                    d : []
                };
                var currentData = null;

                try {
                    currentData = JSON.parse(localStorage.getItem("RememberedItems"));
                }
                catch (e) { }

                var isObject = ((currentData != null) && (typeof currentData === "object"));
                var hasHash  = (isObject && ("h" in currentData) && (typeof currentData.h === "string"));
                var hasData  = (isObject && ("d" in currentData) && (currentData.d instanceof Array)   );
                var isValid  = (hasHash && hasData);

                return isValid ? JSON.stringify(currentData) : JSON.stringify(defaultData);
            });

            chRememberedItems.bind("set", function(trans, p) {
                try {
                    localStorage.setItem("RememberedItems", p);
                }
                catch (e) { }
                return null;
            });

            chRememberedItems.bind("add", function(trans, p) {
                var requestItems = (function() {
                    var _defaultItems = [];
                    var _requestItems = null;

                    try {
                        _requestItems = JSON.parse(p);
                    }
                    catch (e) { }

                    var isValid = (_requestItems instanceof Array);

                    return isValid ? _requestItems : _defaultItems;
                })();
                var currentData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("RememberedItems"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var newData        = currentData;
                var quotaEexceeded = false;

                for (var i = 0; i < requestItems.length; i++) {
                    var item = requestItems[i];
                    var idx  = jQuery.inArray(item, newData.d);

                    if (idx == -1) {
                        newData.d.push(item);
                        newData.h = (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify(newData.d));
                            return hash.toString(CryptoJS.enc.Hex);
                        })();

                        var jsonString = JSON.stringify(newData);
                        if (jsonString.length < 120000) {
                            try {
                                localStorage.setItem("RememberedItems", jsonString);
                                currentData = newData;
                            }
                            catch (e) { }
                        }
                        else {
                            quotaEexceeded = true;
                            break;
                        }
                    }
                }

                if (quotaEexceeded) {
                    return JSON.stringify({
                        h : currentData.h,
                        c : currentData.d.length,
                        p : Util.getLatestRememberedItems(currentData.d)
                    });
                }
                else {
                    return JSON.stringify({
                        h : newData.h,
                        c : newData.d.length,
                        p : Util.getLatestRememberedItems(newData.d)
                    });
                }
            });

            chRememberedItems.bind("del", function(trans, p) {
                var requestItems = (function() {
                    var _defaultItems = [];
                    var _requestItems = null;

                    try {
                        _requestItems = JSON.parse(p);
                    }
                    catch (e) { }

                    var isValid = (_requestItems instanceof Array);

                    return isValid ? _requestItems : _defaultItems;
                })();
                var currentData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("RememberedItems"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var newData        = currentData;
                var quotaEexceeded = false;

                for (var i = 0; i < requestItems.length; i++) {
                    var item = requestItems[i];
                    var idx  = jQuery.inArray(item, newData.d);

                    if (idx != -1) {
                        newData.d.splice(idx, 1);
                        newData.h = (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify(newData.d));
                            return hash.toString(CryptoJS.enc.Hex);
                        })();

                        var jsonString = JSON.stringify(newData);
                        if (jsonString.length < 120000) {
                            try {
                                localStorage.setItem("RememberedItems", jsonString);
                                currentData = newData;
                            }
                            catch (e) { }
                        }
                        else {
                            quotaEexceeded = true;
                            break;
                        }
                    }
                }

                if (quotaEexceeded) {
                    return JSON.stringify({
                        h : currentData.h,
                        c : currentData.d.length
                    });
                }
                else {
                    return JSON.stringify({
                        h : newData.h,
                        c : newData.d.length
                    });
                }
            });
        </script>

        <script type="text/javascript">
            // Saved Preferences
            var chSavedPreferences = Channel.build({
                window : window.parent,
                origin : "*",
                scope  : "SavedPreferences"
            });

            chSavedPreferences.bind("get", function(trans, p) {
                var currentData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    
                    var _currentData = null;
                    
                    // Check for stored preferences
                    if(localStorage.getItem("SavedPreferences")) {
	                    try {
	                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
	                    }
	                    catch (e) { }
                    }
                    
                    // Check for cookie
                    if( $.cookie('bbCustomerPreferences') ) {      	    
                        try {
                        	_currentData = JSON.parse( $.cookie('bbCustomerPreferences') ); 
                        }
                        catch (e) { }
                    }
                    
                    // Check for customer preferences
                    if( p.customerSettings ) {
                        try {
                            _currentData = JSON.parse( p.customerSettings );
                        }
                        catch (e) { }                    	
                    }
                    
	                    
                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();

                return JSON.stringify(currentData);
            });

            chSavedPreferences.bind("getPreferencesAndItems", function(trans, p) {
                var preferencesData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var itemsData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("RememberedItems"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)   );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();

                var returnObject = {
                    sp : (function() {
                        var savedPreferences = [];
                        for (var i = 0; i < preferencesData.d.length; i++) {
                            var item    = preferencesData.d[i];
                            var isValid = Util.validateSavedPreferenceItem(item);
                            var hasSize = (isValid && (item.s.length > 0));
                            var hasFit  = (isValid && (item.f.length > 0));

                            if (hasSize || hasFit) {
                                savedPreferences.push({
                                    c : item.c,
                                    s : item.s,
                                    f : item.f
                                });
                            }
                        }
                        return savedPreferences;
                    })(),
                    ri : (function() {
                        return Util.getLatestRememberedItems(itemsData.d);
                    })()
                };

                return JSON.stringify(returnObject);
            });

            chSavedPreferences.bind("set", function(trans, p) {
                try {
                    localStorage.setItem("SavedPreferences", p);
                }
                catch (e) { }
                return null;
            });

            chSavedPreferences.bind("getCategory", function(trans, p) {
                var reqCategoryId = p;
                var currentData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();

                for (var i = 0; i < currentData.d.length; i++) {
                    var item    = currentData.d[i];
                    var isValid = Util.validateSavedPreferenceItem(item);
                    if (isValid) {
                        if (item.c === reqCategoryId) {
                            return JSON.stringify(item);
                        }
                    }
                }

                return JSON.stringify({
                    c : reqCategoryId,
                    h : "n",
                    f : "" ,
                    s : ""
                });
            });

            chSavedPreferences.bind("save", function(trans, p) {
                var requestJSON = null;
                try { requestJSON = JSON.parse(p); } catch (e) { }

                var hasCategory = (("c" in requestJSON) && (typeof requestJSON.c === "string"));
                var hasFit      = (("f" in requestJSON) && (typeof requestJSON.f === "string"));
                var hasSize     = (("s" in requestJSON) && (typeof requestJSON.s === "string"));
                var isValid     = (hasCategory && hasFit && hasSize);

                if (isValid) {
                    var currentData = (function() {
                        var _defaultData = {
                            h : (function() {
                                var hash = CryptoJS.SHA1(JSON.stringify([]));
                                return hash.toString(CryptoJS.enc.Hex);
                            })(),
                            d : []
                        };
                        var _currentData = null;

                        try {
                            _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                        }
                        catch (e) { }

                        var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                        var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                        var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                        var isValid  = (hasHash && hasData);

                        return isValid ? _currentData : _defaultData;
                    })();
                    var newData = (function() {
                        var itemsList = [];
                        var itemFound = false;

                        for (var i = 0; i < currentData.d.length; i++) {
                            var item    = currentData.d[i];
                            var isValid = Util.validateSavedPreferenceItem(item);
                            if (isValid) {
                                if (item.c === requestJSON.c) {
                                    if (requestJSON.f.length > 0) { item.f = requestJSON.f; }
                                    if (requestJSON.s.length > 0) { item.s = requestJSON.s; }
                                    itemFound = true;
                                }
                                itemsList.push(item);
                            }
                        }

                        if ( !itemFound ) {
                            itemsList.push({
                                c : requestJSON.c,
                                h : "n",
                                f : requestJSON.f,
                                s : requestJSON.s
                            });
                        }

                        return itemsList;
                    })();
                    var newHash = (function() {
                        var hash = CryptoJS.SHA1(JSON.stringify(newData));
                        return hash.toString(CryptoJS.enc.Hex);
                    })();
                    var jsonStr = JSON.stringify({
                        h : newHash,
                        d : newData
                    });

                    if (jsonStr.length < 120000) {
                        try { localStorage.setItem("SavedPreferences", jsonStr); }
                        catch (e) { }
                        return JSON.stringify({ s : "Ok!" });
                    }
                    else {
                        return JSON.stringify({ s : "Quota exceeded!" });
                    }
                }
                else {
                    return JSON.stringify({ s : "Invalid input!" });
                }
            });

            chSavedPreferences.bind("clear", function(trans, p) {
                var reqCategoryId = p;
                var currentData = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var newData = (function() {
                    var itemsList = [];

                    for (var i = 0; i < currentData.d.length; i++) {
                        var item    = currentData.d[i];
                        var isValid = Util.validateSavedPreferenceItem(item);
                        if (isValid) {
                            if (item.c === reqCategoryId) {
                                item.f    = "";
                                item.s    = "";
                            }
                            itemsList.push(item);
                        }
                    }

                    return itemsList;
                })();
                var newHash = (function() {
                    var hash = CryptoJS.SHA1(JSON.stringify(newData));
                    return hash.toString(CryptoJS.enc.Hex);
                })();
                var jsonStr = JSON.stringify({
                    h : newHash,
                    d : newData
                });

                if (jsonStr.length < 120000) {
                    try { localStorage.setItem("SavedPreferences", jsonStr); }
                    catch (e) { }
                    return JSON.stringify({ s : "Ok!" });
                }
                else {
                    return JSON.stringify({ s : "Quota exceeded!" });
                }
            });

            chSavedPreferences.bind("show", function(trans, p) {
                var reqCategoryId = p;
                var currentData   = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var newData = (function() {
                    var itemsList = [];
                    var itemFound = false;

                    for (var i = 0; i < currentData.d.length; i++) {
                        var item    = currentData.d[i];
                        var isValid = Util.validateSavedPreferenceItem(item);
                        if (isValid) {
                            if (item.c === reqCategoryId) {
                                item.h    = "n";
                                itemFound = true;
                            }
                            itemsList.push(item);
                        }
                    }

                    if ( !itemFound ) {
                        itemsList.push({
                            c : reqCategoryId,
                            h : "n",
                            f : "" ,
                            s : ""
                        });
                    }

                    return itemsList;
                })();
                var newHash = (function() {
                    var hash = CryptoJS.SHA1(JSON.stringify(newData));
                    return hash.toString(CryptoJS.enc.Hex);
                })();
                var jsonStr = JSON.stringify({
                    h : newHash,
                    d : newData
                });

                if (jsonStr.length < 120000) {
                    try { localStorage.setItem("SavedPreferences", jsonStr); }
                    catch (e) { }
                    return JSON.stringify({ s : "Ok!" });
                }
                else {
                    return JSON.stringify({ s : "Quota exceeded!" });
                }
            });

            chSavedPreferences.bind("hide", function(trans, p) {
                var reqCategoryId = p;
                var currentData   = (function() {
                    var _defaultData = {
                        h : (function() {
                            var hash = CryptoJS.SHA1(JSON.stringify([]));
                            return hash.toString(CryptoJS.enc.Hex);
                        })(),
                        d : []
                    };
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("SavedPreferences"));
                    }
                    catch (e) { }

                    var isObject = ((_currentData != null) && (typeof _currentData === "object"));
                    var hasHash  = (isObject && ("h" in _currentData) && (typeof _currentData.h === "string"));
                    var hasData  = (isObject && ("d" in _currentData) && (_currentData.d instanceof Array)  );
                    var isValid  = (hasHash && hasData);

                    return isValid ? _currentData : _defaultData;
                })();
                var newData = (function() {
                    var itemsList = [];
                    var itemFound = false;

                    for (var i = 0; i < currentData.d.length; i++) {
                        var item    = currentData.d[i];
                        var isValid = Util.validateSavedPreferenceItem(item);
                        if (isValid) {
                            if (item.c === reqCategoryId) {
                                item.h    = "y";
                                itemFound = true;
                            }
                            itemsList.push(item);
                        }
                    }

                    if ( !itemFound ) {
                        itemsList.push({
                            c : reqCategoryId,
                            h : "y",
                            f : "" ,
                            s : ""
                        });
                    }

                    return itemsList;
                })();
                var newHash = (function() {
                    var hash = CryptoJS.SHA1(JSON.stringify(newData));
                    return hash.toString(CryptoJS.enc.Hex);
                })();
                var jsonStr = JSON.stringify({
                    h : newHash,
                    d : newData
                });

                if (jsonStr.length < 120000) {
                    try { localStorage.setItem("SavedPreferences", jsonStr); }
                    catch (e) { }
                    return JSON.stringify({ s : "Ok!" });
                }
                else {
                    return JSON.stringify({ s : "Quota exceeded!" });
                }
            });
        </script>

        <script type="text/javascript">
            // Recently Viewed Products
            var chRecentlyViewedProducts = Channel.build({
                window : window.parent,
                origin : "*",
                scope  : "RecentlyViewedProducts"
            });

            chRecentlyViewedProducts.bind("get", function(trans, p) {
                var defaultData = [];
                var currentData = null;

                try {
                    currentData = JSON.parse(localStorage.getItem("RecentlyViewedProducts"));
                }
                catch (e) { }

                var isValid    = ((currentData != null) && (currentData instanceof Array));
                var returnData = (isValid ? currentData : defaultData).reverse();
                return JSON.stringify(returnData.slice(1));
            });

            chRecentlyViewedProducts.bind("add", function(trans, p) {
                var requestItems = (function() {
                    var _defaultItems = [];
                    var _requestItems = null;

                    try {
                        _requestItems = JSON.parse(p);
                    }
                    catch (e) { }

                    var isValid = (_requestItems instanceof Array);

                    return isValid ? _requestItems : _defaultItems;
                })();
                var currentData = (function() {
                    var _defaultData = [];
                    var _currentData = null;

                    try {
                        _currentData = JSON.parse(localStorage.getItem("RecentlyViewedProducts"));
                    }
                    catch (e) { }

                    var isValid = ((_currentData != null) && (_currentData instanceof Array));
                    return isValid ? _currentData : _defaultData;
                })();

                for (var i = 0; i < requestItems.length; i++) {
                    var item = requestItems[i];
                    var idx  = jQuery.inArray(item, currentData);

                    if (idx != -1) {
                        currentData.splice(idx, 1);
                    }

                    currentData.push(item);

                    if (currentData.length > 10) {
                        currentData = Util.getRecentlyViewedProducts(currentData);
                    }
                }

                try {
                    localStorage.setItem("RecentlyViewedProducts", JSON.stringify(currentData));
                }
                catch (e) { }
            });
        </script>
    </head>
    <body>
</body></html>