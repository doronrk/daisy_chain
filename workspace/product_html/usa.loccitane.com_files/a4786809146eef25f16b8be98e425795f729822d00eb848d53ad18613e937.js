/* creation date: Wed, 26 Nov 2014 10:09:33 GMT
concat references:
http://usa.loccitane.com/js/OCMS.product_page.js?20140827001
*/
OCMS.productpage={defaultTitle:"",pageTemplate:"",pageArticleTitle:"",sku:"",hideZoomImage:false,zoomIsOpen:false,baseImageUrl:"",baseImageThumbUrl:"",thumbnailSize:0,baseImageZoomUrl:"",formatTested:"default",imageSelector:".product_main_image, .product_badges",rating:0,writeTestimonialLabel:"",clientIDs:{sendFriendSlide:"",productImg:"",txtFeedbackMessage:"",plFeedbackLogin:""},messages:{feedbackFinished:"",loginError:"",feedbackEmailError:""},init:function(){$(document).ready(function(){OCMS.productpage.updateBreadcrumb()});OCMS.productpage.hideZoomImage=OCMS.productpage.hideZoomImage=="true"?true:false;switch(OCMS.GlobalVars.Brand){case"occ":case"erb":OCMS.productpage.thumbnailSize=48;break;case"mel":OCMS.productpage.thumbnailSize=65;break;default:break}$(document).ready(function(){setTimeout(function(){if(typeof twttr!="undefined"){twttr.events.bind("tweet",function(aoEvent){OCMS.addToDataLayer({event:"social",action:"Twitter_tweet",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle})})}},3e3);$(document).on("click","#pinIt a",function(aoEvent){OCMS.addToDataLayer({event:"social",action:"Pinterest_Pinit",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle})});$(document).on("click","#"+OCMS.productpage.clientIDs.sendFriendSlide,function(aoEvent){OCMS.addToDataLayer({event:"social",action:"Email_share",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle})});$(document).on("click","#crossSellCarousel .productThumbnail .thumbnailSelection .button_basic",function(aoEvent){addToBasketCrossSell(aoEvent,$(this))});$(document).on("click","#recentlyViewedCarousel .productThumbnail .thumbnailSelection .button_basic",function(aoEvent){addToBasketCrossSell(aoEvent,$(this))});$(document).on("click","#complementaryCarousel .productThumbnail .thumbnailSelection .button_basic",function(aoEvent){addToBasketCrossSell(aoEvent,$(this))});if(!OCMS.productpage.hideZoomImage){$(document).on("click","#"+OCMS.productpage.clientIDs.productImg,function(aoEvent){aoEvent.preventDefault();$("#mask").css({opacity:"0.5"}).fadeIn("fast");$("#maskimage").center().fadeIn("fast");return false});$(document).keypress(function(aoEvent){if(aoEvent.keyCode==27){HidePopupImage()}});$(document).on("click","#mask",function(){HidePopupImage()});$(document).on("click","#maskimage",function(){HidePopupImage()})}$(document).on("click","#product_text_display",handleTabReadMoreClick);if(OCMS.GlobalVars.IsMobile){OCMS.mobile.productPage()}});$(function(){$("#product_thumbs .item[data-idx='0']").append('<img src="'+OCMS.productpage.baseImageThumbUrl+'" class="product-image-thumb" width="'+OCMS.productpage.thumbnailSize+'" height="'+OCMS.productpage.thumbnailSize+'" data-main="'+OCMS.productpage.baseImageUrl+'" data-zoom="'+OCMS.productpage.baseImageZoomUrl+'" />');if(OCMS.GlobalVars.Brand=="mel"){$("#product_thumbs .item[data-idx='0']").append('<div class="cash">&nbsp;</div>')}if(!OCMS.productpage.hideZoomImage){$(".product_zoom").show();$(".product_main_image").attr("data-zoom",$(".product_main_image_zoom").attr("src"));$(OCMS.productpage.imageSelector).click(showZoomImage).css("cursor","pointer")}else{$(".product_badges").css("cursor","default")}addThumbnail(OCMS.productpage.baseImageUrl,OCMS.productpage.baseImageThumbUrl,OCMS.productpage.baseImageZoomUrl,1);$(document).on("click","#product_thumbs .item",function(){var _img=$(".product_main_image");var _icon=$(".product_zoom");$(OCMS.productpage.imageSelector).unbind("click").css("cursor","default");_icon.hide();var _thumb=$(this).children(".product-image-thumb");var _url=_thumb.attr("data-main");var _zoom=_thumb.attr("data-zoom");_img.attr("src",_url);if(_zoom!==undefined&&_zoom!=null&&_zoom!="undefined"){_img.attr("data-zoom",_zoom);$(".product_zoom").show();$(OCMS.productpage.imageSelector).click(showZoomImage).css("cursor","pointer")}OCMS.addToDataLayer({event:"productPictures",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle})});$(document).on("click","#product_thumbs .item.youtube img, #product_thumbs .item.youku img",function(event){var _img=$(this);OCMS.Popin.open({id:"youtubePopin",content:'<iframe width="640" height="360" src="'+_img.attr("data-url")+'" frameborder="0" allowfullscreen></iframe>',displayFooter:false,displayHeader:false,activateOverlayClick:true,onBeforeOpen:function(c,p){p.container.find(".popinContent").css({padding:"0px"});return true},onOpen:function(){if("undefined"!=typeof _gaq){_gaq.push(["_trackEvent","Video_ProductsPage","Play_"+_img.attr("data-url"),OCMS.productpage.sku])}}})})});OCMS.ui.sendtestimonial=function(){$.ajax({type:"POST",url:"/ajax/UtilsAjax.aspx",data:{task:"feedback",login:"",pwd:"",feedback:$("#"+OCMS.productpage.clientIDs.txtFeedbackMessage).val(),c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L,sku:OCMS.productpage.sku,rate:OCMS.productpage.rating},success:function(data){var tdata=eval("("+data+")");if(tdata.success==1){showPopinSuccessMessage(OCMS.productpage.messages.feedbackFinished);$("#productfeedbackwritting").css("display","none");OCMS.addToDataLayer({event:"productComment",pagetemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle,productRating:OCMS.productpage.rating})}else{if(tdata.error=="login"){showPopinErrorMessage(OCMS.productpage.messages.loginError);$("#"+OCMS.productpage.clientIDs.plFeedbackLogin).show()}else{showPopinErrorMessage(OCMS.productpage.messages.feedbackEmailError)}}}})};$(document).ready(function(){$("#linkValidFeedback").click(function(aoEvent){if(GetDefaultValidationResultWithoutHidden($(".validationGroupFeedback"))&&$("#testimonials_rate input[type=hidden]").valid()){if(dataLayer[0].userIsLogged=="false"){if(OCMS.GlobalVars.Brand=="occ"||OCMS.GlobalVars.Brand=="mel"||OCMS.GlobalVars.Brand=="erb"||OCMS.GlobalVars.Brand=="cdm"){OCMS.showLoginPanel(null,function(){OCMS.ui.sendtestimonial()})}else{openLoginPopin({title:OCMS.productpage.writeTestimonialLabel},null,function(){OCMS.ui.sendtestimonial()})}}else{OCMS.ui.sendtestimonial()}}return false});var _ratingImagesFolder="/img/"+OCMS.GlobalVars.Brand+"/new/";if(OCMS.GlobalVars.Brand=="mel"){_ratingImagesFolder="/img/"+OCMS.GlobalVars.Brand+"/redesign/design/"}else if(OCMS.GlobalVars.Brand=="erb"||OCMS.GlobalVars.Brand=="cdm"){_ratingImagesFolder="/img/"+OCMS.GlobalVars.Brand+"/design/"}$("#testimonials_rate").raty({start:0,path:_ratingImagesFolder,starHalf:"rate_half.png",starOff:"rate_none.png",starOn:"rate_full.png",hintList:["","","","",""],click:function(value){OCMS.productpage.rating=value*2}});var _input=$("#testimonials_rate input[type=hidden]");_input.val("");_input.width(120);_input.addClass("required")})},updateBreadcrumb:function(){var _breadcrumb=$("#breadcrumb");if(!_breadcrumb.length){return}var _hash=window.location.hash;var _index=_hash.indexOf("s=");if(_index!=-1){var _sectionID=_hash.substr(_index+2);if(!OCMS.utils.isEmpty(_sectionID)&&!isNaN(_sectionID)){$.get("/ajax/UtilsAjax.aspx",{task:"getRailWay",c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L,a:OCMS.GlobalVars.A,s:_sectionID},function(htmlContent){var _newBreadcrumb=$(htmlContent);_breadcrumb.html(_newBreadcrumb.html())})}}},refreshTab:function(){var _product_text=$("#product_text");if(OCMS.GlobalVars.Brand=="mel"){_product_text.find("ul.prd-ingredient > li .ingredient-image-mask").each(function(){var _image=$(this).prevAll(".ingredient-image");if(_image.length){$(this).get(0).style.height=_image.get(0).offsetHeight+"px";if(OCMS.utils.isEmpty($(this).html())){var _src="/img/MEL/ingredient-image-mask-small.png";$(this).html('<img src="'+_src+'" />')}}})}var _minHeightValue=_product_text.attr("data-min-height");if(_minHeightValue===undefined){_minHeightValue=_product_text.height();if(OCMS.GlobalVars.Brand=="occ"||OCMS.GlobalVars.Brand=="mel"){var _breadcrumb=$("#breadcrumb");if(_breadcrumb.length){_minHeightValue-=_breadcrumb.get(0).offsetHeight}}_product_text.attr("data-min-height",_minHeightValue)}_product_text.height("auto");setTimeout(function(){var _fullHeight=_product_text.height();var _diffHeight=_fullHeight-_minHeightValue;_product_text.height(_minHeightValue);_product_text.attr("data-max-height",_fullHeight>_minHeightValue?_fullHeight:_minHeightValue);var _product_text_display=$("#product_text_display");if(_diffHeight<=0){_product_text_display.hide()}else{var _arrow=$("#product_text_display > .right");_arrow.removeClass("close");_arrow.addClass("open");_product_text_display.show()}},0)}};window.fbAsyncInit=function(){FB.Event.subscribe("edge.create",function(aoResponse){OCMS.addToDataLayer({event:"social",action:"Facebook_share",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle})})};function addToBasketCrossSell(aoEvent,aoButton){var _parent=$(aoButton).parents(".productThumbnail");var _title=$(_parent).children(".thumbnailTitle").text();var _price=$(_parent).children(".thumbnailPrice").text();OCMS.addToDataLayer({event:"addToBasketCrossSell",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:_title,productPrice:_price})}function HidePopupImage(){$("#mask").fadeOut("fast");$("#maskimage").fadeOut("fast")}function changeTab(aoTabContentContainer,aoTabContainer,abAllowReclick){if(OCMS.GlobalVars.IsMobile&&OCMS.GlobalVars.Brand=="erb"){$("#product_description_menu li").each(function(){var _tabLink=$(this).children("a");if(_tabLink.length){var _dropdownIcon=_tabLink.children(".product-tabs-dropdown-icon");if(!_dropdownIcon.length){_tabLink.prepend('<div class="product-tabs-dropdown-icon"></div>')}}if($(this).get(0)===$(aoTabContainer).get(0)){if($(this)!==$(aoTabContentContainer).parent().get(0)){$(this).append(aoTabContentContainer);aoTabContentContainer.addClass("tabnavproductContent")}$(aoTabContainer).toggleClass("on")}else{$(this).removeClass("on")}if($(this).hasClass("on")){$(this).children(".tabnavproductContent").slideDown(300)}else{$(this).children(".tabnavproductContent").slideUp(300)}})}else{if(!abAllowReclick&&$(aoTabContainer).hasClass("on")){return}$(".tabnavproductContent").css("display","none");$("#product_description_menu li").removeAttr("class");$(aoTabContainer).addClass("on");$("#product_text").html($(aoTabContentContainer).html());OCMS.productpage.refreshTab();OCMS.addToDataLayer({event:"productDescription",pageTemplate:OCMS.productpage.pageTemplate,pageArticleTitle:OCMS.productpage.pageArticleTitle,label:$(aoTabContainer).children("a").text()})}}function handleTabReadMoreClick(){var _product_text=$("#product_text");var _arrow=$("#product_text_display > .right");if(_arrow.hasClass("open")){_arrow.removeClass("open");_arrow.addClass("close");var _maxHeightValue=_product_text.attr("data-max-height");_product_text.animate({height:_maxHeightValue},500,"swing")}else{_arrow.removeClass("close");_arrow.addClass("open");var _minHeightValue=_product_text.attr("data-min-height");_product_text.animate({height:_minHeightValue},500,"swing")}}function ToggleDivSlide(aoElement){if($(aoElement).css("display")=="none"){$(".panelslide").slideUp()}$(aoElement).slideToggle()}function ProductAddTobag(sku,idArticle,quantity,atbBtn,iybBtn,qtyL,iybLbl,lqLbl){addToBagV2(sku,idArticle,quantity,OCMS.GlobalVars.C,OCMS.GlobalVars.L,false,false);$("#"+atbBtn).fadeOut("fast",function(){$("#"+iybBtn).fadeIn("fast")});$("#"+qtyL).fadeOut("fast",function(){$("#"+lqLbl).fadeOut("fast");$("#"+iybLbl).fadeIn("fast")})}function addThumbnail(asBaseImageUrl,asBaseThumbnailUrl,asBaseZoomImageUrl,anIndex){var _baseImageURL=asBaseImageUrl+"_"+anIndex+"&nodef=true";var _thumbnailURL=asBaseThumbnailUrl+"_"+anIndex+"&nodef=true";var _zoomImageURL=asBaseZoomImageUrl+"_"+anIndex+"&nodef=true";var _thumbnailSize=48;if(OCMS.GlobalVars.Brand=="mel"){_thumbnailSize=65}$('<img src="'+_thumbnailURL+'" class="product-image-thumb" width="'+_thumbnailSize+'" height="'+_thumbnailSize+'" data-main="'+_baseImageURL+'"  data-zoom="'+_zoomImageURL+'" />').load([anIndex],function(event){var _img=$(this);var _wrap=$("#product_thumbs .item[data-idx='"+event.data[0]+"']");$("#product_thumbs .item[data-idx='0']").show();_wrap.show();_wrap.append(_img);if(OCMS.GlobalVars.Brand=="mel"){_wrap.append('<div class="cash">&nbsp;</div>')}OCMS.productpage.formatTested="default";if(anIndex+1<=10){addThumbnail(asBaseImageUrl,asBaseThumbnailUrl,asBaseZoomImageUrl,anIndex+1)}}).error(function(){if(OCMS.productpage.formatTested=="default"&&asBaseImageUrl.indexOf("&e=")!=-1){if(asBaseImageUrl.indexOf("jpg")!=-1){var _oldFormat="jpg",_newFormat="png"}else if(asBaseImageUrl.indexOf("png")!=-1){var _oldFormat="png",_newFormat="jpg"}var _newbaseUrl=asBaseImageUrl.replace(_oldFormat,_newFormat);OCMS.productpage.formatTested="alternative";addThumbnail(_newbaseUrl,asBaseThumbnailUrl,asBaseZoomImageUrl,anIndex)}$(this).remove();if(OCMS.GlobalVars.Brand=="cdm"&&anIndex<=1){$("#product_thumbs .item[data-idx='0']").hide()}})}function showZoomImage(aoEvent){if(OCMS.GlobalVars.IsMobile){return}if(!OCMS.productpage.zoomIsOpen){OCMS.productpage.zoomIsOpen=true;var _img=$(".product_main_image");if(OCMS.GlobalVars.Brand=="occ"&&OCMS.GlobalVars.C==43&&OCMS.GlobalVars.S==38218){OCMS.productpage.defaultTitle="L'OCCITANE AU BRÃ‰SIL"}OCMS.Popin.open({id:"popinZoomImage",title:OCMS.productpage.pageArticleTitle+" - "+OCMS.productpage.defaultTitle,content:'<img class="zoom-image" src="'+_img.attr("data-zoom")+'" alt="" />',displayFooter:false,activateOverlayClick:true,onClose:function(){OCMS.productpage.zoomIsOpen=false}});OCMS.addToDataLayer({event:"productZoom",pageTemplate:OCMS.productpage.pageTemplate,action:"Product_zoom",pageArticleTitle:OCMS.productpage.pageArticleTitle})}}function checkLength(aoTextarea){var _realLength=aoTextarea.value.length;var _length=aoTextarea.value.replace(/\r/ig,"").length;if(_length>500){var _tail=_length-500;_length=500;aoTextarea.value=aoTextarea.value.substring(0,_realLength-_tail)}document.getElementById("spanCharLeft").innerHTML=500-_length}function ClearHtmlTags(){for(var i=0;i<document.forms[0].elements.length;i++){if(document.forms[0].elements[i].type=="text"||document.forms[0].elements[i].type=="textarea"){if(document.forms[0].elements[i].value.indexOf("<")>=0){do{document.forms[0][i].value=document.forms[0].elements[i].value.replace("<","&lt;")}while(document.forms[0].elements[i].value.indexOf("<")>=0)}if(document.forms[0].elements[i].value.indexOf(">")>=0){do{document.forms[0][i].value=document.forms[0].elements[i].value.replace(">","&gt;")}while(document.forms[0].elements[i].value.indexOf(">")>=0)}}}}$(document).ready(function(){$("#ctl00_ContentPlaceHolder1_ctl00_txtFeedbackMessage").val("")})