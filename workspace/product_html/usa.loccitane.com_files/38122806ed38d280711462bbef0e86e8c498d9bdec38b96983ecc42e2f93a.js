/* creation date: Wed, 26 Nov 2014 10:09:34 GMT
concat references:
http://usa.loccitane.com/js/_controls/OCMS.controls.search_form.js?20141103001
*/
OCMS.controls.searchform={moreResultsTranslation:"",searchTranslation:"",_searchTimeout:0,_searchRequest:null,_searchInputLastLength:0,_searchResultItemTemplate:OCMS.GlobalVars.Brand!="cdm"?['<a href="[data.url]" class="darkgrey search-short-url" title="[data.alt]">','<span class="left">','<img src="[data.image]" width="50" height="50" alt="" />',"</span>",'<span class="right search-short-url-infos">','<span class="bold search-short-url-title align-left">',"[data.title]","</span>",'<span class="search-short-url-description darkgrey align-left">',"[data.description]","</span>","</span>","</a>"]:['<a href="[data.url]" class="search-short-url" title="[data.alt]">','<span class="search-short-url-infos">','<span class="search-short-url-title">',"[data.title]","</span>",'<span class="search-short-url-description">',"[data.description]","</span>","</span>","<span>",'<img class="search-result-thumbnail" src="[data.image]" width="400" height="400" alt="" />',"</span>","</a>"],ellipsis:function(value,n,end){if(!value){return""}if(value.length<=n){return value}var sub=value.substring(0,n);var builder=[];builder.push(sub.substring(0,sub.lastIndexOf(" ")));builder.push(end);return builder.join("")},init:function(){if(OCMS.GlobalVars.IsMobile){if(OCMS.GlobalVars.Brand=="erb"){$(document).on("focus","#searchfield",function(event){var _searchButtonContainer=$("#btnSearch");if(_searchButtonContainer.length){_searchButtonContainer.addClass("with-focus")}});$(document).on("blur","#searchfield",function(event){var _searchButtonContainer=$("#btnSearch");if(_searchButtonContainer.length){_searchButtonContainer.removeClass("with-focus")}})}}else{$(function(){if(OCMS.GlobalVars.Brand!="cdm"){$(document).on("mouseover",".search-short-url",function(event){$(this).addClass("lightblue_back")});$(document).on("mouseout",".search-short-url",function(event){$(this).removeClass("lightblue_back")});$("#searchfield").blur(function(event){$("#shortUrlsContainer").fadeOut("fast")})}$("#searchfield").keyup(function(event){var input=$(this);var value=input.val();clearTimeout(OCMS.controls.searchform._searchTimeout);if(OCMS.controls.searchform._searchRequest!=null&&typeof OCMS.controls.searchform._searchRequest.abort=="function"){OCMS.controls.searchform._searchRequest.abort()}if(value&&value.length>1){if(event.keyCode!=32&&event.keyCode!=54){OCMS.controls.searchform._searchTimeout=setTimeout(function(){OCMS.controls.searchform._searchRequest=$.ajax({url:"/ajax/UtilsAjax.aspx",data:{c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L,task:"searchresult",query:value},dataType:"json",type:"post"});OCMS.controls.searchform._searchRequest.done(function(result){if(result.success){if(result.data&&result.data.length>0){var length=result.data.length;var builder=[];var skus=[];for(var i=0;i<length;i++){var item=result.data[i];item.description=OCMS.controls.searchform.ellipsis($("<div>"+item.description+"</div>").text(),80,"...");builder.push(OCMS.utils.renderTemplate(OCMS.controls.searchform._searchResultItemTemplate,item));item.url+="?search="+value;skus.push(item.sku)}OCMS.addToDataLayer({event:"internalSearchAllPages",category:"Internal_search",action:"Autocompletion",query:value,searchedProducts:skus});$(".search-short-urls-inner").empty().append(builder.join(""));var _parentContainer=OCMS.GlobalVars.Brand!="cdm"?$("#shortUrlsContainer"):$("#sideSearchContentContainer");_parentContainer.removeClass("empty-block");if(OCMS.controls.searchform.moreResultsTranslation.length>0){var _moreResultsHTML=['<div class="search-short-url-more search-short-url">','<a href="javascript:goSearchpage(OCMS.controls.searchform.searchTranslation, '+OCMS.GlobalVars.C+", "+OCMS.GlobalVars.L+');"'+(OCMS.GlobalVars.Brand!="cdm"?"":' class="button_basic"')+">",OCMS.controls.searchform.moreResultsTranslation,"</a>","</div>"].join("");if(OCMS.GlobalVars.Brand!="cdm"){$(".search-short-urls-inner").append(_moreResultsHTML)}else{if(!$("#shortUrlsContainer").find(".search-short-url-more").length){$("#sideSearchResultsWrapper").parent().append(_moreResultsHTML)}}}if(OCMS.GlobalVars.Brand!="cdm"){$("#shortUrlsContainer").fadeIn("fast",function(){if(OCMS.GlobalVars.Brand=="erb"){OCMS.ui.positionsearch()}})}}else{if(OCMS.GlobalVars.Brand!="cdm"){$("#shortUrlsContainer").fadeOut("fast")}$(".search-short-urls-inner").empty();var _parentContainer=OCMS.GlobalVars.Brand!="cdm"?$("#shortUrlsContainer"):$("#sideSearchContentContainer");_parentContainer.addClass("empty-block");if(OCMS.GlobalVars.Brand=="cdm"){$("#shortUrlsContainer").find(".search-short-url-more").remove()}}}else{OCMS.LogError("Search short urls result fail : "+result.error)}OCMS.controls.searchform._searchRequest=null}).fail(function(xhr,status,message){if(message!="abort"){OCMS.LogError("Search short urls request fail : "+message)}}).always(function(){if(OCMS.GlobalVars.Brand=="cdm"){OCMS.ui.sidesearch.handleResultsArrival()}})},150)}}else{if(OCMS.GlobalVars.Brand!="cdm"){$("#shortUrlsContainer").fadeOut("fast")}$(".search-short-urls-inner").empty();var _parentContainer=OCMS.GlobalVars.Brand!="cdm"?$("#shortUrlsContainer"):$("#sideSearchContentContainer");_parentContainer.addClass("empty-block");if(OCMS.GlobalVars.Brand=="cdm"){$("#shortUrlsContainer").find(".search-short-url-more").remove()}}if(OCMS.GlobalVars.Brand=="cdm"){OCMS.ui.sidesearch.handleResultsArrival()}})})}}}