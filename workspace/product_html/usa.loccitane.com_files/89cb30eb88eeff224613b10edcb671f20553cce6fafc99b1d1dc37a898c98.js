/* creation date: Wed, 26 Nov 2014 10:09:34 GMT
concat references:
http://usa.loccitane.com/js/_controls/popins/OCMS.controls.add_to_bag_popin.js?20140905001
*/
OCMS.controls.addtobagpopin={addToBagPopinOptions:{id:"addToBagPopin",content:"",displayHeader:true,displayFooter:false,activateOverlayClick:true,onBeforeOpen:function(aoComponent,aoPopinConfig){aoPopinConfig.container.find(".popinContent .popinClose").remove();OCMS.Popin.overlay.css("cursor","pointer");return true},onOpen:function(){var spinner=(new Spinner(OCMS.controls.loadingpopin.spinnerOpts)).spin(document.getElementById("spinner"))},onOverlayClick:function(event){OCMS.Popin.close();OCMS.Popin.overlay.css("cursor","default");clearTimeout(OCMS.controls.addtobagpopin.timer)},onClose:function(aoComponent,aoPopinConfig){OCMS.events.addtobagPopinLoaded=false}},timer:null,linkToBag:"",titleLabel:"",shopLabel:"",bagLabel:"",init:function(){var _contentHTML="";if(OCMS.GlobalVars.Brand=="occ"||OCMS.GlobalVars.Brand=="mel"||OCMS.GlobalVars.Brand=="erb"||OCMS.GlobalVars.Brand=="cdm"){_contentHTML=['<div class="popin_container_title">'+this.titleLabel+"</div>",'<div class="popin_container_product">','<div style="text-align:center;">','<img src="[data.productImage]" width="120" height="120" alt="" />','<p class="darkblue" style="text-align:center;">[data.productTitle]</p>','<p class="thumbnailPrice" style="text-align:center;">[data.productPrice]</p>',"</div>","</div>",'<div id="bloc_linkto">','<a id="linkToShop" class="button_secondary" href="javascript:void(0);">',this.shopLabel,"</a>",'<a id="linkToBag" class="button_basic" href="javascript:void(0);">',this.bagLabel,"</a>",'<div style="clear:both;"></div>',"</div>",'<div id="popinComplementaryProducts">','<div id="spinner"></div>',"</div>"].join("")}else{_contentHTML=['<div class="bold" style="text-align:center; padding:20px 20px 10px; font-size:14px;">'+this.titleLabel+"</div>","<div>",'<div style="text-align:center;">','<img src="[data.productImage]" width="120" height="120" alt="" />','<p class="darkblue bold" style="text-align:center;">[data.productTitle]</p>','<p class="productThumbnail" style="text-align:center;">[data.productPrice]</p>',"</div>","</div>","<div>",'<a id="linkToShop" href="javascript:void(0);" class="darkbluebutton left" style="margin:10px 20px">',this.shopLabel,"</a>",'<a id="linkToBag" href="javascript:void(0);" class="darkbluebutton right" style="margin:10px 20px">',this.bagLabel,"</a>",'<div style="clear:both;"></div>',"</div>",'<div id="popinComplementaryProducts">','<div id="spinner"></div>',"</div>"].join("");this.addToBagPopinOptions["minWidth"]=350}this.addToBagPopinOptions.content=_contentHTML}};function ShowPopupAddToBag(options){if(OCMS.GlobalVars.IsMobile){return}OCMS.Popin.close();var o=$.extend({},OCMS.controls.addtobagpopin.addToBagPopinOptions);o.content=OCMS.Popin.renderTemplate(o.content,options);OCMS.Popin.open(o);$.ajax({url:"/ajax/UtilsAjax.aspx",data:{Task:"getcomplementary",articleId:options.articleId,c:OCMS.GlobalVars.C,l:OCMS.GlobalVars.L},type:"post",success:function(html){var _popinComplementaryProducts=$("#popinComplementaryProducts");if(!html||typeof html!="string"||html.length===0){_popinComplementaryProducts.empty();OCMS.Popin.current.container.center();clearTimeout(OCMS.controls.addtobagpopin.timer);OCMS.controls.addtobagpopin.timer=setTimeout(function(){HidePopupAddToBag()},5e3);return}_popinComplementaryProducts.html(html);if(OCMS.GlobalVars.Brand=="occ"||OCMS.GlobalVars.Brand=="mel"||OCMS.GlobalVars.Brand=="erb"||OCMS.GlobalVars.Brand=="cdm"){var _productThumbnailsListContainer=$("#popinComplementaryProducts .thumbnailContainerSmall").parent();_productThumbnailsListContainer.width("auto");_productThumbnailsListContainer.addClass("inline-block");$("#popinComplementaryProducts .thumbnailContainerSmall").css("border-width","0px");GlobalEqualizeElements()}else{OCMS.Popin.current.container.css("width","auto");$("#popinComplementaryProducts .thumbnailContainerSmall").css("border-width","0px");$("#popinComplementaryProducts .thumbnailSelection .greenbutton").each(function(index,element){var a=$(element);a.attr("data-onclick",a.attr("onclick"));a.attr("onclick","")}).click(function(e){e.preventDefault();var a=$(this);OCMS.Popin.close();var c=a.attr("data-onclick");if(c===undefined||c==null||c===""){document.location=a.attr("href")}eval("(function() {"+c+"})()")})}OCMS.Popin.current.container.center();$(document).trigger("addtobagPopinLoaded")}});return false}function HidePopupAddToBag(){OCMS.Popin.close();OCMS.events.addtobagPopinLoaded=false}$(document).on("click","#linkToShop",function(){clearTimeout(OCMS.controls.addtobagpopin.timer);HidePopupAddToBag()});$(document).on("click","#linkToBag",function(){clearTimeout(OCMS.controls.addtobagpopin.timer);document.location.href=OCMS.controls.addtobagpopin.linkToBag;return true});$(document).on("click","#addToBagPopin #popinComplementaryProducts .thumbnailSelection .button_basic",function(event){var a=$(this);var parent=a.parents(".productThumbnail");var title=parent.find(".thumbnailTitle").text();var priceC=parent.find(".thumbnailPrice .priceAfterDiscount");if(priceC.length===0){priceC=parent.find(".thumbnailPrice")}var price=priceC.text();OCMS.addToDataLayer({event:"QuickshopCrossSell",pageTemplate:OCMS.GlobalVars.CurrentTemplate,pageArticleTitle:title,productPrice:price})})