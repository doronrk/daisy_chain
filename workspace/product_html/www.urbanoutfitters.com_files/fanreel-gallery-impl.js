var Curalate=window.Curalate||{};(function(a,b){Curalate.Spinner=b()}(this,function(){var e=["webkit","Moz","ms","O"],o={},n;function g(p,s){var q=document.createElement(p||"div"),r;for(r in s){q[r]=s[r]}return q}function h(q){for(var p=1,r=arguments.length;p<r;p++){q.appendChild(arguments[p])}return q}var i=(function(){var p=g("style",{type:"text/css"});h(document.getElementsByTagName("head")[0],p);return p.sheet||p.styleSheet}());function c(t,p,u,x){var q=["opacity",p,~~(t*100),u,x].join("-"),r=0.01+u/x*100,w=Math.max(1-(1-t)/p*(100-r),t),v=n.substring(0,n.indexOf("Animation")).toLowerCase(),s=v&&"-"+v+"-"||"";if(!o[q]){i.insertRule("@"+s+"keyframes "+q+"{0%{opacity:"+w+"}"+r+"%{opacity:"+t+"}"+(r+0.01)+"%{opacity:1}"+(r+p)%100+"%{opacity:"+t+"}100%{opacity:"+w+"}}",i.cssRules.length);o[q]=1}return q}function m(t,u){var r=t.style,p,q;if(r[u]!==undefined){return u}u=u.charAt(0).toUpperCase()+u.slice(1);for(q=0;q<e.length;q++){p=e[q]+u;if(r[p]!==undefined){return p}}}function f(p,r){for(var q in r){p.style[m(p,q)||q]=r[q]}return p}function k(r){for(var p=1;p<arguments.length;p++){var q=arguments[p];for(var s in q){if(r[s]===undefined){r[s]=q[s]}}}return r}function j(p){var q={x:p.offsetLeft,y:p.offsetTop};while((p=p.offsetParent)){q.x+=p.offsetLeft,q.y+=p.offsetTop}return q}var d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto",position:"relative"};function b(p){if(typeof this=="undefined"){return new b(p)}this.opts=k(p||{},b.defaults,d)}b.defaults={};k(b.prototype,{spin:function(y){this.stop();var C=this,q=C.opts,r=C.el=f(g(0,{className:q.className}),{position:q.position,width:0,zIndex:q.zIndex}),B=q.radius+q.length+q.width,D,A;if(y){y.insertBefore(r,y.firstChild||null);A=j(y);D=j(r);f(r,{left:(q.left=="auto"?A.x-D.x+(y.offsetWidth>>1):parseInt(q.left,10)+B)+"px",top:(q.top=="auto"?A.y-D.y+(y.offsetHeight>>1):parseInt(q.top,10)+B)+"px"})}r.setAttribute("role","progressbar");C.lines(r,C.opts);if(!n){var v=0,p=(q.lines-1)*(1-q.direction)/2,u,s=q.fps,x=s/q.speed,w=(1-q.opacity)/(x*q.trail/100),z=x/q.lines;(function t(){v++;for(var E=0;E<q.lines;E++){u=Math.max(1-(v+(q.lines-E)*z)%x*w,q.opacity);C.opacity(r,E*q.direction+p,u,q)}C.timeout=C.el&&setTimeout(t,~~(1000/s))})()}return C},stop:function(){var p=this.el;if(p){clearTimeout(this.timeout);if(p.parentNode){p.parentNode.removeChild(p)}this.el=undefined}return this},lines:function(r,t){var q=0,u=(t.lines-1)*(1-t.direction)/2,p;function s(v,w){return f(g(),{position:"absolute",width:(t.length+t.width)+"px",height:t.width+"px",background:v,boxShadow:w,transformOrigin:"left",transform:"rotate("+~~(360/t.lines*q+t.rotate)+"deg) translate("+t.radius+"px,0)",borderRadius:(t.corners*t.width>>1)+"px"})}for(;q<t.lines;q++){p=f(g(),{position:"absolute",top:1+~(t.width/2)+"px",transform:t.hwaccel?"translate3d(0,0,0)":"",opacity:t.opacity,animation:n&&c(t.opacity,t.trail,u+q*t.direction,t.lines)+" "+1/t.speed+"s linear infinite"});if(t.shadow){h(p,f(s("#000","0 0 4px #000"),{top:2+"px"}))}h(r,h(p,s(t.color,"0 0 1px rgba(0,0,0,.1)")))}return r},opacity:function(q,p,r){if(p<q.childNodes.length){q.childNodes[p].style.opacity=r}}});function l(){function p(r,q){return g("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',q)}i.addRule(".spin-vml","behavior:url(#default#VML)");b.prototype.lines=function(u,t){var q=t.length+t.width,A=2*q;function z(){return f(p("group",{coordsize:A+" "+A,coordorigin:-q+" "+-q}),{width:A,height:A})}var v=-(t.width+t.length)*2+"px",y=f(z(),{position:"absolute",top:v,left:v}),x;function w(s,r,B){h(y,h(f(z(),{rotation:360/t.lines*s+"deg",left:~~r}),h(f(p("roundrect",{arcsize:t.corners}),{width:q,height:t.width,left:t.radius,top:-t.width>>1,filter:B}),p("fill",{color:t.color,opacity:t.opacity}),p("stroke",{opacity:0}))))}if(t.shadow){for(x=1;x<=t.lines;x++){w(x,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(x=1;x<=t.lines;x++){w(x)}return h(u,y)};b.prototype.opacity=function(r,q,t,s){var u=r.firstChild;s=s.shadow&&s.lines||0;if(u&&q+s<u.childNodes.length){u=u.childNodes[q+s];u=u&&u.firstChild;u=u&&u.firstChild;if(u){u.opacity=t}}}}var a=f(g("group"),{behavior:"url(#default#VML)"});if(!m(a,"transform")&&a.adj){l()}else{n=m(a,"animation")}return b}));(function(){var w=this;var k=w._;var D={};var C=Array.prototype,f=Object.prototype,r=Function.prototype;var G=C.push,o=C.slice,y=C.concat,d=f.toString,j=f.hasOwnProperty;var K=C.forEach,q=C.map,E=C.reduce,c=C.reduceRight,b=C.filter,B=C.every,p=C.some,n=C.indexOf,l=C.lastIndexOf,u=Array.isArray,e=Object.keys,F=r.bind;var L=function(M){if(M instanceof L){return M}if(!(this instanceof L)){return new L(M)}this._wrapped=M};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=L}exports._=L}else{w._=L}L.VERSION="1.4.4";var H=L.each=L.forEach=function(R,Q,P){if(R==null){return}if(K&&R.forEach===K){R.forEach(Q,P)}else{if(R.length===+R.length){for(var O=0,M=R.length;O<M;O++){if(Q.call(P,R[O],O,R)===D){return}}}else{for(var N in R){if(L.has(R,N)){if(Q.call(P,R[N],N,R)===D){return}}}}}};L.map=L.collect=function(P,O,N){var M=[];if(P==null){return M}if(q&&P.map===q){return P.map(O,N)}H(P,function(S,Q,R){M[M.length]=O.call(N,S,Q,R)});return M};var g="Reduce of empty array with no initial value";L.reduce=L.foldl=L.inject=function(Q,P,M,O){var N=arguments.length>2;if(Q==null){Q=[]}if(E&&Q.reduce===E){if(O){P=L.bind(P,O)}return N?Q.reduce(P,M):Q.reduce(P)}H(Q,function(T,R,S){if(!N){M=T;N=true}else{M=P.call(O,M,T,R,S)}});if(!N){throw new TypeError(g)}return M};L.reduceRight=L.foldr=function(S,P,M,O){var N=arguments.length>2;if(S==null){S=[]}if(c&&S.reduceRight===c){if(O){P=L.bind(P,O)}return N?S.reduceRight(P,M):S.reduceRight(P)}var R=S.length;if(R!==+R){var Q=L.keys(S);R=Q.length}H(S,function(V,T,U){T=Q?Q[--R]:--R;if(!N){M=S[T];N=true}else{M=P.call(O,M,S[T],T,U)}});if(!N){throw new TypeError(g)}return M};L.find=L.detect=function(P,O,N){var M;A(P,function(S,Q,R){if(O.call(N,S,Q,R)){M=S;return true}});return M};L.filter=L.select=function(P,O,N){var M=[];if(P==null){return M}if(b&&P.filter===b){return P.filter(O,N)}H(P,function(S,Q,R){if(O.call(N,S,Q,R)){M[M.length]=S}});return M};L.reject=function(O,N,M){return L.filter(O,function(R,P,Q){return !N.call(M,R,P,Q)},M)};L.every=L.all=function(P,O,N){O||(O=L.identity);var M=true;if(P==null){return M}if(B&&P.every===B){return P.every(O,N)}H(P,function(S,Q,R){if(!(M=M&&O.call(N,S,Q,R))){return D}});return !!M};var A=L.some=L.any=function(P,O,N){O||(O=L.identity);var M=false;if(P==null){return M}if(p&&P.some===p){return P.some(O,N)}H(P,function(S,Q,R){if(M||(M=O.call(N,S,Q,R))){return D}});return !!M};L.contains=L.include=function(N,M){if(N==null){return false}if(n&&N.indexOf===n){return N.indexOf(M)!=-1}return A(N,function(O){return O===M})};L.invoke=function(O,P){var M=o.call(arguments,2);var N=L.isFunction(P);return L.map(O,function(Q){return(N?P:Q[P]).apply(Q,M)})};L.pluck=function(N,M){return L.map(N,function(O){return O[M]})};L.where=function(N,M,O){if(L.isEmpty(M)){return O?null:[]}return L[O?"find":"filter"](N,function(Q){for(var P in M){if(M[P]!==Q[P]){return false}}return true})};L.findWhere=function(N,M){return L.where(N,M,true)};L.max=function(P,O,N){if(!O&&L.isArray(P)&&P[0]===+P[0]&&P.length<65535){return Math.max.apply(Math,P)}if(!O&&L.isEmpty(P)){return -Infinity}var M={computed:-Infinity,value:-Infinity};H(P,function(T,Q,S){var R=O?O.call(N,T,Q,S):T;R>=M.computed&&(M={value:T,computed:R})});return M.value};L.min=function(P,O,N){if(!O&&L.isArray(P)&&P[0]===+P[0]&&P.length<65535){return Math.min.apply(Math,P)}if(!O&&L.isEmpty(P)){return Infinity}var M={computed:Infinity,value:Infinity};H(P,function(T,Q,S){var R=O?O.call(N,T,Q,S):T;R<M.computed&&(M={value:T,computed:R})});return M.value};L.shuffle=function(P){var O;var N=0;var M=[];H(P,function(Q){O=L.random(N++);M[N-1]=M[O];M[O]=Q});return M};var a=function(M){return L.isFunction(M)?M:function(N){return N[M]}};L.sortBy=function(P,O,M){var N=a(O);return L.pluck(L.map(P,function(S,Q,R){return{value:S,index:Q,criteria:N.call(M,S,Q,R)}}).sort(function(T,S){var R=T.criteria;var Q=S.criteria;if(R!==Q){if(R>Q||R===void 0){return 1}if(R<Q||Q===void 0){return -1}}return T.index<S.index?-1:1}),"value")};var t=function(R,Q,N,P){var M={};var O=a(Q||L.identity);H(R,function(U,S){var T=O.call(N,U,S,R);P(M,T,U)});return M};L.groupBy=function(O,N,M){return t(O,N,M,function(P,Q,R){(L.has(P,Q)?P[Q]:(P[Q]=[])).push(R)})};L.countBy=function(O,N,M){return t(O,N,M,function(P,Q){if(!L.has(P,Q)){P[Q]=0}P[Q]++})};L.sortedIndex=function(T,S,P,O){P=P==null?L.identity:a(P);var R=P.call(O,S);var M=0,Q=T.length;while(M<Q){var N=(M+Q)>>>1;P.call(O,T[N])<R?M=N+1:Q=N}return M};L.toArray=function(M){if(!M){return[]}if(L.isArray(M)){return o.call(M)}if(M.length===+M.length){return L.map(M,L.identity)}return L.values(M)};L.size=function(M){if(M==null){return 0}return(M.length===+M.length)?M.length:L.keys(M).length};L.first=L.head=L.take=function(O,N,M){if(O==null){return void 0}return(N!=null)&&!M?o.call(O,0,N):O[0]};L.initial=function(O,N,M){return o.call(O,0,O.length-((N==null)||M?1:N))};L.last=function(O,N,M){if(O==null){return void 0}if((N!=null)&&!M){return o.call(O,Math.max(O.length-N,0))}else{return O[O.length-1]}};L.rest=L.tail=L.drop=function(O,N,M){return o.call(O,(N==null)||M?1:N)};L.compact=function(M){return L.filter(M,L.identity)};var x=function(N,O,M){H(N,function(P){if(L.isArray(P)){O?G.apply(M,P):x(P,O,M)}else{M.push(P)}});return M};L.flatten=function(N,M){return x(N,M,[])};L.without=function(M){return L.difference(M,o.call(arguments,1))};L.uniq=L.unique=function(S,R,Q,P){if(L.isFunction(R)){P=Q;Q=R;R=false}var N=Q?L.map(S,Q,P):S;var O=[];var M=[];H(N,function(U,T){if(R?(!T||M[M.length-1]!==U):!L.contains(M,U)){M.push(U);O.push(S[T])}});return O};L.union=function(){return L.uniq(y.apply(C,arguments))};L.intersection=function(N){var M=o.call(arguments,1);return L.filter(L.uniq(N),function(O){return L.every(M,function(P){return L.indexOf(P,O)>=0})})};L.difference=function(N){var M=y.apply(C,o.call(arguments,1));return L.filter(N,function(O){return !L.contains(M,O)})};L.zip=function(){var M=o.call(arguments);var P=L.max(L.pluck(M,"length"));var O=new Array(P);for(var N=0;N<P;N++){O[N]=L.pluck(M,""+N)}return O};L.object=function(Q,O){if(Q==null){return{}}var M={};for(var P=0,N=Q.length;P<N;P++){if(O){M[Q[P]]=O[P]}else{M[Q[P][0]]=Q[P][1]}}return M};L.indexOf=function(Q,O,P){if(Q==null){return -1}var N=0,M=Q.length;if(P){if(typeof P=="number"){N=(P<0?Math.max(0,M+P):P)}else{N=L.sortedIndex(Q,O);return Q[N]===O?N:-1}}if(n&&Q.indexOf===n){return Q.indexOf(O,P)}for(;N<M;N++){if(Q[N]===O){return N}}return -1};L.lastIndexOf=function(Q,O,P){if(Q==null){return -1}var M=P!=null;if(l&&Q.lastIndexOf===l){return M?Q.lastIndexOf(O,P):Q.lastIndexOf(O)}var N=(M?P:Q.length);while(N--){if(Q[N]===O){return N}}return -1};L.range=function(R,P,Q){if(arguments.length<=1){P=R||0;R=0}Q=arguments[2]||1;var N=Math.max(Math.ceil((P-R)/Q),0);var M=0;var O=new Array(N);while(M<N){O[M++]=R;R+=Q}return O};L.bind=function(O,N){if(O.bind===F&&F){return F.apply(O,o.call(arguments,1))}var M=o.call(arguments,2);return function(){return O.apply(N,M.concat(o.call(arguments)))}};L.partial=function(N){var M=o.call(arguments,1);return function(){return N.apply(this,M.concat(o.call(arguments)))}};L.bindAll=function(N){var M=o.call(arguments,1);if(M.length===0){M=L.functions(N)}H(M,function(O){N[O]=L.bind(N[O],N)});return N};L.memoize=function(O,N){var M={};N||(N=L.identity);return function(){var P=N.apply(this,arguments);return L.has(M,P)?M[P]:(M[P]=O.apply(this,arguments))}};L.delay=function(N,O){var M=o.call(arguments,2);return setTimeout(function(){return N.apply(null,M)},O)};L.defer=function(M){return L.delay.apply(L,[M,1].concat(o.call(arguments,1)))};L.throttle=function(R,T){var P,O,S,M;var Q=0;var N=function(){Q=new Date;S=null;M=R.apply(P,O)};return function(){var U=new Date;var V=T-(U-Q);P=this;O=arguments;if(V<=0){clearTimeout(S);S=null;Q=U;M=R.apply(P,O)}else{if(!S){S=setTimeout(N,V)}}return M}};L.debounce=function(O,Q,N){var P,M;return function(){var U=this,T=arguments;var S=function(){P=null;if(!N){M=O.apply(U,T)}};var R=N&&!P;clearTimeout(P);P=setTimeout(S,Q);if(R){M=O.apply(U,T)}return M}};L.once=function(O){var M=false,N;return function(){if(M){return N}M=true;N=O.apply(this,arguments);O=null;return N}};L.wrap=function(M,N){return function(){var O=[M];G.apply(O,arguments);return N.apply(this,O)}};L.compose=function(){var M=arguments;return function(){var N=arguments;for(var O=M.length-1;O>=0;O--){N=[M[O].apply(this,N)]}return N[0]}};L.after=function(N,M){if(N<=0){return M()}return function(){if(--N<1){return M.apply(this,arguments)}}};L.keys=e||function(O){if(O!==Object(O)){throw new TypeError("Invalid object")}var N=[];for(var M in O){if(L.has(O,M)){N[N.length]=M}}return N};L.values=function(O){var M=[];for(var N in O){if(L.has(O,N)){M.push(O[N])}}return M};L.pairs=function(O){var N=[];for(var M in O){if(L.has(O,M)){N.push([M,O[M]])}}return N};L.invert=function(O){var M={};for(var N in O){if(L.has(O,N)){M[O[N]]=N}}return M};L.functions=L.methods=function(O){var N=[];for(var M in O){if(L.isFunction(O[M])){N.push(M)}}return N.sort()};L.extend=function(M){H(o.call(arguments,1),function(N){if(N){for(var O in N){M[O]=N[O]}}});return M};L.pick=function(N){var O={};var M=y.apply(C,o.call(arguments,1));H(M,function(P){if(P in N){O[P]=N[P]}});return O};L.omit=function(O){var P={};var N=y.apply(C,o.call(arguments,1));for(var M in O){if(!L.contains(N,M)){P[M]=O[M]}}return P};L.defaults=function(M){H(o.call(arguments,1),function(N){if(N){for(var O in N){if(M[O]==null){M[O]=N[O]}}}});return M};L.clone=function(M){if(!L.isObject(M)){return M}return L.isArray(M)?M.slice():L.extend({},M)};L.tap=function(N,M){M(N);return N};var I=function(T,S,N,O){if(T===S){return T!==0||1/T==1/S}if(T==null||S==null){return T===S}if(T instanceof L){T=T._wrapped}if(S instanceof L){S=S._wrapped}var Q=d.call(T);if(Q!=d.call(S)){return false}switch(Q){case"[object String]":return T==String(S);case"[object Number]":return T!=+T?S!=+S:(T==0?1/T==1/S:T==+S);case"[object Date]":case"[object Boolean]":return +T==+S;case"[object RegExp]":return T.source==S.source&&T.global==S.global&&T.multiline==S.multiline&&T.ignoreCase==S.ignoreCase}if(typeof T!="object"||typeof S!="object"){return false}var M=N.length;while(M--){if(N[M]==T){return O[M]==S}}N.push(T);O.push(S);var V=0,W=true;if(Q=="[object Array]"){V=T.length;W=V==S.length;if(W){while(V--){if(!(W=I(T[V],S[V],N,O))){break}}}}else{var R=T.constructor,P=S.constructor;if(R!==P&&!(L.isFunction(R)&&(R instanceof R)&&L.isFunction(P)&&(P instanceof P))){return false}for(var U in T){if(L.has(T,U)){V++;if(!(W=L.has(S,U)&&I(T[U],S[U],N,O))){break}}}if(W){for(U in S){if(L.has(S,U)&&!(V--)){break}}W=!V}}N.pop();O.pop();return W};L.isEqual=function(N,M){return I(N,M,[],[])};L.isEmpty=function(N){if(N==null){return true}if(L.isArray(N)||L.isString(N)){return N.length===0}for(var M in N){if(L.has(N,M)){return false}}return true};L.isElement=function(M){return !!(M&&M.nodeType===1)};L.isArray=u||function(M){return d.call(M)=="[object Array]"};L.isObject=function(M){return M===Object(M)};H(["Arguments","Function","String","Number","Date","RegExp"],function(M){L["is"+M]=function(N){return d.call(N)=="[object "+M+"]"}});if(!L.isArguments(arguments)){L.isArguments=function(M){return !!(M&&L.has(M,"callee"))}}if(typeof(/./)!=="function"){L.isFunction=function(M){return typeof M==="function"}}L.isFinite=function(M){return isFinite(M)&&!isNaN(parseFloat(M))};L.isNaN=function(M){return L.isNumber(M)&&M!=+M};L.isBoolean=function(M){return M===true||M===false||d.call(M)=="[object Boolean]"};L.isNull=function(M){return M===null};L.isUndefined=function(M){return M===void 0};L.has=function(N,M){return j.call(N,M)};L.noConflict=function(){w._=k;return this};L.identity=function(M){return M};L.times=function(Q,P,O){var M=Array(Q);for(var N=0;N<Q;N++){M[N]=P.call(O,N)}return M};L.random=function(N,M){if(M==null){M=N;N=0}return N+Math.floor(Math.random()*(M-N+1))};var m={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};m.unescape=L.invert(m.escape);var J={escape:new RegExp("["+L.keys(m.escape).join("")+"]","g"),unescape:new RegExp("("+L.keys(m.unescape).join("|")+")","g")};L.each(["escape","unescape"],function(M){L[M]=function(N){if(N==null){return""}return(""+N).replace(J[M],function(O){return m[M][O]})}});L.result=function(M,O){if(M==null){return null}var N=M[O];return L.isFunction(N)?N.call(M):N};L.mixin=function(M){H(L.functions(M),function(N){var O=L[N]=M[N];L.prototype[N]=function(){var P=[this._wrapped];G.apply(P,arguments);return s.call(this,O.apply(L,P))}})};var z=0;L.uniqueId=function(M){var N=++z+"";return M?M+N:N};L.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/(.)^/;var h={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"};var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;L.template=function(U,P,O){var N;O=L.defaults({},O,L.templateSettings);var Q=new RegExp([(O.escape||v).source,(O.interpolate||v).source,(O.evaluate||v).source].join("|")+"|$","g");var R=0;var M="__p+='";U.replace(Q,function(W,X,V,Z,Y){M+=U.slice(R,Y).replace(i,function(aa){return"\\"+h[aa]});if(X){M+="'+\n((__t=("+X+"))==null?'':_.escape(__t))+\n'"}if(V){M+="'+\n((__t=("+V+"))==null?'':__t)+\n'"}if(Z){M+="';\n"+Z+"\n__p+='"}R=Y+W.length;return W});M+="';\n";if(!O.variable){M="with(obj||{}){\n"+M+"}\n"}M="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+M+"return __p;\n";try{N=new Function(O.variable||"obj","_",M)}catch(S){S.source=M;throw S}if(P){return N(P,L)}var T=function(V){return N.call(this,V,L)};T.source="function("+(O.variable||"obj")+"){\n"+M+"}";return T};L.chain=function(M){return L(M).chain()};var s=function(M){return this._chain?L(M).chain():M};L.mixin(L);H(["pop","push","reverse","shift","sort","splice","unshift"],function(M){var N=C[M];L.prototype[M]=function(){var O=this._wrapped;N.apply(O,arguments);if((M=="shift"||M=="splice")&&O.length===0){delete O[0]}return s.call(this,O)}});H(["concat","join","slice"],function(M){var N=C[M];L.prototype[M]=function(){return s.call(this,N.apply(this._wrapped,arguments))}});L.extend(L.prototype,{chain:function(){this._chain=true;return this},value:function(){return this._wrapped}})}).call(this);(function(){var u=this;var B=u.Backbone;var g=[];var D=g.push;var n=g.slice;var t=g.splice;var z;if(typeof exports!=="undefined"){z=exports}else{z=u.Backbone={}}z.VERSION="1.0.0";var L=u._;if(!L&&(typeof require!=="undefined")){L=require("underscore")}z.$=u.jQuery||u.Zepto||u.ender||u.$;z.noConflict=function(){u.Backbone=B;return this};z.emulateHTTP=false;z.emulateJSON=false;var J=z.Events={on:function(M,P,O){if(!x(this,"on",M,[P,O])||!P){return this}this._events||(this._events={});var N=this._events[M]||(this._events[M]=[]);N.push({callback:P,context:O,ctx:O||this});return this},once:function(N,Q,O){if(!x(this,"once",N,[Q,O])||!Q){return this}var M=this;var P=L.once(function(){M.off(N,P);Q.apply(this,arguments)});P._callback=Q;return this.on(N,P,O)},off:function(M,V,N){var T,U,W,S,R,O,Q,P;if(!this._events||!x(this,"off",M,[V,N])){return this}if(!M&&!V&&!N){this._events={};return this}S=M?[M]:L.keys(this._events);for(R=0,O=S.length;R<O;R++){M=S[R];if(W=this._events[M]){this._events[M]=T=[];if(V||N){for(Q=0,P=W.length;Q<P;Q++){U=W[Q];if((V&&V!==U.callback&&V!==U.callback._callback)||(N&&N!==U.context)){T.push(U)}}}if(!T.length){delete this._events[M]}}}return this},trigger:function(O){if(!this._events){return this}var N=n.call(arguments,1);if(!x(this,"trigger",O,N)){return this}var P=this._events[O];var M=this._events.all;if(P){b(P,N)}if(M){b(M,arguments)}return this},stopListening:function(P,M,R){var N=this._listeners;if(!N){return this}var O=!M&&!R;if(typeof M==="object"){R=this}if(P){(N={})[P._listenerId]=P}for(var Q in N){N[Q].off(M,R,this);if(O){delete this._listeners[Q]}}return this}};var w=/\s+/;var x=function(T,R,N,Q){if(!N){return true}if(typeof N==="object"){for(var P in N){T[R].apply(T,[P,N[P]].concat(Q))}return false}if(w.test(N)){var S=N.split(w);for(var O=0,M=S.length;O<M;O++){T[R].apply(T,[S[O]].concat(Q))}return false}return true};var b=function(R,P){var S,Q=-1,O=R.length,N=P[0],M=P[1],T=P[2];switch(P.length){case 0:while(++Q<O){(S=R[Q]).callback.call(S.ctx)}return;case 1:while(++Q<O){(S=R[Q]).callback.call(S.ctx,N)}return;case 2:while(++Q<O){(S=R[Q]).callback.call(S.ctx,N,M)}return;case 3:while(++Q<O){(S=R[Q]).callback.call(S.ctx,N,M,T)}return;default:while(++Q<O){(S=R[Q]).callback.apply(S.ctx,P)}}};var C={listenTo:"on",listenToOnce:"once"};L.each(C,function(M,N){J[N]=function(Q,O,S){var P=this._listeners||(this._listeners={});var R=Q._listenerId||(Q._listenerId=L.uniqueId("l"));P[R]=Q;if(typeof O==="object"){S=this}Q[M](O,S,this);return this}});J.bind=J.on;J.unbind=J.off;L.extend(z,J);var E=z.Model=function(M,O){var P;var N=M||{};O||(O={});this.cid=L.uniqueId("c");this.attributes={};L.extend(this,L.pick(O,F));if(O.parse){N=this.parse(N,O)||{}}if(P=L.result(this,"defaults")){N=L.defaults({},N,P)}this.set(N,O);this.changed={};this.initialize.apply(this,arguments)};var F=["url","urlRoot","collection"];L.extend(E.prototype,J,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(M){return L.clone(this.attributes)},sync:function(){return z.sync.apply(this,arguments)},get:function(M){return this.attributes[M]},escape:function(M){return L.escape(this.get(M))},has:function(M){return this.get(M)!=null},set:function(U,M,Y){var S,V,W,T,R,X,O,Q;if(U==null){return this}if(typeof U==="object"){V=U;Y=M}else{(V={})[U]=M}Y||(Y={});if(!this._validate(V,Y)){return false}W=Y.unset;R=Y.silent;T=[];X=this._changing;this._changing=true;if(!X){this._previousAttributes=L.clone(this.attributes);this.changed={}}Q=this.attributes,O=this._previousAttributes;if(this.idAttribute in V){this.id=V[this.idAttribute]}for(S in V){M=V[S];if(!L.isEqual(Q[S],M)){T.push(S)}if(!L.isEqual(O[S],M)){this.changed[S]=M}else{delete this.changed[S]}W?delete Q[S]:Q[S]=M}if(!R){if(T.length){this._pending=true}for(var P=0,N=T.length;P<N;P++){this.trigger("change:"+T[P],this,Q[T[P]],Y)}}if(X){return this}if(!R){while(this._pending){this._pending=false;this.trigger("change",this,Y)}}this._pending=false;this._changing=false;return this},unset:function(M,N){return this.set(M,void 0,L.extend({},N,{unset:true}))},clear:function(N){var M={};for(var O in this.attributes){M[O]=void 0}return this.set(M,L.extend({},N,{unset:true}))},hasChanged:function(M){if(M==null){return !L.isEmpty(this.changed)}return L.has(this.changed,M)},changedAttributes:function(O){if(!O){return this.hasChanged()?L.clone(this.changed):false}var Q,P=false;var N=this._changing?this._previousAttributes:this.attributes;for(var M in O){if(L.isEqual(N[M],(Q=O[M]))){continue}(P||(P={}))[M]=Q}return P},previous:function(M){if(M==null||!this._previousAttributes){return null}return this._previousAttributes[M]},previousAttributes:function(){return L.clone(this._previousAttributes)},fetch:function(N){N=N?L.clone(N):{};if(N.parse===void 0){N.parse=true}var M=this;var O=N.success;N.success=function(P){if(!M.set(M.parse(P,N),N)){return false}if(O){O(M,P,N)}M.trigger("sync",M,P,N)};H(this,N);return this.sync("read",this,N)},save:function(Q,N,U){var R,M,T,O=this.attributes;if(Q==null||typeof Q==="object"){R=Q;U=N}else{(R={})[Q]=N}if(R&&(!U||!U.wait)&&!this.set(R,U)){return false}U=L.extend({validate:true},U);if(!this._validate(R,U)){return false}if(R&&U.wait){this.attributes=L.extend({},O,R)}if(U.parse===void 0){U.parse=true}var P=this;var S=U.success;U.success=function(W){P.attributes=O;var V=P.parse(W,U);if(U.wait){V=L.extend(R||{},V)}if(L.isObject(V)&&!P.set(V,U)){return false}if(S){S(P,W,U)}P.trigger("sync",P,W,U)};H(this,U);M=this.isNew()?"create":(U.patch?"patch":"update");if(M==="patch"){U.attrs=R}T=this.sync(M,this,U);if(R&&U.wait){this.attributes=O}return T},destroy:function(N){N=N?L.clone(N):{};var M=this;var Q=N.success;var O=function(){M.trigger("destroy",M,M.collection,N)};N.success=function(R){if(N.wait||M.isNew()){O()}if(Q){Q(M,R,N)}if(!M.isNew()){M.trigger("sync",M,R,N)}};if(this.isNew()){N.success();return false}H(this,N);var P=this.sync("delete",this,N);if(!N.wait){O()}return P},url:function(){var M=L.result(this,"urlRoot")||L.result(this.collection,"url")||r();if(this.isNew()){return M}return M+(M.charAt(M.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(N,M){return N},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(M){return this._validate({},L.extend(M||{},{validate:true}))},_validate:function(O,N){if(!N.validate||!this.validate){return true}O=L.extend({},this.attributes,O);var M=this.validationError=this.validate(O,N)||null;if(!M){return true}this.trigger("invalid",this,M,L.extend(N||{},{validationError:M}));return false}});var a=["keys","values","pairs","invert","pick","omit"];L.each(a,function(M){E.prototype[M]=function(){var N=n.call(arguments);N.unshift(this.attributes);return L[M].apply(L,N)}});var c=z.Collection=function(N,M){M||(M={});if(M.url){this.url=M.url}if(M.model){this.model=M.model}if(M.comparator!==void 0){this.comparator=M.comparator}this._reset();this.initialize.apply(this,arguments);if(N){this.reset(N,L.extend({silent:true},M))}};var o={add:true,remove:true,merge:true};var K={add:true,merge:false,remove:false};L.extend(c.prototype,J,{model:E,initialize:function(){},toJSON:function(M){return this.map(function(N){return N.toJSON(M)})},sync:function(){return z.sync.apply(this,arguments)},add:function(N,M){return this.set(N,L.defaults(M||{},K))},remove:function(R,P){R=L.isArray(R)?R.slice():[R];P||(P={});var Q,M,O,N;for(Q=0,M=R.length;Q<M;Q++){N=this.get(R[Q]);if(!N){continue}delete this._byId[N.id];delete this._byId[N.cid];O=this.indexOf(N);this.models.splice(O,1);this.length--;if(!P.silent){P.index=O;N.trigger("remove",N,this,P)}this._removeReference(N)}return this},set:function(N,Z){Z=L.defaults(Z||{},o);if(Z.parse){N=this.parse(N,Z)}if(!L.isArray(N)){N=N?[N]:[]}var U,Q,W,X,O,V;var P=Z.at;var T=this.comparator&&(P==null)&&Z.sort!==false;var R=L.isString(this.comparator)?this.comparator:null;var Y=[],M=[],S={};for(U=0,Q=N.length;U<Q;U++){if(!(W=this._prepareModel(N[U],Z))){continue}if(O=this.get(W)){if(Z.remove){S[O.cid]=true}if(Z.merge){O.set(W.attributes,Z);if(T&&!V&&O.hasChanged(R)){V=true}}}else{if(Z.add){Y.push(W);W.on("all",this._onModelEvent,this);this._byId[W.cid]=W;if(W.id!=null){this._byId[W.id]=W}}}}if(Z.remove){for(U=0,Q=this.length;U<Q;++U){if(!S[(W=this.models[U]).cid]){M.push(W)}}if(M.length){this.remove(M,Z)}}if(Y.length){if(T){V=true}this.length+=Y.length;if(P!=null){t.apply(this.models,[P,0].concat(Y))}else{D.apply(this.models,Y)}}if(V){this.sort({silent:true})}if(Z.silent){return this}for(U=0,Q=Y.length;U<Q;U++){(W=Y[U]).trigger("add",W,this,Z)}if(V){this.trigger("sort",this,Z)}return this},reset:function(P,N){N||(N={});for(var O=0,M=this.models.length;O<M;O++){this._removeReference(this.models[O])}N.previousModels=this.models;this._reset();this.add(P,L.extend({silent:true},N));if(!N.silent){this.trigger("reset",this,N)}return this},push:function(N,M){N=this._prepareModel(N,M);this.add(N,L.extend({at:this.length},M));return N},pop:function(N){var M=this.at(this.length-1);this.remove(M,N);return M},unshift:function(N,M){N=this._prepareModel(N,M);this.add(N,L.extend({at:0},M));return N},shift:function(N){var M=this.at(0);this.remove(M,N);return M},slice:function(N,M){return this.models.slice(N,M)},get:function(M){if(M==null){return void 0}return this._byId[M.id!=null?M.id:M.cid||M]},at:function(M){return this.models[M]},where:function(M,N){if(L.isEmpty(M)){return N?void 0:[]}return this[N?"find":"filter"](function(O){for(var P in M){if(M[P]!==O.get(P)){return false}}return true})},findWhere:function(M){return this.where(M,true)},sort:function(M){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}M||(M={});if(L.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(L.bind(this.comparator,this))}if(!M.silent){this.trigger("sort",this,M)}return this},sortedIndex:function(M,P,N){P||(P=this.comparator);var O=L.isFunction(P)?P:function(Q){return Q.get(P)};return L.sortedIndex(this.models,M,O,N)},pluck:function(M){return L.invoke(this.models,"get",M)},fetch:function(M){M=M?L.clone(M):{};if(M.parse===void 0){M.parse=true}var O=M.success;var N=this;M.success=function(P){var Q=M.reset?"reset":"set";N[Q](P,M);if(O){O(N,P,M)}N.trigger("sync",N,P,M)};H(this,M);return this.sync("read",this,M)},create:function(N,M){M=M?L.clone(M):{};if(!(N=this._prepareModel(N,M))){return false}if(!M.wait){this.add(N,M)}var P=this;var O=M.success;M.success=function(Q){if(M.wait){P.add(N,M)}if(O){O(N,Q,M)}};N.save(null,M);return N},parse:function(N,M){return N},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(O,N){if(O instanceof E){if(!O.collection){O.collection=this}return O}N||(N={});N.collection=this;var M=new this.model(O,N);if(!M._validate(O,N)){this.trigger("invalid",this,O,N);return false}return M},_removeReference:function(M){if(this===M.collection){delete M.collection}M.off("all",this._onModelEvent,this)},_onModelEvent:function(O,N,P,M){if((O==="add"||O==="remove")&&P!==this){return}if(O==="destroy"){this.remove(N,M)}if(N&&O==="change:"+N.idAttribute){delete this._byId[N.previous(N.idAttribute)];if(N.id!=null){this._byId[N.id]=N}}this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];L.each(y,function(M){c.prototype[M]=function(){var N=n.call(arguments);N.unshift(this.models);return L[M].apply(L,N)}});var k=["groupBy","countBy","sortBy"];L.each(k,function(M){c.prototype[M]=function(P,N){var O=L.isFunction(P)?P:function(Q){return Q.get(P)};return L[M](this.models,O,N)}});var G=z.View=function(M){this.cid=L.uniqueId("view");this._configure(M||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var v=/^(\S+)\s*(.*)$/;var e=["model","collection","el","id","attributes","className","tagName","events"];L.extend(G.prototype,J,{tagName:"div",$:function(M){return this.$el.find(M)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(M,N){if(this.$el){this.undelegateEvents()}this.$el=M instanceof z.$?M:z.$(M);this.el=this.$el[0];if(N!==false){this.delegateEvents()}return this},delegateEvents:function(Q){if(!(Q||(Q=L.result(this,"events")))){return this}this.undelegateEvents();for(var P in Q){var R=Q[P];if(!L.isFunction(R)){R=this[Q[P]]}if(!R){continue}var O=P.match(v);var N=O[1],M=O[2];R=L.bind(R,this);N+=".delegateEvents"+this.cid;if(M===""){this.$el.on(N,R)}else{this.$el.on(N,M,R)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(M){if(this.options){M=L.extend({},L.result(this,"options"),M)}L.extend(this,L.pick(M,e));this.options=M},_ensureElement:function(){if(!this.el){var M=L.extend({},L.result(this,"attributes"));if(this.id){M.id=L.result(this,"id")}if(this.className){M["class"]=L.result(this,"className")}var N=z.$("<"+L.result(this,"tagName")+">").attr(M);this.setElement(N,false)}else{this.setElement(L.result(this,"el"),false)}}});z.sync=function(S,N,M){var P=j[S];L.defaults(M||(M={}),{emulateHTTP:z.emulateHTTP,emulateJSON:z.emulateJSON});var R={type:P,dataType:"json"};if(!M.url){R.url=L.result(N,"url")||r()}if(M.data==null&&N&&(S==="create"||S==="update"||S==="patch")){R.contentType="application/json";R.data=JSON.stringify(M.attrs||N.toJSON(M))}if(M.emulateJSON){R.contentType="application/x-www-form-urlencoded";R.data=R.data?{model:R.data}:{}}if(M.emulateHTTP&&(P==="PUT"||P==="DELETE"||P==="PATCH")){R.type="POST";if(M.emulateJSON){R.data._method=P}var O=M.beforeSend;M.beforeSend=function(T){T.setRequestHeader("X-HTTP-Method-Override",P);if(O){return O.apply(this,arguments)}}}if(R.type!=="GET"&&!M.emulateJSON){R.processData=false}if(R.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){R.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var Q=M.xhr=z.ajax(L.extend(R,M));N.trigger("request",N,Q,M);return Q};var j={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};z.ajax=function(){return z.$.ajax.apply(z.$,arguments)};var p=z.Router=function(M){M||(M={});if(M.routes){this.routes=M.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var q=/\((.*?)\)/g;var s=/(\(\?)?:\w+/g;var d=/\*\w+/g;var h=/[\-{}\[\]+?.,\\\^$|#\s]/g;L.extend(p.prototype,J,{initialize:function(){},route:function(N,O,P){if(!L.isRegExp(N)){N=this._routeToRegExp(N)}if(L.isFunction(O)){P=O;O=""}if(!P){P=this[O]}var M=this;z.history.route(N,function(R){var Q=M._extractParameters(N,R);P&&P.apply(M,Q);M.trigger.apply(M,["route:"+O].concat(Q));M.trigger("route",O,Q);z.history.trigger("route",M,O,Q)});return this},navigate:function(N,M){z.history.navigate(N,M);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=L.result(this,"routes");var N,M=L.keys(this.routes);while((N=M.pop())!=null){this.route(N,this.routes[N])}},_routeToRegExp:function(M){M=M.replace(h,"\\$&").replace(q,"(?:$1)?").replace(s,function(O,N){return N?O:"([^/]+)"}).replace(d,"(.*?)");return new RegExp("^"+M+"$")},_extractParameters:function(M,N){var O=M.exec(N).slice(1);return L.map(O,function(P){return P?decodeURIComponent(P):null})}});var i=z.History=function(){this.handlers=[];L.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var A=/^[#\/]|\s+$/g;var f=/^\/+|\/+$/g;var I=/msie [\w.]+/;var m=/\/$/;i.started=false;L.extend(i.prototype,J,{interval:50,getHash:function(N){var M=(N||this).location.href.match(/#(.*)$/);return M?M[1]:""},getFragment:function(O,N){if(O==null){if(this._hasPushState||!this._wantsHashChange||N){O=this.location.pathname;var M=this.root.replace(m,"");if(!O.indexOf(M)){O=O.substr(M.length)}}else{O=this.getHash()}}return O.replace(A,"")},start:function(O){if(i.started){throw new Error("Backbone.history has already been started")}i.started=true;this.options=L.extend({},{root:"/"},this.options,O);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var N=this.getFragment();var M=document.documentMode;var Q=(I.exec(navigator.userAgent.toLowerCase())&&(!M||M<=7));this.root=("/"+this.root+"/").replace(f,"/");if(Q&&this._wantsHashChange){this.iframe=z.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(N)}if(this._hasPushState){z.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!Q){z.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=N;var R=this.location;var P=R.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!P){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&P&&R.hash){this.fragment=this.getHash().replace(A,"");this.history.replaceState({},document.title,this.root+this.fragment+R.search)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){z.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);i.started=false},route:function(M,N){this.handlers.unshift({route:M,callback:N})},checkUrl:function(N){var M=this.getFragment();if(M===this.fragment&&this.iframe){M=this.getFragment(this.getHash(this.iframe))}if(M===this.fragment){return false}if(this.iframe){this.navigate(M)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(O){var N=this.fragment=this.getFragment(O);var M=L.any(this.handlers,function(P){if(P.route.test(N)){P.callback(N);return true}});return M},navigate:function(O,N){if(!i.started){return false}if(!N||N===true){N={trigger:N}}O=this.getFragment(O||"");if(this.fragment===O){return}this.fragment=O;var M=this.root+O;if(this._hasPushState){this.history[N.replace?"replaceState":"pushState"]({},document.title,M)}else{if(this._wantsHashChange){this._updateHash(this.location,O,N.replace);if(this.iframe&&(O!==this.getFragment(this.getHash(this.iframe)))){if(!N.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,O,N.replace)}}else{return this.location.assign(M)}}if(N.trigger){this.loadUrl(O)}},_updateHash:function(M,O,P){if(P){var N=M.href.replace(/(javascript:|#).*$/,"");M.replace(N+"#"+O)}else{M.hash="#"+O}}});z.history=new i;var l=function(M,O){var N=this;var Q;if(M&&L.has(M,"constructor")){Q=M.constructor}else{Q=function(){return N.apply(this,arguments)}}L.extend(Q,N,O);var P=function(){this.constructor=Q};P.prototype=N.prototype;Q.prototype=new P;if(M){L.extend(Q.prototype,M)}Q.__super__=N.prototype;return Q};E.extend=c.extend=p.extend=G.extend=i.extend=l;var r=function(){throw new Error('A "url" property or function must be specified')};var H=function(O,N){var M=N.error;N.error=function(P){if(M){M(O,P,N)}O.trigger("error",O,P,N)}}}).call(this);var XD=function(){var e,d,b=1,c,a=this;return{postMessage:function(f,h,g){if(!h){return}g=g||parent;if(a.postMessage){g.postMessage(f,h.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(h){g.location=h.replace(/#.*$/,"")+"#"+(+new Date)+(b++)+"&"+f}}},receiveMessage:function(g,f){if(a.postMessage){if(g){c=function(h){if((typeof f==="string"&&h.origin!==f)||(Object.prototype.toString.call(f)==="[object Function]"&&f(h.origin)===!1)){return !1}g(h)}}if(a.addEventListener){a[g?"addEventListener":"removeEventListener"]("message",c,!1)}else{a[g?"attachEvent":"detachEvent"]("onmessage",c)}}else{e&&clearInterval(e);e=null;if(g){e=setInterval(function(){var i=document.location.hash,h=/^#?\d+&/;if(i!==d&&h.test(i)){d=i;g({data:i.replace(h,"")})}},100)}}}}}();var Curalate=Curalate||{};Curalate.config=Curalate.config||{};Curalate.config.DOMAIN="api.curalate.com";var Curalate=Curalate||{};Curalate.config=Curalate.config||{};Curalate.config.API_VERSION="v1";var Curalate=Curalate||{};if(!Object.hasOwnProperty("create")){Object.create=function(a){function b(){}b.prototype=a;return new b()}}if(!Array.prototype.filter){Array.prototype.filter=function(b){if(this===void 0||this===null){throw new TypeError()}var f=Object(this);var a=f.length>>>0;if(typeof b!=="function"){throw new TypeError()}var e=[];var d=arguments[1];for(var c=0;c<a;c++){if(c in f){var g=f[c];if(b.call(d,g,c,f)){e.push(g)}}}return e}}Curalate.getProtocol=function(){return"https:"===document.location.protocol?"https:":"http:"};Curalate.getByElementOrId=function(b){var a;if(typeof b==="string"){a=b;b=document.getElementById(b);if(!b){throw new Error("No element matches the ID: "+a)}}else{if(typeof b==="undefined"){throw new Error("An element or element ID must be defined.")}}return b};Curalate.isValidEmail=function(h){var a="[^\\x0d\\x22\\x5c\\x80-\\xff]";var b="[^\\x0d\\x5b-\\x5d\\x80-\\xff]";var m="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+";var k="\\x5c[\\x00-\\x7f]";var g="\\x5b("+b+"|"+k+")*\\x5d";var e="\\x22("+a+"|"+k+")*\\x22";var o=m;var n="("+o+"|"+g+")";var d="("+m+"|"+e+")";var l=n+"(\\x2e"+n+")*";var i=d+"(\\x2e"+d+")*";var c=i+"\\x40"+l;var j="^"+c+"$";var f=new RegExp(j);return f.test(h)};Curalate.showErrors=function(d,c){var b,a="";if(typeof(d)==="string"){d=[d]}if(d.length===1){c.html(d[0]).show()}else{for(b=0;b<d.length;b++){a+="<li>"+d[b]+"</li>"}c.html("There are some problems: <ul>"+a+"</ul>").show()}};Curalate.parseQueryString=function(){var a={},d=(window.location.search.substr(1)).split("&"),b,c;for(b=0;b<d.length;b++){c=d[b].split("=");if(!c[0]){continue}else{if(c.length===1){a[c[0]]=""}else{a[c[0]]=decodeURIComponent(c[1])}}}return a};Curalate.base64Encode=function(a){if(window.btoa){return window.btoa(unescape(encodeURIComponent(a)))}else{return Curalate.base64.encode(unescape(encodeURIComponent(a)))}};Curalate.base64Decode=function(b,a){if(a){b=decodeURIComponent(b)}if(window.atob){return decodeURIComponent(escape(window.atob(b)))}else{return decodeURIComponent(escape(Curalate.base64.decode(b)))}};Curalate.isMobileRequest=function(){if(navigator&&navigator.userAgent&&navigator.userAgent.match(/Symbian|Mobile|Android|BlackBerry/)){return true}return false};Curalate.generateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d==="x"?b:(b&3|8);return a.toString(16)})};Curalate.trackingId=Curalate.generateGuid();Curalate.Promise=function(){this.onSuccessHandler=function(){};this.onFailureHandler=function(){}};Curalate.Promise.prototype.success=function(a){this.onSuccessHandler=a;return this};Curalate.Promise.prototype.failure=function(a){this.onFailureHandler=a;return this};Curalate.base64={};Curalate.base64.PADCHAR="=";Curalate.base64.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";Curalate.base64.makeDOMException=function(){var c,b;try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(b){var a=new Error("DOM Exception 5");a.code=a.number=5;a.name=a.description="INVALID_CHARACTER_ERR";a.toString=function(){return"Error: "+a.name+": "+a.message};return a}};Curalate.base64.getbyte64=function(c,b){var a=Curalate.base64.ALPHA.indexOf(c.charAt(b));if(a===-1){throw Curalate.base64.makeDOMException()}return a};Curalate.base64.decode=function(d){d=""+d;var g=Curalate.base64.getbyte64;var f,c,e;var b=d.length;if(b===0){return d}if(b%4!==0){throw Curalate.base64.makeDOMException()}f=0;if(d.charAt(b-1)===Curalate.base64.PADCHAR){f=1;if(d.charAt(b-2)===Curalate.base64.PADCHAR){f=2}b-=4}var a=[];for(c=0;c<b;c+=4){e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6)|g(d,c+3);a.push(String.fromCharCode(e>>16,(e>>8)&255,e&255))}switch(f){case 1:e=(g(d,c)<<18)|(g(d,c+1)<<12)|(g(d,c+2)<<6);a.push(String.fromCharCode(e>>16,(e>>8)&255));break;case 2:e=(g(d,c)<<18)|(g(d,c+1)<<12);a.push(String.fromCharCode(e>>16));break}return a.join("")};Curalate.base64.getbyte=function(c,b){var a=c.charCodeAt(b);if(a>255){throw Curalate.base64.makeDOMException()}return a};Curalate.base64.encode=function(e){if(arguments.length!==1){throw new SyntaxError("Not enough arguments")}var b=Curalate.base64.PADCHAR;var g=Curalate.base64.ALPHA;var f=Curalate.base64.getbyte;var d,h;var a=[];e=""+e;var c=e.length-e.length%3;if(e.length===0){return e}for(d=0;d<c;d+=3){h=(f(e,d)<<16)|(f(e,d+1)<<8)|f(e,d+2);a.push(g.charAt(h>>18));a.push(g.charAt((h>>12)&63));a.push(g.charAt((h>>6)&63));a.push(g.charAt(h&63))}switch(e.length-c){case 1:h=f(e,d)<<16;a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+b+b);break;case 2:h=(f(e,d)<<16)|(f(e,d+1)<<8);a.push(g.charAt(h>>18)+g.charAt((h>>12)&63)+g.charAt((h>>6)&63)+b);break}return a.join("")};var Curalate=Curalate||{};Curalate.tracking=(function(i){var o="data-tracking-click";var y="data-tracking-click-deferred";var A="data-tracking-hover";var w=1000;var j=1000;var m=10000;var f=["DOMContentLoaded","load","scroll","resize"];var d=["onreadystatechange","onload","onscroll","onresize"];var n=/fr\.(.+)/;var C=/item-(.+)/;var D=/product-(.+)/;var u;var e={};var q=[];var x;var k;var r=function(I){var G,F,E,H,J;if(u){u.endTime=(new Date()).getTime();if(u.isMeasurable()){H=u.code;J=u.target;c(u);u=new b(H,J);t(u)}else{u.endTime=null}}if(q.length===0){return}F=Curalate.getProtocol()+"//"+Curalate.config.DOMAIN+"/"+Curalate.config.API_VERSION+"/tracking/events.png?r="+Math.floor(Math.random()*100000);for(G=0;G<q.length;G++){F+="&e="+encodeURIComponent(q[G].serialize())}E=new Image(1,1);E.src=F;E.style.display="none";if(typeof I==="function"){E.onload=I;E.onerror=I}document.body.appendChild(E);q=[]};var z=setInterval(r,m);var l=function(I){var K=I.getBoundingClientRect(),H=K.bottom-K.top,J=K.right-K.left,G=H*J,F={height:(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight),width:(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)},E={height:0,width:0};if(H===0||J===0||I.style.display==="none"||I.style.visibility==="hidden"){return false}if(K.top>F.height){return false}else{if(K.bottom<0){return false}else{if(K.top>0){E.height=H-Math.max((K.bottom-F.height),0)}else{E.height=H+K.top}}}if(K.left>F.width){return false}else{if(K.right<0){return false}else{if(K.left>0){E.width=J-Math.max((K.right-F.width),0)}else{E.width=J+K.left}}}return((E.width*E.height)>=(G/2))||((E.width*E.height)/(F.width*F.height)>=0.5)};var t=function(E){var F=[E.code,E.target,E.type];E.startTime=new Date().getTime();e[F]=E};var c=function(E){var F=[E.code,E.target,E.type];if(!e[F]){return}delete e[F];E.endTime=new Date().getTime();if(E.isMeasurable()){q.push(E)}};var p=function(){var E=[];for(var F in e){E.push(e[F]);c(e[F])}u=null;return E};var g=function(E){return E.replace(/\|/g,"")};var h=function(E,N,M){var G=C.test(M),J=D.test(M),K,F,I,O,H;if(!window.Curalate||!window.Curalate.cfgTraffic){return}K=Curalate.cfgTraffic;if(!n.test(E)){return}F="curalate.fanreel."+n.exec(E)[1];if(G){H=C.exec(M)[1]}else{if(J){H=D.exec(M)[1]}}switch(N){case"impression":if(!H){I="reel.impression"}break;case"click":if(H){if(J){I="item.shop"}else{I="item.click"}O=H}break}if(!I){return}try{if(K._gaq){K._gaq.push(["_trackEvent",F,I,O])}else{if(K.ga){K.ga("send","event",F,I,O)}}}catch(L){if(window.console&&console.log){console.log("Unable to send traffic event:"+L.message)}}};function a(E,F){this.code=E;this.target=F}a.prototype.isMeasurable=function(){throw new Error("Method must be implemented by subclass")};a.prototype.serialize=function(){var E;if(!this.startTime||!this.endTime){throw new Error("A start time and end time for this event must be established before recording this event.")}if(!this.type){throw new Error("Tracking event must define a 'type' field in order to be recorded.")}if(!this.code){throw new Error("Tracking event must define a 'code' field in order to be recorded.")}E="code:"+g(this.code)+"|type:"+g(this.type)+"|uuid:"+Curalate.trackingId+"|time:"+(this.endTime-this.startTime);if(this.target){E+="|target:"+g(this.target)}return E};function v(E,F){a.call(this,E,F);this.type="dwell"}v.prototype=Object.create(a.prototype);v.prototype.isMeasurable=function(){if(!this.startTime||!this.endTime){throw new Error("A start time and end time for this event must be established before recording this event.")}return(this.endTime-this.startTime)>j};function B(E,F){a.call(this,E,F);this.type="impression"}B.prototype=Object.create(a.prototype);B.prototype.isMeasurable=function(){return true};function b(E,F){a.call(this,E,F);this.type="viewable-impression"}b.prototype=Object.create(a.prototype);b.prototype.isMeasurable=function(){if(!this.startTime||!this.endTime){throw new Error("A start time and end time for this event must be established before recording this event.")}return(this.endTime-this.startTime)>w};function s(E,F){a.call(this,E,F);this.type="click"}s.prototype=Object.create(a.prototype);s.prototype.isMeasurable=function(){return true};return{recordImpression:function(F,G){var H=new B(F,G),E=(new Date()).getTime();H.startTime=E;H.endTime=E;q.push(H);h(F,"impression");r()},recordClick:function(I,K,L,E){var H=new s(I,K),F=(new Date()).getTime(),J=[],G;H.startTime=H.endTime=F;q.push(H);h(I,"click",K);J=p();if(L){r(function(){window.location.href=E})}else{r()}for(G=0;G<J.length;G++){H=J[G];H.startTime=null;H.endTime=null;t(H)}},initializeClickTracker:function(E){i("html").on("click","["+o+"], ["+y+"]",function(I){var H=i(this),G=H.attr(y)||H.attr(o),J=H.attr(y)?true:false,F=H.attr("href");if(J){I.preventDefault()}Curalate.tracking.recordClick(E,G,J,F);return true})},initializeDwellTracker:function(F){var E=i("html");E.on("mouseenter","["+A+"]",function(){var I=i(this),H=I.attr(A),G=new v(F,H);t(G);I.data("generated-event",G)});E.on("mouseleave","["+A+"]",function(){var H=i(this),G=H.data("generated-event");if(!G){return}c(G);H.removeData("generated-event")})},initializeVisibilityTracker:function(J,G,I,H){var F=document.getElementById(J),E;if(x){if(window.removeEventListener){window.removeEventListener("focus",x,true);window.removeEventListener("blur",p,true);for(E=0;E<f.length;E++){window.removeEventListener(f[E],x)}}else{document.detachEvent("onfocusin",x);document.detachEvent("onfocusout",p);for(E=0;E<d.length;E++){window.detachEvent(d[E],x)}}if(document.visibilityState){document.removeEventListener("visibilitychange",k,true)}else{if(document.webkitVisibilityState){document.removeEventListener("webkitvisibilitychange",k,true)}else{if(document.mozVisibilityState){document.removeEventListener("mozvisibilitychange",k,true)}else{if(document.msVisibilityState){document.removeEventListener("msvisibilitychange",k,true)}}}}p()}x=function(){var K=l(F);if(K&&!u){u=new b(G,I);t(u)}else{if(!K&&u){c(u);u=null}}};if(window.addEventListener){for(E=0;E<f.length;E++){window.addEventListener(f[E],x)}}else{if(window.attachEvent){for(E=0;E<d.length;E++){window.attachEvent(d[E],x)}}}if(document.visibilityState){k=function(){if(document.hidden){p()}else{x()}};document.addEventListener("visibilitychange",k,true)}else{if(document.webkitVisibilityState){k=function(){if(document.webkitHidden){p()}else{x()}};document.addEventListener("webkitvisibilitychange",k,true)}else{if(document.mozVisibilityState){k=function(){if(document.mozHidden){p()}else{x()}};document.addEventListener("mozvisibilitychange",k,true)}else{if(document.msVisibilityState){k=function(){if(document.msHidden){p()}else{x()}};document.addEventListener("msvisibilitychange",k,true)}}}}if(window.addEventListener){window.addEventListener("focus",x,true);window.addEventListener("blur",p,true)}else{document.attachEvent("onfocusin",x);document.attachEvent("onfocusout",p)}if(H){x()}},requestId:Curalate.generateGuid()}}(window.jQuery));var Curalate=Curalate||{};(function(){var g=50,c=5000,a="curalate-photo-picker",e=false,b=function(k){var j=[],i,h=function(l){return l.replace(/\\/g,"\\\\").replace(/:/g,"\\:").replace(/,/g,"\\,")};for(i in k){if(!k.hasOwnProperty(i)){continue}if(k[i]&&k[i].trim().length>0){j.push(h(i)+":"+h(k[i]))}else{j.push(h(i))}}return j.join(",")},f=function(h){if(!h){throw new Error("Configuration object must be passed as a parameter.")}if(h.code){this.code=h.code}else{throw new Error("Configuration object is missing the value 'code'")}if(h.productId){this.productId=h.productId}if(h.aviary){this.aviary={label:h.aviary.label,tools:h.aviary.tools,initTool:h.aviary.initTool}}},d=function(i){var h;if(i.data==="close-photo-picker"){h=document.getElementById(a);h.parentNode.removeChild(h)}};f.prototype.retrieve=function(m){var i,l,n="cb_"+Math.floor(Math.random()*1000000),o=new Curalate.Promise(),h=false,k,j;m=m||{};i=m.limit||g;if(this.code){l=Curalate.getProtocol()+"//"+Curalate.config.DOMAIN+"/"+Curalate.config.API_VERSION+"/reels/"+this.code+".jsonp"}else{throw new Error("Unable to identify this Fan Reel")}l+="?callback=Curalate.FanReel.callbacks."+n;l+="&limit="+i;if(m.bookmark){l+="&bookmark="+m.bookmark}if(this.productId){l+="&productId="+encodeURIComponent(this.productId)}if(m.sortValue){l+="&sort="+encodeURIComponent(m.sortValue)}if(m.filters){l+="&filters="+encodeURIComponent(b(m.filters))}k=setTimeout(function(){h=true;o.onFailureHandler("Request timed out")},c);Curalate.FanReel.callbacks[n]=function(p){if(h){return}clearTimeout(k);if(!p.errorMessage){o.onSuccessHandler(p)}else{o.onFailureHandler(p.errorMessage)}};j=document.createElement("script");j.setAttribute("type","text/javascript");j.setAttribute("src",l);document.body.appendChild(j);return o};f.prototype.retrieveItemById=function(l){var k,m="cb_"+Math.floor(Math.random()*1000000),n=new Curalate.Promise(),h=false,j,i;l=l||{};if(this.code){k=Curalate.getProtocol()+"//"+Curalate.config.DOMAIN+"/"+Curalate.config.API_VERSION+"/reels/"+this.code+"/"+l.id+".jsonp"}else{throw new Error("Unable to identify this Fan Reel")}k+="?callback=Curalate.FanReel.callbacks."+m;if(l.productId){k+="&productId="+encodeURIComponent(l.productId)}if(l.sortValue){k+="&sort="+encodeURIComponent(l.sortValue)}if(l.filters){k+="&filters="+encodeURIComponent(b(l.filters))}j=setTimeout(function(){h=true;n.onFailureHandler("Request timed out")},c);Curalate.FanReel.callbacks[m]=function(o){if(h){return}clearTimeout(j);if(!o.errorMessage){n.onSuccessHandler(o)}else{n.onFailureHandler(o.errorMessage)}};i=document.createElement("script");i.setAttribute("type","text/javascript");i.setAttribute("src",k);document.body.appendChild(i);return n};f.prototype.showPhotoPicker=function(){var j,i,h;if(Curalate.isMobileRequest()){h=Curalate.getProtocol()+"//"+Curalate.config.DOMAIN+"/"+Curalate.config.API_VERSION+"/reels/"+this.code+"/photo-picker-mobile";if(this.productId){h+="?productId="+this.productId}window.open(h,"","")}else{h=Curalate.getProtocol()+"//"+Curalate.config.DOMAIN+"/"+Curalate.config.API_VERSION+"/reels/"+this.code+"/photo-picker?source="+encodeURIComponent(window.location.href);if(this.productId){h+="&productId="+this.productId}if(this.aviary){if(this.aviary.label){h+="&aviaryLabel="+this.aviary.label}if(this.aviary.tools){h+="&aviaryTools="+this.aviary.tools}if(this.aviary.initTool){h+="&aviaryInitTool="+this.aviary.initTool}}if(!e){XD.receiveMessage(d,Curalate.getProtocol()+"//"+Curalate.config.DOMAIN);e=true}i=document.createElement("iframe");i.id=a;i.src=h;i.scrolling="no";i.frameBorder="0";i.allowTransparency="true";i.style.cssText="border: 0 none; overflow: hidden; position: fixed; margin: 0; padding: 0; top: 0; left: 0; right: 0; bottom: 0; height: 100%; width: 100%; z-index: 1040;";document.body.appendChild(i)}};f.callbacks={};if(!Curalate.FanReel){Curalate.FanReel=f}}());var Curalate=window.Curalate||{};Curalate.FanReels=Curalate.FanReels||{};Curalate.Backbone=Backbone.noConflict();Curalate._=_.noConflict();Curalate.FanReels.parseFilters=function(d){var a=Curalate._,e="TAGS",c={},b;a.each(d,function(g,f){if(f.toUpperCase()===e&&typeof g==="object"){for(b=0;b<g.length;b++){if(c[g[b]]==null){c[g[b]]=""}}}else{if(f.toUpperCase()===e&&c[g]==null){c[g]=""}else{if(c[g]==null){c[f]=g}}}});return c};(function(h,j,f){var a="large";var d=window.attachEvent?true:false;var i=h.Model.extend();var c=h.Collection.extend({model:i,limit:100,bookmark:null,filters:{},productId:null,initialize:function(m,l){if(!l){throw new Error("A FanReel identifier must be passed.")}if(l.code){this.reel=new Curalate.FanReel({code:l.code,filters:l.filters})}else{throw new Error("A FanReel code must be present.")}j.extend(this,{limit:l.limit,bookmark:l.bookmark,productId:l.productId});if(this.productId){this.reel.productId=this.productId}},parse:function(l){return l.items},sync:function(q,o,n){var l=j.bind(n.complete,this),p=j.bind(n.success,this),m=j.bind(n.error,this);this.reel.retrieve({bookmark:this.bookmark,filters:j.isEmpty(this.filters)?null:this.filters,sortValue:this.sortValue,limit:this.limit}).success(function(r){l(n);p(r)}).failure(function(r){l(n);m(r)})},retrieve:function(m){m=m?j.clone(m):{};var o=m.success,l=m.complete,n=this;m.complete=function(p){if(l){l(p)}n.trigger("fetch:complete")};m.success=function(q,p){n.trigger("retrieve");if(o){o(q,p,m)}n.bookmark=p.bookmark};m.remove=false;this.trigger("fetch:begin");return h.Collection.prototype.fetch.apply(this,[m])},fetch:function(l){return this.retrieve(l)},fetchMore:function(l){if(this.bookmark!=null){this.retrieve(l)}else{if(l.complete){setTimeout(l.complete,1)}}}});var e=h.View.extend({el:f("#curalate-fan-reel"),_super:h.View.prototype,hashPrefix:"crl8-",events:{},initialize:function(l){var m=this,n=f(document);n.on("click","#curalate-upload-photos",function(o){m._openPhotoPicker()});if(l){this.collection.filters=Curalate.FanReels.parseFilters(l.filters)}this._initializeSortTracking(l);this._initializeFilterTracking(l)},_initializeSortTracking:function(n){var o=this,l=(n.navigation&&n.navigation.sortSelector)?n.navigation.sortSelector:"[data-curalate-sort]";var m=function(r){if(r){var q=f(r).attr("data-curalate-sort");if(q&&q!==o.collection.sort){o.collection.bookmark=null;o.collection.sortValue=q;o.collection.fetch({reset:true})}}};var p=f(l);switch(p.prop("tagName")){case"SELECT":p.change(function(){var q=f(this);q.attr("data-curalate-sort",q.find("option:selected").attr("data-curalate-sort-value"));m(this)});break;default:p.each(function(q,r){f(r).click(function(){m(r)})})}},_initializeFilterTracking:function(l){var p=this,s=(l.navigation&&l.navigation.filter)?l.navigation.filter:"[data-curalate-filter]",o=(l.navigation&&l.navigation.filterValue)?l.navigation.filterValue:"[data-curalate-filter-value]";var m=function(){p.collection.bookmark=null;p.collection.fetch({reset:true})};var n=function(t,v,u){if(u){delete p.collection.filters[t]}else{p.collection.filters[t]=v}m()};var q=function(t){delete p.collection.filters[t]};var r=function(t){q(t);m()};j.each(f(s),function(w){var v=f(w);var u=v.attr("data-curalate-filter"),x=v.find(o),t={el:v,tagName:v.prop("tagName"),filterSelector:null};if(u&&x.length>0){switch(t.tagName){case"SELECT":v.change(function(){if(v.find("option:selected").attr("data-curalate-filter-value").trim().length===0){r(u)}else{n(u,v.find("option:selected").attr("data-curalate-filter-value"),false)}});break;default:x.click(function(){var z=f(this),y;if(z.hasClass("curalate-active")){return}y=z.attr("data-curalate-filter-value").trim().length===0;n(u,z.attr("data-curalate-filter-value"),y);v.find(".curalate-active").removeClass("curalate-active");z.addClass("curalate-active")})}}else{if(!u&&x.length>0){switch(t.tagName){case"SELECT":v.change(function(){j.each(x,function(y){q(f(y).attr("data-curalate-filter-value"))});if(v.find("option:selected").attr("data-curalate-filter-value").trim().length===0){m()}else{n(v.find("option:selected").attr("data-curalate-filter-value"),null,false)}});break;default:x.click(function(){var y=f(this);if(y.hasClass("curalate-active")){return}j.each(x,function(z){q(f(z).attr("data-curalate-filter-value"))});if(y.attr("data-curalate-filter-value").trim().length===0){m()}else{n(y.attr("data-curalate-filter-value"),null,v.hasClass(".curalate-active"))}v.find(".curalate-active").removeClass("curalate-active");y.addClass("curalate-active")})}}else{if(u){v.click(function(){var y=f(this);n(u,y.attr("data-curalate-filter-value"),y.hasClass(".curalate-active"));y.toggleClass("curalate-active")})}else{if(!u){v.click(function(){n(u,null,v.hasClass(".curalate-active"));f(this).toggleClass("curalate-active")})}}}}})},_openPhotoPicker:function(){this.collection.reel.showPhotoPicker()}});var k=h.View.extend({className:"product",templateName:"product-template",_super:h.View.prototype,hashprefix:"crl8-",initialize:function(l,m){this.product=l;this.itemId=m},render:function(){this.$el.html(this.template(this.product.model));return this},template:function(q){var q=q||this.product.model,m=f("[data-"+this.templateName+"]").first().clone().removeClass("curalate-hidden"),l=m.find("[data-curalate-product-id]"),r=m.find("[data-curalate-product-name]"),o=m.find("[data-curalate-product-url]"),p=m.find("[data-curalate-product-description]"),n=m.find("[data-curalate-product-image]"),s=m.find("[data-curalate-product-price]");if(f.isEmptyObject(q)){return m}j.each(l,function(u,t){f(u).text(q?q.id:"")},this);j.each(r,function(u,t){f(u).text(q?q.name:"")},this);j.each(o,function(v,t){var u=f(v);switch(v.nodeName.toUpperCase()){case"A":if(q){u.attr("href",q.link);u.attr("data-tracking-click-deferred","product-"+this.itemId)}else{u.attr("href","javascript:void(0);")}break;default:break}},this);j.each(p,function(u,t){f(u).text(q?q.description||"":"")},this);j.each(n,function(v,t){var u=f(v);if(q&&q.image){switch(v.nodeName.toUpperCase()){case"IMG":u.attr("src",q.image);break;case"DIV":u.css("background-image","url("+q.image+");");break}}},this);j.each(s,function(u,t){f(u).text(q?q.price:"")},this);return m}});var g=h.View.extend({className:"item",templateName:"item-template",_super:h.View.prototype,hashPrefix:"crl8-",animate:true,isAnimationEnabled:function(){return this.animate&&!d},events:{"mouseover [data-curalate-image]":"showImageOverlay",mouseleave:"hideImageOverlay","click [data-curalate-video-ctrl]":"playPauseVideo",'mouseleave [data-curalate-video-onleave="stop"]':"stopVideo",'mouseleave [data-curalate-video-onleave="pause"]':"pauseVideo"},initialize:function(l){if(l.templateName){this.templateName=l.templateName}},formatElapsedTime:function(n){var l=Math.floor(new Date().valueOf()/1000),q=l-n,o=60,m=o*60,s=m*24,p=s*7,r=p*52;if(q<o){return"Less than a minute ago"}else{if(q<(o*2)){return"1 minute ago"}else{if(q<m){return parseInt(q/o,10)+" minutes ago"}else{if(q<(m*2)){return"1 hour ago"}else{if(q<s){return parseInt(q/m,10)+" hours ago"}else{if(q<(s*2)){return"1 day ago"}else{if(q<p){return parseInt(q/s,10)+" days ago"}else{if(q<(p*2)){return"1 week ago"}else{if(q<r){return parseInt(q/p,10)+" weeks ago"}else{if(q<(r*2)){return"1 year ago"}else{return parseInt(q/r,10)+" years ago"}}}}}}}}}}},render:function(){this.$el.html(this.template(this.model.attributes));return this},template:function(w){var w=w||this.model.attributes,r=f("[data-"+this.templateName+"]").first().clone().removeClass("curalate-hidden"),q=r.find("[data-curalate-image]"),A=r.find("[data-curalate-video]"),p=r.find("[data-curalate-video-ctrl]"),F=r.find("[data-curalate-avatar]"),G=r.find("[data-curalate-user-full-name-or-username]"),u=r.find("[data-curalate-user-full-name]"),I=r.find("[data-curalate-username]"),v=r.find("[data-curalate-caption]"),B=r.find("[data-curalate-comments]"),J=r.find("[data-curalate-likes]"),s=r.find("[data-curalate-repins]"),l=r.find("[data-curalate-item-url]"),H=r.find("[data-curalate-product-id]"),m=r.find("[data-curalate-product-name]"),o=r.find("[data-curalate-product-url]"),z=r.find("[data-curalate-product-description]"),E=r.find("[data-curalate-product-image]"),t=r.find("[data-curalate-product-price]"),x=r.find("[data-curalate-products]"),n=r.find("[data-curalate-posted-elapsed]"),D=r.find("[data-curalate-facebook-share]"),C=r.find("[data-curalate-twitter-share]"),y=r.find("[data-curalate-pinterest-share]");if(f.isEmptyObject(w)){return r}this.$products=x;w.product=w.products[0];j.each(q,function(P,L){var N=f(P),M=N.attr("data-curalate-image"),K=w.photo[M],O;if(this.resize){N.css({height:K.height})}if(this.isAnimationEnabled()){O=j.uniqueId("crl8-");N.css({visibility:"hidden",opacity:0}).attr("id",O)}switch(P.nodeName.toUpperCase()){case"IMG":N.attr("src",K.url);break;case"DIV":N.css("background-image","url("+K.url+");");break;default:break}if(this.isAnimationEnabled()){N.load(function(){f("#"+O).css("visibility","visible").fadeTo("fast",1).removeAttr("id")}).each(function(){if(this.complete){f(this).load()}})}},this);j.each(A,function(Q,N){var P=f(Q),M,O=P.siblings("[data-curalate-image]").first().attr("data-curalate-image"),L=w.photo[O],K=P.attr("data-curalate-video"),R=w.video?w.video[K]:null;if(R&&Q.nodeName==="VIDEO"){M=f("<source />").attr({src:R.url,type:"video/mp4",preload:"metadata"}).css({"max-width":L.width,"max-height":L.height});P.append(M)}},this);j.each(p,function(L,K){if(!w.video){f(L).hide()}},this);j.each(F,function(P,L){var N=f(P),M=N.data("curalate-avatar"),K=w.user[M],O;if(K){if(this.isAnimationEnabled()){O=j.uniqueId("crl8-");N.css({visibility:"hidden",opacity:0}).attr("id",O)}switch(P.nodeName.toUpperCase()){case"IMG":N.attr("src",K.url);break;case"DIV":N.css("background-image",K.url);break;default:break}if(this.isAnimationEnabled()){N.load(function(){f("#"+O).css("visibility","visible").fadeTo("fast",1).removeAttr("id")}).each(function(){if(this.complete){f(this).load()}})}}else{N.remove()}},this);j.each(u,function(L,K){f(L).text(w.user.display_name||"")},this);j.each(G,function(L,K){f(L).text(w.user.display_name||w.user.username||"")},this);j.each(I,function(L,K){f(L).text(w.user.username||"")},this);j.each(v,function(L,K){f(L).text(w.caption||"")},this);j.each(B,function(L,K){f(L).text(w.comment_count||0)},this);j.each(J,function(L,K){f(L).text(w.like_count||0)},this);j.each(s,function(L,K){f(L).text(w.repin_count||0)},this);j.each(l,function(L,K){switch(L.nodeName.toUpperCase()){case"A":f(L).attr("href",w.url);break;default:break}},this);j.each(H,function(L,K){f(L).text(w.product?w.product.id:"")},this);j.each(m,function(L,K){f(L).text(w.product?w.product.name:"")},this);j.each(o,function(L,K){switch(L.nodeName.toUpperCase()){case"A":if(w.product){f(L).attr("href",w.product.link);f(L).attr("data-tracking-click-deferred","product-"+w.id)}else{f(L).attr("href","javascript:void(0);")}break;default:break}},this);j.each(D,function(L,K){f(L).attr("data-tracking-click","facebook-share-click-item-"+w.id)},this);j.each(C,function(L,K){f(L).attr("data-tracking-click","twitter-share-click-item-"+w.id)},this);j.each(y,function(L,K){f(L).attr("data-tracking-click","pinterest-share-click-item-"+w.id)},this);j.each(x,function(L,K){this.addProducts(w.products,w.id)},this);j.each(z,function(L,K){f(L).text(w.product?w.product.description||"":"")},this);j.each(E,function(L,K){if(w.product&&w.product.image){switch(L.nodeName.toUpperCase()){case"IMG":f(L).attr("src",w.product.image);break;case"DIV":f(L).css("background-image","url("+w.product.image+");");break}}},this);j.each(t,function(L,K){f(L).text(w.product?w.product.price:"")},this);j.each(n,function(L,K){f(L).text(w.timestamp?this.formatElapsedTime(w.timestamp):"")},this);return r},addProduct:function(m,n){var l=new k({model:m,id:"product-"+m.id},n);this.$products.append(l.render().el)},addProducts:function(l,m){j.each(l,function(n){this.addProduct(n,m)},this)},showImageOverlay:function(){if(this.hasModal){this.$("[data-curalate-image-overlay]").stop(true,true).fadeTo("fast",0.3)}},hideImageOverlay:function(){if(this.hasModal){this.$("[data-curalate-image-overlay]").stop(false,true).fadeOut(100)}},playPauseVideo:function(q){var p=this,t=p.$el,o=p.activeVideo,s=f(q.target).attr("data-curalate-video-ctrl"),n=s.indexOf("play")>-1,u=s.indexOf("pause")>-1,m=t.find("[data-curalate-video]").first(),l=m?m.get(0):null,r=m.siblings("[data-curalate-image]").first();q.preventDefault();q.stopPropagation();if(n&&!o&&l&&l.readyState){p.activeVideo={"$videoElmt":m,video:l,"$imageElmt":r};r.hide();m.show();t.addClass("curalate-video-active").removeClass("curalate-video-paused");l.play();l.addEventListener("ended",function(){p.stopVideo()})}else{if(n&&o&&t.hasClass("curalate-video-paused")){o.video.play();t.removeClass("curalate-video-paused")}else{if(u&&o&&!t.hasClass("curalate-video-paused")){o.video.pause();t.addClass("curalate-video-paused")}}}},pauseVideo:function(){var l=this.$el,m=this.activeVideo;if(m){m.video.pause();l.addClass("curalate-video-paused")}},stopVideo:function(){var m=this,l=this.$el,n=this.activeVideo;if(n){n.video.pause();n.video.load();n.$videoElmt.hide();n.$imageElmt.show();l.removeClass("curalate-video-active curalate-video-paused");m.activeVideo=null}}});var b=g.extend({templateName:"photo-modal-template",_super:g.prototype,hashPrefix:"crl8-",forceRedirectToGallery:document.referrer.indexOf(this.hashPrefix)===-1,events:j.extend(g.prototype.events,{"click [data-curalate-modal-next-page]":"nextPhoto","click [data-curalate-modal-previous-page]":"previousPhoto","click .curalate-modal-close":"closeModal","click .curalate-facebook-icon":"shareOnFacebook","click .curalate-twitter-icon":"shareOnTwitter","click .curalate-pinterest-icon":"shareOnPinterest"}),animate:true,initialize:function(l){this._super.initialize.apply(this,arguments);if(l.code){this.reel=new Curalate.FanReel({code:l.code})}else{throw new Error("You must provide a FanReel code for a modal view.")}f(window).on("hashchange",j.bind(function(m){if(!window.location.hash.length||window.location.hash.substring(1)===this.hashPrefix+"gallery"){this.closeModal(m,true)}},this));f(".curalate-overlay").on("click",j.bind(function(m){if(f(m.target).hasClass("curalate-overlay")){this.closeModal(m,false)}},this));if(l.productId){this.productId=l.productId}if(l.filters){this.filters=l.filters}},_success:function(l){this.model=new i(l.item);this.next=l.next;this.previous=l.prev;if(l.item){this.render().show()}},_failure:function(l){throw new Error(l)},load:function(o,l,n){var m=this;this.sortValue=l;this.filters=n;this.reel.retrieveItemById({id:o,productId:this.productId,sortValue:this.sortValue,filters:this.filters}).success(function(p){m._success.call(m,p)}).failure(function(p){m._failure.call(m,p)})},show:function(){var l=this;this.$el.show().addClass("active").children().addClass("active")},render:function(){this.$el.html(this.template(this.model.attributes));return this},template:function(m){var q=this,p=this._super.template.apply(this,arguments),r=new Curalate.Spinner().spin(),l=p.find("[data-curalate-image]"),o=p.find("[data-curalate-video]"),n=window.location.href.replace(window.location.hash,"");if(f.isEmptyObject(m)){return p.html()}l.css("height",m.photo[l.data("curalate-image")||a].height);if(this.$el.hasClass("active")){p.addClass("active").children().addClass("active")}if(window.location.hash==""&&window.history.replaceState){window.history.replaceState({id:"gallery"},null,n+"#"+this.hashPrefix+"gallery")}if(!window.history.replaceState){}else{if(window.location.hash.indexOf(this.hashPrefix+"gallery")!=-1){window.history.pushState({id:m.id},null,n+"#"+this.hashPrefix+m.id)}else{window.history.replaceState({id:m.id},null,n+"#"+this.hashPrefix+m.id)}}p.find("[data-curalate-spinner]").append(r.spin().el);if(this.next){p.find("[data-curalate-modal-next-page]").show().attr("data-tracking-click","item-"+this.next)}else{p.find("[data-curalate-modal-next-page]").hide()}if(this.previous){p.find("[data-curalate-modal-previous-page]").show().attr("data-tracking-click","item-"+this.previous)}else{p.find("[data-curalate-modal-previous-page]").hide()}l.load(function(){q.$el.find("[data-curalate-spinner]").empty();r.stop()}).each(function(){if(this.complete){f(this).load()}});return p.html()},nextPhoto:function(l){l.preventDefault();if(this.next){this.load(this.next,this.sortValue,this.filters)}},previousPhoto:function(l){l.preventDefault();if(this.previous){this.load(this.previous,this.sortValue,this.filters)}},_openShareWindow:function(l,m){l+="?"+f.param(m);window.open(l,"_blank","width=450,height=300")},shareOnFacebook:function(){var l="https://www.facebook.com/sharer/sharer.php",m={s:100,"p[title]":this.$el.find("[data-curalate-caption]").text(),"p[images][0]":"https:"+this.$el.find("[data-curalate-image]").attr("src"),"p[summary]":"","p[url]":window.location.href};this._openShareWindow(l,m)},shareOnTwitter:function(){var l="https://twitter.com/share",m={source:"webclient",text:this.$el.find("[data-curalate-caption]").text()+" https:"+this.$el.find("[data-curalate-image]").attr("src")};this._openShareWindow(l,m)},shareOnPinterest:function(){var l="http://pinterest.com/pin/create/button/",m={media:"https:"+this.$el.find("[data-curalate-image]").attr("src"),description:caption=this.$el.find("[data-curalate-caption]").text(),ref:window.location.href,url:window.location.href};this._openShareWindow(l,m)},closeModal:function(m,l){if(f(m.target)[0]===f(m.currentTarget)[0]){f(".curalate-photo-detail-container").removeClass("active");setTimeout(function(){f(".curalate-overlay").removeClass("active").hide()},500)}if(!l&&window.history.replaceState){if(this.forceRedirectToGallery){this.forceRedirectToGallery=false;window.history.replaceState({id:"gallery"},null,window.location.href.replace(window.location.hash,"")+"#"+this.hashPrefix+"gallery")}else{window.history.back()}}},});j.extend(Curalate.FanReels,{Photo:i,Photos:c,BaseView:e,DetailModal:b,BaseItemView:g,ProductView:k})})(Curalate.Backbone,Curalate._,jQuery);var Curalate=window.Curalate||{};Curalate.FanReels=Curalate.FanReels||{};Curalate.FanReels.Gallery=Curalate.FanReels.Gallery||{};(function(h,b,d){var c=window.location.hash,f=new Curalate.Spinner().spin(),a;var g=Curalate.FanReels.BaseItemView.extend({className:"curalate-thumbnail",templateName:"curalate-photo-template",_super:Curalate.FanReels.BaseItemView.prototype,events:b.extend(Curalate.FanReels.BaseItemView.prototype.events,{"click [data-curalate-image-overlay]":"showPhotoDetail","click [data-curalate-image]":"showPhotoDetail"}),initialize:function(i){this._super.initialize.apply(this,arguments);this.hasModal=true;this.$el.attr({"data-tracking-hover":"item-"+this.model.get("id"),"data-tracking-click":"item-"+this.model.get("id")});this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"destroy",this.remove)},template:function(i){return d(this._super.template.apply(this,arguments)).html()},showPhotoDetail:function(){if(this.hasModal){a.load(this.model.get("id"),this.model.collection.sortValue,this.model.collection.filters)}}});var e=Curalate.FanReels.BaseView.extend({scrollPadding:0,initialize:function(i){var j=this,k=d(window),l=false;Curalate.FanReels.BaseView.prototype.initialize.apply(this,arguments);b.extend(this,{hasModal:i.hasModal,navigation:{loadMore:i.navigation&&i.navigation.loadMore?i.navigation.loadMore:j.$("[data-curalate-load-more]"),infiniteScroll:i.navigation&&i.navigation.infiniteScroll!=null?i.navigation.infiniteScroll:true}});this.$pictures=this.$(".curalate-thumbs");this.listenTo(this.collection,"add",this.addPhoto);this.listenTo(this.collection,"reset",this.addPhotos);this.$el.attr("data-tracking-hover","");if(this.navigation.loadMore){this.navigation.loadMore.click(function(){if(!l){l=true;j.loadMore().once("fetch:complete",function(){l=false})}})}if(this.navigation.infiniteScroll){k.on("scroll",function(){var m=k.scrollTop()+k.height(),n=j.$el.position().top+j.$el.outerHeight();if(m+j.scrollPadding>=n&&!l){l=true;j.loadMore().once("fetch:complete",function(){l=false})}})}this.collection.fetch()},addPhoto:function(j){var i=new Curalate.FanReels.Thumbnail({model:j,id:"photo-"+j.id});this.$pictures.append(i.render().el)},addPhotos:function(i){this.$pictures.empty();i.each(this.addPhoto,this)},loadMore:function(){var i=this;this.$(".curalate-lazy-load-spinner").append(f.spin().el);this.collection.fetchMore({complete:function(){f.stop();i.trigger("fetch:complete")}});return this}});b.extend(Curalate.FanReels,{Thumbnail:g,Gallery:e});Curalate.FanReels.Gallery.defaultOptions={pageSize:3};Curalate.FanReels.Gallery.load=function(l){var k,j,i=Curalate.FanReels.DetailModal.prototype.hashPrefix;b.defaults(l,this.defaultOptions);k=4*l.pageSize;Curalate.FanReels.PhotosCollection=new Curalate.FanReels.Photos([],{code:l.code,productId:l.productId,filters:l.filters,limit:k});a=new Curalate.FanReels.DetailModal({el:d(".curalate-overlay"),code:l.code,productId:l.productId});Curalate.tracking.recordImpression("fr."+l.code);Curalate.tracking.initializeClickTracker("fr."+l.code);Curalate.tracking.initializeDwellTracker("fr."+l.code);Curalate.tracking.initializeVisibilityTracker("curalate-fan-reel","fr."+l.code);if(c.length&&c.indexOf(i)===1&&c.indexOf("gallery")===-1){j=c.substr(i.length+1);a.load(j,null,Curalate.FanReels.parseFilters(l.filters))}return new Curalate.FanReels.Gallery({collection:Curalate.FanReels.PhotosCollection,pageSize:l.pageSize,navigation:l.navigation,filters:l.filters})}})(Curalate.Backbone,Curalate._,jQuery);